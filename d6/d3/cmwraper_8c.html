<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: cmwraper.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>cmwraper.c File Reference</h1><code>#include "<a class="el" href="../../d1/d4/edithive_8h-source.html">edithive.h</a>"</code><br>
<code>#include "nturtl.h"</code><br>
<code>#include "stdlib.h"</code><br>
<code>#include "stdio.h"</code><br>

<p>
<a href="../../d7/d2/cmwraper_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d3/cmwraper_8c.html#a9">DbgPrint</a> (IN PCH Format,...)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d3/cmwraper_8c.html#a10">MyCmpInitHiveFromFile</a> (IN PUNICODE_STRING <a class="el" href="../../d8/d1/hivestat_8c.html#a9">FileName</a>, OUT <a class="el" href="../../d9/d6/struct__CMHIVE.html">PCMHIVE</a> *CmHive, OUT PBOOLEAN Allocate)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d3/cmwraper_8c.html#a11">CmpLazyFlush</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d3/cmwraper_8c.html#a12">CmpFreeSecurityDescriptor</a> (IN <a class="el" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a> <a class="el" href="../../d7/d1/hivemap_8c.html#a0">Hive</a>, IN <a class="el" href="../../d0/d1/hivedata_8h.html#a49">HCELL_INDEX</a> <a class="el" href="../../d7/d0/cmdat2_8c.html#a24">Cell</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d3/cmwraper_8c.html#a13">CmpReportNotify</a> (UNICODE_STRING <a class="el" href="../../d9/d3/rules_8c.html#a6">Name</a>, <a class="el" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a> <a class="el" href="../../d7/d1/hivemap_8c.html#a0">Hive</a>, <a class="el" href="../../d0/d1/hivedata_8h.html#a49">HCELL_INDEX</a> <a class="el" href="../../d7/d0/cmdat2_8c.html#a24">Cell</a>, ULONG <a class="el" href="../../d5/d2/rtnotify_8c.html#a9">Filter</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d3/cmwraper_8c.html#a14">CmpLockRegistry</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d3/cmwraper_8c.html#a15">CmpTryLockRegistryExclusive</a> (IN BOOLEAN CanWait)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d3/cmwraper_8c.html#a16">CmpUnlockRegistry</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d3/cmwraper_8c.html#a17">CmpTestRegistryLock</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d3/cmwraper_8c.html#a18">CmpTestRegistryLockExclusive</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d3/cmwraper_8c.html#a19">KeReleaseMutex</a> (IN <a class="el" href="../../d3/d7/struct__KMUTANT.html">PKMUTEX</a> Mutex, IN BOOLEAN Wait)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d3/cmwraper_8c.html#a20">KeWaitForSingleObject</a> (IN PVOID Object, IN <a class="el" href="../../d4/d9/ke_8h.html#a53">KWAIT_REASON</a> WaitReason, IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> WaitMode, IN BOOLEAN Alertable, IN PLARGE_INTEGER Timeout OPTIONAL)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d3/cmwraper_8c.html#a21">CmpValidateHiveSecurityDescriptors</a> (IN <a class="el" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a> <a class="el" href="../../d7/d1/hivemap_8c.html#a0">Hive</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d3/cmwraper_8c.html#a22">KeBugCheck</a> (IN ULONG BugCheckCode)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d3/cmwraper_8c.html#a23">KeBugCheckEx</a> (IN ULONG BugCheckCode, IN ULONG Arg1, IN ULONG Arg2, IN ULONG Arg3, IN ULONG Arg4)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d3/cmwraper_8c.html#a24">KeQuerySystemTime</a> (OUT PLARGE_INTEGER SystemTime)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PVOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d3/cmwraper_8c.html#a25">ExAllocatePool</a> (IN <a class="el" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a> PoolType, IN ULONG NumberOfBytes)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d3/cmwraper_8c.html#a26">ExFreePool</a> (IN PVOID P)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d3/cmwraper_8c.html#a27">CmpWorkerCommand</a> (IN OUT <a class="el" href="../../d4/d3/struct__REGISTRY__COMMAND.html">PREGISTRY_COMMAND</a> Command)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d3/cmwraper_8c.html#a28">CmpLinkHiveToMaster</a> (PUNICODE_STRING LinkName, HANDLE RootDirectory, <a class="el" href="../../d9/d6/struct__CMHIVE.html">PCMHIVE</a> CmHive, BOOLEAN Allocate, PSECURITY_DESCRIPTOR SecurityDescriptor)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d3/cmwraper_8c.html#a29">CmpFileSetSize</a> (<a class="el" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a> <a class="el" href="../../d7/d1/hivemap_8c.html#a0">Hive</a>, ULONG FileType, ULONG FileSize)</td></tr>

<tr><td colspan=2><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d3/cmwraper_8c.html#a0">UsedStorage</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>CCHAR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d3/cmwraper_8c.html#a1">KiFindFirstSetRight</a> [256]</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d3/cmwraper_8c.html#a2">MmSizeOfPagedPoolInBytes</a> = 0xffffffff</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>GENERIC_MAPPING&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d3/cmwraper_8c.html#a3">CmpKeyMapping</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d3/cmwraper_8c.html#a4">CmpNoWrite</a> = FALSE</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d3/cmwraper_8c.html#a5">CmLogLevel</a> = 0</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d3/cmwraper_8c.html#a6">CmLogSelect</a> = 0</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d9/d6/struct__CMHIVE.html">PCMHIVE</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d3/cmwraper_8c.html#a7">CmpMasterHive</a> = NULL</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LIST_ENTRY&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d3/cmwraper_8c.html#a8">CmpHiveListHead</a></td></tr>

</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a29" doxytag="cmwraper.c::CmpFileSetSize" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN CmpFileSetSize           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Hive</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>FileType</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>FileSize</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00509">509</a> of file <a class="el" href="../../d7/d2/cmwraper_8c-source.html">cmwraper.c</a>.
<p>
References <a class="el" href="../../d2/d1/cmp_8h-source.html#l00246">CML_MAJOR</a>, <a class="el" href="../../d2/d1/cmp_8h-source.html#l00293">CMLOG</a>, <a class="el" href="../../d8/d2/cmwrapr_8c-source.html#l00227">CmpDoFileSetSize()</a>, <a class="el" href="../../d2/d1/cmp_8h-source.html#l00275">CMS_IO_ERROR</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d9/cmchek_8c-source.html#l00092">Hive</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d9/d0/cminit_8c-source.html#l00471">CmpInitializeHive()</a>, and <a class="el" href="../../d2/d2/cmsysini_8c-source.html#l00726">CmpInitializeHiveList()</a>.
<p>
<pre class="fragment"><div>00516                    :
00517 
00518     This routine sets <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> size of a <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a>.  It must not <span class="keywordflow">return</span> until
00519     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> size <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> guaranteed, therefore, <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> does a flush.
00520 
00521     It <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> environment specific.
00522 
00523     This routine will force execution to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> correct thread context.
00524 
00525 Arguments:
00526 
00527     <a class="code" href="../../d1/d0/cmchek_8c.html#a3">Hive</a> - <a class="code" href="../../d1/d0/cmchek_8c.html#a3">Hive</a> we are doing I/O <span class="keywordflow">for</span>
00528 
00529     FileType - which supporting <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a> to use
00530 
00531     FileSize - 32 bit value to set <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a>'s size to
00532 
00533 Return Value:
00534 
00535     <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> <span class="keywordflow">if</span> <a class="code" href="../../d8/d0/rtbatcr_8c.html#a1">failure</a>
00536     <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <span class="keywordflow">if</span> success
00537 
00538 --*/
00539 {
00540     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>    status;
00541 
00542     status = <a class="code" href="../../d7/d3/cmwrapr_8c.html#a13">CmpDoFileSetSize</a>(Hive, FileType, FileSize);
00543     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
00544         <a class="code" href="../../d1/d2/cmp_8h.html#a55">CMLOG</a>(CML_MAJOR, CMS_IO_ERROR) {
00545             KdPrint((<span class="stringliteral">"CmpFileSetSize:\n\t"</span>));
00546             KdPrint((<span class="stringliteral">"Failure: status = %08lx "</span>, status));
00547         }
00548         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00549     }
00550 
00551     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00552 }
}
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="cmwraper.c::CmpFreeSecurityDescriptor" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID CmpFreeSecurityDescriptor           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Hive</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d1/hivedata_8h.html#a49">HCELL_INDEX</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Cell</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00105">105</a> of file <a class="el" href="../../d7/d2/cmwraper_8c-source.html">cmwraper.c</a>.
<p>
Referenced by <a class="el" href="../../d4/d2/cmtredel_8c-source.html#l00140">CmpFreeKeyByCell()</a>, and <a class="el" href="../../d3/d2/cmtrecpy_8c-source.html#l01064">CmpFreeKeyValues()</a>.
<p>
<pre class="fragment"><div>00109 {
00110     <span class="keywordflow">return</span>;
00111 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="cmwraper.c::CmpLazyFlush" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID CmpLazyFlush           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00097">97</a> of file <a class="el" href="../../d7/d2/cmwraper_8c-source.html">cmwraper.c</a>.
<p>
Referenced by <a class="el" href="../../d2/d2/cmsysini_8c-source.html#l00726">CmpInitializeHiveList()</a>, <a class="el" href="../../d6/d2/cmworker_8c-source.html#l00461">CmpLazyFlushWorker()</a>, and <a class="el" href="../../d1/d1/hivesync_8c-source.html#l00270">HvMarkDirty()</a>.
<p>
<pre class="fragment"><div>00100 {
00101 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a28" doxytag="cmwraper.c::CmpLinkHiveToMaster" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS CmpLinkHiveToMaster           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap> <em>LinkName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>RootDirectory</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d9/d6/struct__CMHIVE.html">PCMHIVE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>CmHive</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>Allocate</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PSECURITY_DESCRIPTOR&nbsp;</td>
          <td class="mdname" nowrap> <em>SecurityDescriptor</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00496">496</a> of file <a class="el" href="../../d7/d2/cmwraper_8c-source.html">cmwraper.c</a>.
<p>
Referenced by <a class="el" href="../../d2/d2/cmsysini_8c-source.html#l00293">CmInitSystem1()</a>, <a class="el" href="../../d9/d8/cmapi_8c-source.html#l01901">CmLoadKey()</a>, <a class="el" href="../../d2/d2/cmsysini_8c-source.html#l00726">CmpInitializeHiveList()</a>, <a class="el" href="../../d2/d2/cmsysini_8c-source.html#l02022">CmpInitializeSystemHive()</a>, and <a class="el" href="../../d7/d1/cmsavres_8c-source.html#l00484">CmpLoadHiveVolatile()</a>.
<p>
<pre class="fragment"><div>00503 {
00504     <span class="keywordflow">return</span>( STATUS_SUCCESS );
00505 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a14" doxytag="cmwraper.c::CmpLockRegistry" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID CmpLockRegistry           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00124">124</a> of file <a class="el" href="../../d7/d2/cmwraper_8c-source.html">cmwraper.c</a>.
<p>
Referenced by <a class="el" href="../../d9/d8/cmapi_8c-source.html#l00285">CmEnumerateKey()</a>, <a class="el" href="../../d9/d8/cmapi_8c-source.html#l00416">CmEnumerateValueKey()</a>, <a class="el" href="../../d4/d9/cmclose_8c-source.html#l00028">CmpCloseKeyObject()</a>, <a class="el" href="../../d2/d0/cmdelete_8c-source.html#l00031">CmpDeleteKeyObject()</a>, <a class="el" href="../../d6/d2/cmworker_8c-source.html#l00461">CmpLazyFlushWorker()</a>, <a class="el" href="../../d6/d1/cmquery_8c-source.html#l00028">CmpQueryKeyName()</a>, <a class="el" href="../../d8/d1/cmse_8c-source.html#l00158">CmpSecurityMethod()</a>, <a class="el" href="../../d9/d8/cmapi_8c-source.html#l00647">CmQueryKey()</a>, <a class="el" href="../../d9/d8/cmapi_8c-source.html#l00940">CmQueryMultipleValueKey()</a>, <a class="el" href="../../d9/d8/cmapi_8c-source.html#l00804">CmQueryValueKey()</a>, <a class="el" href="../../d9/d8/cmapi_8c-source.html#l01087">CmSetValueKey()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l00904">NtFlushKey()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l01319">NtNotifyChangeMultipleKeys()</a>, and <a class="el" href="../../d8/d6/ntapi_8c-source.html#l01870">NtOpenKey()</a>.
<p>
<pre class="fragment"><div>00125 {
00126     <span class="keywordflow">return</span>;
00127 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="cmwraper.c::CmpReportNotify" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID CmpReportNotify           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">UNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap> <em>Name</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Hive</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d1/hivedata_8h.html#a49">HCELL_INDEX</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Cell</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Filter</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00114">114</a> of file <a class="el" href="../../d7/d2/cmwraper_8c-source.html">cmwraper.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d9/cmapi2_8c-source.html#l00031">CmDeleteKey()</a>, <a class="el" href="../../d9/d8/cmapi_8c-source.html#l00092">CmDeleteValueKey()</a>, <a class="el" href="../../d4/d1/cmparse2_8c-source.html#l00226">CmpDoCreateChild()</a>, <a class="el" href="../../d2/d2/cmsysini_8c-source.html#l01421">CmpLinkHiveToMaster()</a>, <a class="el" href="../../d8/d1/cmse_8c-source.html#l00158">CmpSecurityMethod()</a>, <a class="el" href="../../d7/d1/cmsavres_8c-source.html#l00097">CmRestoreKey()</a>, <a class="el" href="../../d9/d8/cmapi_8c-source.html#l01087">CmSetValueKey()</a>, and <a class="el" href="../../d8/d6/ntapi_8c-source.html#l03093">NtUnloadKey()</a>.
<p>
<pre class="fragment"><div>00120 {
00121 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a17" doxytag="cmwraper.c::CmpTestRegistryLock" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN CmpTestRegistryLock           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00144">144</a> of file <a class="el" href="../../d7/d2/cmwraper_8c-source.html">cmwraper.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>00145 {
00146     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00147 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a18" doxytag="cmwraper.c::CmpTestRegistryLockExclusive" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN CmpTestRegistryLockExclusive           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00150">150</a> of file <a class="el" href="../../d7/d2/cmwraper_8c-source.html">cmwraper.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>00151 {
00152     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00153 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a15" doxytag="cmwraper.c::CmpTryLockRegistryExclusive" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN CmpTryLockRegistryExclusive           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN BOOLEAN&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>CanWait</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00130">130</a> of file <a class="el" href="../../d7/d2/cmwraper_8c-source.html">cmwraper.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>00133 {
00134     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00135 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a16" doxytag="cmwraper.c::CmpUnlockRegistry" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID CmpUnlockRegistry           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00138">138</a> of file <a class="el" href="../../d7/d2/cmwraper_8c-source.html">cmwraper.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d9/cmapi2_8c-source.html#l00031">CmDeleteKey()</a>, <a class="el" href="../../d9/d8/cmapi_8c-source.html#l00092">CmDeleteValueKey()</a>, <a class="el" href="../../d9/d8/cmapi_8c-source.html#l00285">CmEnumerateKey()</a>, <a class="el" href="../../d9/d8/cmapi_8c-source.html#l00416">CmEnumerateValueKey()</a>, <a class="el" href="../../d2/d2/cmsysini_8c-source.html#l02169">CmGetSystemDriverList()</a>, <a class="el" href="../../d2/d2/cmsysini_8c-source.html#l00293">CmInitSystem1()</a>, <a class="el" href="../../d9/d8/cmapi_8c-source.html#l01901">CmLoadKey()</a>, <a class="el" href="../../d1/d1/cmnotify_8c-source.html#l01028">CmNotifyRunDown()</a>, <a class="el" href="../../d2/d2/cmsysini_8c-source.html#l03262">CmpCloneControlSet()</a>, <a class="el" href="../../d7/d1/hwprofil_8c-source.html#l01869">CmpCloneHwProfile()</a>, <a class="el" href="../../d4/d9/cmclose_8c-source.html#l00028">CmpCloseKeyObject()</a>, <a class="el" href="../../d2/d0/cmdelete_8c-source.html#l00031">CmpDeleteKeyObject()</a>, <a class="el" href="../../d9/d2/cmwrapr2_8c-source.html#l00045">CmpFileSetSize()</a>, <a class="el" href="../../d6/d2/cmworker_8c-source.html#l00461">CmpLazyFlushWorker()</a>, <a class="el" href="../../d7/d1/cmsavres_8c-source.html#l00484">CmpLoadHiveVolatile()</a>, <a class="el" href="../../d6/d1/cmquery_8c-source.html#l00028">CmpQueryKeyName()</a>, <a class="el" href="../../d7/d1/cmsavres_8c-source.html#l00731">CmpRefreshHive()</a>, <a class="el" href="../../d2/d2/cmsysini_8c-source.html#l03458">CmpSaveBootControlSet()</a>, <a class="el" href="../../d7/d1/cmsavres_8c-source.html#l01261">CmpSaveKeyByFileCopy()</a>, <a class="el" href="../../d8/d1/cmse_8c-source.html#l00158">CmpSecurityMethod()</a>, <a class="el" href="../../d9/d8/cmapi_8c-source.html#l00647">CmQueryKey()</a>, <a class="el" href="../../d9/d8/cmapi_8c-source.html#l00940">CmQueryMultipleValueKey()</a>, <a class="el" href="../../d9/d8/cmapi_8c-source.html#l00804">CmQueryValueKey()</a>, <a class="el" href="../../d9/d8/cmapi_8c-source.html#l02293">CmReplaceKey()</a>, <a class="el" href="../../d7/d1/cmsavres_8c-source.html#l00097">CmRestoreKey()</a>, <a class="el" href="../../d7/d1/cmsavres_8c-source.html#l00862">CmSaveKey()</a>, <a class="el" href="../../d7/d1/cmsavres_8c-source.html#l01047">CmSaveMergedKeys()</a>, <a class="el" href="../../d9/d8/cmapi_8c-source.html#l01841">CmSetLastWriteTimeKey()</a>, <a class="el" href="../../d9/d8/cmapi_8c-source.html#l01087">CmSetValueKey()</a>, <a class="el" href="../../d2/d2/cmsysini_8c-source.html#l03944">CmShutdownSystem()</a>, <a class="el" href="../../d9/d8/cmapi_8c-source.html#l02079">CmUnloadKey()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l00166">NtCreateKey()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l00904">NtFlushKey()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l00997">NtInitializeRegistry()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l01319">NtNotifyChangeMultipleKeys()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l01870">NtOpenKey()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l04090">NtQueryOpenSubKeys()</a>, and <a class="el" href="../../d8/d6/ntapi_8c-source.html#l03093">NtUnloadKey()</a>.
<p>
<pre class="fragment"><div>00140 {
00141 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a21" doxytag="cmwraper.c::CmpValidateHiveSecurityDescriptors" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN CmpValidateHiveSecurityDescriptors           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Hive</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00175">175</a> of file <a class="el" href="../../d7/d2/cmwraper_8c-source.html">cmwraper.c</a>.
<p>
References <a class="el" href="../../d1/d0/hivedata_8h-source.html#l00605">_HHIVE::BaseBlock</a>, <a class="el" href="../../d0/d0/cmdata_8h-source.html#l00523">_CM_KEY_SECURITY::Blink</a>, <a class="el" href="../../d2/d1/cmp_8h-source.html#l00248">CML_FLOW</a>, <a class="el" href="../../d2/d1/cmp_8h-source.html#l00246">CML_MAJOR</a>, <a class="el" href="../../d2/d1/cmp_8h-source.html#l00247">CML_MINOR</a>, <a class="el" href="../../d2/d1/cmp_8h-source.html#l00293">CMLOG</a>, <a class="el" href="../../d2/d1/cmp_8h-source.html#l00400">CmpDumpSecurityDescriptor</a>, <a class="el" href="../../d2/d1/cmp_8h-source.html#l00263">CMS_SEC</a>, <a class="el" href="../../d0/d0/cmdata_8h-source.html#l00526">_CM_KEY_SECURITY::Descriptor</a>, <a class="el" href="../../d0/d0/cmdata_8h-source.html#l00525">_CM_KEY_SECURITY::DescriptorLength</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d0/d0/cmdata_8h-source.html#l00522">_CM_KEY_SECURITY::Flink</a>, <a class="el" href="../../d1/d0/hivedata_8h-source.html#l00106">HCELL_INDEX</a>, <a class="el" href="../../d2/d9/cmchek_8c-source.html#l00092">Hive</a>, <a class="el" href="../../d7/d9/hive_8h-source.html#l00290">HvGetCell</a>, <a class="el" href="../../d9/d9/hivecell_8c-source.html#l01453">HvIsCellAllocated()</a>, <a class="el" href="../../d9/d0/cmdata_8h.html#a83">PCM_KEY_SECURITY</a>, <a class="el" href="../../d0/d0/cmdata_8h-source.html#l00524">_CM_KEY_SECURITY::ReferenceCount</a>, <a class="el" href="../../d1/d0/hivedata_8h-source.html#l00343">_HBASE_BLOCK::RootCell</a>, <a class="el" href="../../d0/d0/cmdata_8h-source.html#l00463">_CM_KEY_NODE::Security</a>, <a class="el" href="../../d2/d1/cmp_8h-source.html#l01555">SetUsed</a>, <a class="el" href="../../d3/d4/se_2capture_8c-source.html#l02414">SeValidSecurityDescriptor()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d2/d9/cmchek_8c-source.html#l00108">CmCheckRegistry()</a>.
<p>
<pre class="fragment"><div>00178 {
00179     <a class="code" href="../../d2/d5/struct__CM__KEY__NODE.html">PCM_KEY_NODE</a> RootNode;
00180     <a class="code" href="../../d6/d5/struct__CM__KEY__SECURITY.html">PCM_KEY_SECURITY</a> SecurityCell;
00181     <a class="code" href="../../d0/d1/hivedata_8h.html#a49">HCELL_INDEX</a> ListAnchor;
00182     <a class="code" href="../../d0/d1/hivedata_8h.html#a49">HCELL_INDEX</a> NextCell;
00183     <a class="code" href="../../d0/d1/hivedata_8h.html#a49">HCELL_INDEX</a> LastCell;
00184     BOOLEAN ValidHive = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00185 
00186     <a class="code" href="../../d1/d2/cmp_8h.html#a55">CMLOG</a>(CML_FLOW, CMS_SEC) {
00187         KdPrint((<span class="stringliteral">"CmpValidateHiveSecurityDescriptor: Hive = %lx\n"</span>,(ULONG)Hive));
00188     }
00189     RootNode = (<a class="code" href="../../d2/d5/struct__CM__KEY__NODE.html">PCM_KEY_NODE</a>) <a class="code" href="../../d6/d0/hive_8h.html#a12">HvGetCell</a>(Hive, <a class="code" href="../../d1/d0/cmchek_8c.html#a3">Hive</a>-&gt;<a class="code" href="../../d7/d7/struct__HHIVE.html#o8">BaseBlock</a>-&gt;<a class="code" href="../../d6/d4/struct__HBASE__BLOCK.html#o8">RootCell</a>);
00190     ListAnchor = NextCell = RootNode-&gt;u1.s1.<a class="code" href="../../d2/d5/struct__CM__KEY__NODE.html#o9">Security</a>;
00191 
00192     <span class="keywordflow">do</span> {
00193         SecurityCell = (<a class="code" href="../../d6/d5/struct__CM__KEY__SECURITY.html">PCM_KEY_SECURITY</a>) <a class="code" href="../../d6/d0/hive_8h.html#a12">HvGetCell</a>(Hive, NextCell);
00194         <span class="keywordflow">if</span> (NextCell != ListAnchor) {
00195             <span class="comment">//</span>
00196             <span class="comment">// Check to make sure that our Blink points to where we just</span>
00197             <span class="comment">// came from.</span>
00198             <span class="comment">//</span>
00199             <span class="keywordflow">if</span> (SecurityCell-&gt;<a class="code" href="../../d6/d5/struct__CM__KEY__SECURITY.html#o3">Blink</a> != LastCell) {
00200                 <a class="code" href="../../d1/d2/cmp_8h.html#a55">CMLOG</a>(CML_MAJOR, CMS_SEC) {
00201                     KdPrint((<span class="stringliteral">"  Invalid Blink (%ld) on security cell %ld\n"</span>,SecurityCell-&gt;<a class="code" href="../../d6/d5/struct__CM__KEY__SECURITY.html#o3">Blink</a>, NextCell));
00202                     KdPrint((<span class="stringliteral">"  should point to %ld\n"</span>, LastCell));
00203                 }
00204                 ValidHive = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00205             }
00206         }
00207         <a class="code" href="../../d1/d2/cmp_8h.html#a55">CMLOG</a>(CML_MINOR, CMS_SEC) {
00208             KdPrint((<span class="stringliteral">"CmpValidSD:  SD shared by %d nodes\n"</span>,SecurityCell-&gt;<a class="code" href="../../d6/d5/struct__CM__KEY__SECURITY.html#o4">ReferenceCount</a>));
00209         }
00210 <span class="comment">//        SetUsed(Hive, NextCell);</span>
00211         LastCell = NextCell;
00212         NextCell = SecurityCell-&gt;<a class="code" href="../../d6/d5/struct__CM__KEY__SECURITY.html#o2">Flink</a>;
00213     } <span class="keywordflow">while</span> ( NextCell != ListAnchor );
00214     <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00215 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a27" doxytag="cmwraper.c::CmpWorkerCommand" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS CmpWorkerCommand           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT <a class="el" href="../../d4/d3/struct__REGISTRY__COMMAND.html">PREGISTRY_COMMAND</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Command</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00323">323</a> of file <a class="el" href="../../d7/d2/cmwraper_8c-source.html">cmwraper.c</a>.
<p>
References <a class="el" href="../../d9/d8/cmapi_8c-source.html#l00564">CmFlushKey()</a>, <a class="el" href="../../d8/d2/cmwrapr_8c-source.html#l00227">CmpDoFileSetSize()</a>, <a class="el" href="../../d2/d1/cmp_8h-source.html#l00650">_CMHIVE::FileHandles</a>, <a class="el" href="../../d3/d1/rtload_8c-source.html#l00047">FileName</a>, <a class="el" href="../../d1/d0/hivedata_8h-source.html#l00572">HFILE_TYPE_MAX</a>, <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00405">MyCmpInitHiveFromFile()</a>, <a class="el" href="../../d6/d9/obclose_8c-source.html#l00037">NtClose()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d2/d1/cmp_8h-source.html#l00721">REG_CMD_FILE_SET_SIZE</a>, <a class="el" href="../../d2/d1/cmp_8h-source.html#l00720">REG_CMD_FLUSH_KEY</a>, <a class="el" href="../../d2/d1/cmp_8h-source.html#l00723">REG_CMD_HIVE_CLOSE</a>, <a class="el" href="../../d2/d1/cmp_8h-source.html#l00722">REG_CMD_HIVE_OPEN</a>, and <a class="el" href="../../d2/d1/cmp_8h-source.html#l00724">REG_CMD_SHUTDOWN</a>.
<p>
<pre class="fragment"><div>00329                    :
00330 
00331     This routine just encapsulates all <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> necessary synchronization <span class="keywordflow">for</span>
00332     sending a command to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> worker thread.
00333 
00334 Arguments:
00335 
00336     Command - Supplies a pointer to an initialized <a class="code" href="../../d4/d3/struct__REGISTRY__COMMAND.html">REGISTRY_COMMAND</a> structure
00337             which will be copied into <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> global communication structure.
00338 
00339 Return Value:
00340 
00341     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> = Command.Status
00342 
00343 --*/
00344 
00345 {
00346     <a class="code" href="../../d9/d6/struct__CMHIVE.html">PCMHIVE</a> CmHive;
00347     PUNICODE_STRING <a class="code" href="../../d2/d2/rtload_8c.html#a3">FileName</a>;
00348     ULONG i;
00349 
00350     <span class="keywordflow">switch</span> (Command-&gt;Command) {
00351 
00352         <span class="keywordflow">case</span> <a class="code" href="../../d1/d2/cmp_8h.html#a102">REG_CMD_FLUSH_KEY</a>:
00353             <span class="keywordflow">return</span> <a class="code" href="../../d1/d2/cmp_8h.html#a228">CmFlushKey</a>(Command-&gt;Hive, Command-&gt;Cell);
00354             <span class="keywordflow">break</span>;
00355 
00356         <span class="keywordflow">case</span> <a class="code" href="../../d1/d2/cmp_8h.html#a103">REG_CMD_FILE_SET_SIZE</a>:
00357             <span class="keywordflow">return</span> <a class="code" href="../../d7/d3/cmwrapr_8c.html#a13">CmpDoFileSetSize</a>(
00358                       Command-&gt;Hive,
00359                       Command-&gt;FileType,
00360                       Command-&gt;FileSize
00361                       );
00362             <span class="keywordflow">break</span>;
00363 
00364         <span class="keywordflow">case</span> <a class="code" href="../../d1/d2/cmp_8h.html#a104">REG_CMD_HIVE_OPEN</a>:
00365 
00366             <span class="comment">//</span>
00367             <span class="comment">// Open the file.</span>
00368             <span class="comment">//</span>
00369             <a class="code" href="../../d2/d2/rtload_8c.html#a3">FileName</a> = Command-&gt;FileAttributes-&gt;ObjectName;
00370 
00371             <span class="keywordflow">return</span> <a class="code" href="../../d6/d3/cmwraper_8c.html#a10">MyCmpInitHiveFromFile</a>(FileName,
00372                                          &amp;Command-&gt;CmHive,
00373                                          &amp;Command-&gt;Allocate);
00374 
00375             <span class="keywordflow">break</span>;
00376 
00377         <span class="keywordflow">case</span> <a class="code" href="../../d1/d2/cmp_8h.html#a105">REG_CMD_HIVE_CLOSE</a>:
00378 
00379             <span class="comment">//</span>
00380             <span class="comment">// Close the files associated with this hive.</span>
00381             <span class="comment">//</span>
00382             CmHive = Command-&gt;CmHive;
00383 
00384             <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="../../d0/d1/hivedata_8h.html#a42">HFILE_TYPE_MAX</a>; i++) {
00385                 <span class="keywordflow">if</span> (CmHive-&gt;<a class="code" href="../../d9/d6/struct__CMHIVE.html#o1">FileHandles</a>[i] != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00386                     <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(CmHive-&gt;<a class="code" href="../../d9/d6/struct__CMHIVE.html#o1">FileHandles</a>[i]);
00387                 }
00388             }
00389             <span class="keywordflow">return</span> STATUS_SUCCESS;
00390             <span class="keywordflow">break</span>;
00391 
00392         <span class="keywordflow">case</span> <a class="code" href="../../d1/d2/cmp_8h.html#a106">REG_CMD_SHUTDOWN</a>:
00393 
00394             <span class="comment">//</span>
00395             <span class="comment">// shut down the registry</span>
00396             <span class="comment">//</span>
00397             <span class="keywordflow">break</span>;
00398 
00399         <span class="keywordflow">default</span>:
00400             <span class="keywordflow">return</span> STATUS_INVALID_PARAMETER;
00401     }
00402 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="cmwraper.c::DbgPrint" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG DbgPrint           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PCH&nbsp;</td>
          <td class="mdname" nowrap> <em>Format</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>&nbsp;</td>
          <td class="mdname" nowrap> <em>...</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00050">50</a> of file <a class="el" href="../../d7/d2/cmwraper_8c-source.html">cmwraper.c</a>.
<p>
References <a class="el" href="../../d7/d1/rtqkey_8c-source.html#l00042">Buffer</a>.
<p>
<pre class="fragment"><div>00054 {
00055     va_list arglist;
00056     UCHAR <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>[512];
00057     STRING Output;
00058 
00059     <span class="comment">//</span>
00060     <span class="comment">// Format the output into a buffer and then print it.</span>
00061     <span class="comment">//</span>
00062 
00063     va_start(arglist, Format);
00064     Output.Length = _vsnprintf(Buffer, <span class="keyword">sizeof</span>(Buffer), Format, arglist);
00065     Output.Buffer = <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>;
00066     printf(<span class="stringliteral">"%s"</span>, Buffer);
00067     <span class="keywordflow">return</span> 0;
00068 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a25" doxytag="cmwraper.c::ExAllocatePool" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PVOID ExAllocatePool           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>PoolType</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>NumberOfBytes</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00278">278</a> of file <a class="el" href="../../d7/d2/cmwraper_8c-source.html">cmwraper.c</a>.
<p>
References <a class="el" href="../../d1/d0/hivedata_8h-source.html#l00122">HBLOCK_SIZE</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d4/d5/allocvm_8c-source.html#l00075">NtAllocateVirtualMemory()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d9/hive_8h-source.html#l00049">ROUND_UP</a>, and <a class="el" href="../../d9/d6/lh__open_2pi__mem_8h-source.html#l00017">Size</a>.
<p>
<pre class="fragment"><div>00282 {
00283     PVOID   Address = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00284     ULONG   <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>;
00285     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>    status;
00286 
00287     <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a> = <a class="code" href="../../d6/d0/hive_8h.html#a2">ROUND_UP</a>(NumberOfBytes, HBLOCK_SIZE);
00288     status = <a class="code" href="../../d3/d6/allocvm_8c.html#a7">NtAllocateVirtualMemory</a>(
00289                 NtCurrentProcess(),
00290                 &amp;Address,
00291                 0,
00292                 &amp;Size,
00293                 MEM_COMMIT,
00294                 PAGE_READWRITE
00295                 );
00296     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
00297         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00298     }
00299     <span class="keywordflow">return</span> Address;
00300 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a26" doxytag="cmwraper.c::ExFreePool" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID ExFreePool           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>P</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">304</a> of file <a class="el" href="../../d7/d2/cmwraper_8c-source.html">cmwraper.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html#l00408">ExInitializeNPagedLookasideList()</a>, and <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html#l00543">ExInitializePagedLookasideList()</a>.
<p>
<pre class="fragment"><div>00307 {
00308     ULONG   size;
00309     size = <a class="code" href="../../d0/d1/hivedata_8h.html#a14">HBLOCK_SIZE</a>;
00310 
00311     <span class="comment">// if it was really more than 1 page, well, too bad</span>
00312     <a class="code" href="../../d3/d7/freevm_8c.html#a6">NtFreeVirtualMemory</a>(
00313         NtCurrentProcess(),
00314         &amp;P,
00315         &amp;size,
00316         MEM_DECOMMIT
00317         );
00318     <span class="keywordflow">return</span>;
00319 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a22" doxytag="cmwraper.c::KeBugCheck" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KeBugCheck           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN ULONG&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>BugCheckCode</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00218">218</a> of file <a class="el" href="../../d7/d2/cmwraper_8c-source.html">cmwraper.c</a>.
<p>
Referenced by <a class="el" href="../../d9/d1/ia64_2initkr_8c-source.html#l00078">KiInitializeKernel()</a>.
<p>
<pre class="fragment"><div>00221 {
00222     printf(<span class="stringliteral">"BugCheck: code = %08lx\n"</span>, BugCheckCode);
00223     <a class="code" href="../../d9/d1/fedefs_8h.html#a16">exit</a>(1);
00224 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a23" doxytag="cmwraper.c::KeBugCheckEx" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KeBugCheckEx           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>BugCheckCode</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Arg1</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Arg2</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Arg3</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Arg4</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00227">227</a> of file <a class="el" href="../../d7/d2/cmwraper_8c-source.html">cmwraper.c</a>.
<p>
References <a class="el" href="../../d0/d1/fedefs_8h-source.html#l00051">exit</a>.
<p>
<pre class="fragment"><div>00234 {
00235     printf(<span class="stringliteral">"BugCheck: code = %08lx\n"</span>, BugCheckCode);
00236     printf(<span class="stringliteral">"Args =%08lx %08lx %08lx %08lx\n"</span>, Arg1, Arg2, Arg3, Arg4);
00237     <a class="code" href="../../d9/d1/fedefs_8h.html#a16">exit</a>(1);
00238 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a24" doxytag="cmwraper.c::KeQuerySystemTime" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KeQuerySystemTime           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">OUT PLARGE_INTEGER&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>SystemTime</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00242">242</a> of file <a class="el" href="../../d7/d2/cmwraper_8c-source.html">cmwraper.c</a>.
<p>
<pre class="fragment"><div>00245 {
00246     NtQuerySystemTime(SystemTime);
00247 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a19" doxytag="cmwraper.c::KeReleaseMutex" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LONG KeReleaseMutex           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d3/d7/struct__KMUTANT.html">PKMUTEX</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Mutex</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>Wait</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00155">155</a> of file <a class="el" href="../../d7/d2/cmwraper_8c-source.html">cmwraper.c</a>.
<p>
References <a class="el" href="../../d4/d9/ke_8h.html#a88">PKMUTEX</a>.
<p>
<pre class="fragment"><div>00159 {
00160     <span class="keywordflow">return</span>(0);
00161 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a20" doxytag="cmwraper.c::KeWaitForSingleObject" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS KeWaitForSingleObject           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Object</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d4/d9/ke_8h.html#a53">KWAIT_REASON</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>WaitReason</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>WaitMode</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>Alertable</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PLARGE_INTEGER Timeout&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00163">163</a> of file <a class="el" href="../../d7/d2/cmwraper_8c-source.html">cmwraper.c</a>.
<p>
<pre class="fragment"><div>00170 {
00171     <span class="keywordflow">return</span>(STATUS_SUCCESS);
00172 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="cmwraper.c::MyCmpInitHiveFromFile" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS MyCmpInitHiveFromFile           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap> <em>FileName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT <a class="el" href="../../d9/d6/struct__CMHIVE.html">PCMHIVE</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>CmHive</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PBOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>Allocate</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00405">405</a> of file <a class="el" href="../../d7/d2/cmwraper_8c-source.html">cmwraper.c</a>.
<p>
References <a class="el" href="../../d9/d0/cminit_8c-source.html#l00471">CmpInitializeHive()</a>, <a class="el" href="../../d1/d2/cmp_8h.html#a290">CmpOpenHiveFiles()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d1/rtload_8c-source.html#l00047">FileName</a>, <a class="el" href="../../d1/d0/hivedata_8h-source.html#l00570">HFILE_TYPE_LOG</a>, <a class="el" href="../../d1/d0/hivedata_8h-source.html#l00568">HFILE_TYPE_PRIMARY</a>, <a class="el" href="../../d7/d9/hive_8h-source.html#l00197">HINIT_CREATE</a>, <a class="el" href="../../d7/d9/hive_8h-source.html#l00199">HINIT_FILE</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d6/d9/obclose_8c-source.html#l00037">NtClose()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00323">CmpWorkerCommand()</a>.
<p>
<pre class="fragment"><div>00413                    :
00414 
00415     This routine opens a <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a> and log, allocates a <a class="code" href="../../d9/d6/struct__CMHIVE.html">CMHIVE</a>, and initializes
00416     <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a>.
00417 
00418 Arguments:
00419 
00420     <a class="code" href="../../d2/d2/rtload_8c.html#a3">FileName</a> - Supplies name of <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a> to be loaded.
00421 
00422     CmHive   - Returns pointer to initialized hive (<span class="keywordflow">if</span> successful)
00423 
00424     Allocate - Returns whether <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> hive was allocated or existing.
00425 
00426 Return Value:
00427 
00428     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00429 
00430 --*/
00431 
00432 {
00433     <a class="code" href="../../d9/d6/struct__CMHIVE.html">PCMHIVE</a> NewHive;
00434     ULONG Disposition;
00435     ULONG SecondaryDisposition;
00436     HANDLE PrimaryHandle;
00437     HANDLE LogHandle;
00438     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00439     ULONG FileType;
00440     ULONG Operation;
00441 
00442     BOOLEAN Success;
00443 
00444     *CmHive = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00445 
00446     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d1/d2/cmp_8h.html#a290">CmpOpenHiveFiles</a>(FileName,
00447                               L<span class="stringliteral">".log"</span>,
00448                               &amp;PrimaryHandle,
00449                               &amp;LogHandle,
00450                               &amp;Disposition,
00451                               &amp;SecondaryDisposition,
00452                               TRUE,
00453                               NULL
00454                               );
00455     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00456         <span class="keywordflow">return</span>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00457     }
00458 
00459     <span class="keywordflow">if</span> (LogHandle == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00460         FileType = <a class="code" href="../../d0/d1/hivedata_8h.html#a38">HFILE_TYPE_PRIMARY</a>;
00461     } <span class="keywordflow">else</span> {
00462         FileType = <a class="code" href="../../d0/d1/hivedata_8h.html#a40">HFILE_TYPE_LOG</a>;
00463     }
00464 
00465     <span class="keywordflow">if</span> (Disposition == FILE_CREATED) {
00466         Operation = <a class="code" href="../../d6/d0/hive_8h.html#a4">HINIT_CREATE</a>;
00467         *Allocate = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00468     } <span class="keywordflow">else</span> {
00469         Operation = <a class="code" href="../../d6/d0/hive_8h.html#a6">HINIT_FILE</a>;
00470         *Allocate = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00471     }
00472 
00473     Success = <a class="code" href="../../d1/d2/cmp_8h.html#a275">CmpInitializeHive</a>(&amp;NewHive,
00474                                 Operation,
00475                                 FALSE,
00476                                 FileType,
00477                                 NULL,
00478                                 PrimaryHandle,
00479                                 NULL,
00480                                 LogHandle,
00481                                 NULL,
00482                                 NULL);
00483     <span class="keywordflow">if</span> (!Success) {
00484         <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(PrimaryHandle);
00485         <span class="keywordflow">if</span> (LogHandle != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00486             <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(LogHandle);
00487         }
00488         <span class="keywordflow">return</span>(STATUS_REGISTRY_CORRUPT);
00489     } <span class="keywordflow">else</span> {
00490         *CmHive = NewHive;
00491         <span class="keywordflow">return</span>(STATUS_SUCCESS);
00492     }
00493 }

</div></pre>    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="a5" doxytag="cmwraper.c::CmLogLevel" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d6/d3/cmwraper_8c.html#a5">CmLogLevel</a> = 0          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00083">83</a> of file <a class="el" href="../../d7/d2/cmwraper_8c-source.html">cmwraper.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="cmwraper.c::CmLogSelect" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d6/d3/cmwraper_8c.html#a6">CmLogSelect</a> = 0          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00084">84</a> of file <a class="el" href="../../d7/d2/cmwraper_8c-source.html">cmwraper.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="cmwraper.c::CmpHiveListHead" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LIST_ENTRY <a class="el" href="../../d9/d4/edithive_8c.html#a2">CmpHiveListHead</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00086">86</a> of file <a class="el" href="../../d7/d2/cmwraper_8c-source.html">cmwraper.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="cmwraper.c::CmpKeyMapping" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> GENERIC_MAPPING <a class="el" href="../../d9/d4/edithive_8c.html#a1">CmpKeyMapping</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Initial value:</b><pre class="fragment"><div> {
    KEY_READ,
    KEY_WRITE,
    KEY_EXECUTE,
    KEY_ALL_ACCESS
}
</div></pre>
<p>
Definition at line <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00076">76</a> of file <a class="el" href="../../d7/d2/cmwraper_8c-source.html">cmwraper.c</a>.
<p>
Referenced by <a class="el" href="../../d2/d2/cmsysini_8c-source.html#l01074">CmpCreateObjectTypes()</a>, and <a class="el" href="../../d0/d4/edithive_8c-source.html#l00988">EhpAttachSecurity()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="cmwraper.c::CmpMasterHive" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d9/d6/struct__CMHIVE.html">PCMHIVE</a> <a class="el" href="../../d6/d3/cmwraper_8c.html#a7">CmpMasterHive</a> = NULL          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00085">85</a> of file <a class="el" href="../../d7/d2/cmwraper_8c-source.html">cmwraper.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="cmwraper.c::CmpNoWrite" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN <a class="el" href="../../d6/d3/cmwraper_8c.html#a4">CmpNoWrite</a> = FALSE          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00082">82</a> of file <a class="el" href="../../d7/d2/cmwraper_8c-source.html">cmwraper.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="cmwraper.c::KiFindFirstSetRight" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> CCHAR <a class="el" href="../../d5/d9/kernldat_8c.html#a39">KiFindFirstSetRight</a>[256]          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Initial value:</b><pre class="fragment"><div> {
        0, 0, 1, 0, 2, 0, 1, 0, 3, 0, 1, 0, 2, 0, 1, 0,
        4, 0, 1, 0, 2, 0, 1, 0, 3, 0, 1, 0, 2, 0, 1, 0,
        5, 0, 1, 0, 2, 0, 1, 0, 3, 0, 1, 0, 2, 0, 1, 0,
        4, 0, 1, 0, 2, 0, 1, 0, 3, 0, 1, 0, 2, 0, 1, 0,
        6, 0, 1, 0, 2, 0, 1, 0, 3, 0, 1, 0, 2, 0, 1, 0,
        4, 0, 1, 0, 2, 0, 1, 0, 3, 0, 1, 0, 2, 0, 1, 0,
        5, 0, 1, 0, 2, 0, 1, 0, 3, 0, 1, 0, 2, 0, 1, 0,
        4, 0, 1, 0, 2, 0, 1, 0, 3, 0, 1, 0, 2, 0, 1, 0,
        7, 0, 1, 0, 2, 0, 1, 0, 3, 0, 1, 0, 2, 0, 1, 0,
        4, 0, 1, 0, 2, 0, 1, 0, 3, 0, 1, 0, 2, 0, 1, 0,
        5, 0, 1, 0, 2, 0, 1, 0, 3, 0, 1, 0, 2, 0, 1, 0,
        4, 0, 1, 0, 2, 0, 1, 0, 3, 0, 1, 0, 2, 0, 1, 0,
        6, 0, 1, 0, 2, 0, 1, 0, 3, 0, 1, 0, 2, 0, 1, 0,
        4, 0, 1, 0, 2, 0, 1, 0, 3, 0, 1, 0, 2, 0, 1, 0,
        5, 0, 1, 0, 2, 0, 1, 0, 3, 0, 1, 0, 2, 0, 1, 0,
        4, 0, 1, 0, 2, 0, 1, 0, 3, 0, 1, 0, 2, 0, 1, 0}
</div></pre>
<p>
Definition at line <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00028">28</a> of file <a class="el" href="../../d7/d2/cmwraper_8c-source.html">cmwraper.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="cmwraper.c::MmSizeOfPagedPoolInBytes" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d0/d9/miglobal_8c.html#a57">MmSizeOfPagedPoolInBytes</a> = 0xffffffff          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00047">47</a> of file <a class="el" href="../../d7/d2/cmwraper_8c-source.html">cmwraper.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="cmwraper.c::UsedStorage" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d6/d3/cmwraper_8c.html#a0">UsedStorage</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00026">26</a> of file <a class="el" href="../../d7/d2/cmwraper_8c-source.html">cmwraper.c</a>.
<p>
Referenced by <a class="el" href="../../d2/d9/cmchek_8c-source.html#l00108">CmCheckRegistry()</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:43:12 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
