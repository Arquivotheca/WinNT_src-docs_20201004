<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: dmmnem.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>dmmnem.c</h1><a href="../../d5/d0/dmmnem_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/***************************************************************************\</span>
00002 <span class="comment">*</span>
00003 <span class="comment">*  DMMNEM.C -</span>
00004 <span class="comment">*</span>
00005 <span class="comment">* Copyright (c) 1985 - 1999, Microsoft Corporation</span>
00006 <span class="comment">*</span>
00007 <span class="comment">*      Mnemonic Character Processing Routines</span>
00008 <span class="comment">*</span>
00009 <span class="comment">* ??-???-???? mikeke    Ported from Win 3.0 sources</span>
00010 <span class="comment">* 12-Feb-1991 mikeke    Added Revalidation code</span>
00011 <span class="comment">\***************************************************************************/</span>
00012 
00013 <span class="preprocessor">#include "<a class="code" href="../../d7/d3/w32_2ntuser_2client_2precomp_8h.html">precomp.h</a>"</span>
00014 <span class="preprocessor">#pragma hdrstop</span>
00015 <span class="preprocessor"></span>
00016 <span class="comment">/***************************************************************************\</span>
00017 <span class="comment">* FindMnemChar</span>
00018 <span class="comment">*</span>
00019 <span class="comment">* Returns: 0x00 if no matching char,</span>
00020 <span class="comment">*          0x01 if menmonic char is matching,</span>
00021 <span class="comment">*          0x80 if first char is matching</span>
00022 <span class="comment">*</span>
00023 <span class="comment">* History:</span>
00024 <span class="comment">*   11-18-90 JimA       Created.</span>
00025 <span class="comment">\***************************************************************************/</span>
00026 
<a name="l00027"></a><a class="code" href="../../d6/d0/usercli_8h.html#a646">00027</a> <span class="keywordtype">int</span> <a class="code" href="../../d6/d0/usercli_8h.html#a646">FindMnemChar</a>(
00028     LPWSTR lpstr,
00029     WCHAR ch,
00030     BOOL fFirst,
00031     BOOL fPrefix)
00032 {
00033     WCHAR chc;
00034     WCHAR chnext;
00035     WCHAR chFirst;
00036 
00037     <span class="keywordflow">while</span> (*lpstr == TEXT(<span class="charliteral">' '</span>))
00038         lpstr++;
00039 
00040     ch = (WCHAR)(ULONG_PTR)<a class="code" href="../../d8/d0/wstrings_8c.html#a8">CharLowerW</a>((LPWSTR)ULongToPtr( (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a1">UTCHAR</a>)ch ));
00041     chFirst = (WCHAR)(ULONG_PTR)<a class="code" href="../../d8/d0/wstrings_8c.html#a8">CharLowerW</a>((LPWSTR)ULongToPtr( (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a1">UTCHAR</a>)(*lpstr) ));
00042 
00043 <span class="preprocessor">#ifdef FE_SB // FindMnemChar()</span>
00044 <span class="preprocessor"></span>    <span class="comment">//</span>
00045     <span class="comment">// HIRO: LATER: CH_ENGLISHPREFIX is obsolete, so entire FE_SB can be removed ?</span>
00046     <span class="comment">//</span>
00047     <span class="keywordflow">if</span> (fPrefix) {
00048         <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> wvch, xvkey;
00049         <span class="comment">//</span>
00050         <span class="comment">// get OEM-dependent virtual key code</span>
00051         <span class="comment">//</span>
00052         <span class="keywordflow">if</span> ((wvch = <a class="code" href="../../d3/d0/user32_8def.html#a48">VkKeyScanW</a>(ch)) != -1)
00053             wvch &amp;= 0x00FF;
00054 
00055         <span class="keywordflow">while</span> (chc = *lpstr++) {
00056             <span class="comment">//</span>
00057             <span class="comment">// This should think about KOREA &amp; TAIWAN case. But probably OK.</span>
00058             <span class="comment">//</span>
00059             <span class="keywordflow">if</span> ((chc == <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a894">CH_PREFIX</a>) || (chc == <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a895">CH_ENGLISHPREFIX</a>)) {
00060                 chnext = (WCHAR)(ULONG_PTR)<a class="code" href="../../d8/d0/wstrings_8c.html#a8">CharLowerW</a>((LPWSTR)ULongToPtr( (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a1">UTCHAR</a>)*lpstr ));
00061 
00062                 <span class="keywordflow">if</span> (chnext == <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a894">CH_PREFIX</a>)
00063                     lpstr++;
00064                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (chnext == ch)
00065                     <span class="keywordflow">return</span>(0x01);
00066                 <span class="keywordflow">else</span> {
00067                     <span class="comment">//</span>
00068                     <span class="comment">// Compare should be done with virtual key in Kanji menu mode</span>
00069                     <span class="comment">// in order to accept Digit shortcut key and save English</span>
00070                     <span class="comment">// windows applications!</span>
00071                     <span class="comment">//</span>
00072                     xvkey = <a class="code" href="../../d3/d0/user32_8def.html#a48">VkKeyScanW</a>(chnext);
00073                     <span class="keywordflow">if</span> (xvkey != 0xFFFF &amp;&amp; ((xvkey &amp; 0x00FF) == wvch))
00074                         <span class="keywordflow">return</span>(0x01);
00075                     <span class="keywordflow">else</span>
00076                         <span class="keywordflow">return</span>(0x00);
00077                }
00078             }
00079         }
00080     }
00081 <span class="preprocessor">#else</span>
00082 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (fPrefix) {
00083         <span class="keywordflow">while</span> (chc = *lpstr++) {
00084             <span class="keywordflow">if</span> (((WCHAR)CharLower((LPWSTR)(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a1">UTCHAR</a>)chc) == <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a894">CH_PREFIX</a>)) {
00085                 chnext = (WCHAR)<a class="code" href="../../d8/d0/wstrings_8c.html#a8">CharLowerW</a>((LPWSTR)(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a1">UTCHAR</a>)*lpstr);
00086 
00087                 <span class="keywordflow">if</span> (chnext == <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a894">CH_PREFIX</a>)
00088                     lpstr++;
00089                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (chnext == ch)
00090                     <span class="keywordflow">return</span> 0x01;
00091                 <span class="keywordflow">else</span> {
00092                     <span class="keywordflow">return</span> 0x00;
00093                 }
00094             }
00095         }
00096     }
00097 <span class="preprocessor">#endif // FE_SB</span>
00098 <span class="preprocessor"></span>
00099     <span class="keywordflow">if</span> (fFirst &amp;&amp; (ch == chFirst))
00100         <span class="keywordflow">return</span> 0x80;
00101 
00102     <span class="keywordflow">return</span> 0x00;
00103 }
00104 
00105 
00106 <span class="comment">/***************************************************************************\</span>
00107 <span class="comment">* xxxFindNextMnem</span>
00108 <span class="comment">*</span>
00109 <span class="comment">* This function returns NULL if no control with the specified mnemonic</span>
00110 <span class="comment">* can be found.</span>
00111 <span class="comment">*</span>
00112 <span class="comment">* History:</span>
00113 <span class="comment">\***************************************************************************/</span>
00114 
<a name="l00115"></a><a class="code" href="../../d5/d0/dmmnem_8c.html#a1">00115</a> <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> <a class="code" href="../../d5/d0/dmmnem_8c.html#a1">xxxGNM_FindNextMnem</a>(
00116     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndDlg,
00117     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd,
00118     WCHAR ch)
00119 {
00120     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndStart;
00121     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndT;
00122     WCHAR rgchText[256];
00123     <span class="keywordtype">int</span> i = 0;
00124     <a class="code" href="../../d5/d1/struct__TL.html">TL</a> tlpwndStart;
00125     <a class="code" href="../../d5/d1/struct__TL.html">TL</a> tlpwnd;
00126     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwDlgCode;
00127 
00128     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwndDlg);
00129     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwnd);
00130 
00131     <span class="comment">/*</span>
00132 <span class="comment">     * Check if we are in a group box so we can find local mnemonics.</span>
00133 <span class="comment">     */</span>
00134 
00135     pwndStart = <a class="code" href="../../d6/d0/usercli_8h.html#a643">_GetChildControl</a>(pwndDlg, pwnd);
00136     <a class="code" href="../../d6/d0/usercli_8h.html#a36">ThreadLock</a>(pwndStart, &amp;tlpwndStart);
00137 
00138     <span class="keywordflow">while</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
00139 
00140         pwndT = <a class="code" href="../../d6/d0/usercli_8h.html#a641">_GetNextDlgGroupItem</a>(pwndDlg, pwndStart, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00141 
00142         <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwndStart);
00143 
00144         i++;
00145         <span class="keywordflow">if</span> (pwndT == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> || pwndT == pwnd || i &gt; 60) {
00146 
00147             <span class="comment">/*</span>
00148 <span class="comment">             * If we have returned to our starting window or if we have gone</span>
00149 <span class="comment">             * through 60 iterations, let's exit.  There are no local mnemonics</span>
00150 <span class="comment">             * that match.  We have to check for 60 iterations (or so) because</span>
00151 <span class="comment">             * we run into problems with WS_GROUP not being properly defined in</span>
00152 <span class="comment">             * rc files that we never reach this same starting window again....</span>
00153 <span class="comment">             */</span>
00154             <span class="keywordflow">break</span>;
00155         }
00156 
00157         pwndStart = pwndT;
00158 
00159         <span class="comment">/*</span>
00160 <span class="comment">         * Only check for matching mnemonic if control doesn't want characters</span>
00161 <span class="comment">         * and control isn't a static control with SS_NOPREFIX</span>
00162 <span class="comment">         */</span>
00163         <a class="code" href="../../d6/d0/usercli_8h.html#a36">ThreadLock</a>(pwndStart, &amp;tlpwndStart);
00164 
00165         dwDlgCode = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)<a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(pwndT), WM_GETDLGCODE, 0, 0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>);
00166         <span class="keywordflow">if</span> (!(dwDlgCode &amp; DLGC_WANTCHARS) &amp;&amp;
00167                 (!(dwDlgCode &amp; DLGC_STATIC) || !(pwndT-&gt;style &amp; SS_NOPREFIX))) {
00168             <a class="code" href="../../d5/d9/cltxt_8h.html#a21">GetWindowText</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(pwndT), rgchText, <span class="keyword">sizeof</span>(rgchText)/<span class="keyword">sizeof</span>(WCHAR));
00169             <span class="keywordflow">if</span> (<a class="code" href="../../d6/d0/usercli_8h.html#a646">FindMnemChar</a>(rgchText, ch, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) != 0) {
00170                 <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwndStart);
00171                 <span class="keywordflow">return</span> pwndT;
00172             }
00173         }
00174     }
00175 
00176     pwnd = pwndStart = <a class="code" href="../../d6/d0/usercli_8h.html#a643">_GetChildControl</a>(pwndDlg, pwnd);
00177 
00178     <a class="code" href="../../d6/d0/usercli_8h.html#a36">ThreadLock</a>(pwnd, &amp;tlpwnd);
00179     <span class="keywordflow">while</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
00180 
00181         <span class="comment">/*</span>
00182 <span class="comment">         * Start with next so we see multiples of same mnemonic.</span>
00183 <span class="comment">         */</span>
00184         pwnd = <a class="code" href="../../d6/d0/usercli_8h.html#a639">_NextControl</a>(pwndDlg, pwnd, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00185 
00186         <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwnd);
00187         <a class="code" href="../../d6/d0/usercli_8h.html#a36">ThreadLock</a>(pwnd, &amp;tlpwnd);
00188 
00189 
00190 
00191         <span class="comment">/*</span>
00192 <span class="comment">         * Only check for matching mnemonic if control doesn't want characters</span>
00193 <span class="comment">         * and control isn't a static control with SS_NOPREFIX</span>
00194 <span class="comment">         */</span>
00195         dwDlgCode = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)<a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a450">HW</a>(pwnd), WM_GETDLGCODE, 0, 0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>);
00196         <span class="keywordflow">if</span> (!(dwDlgCode &amp; DLGC_WANTCHARS) &amp;&amp;
00197                 (!(dwDlgCode &amp; DLGC_STATIC) || !(pwnd-&gt;style &amp; SS_NOPREFIX))) {
00198             <a class="code" href="../../d5/d9/cltxt_8h.html#a21">GetWindowText</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a450">HW</a>(pwnd), rgchText, <span class="keyword">sizeof</span>(rgchText)/<span class="keyword">sizeof</span>(WCHAR));
00199             <span class="keywordflow">if</span> (<a class="code" href="../../d6/d0/usercli_8h.html#a646">FindMnemChar</a>(rgchText, ch, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) != 0)
00200                 <span class="keywordflow">break</span>;
00201         }
00202 
00203         <span class="keywordflow">if</span> (pwnd == pwndStart) {
00204             pwnd = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00205             <span class="keywordflow">break</span>;
00206         }
00207     }
00208     <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwnd);
00209 
00210     <span class="keywordflow">return</span> pwnd;
00211 }
00212 
00213 <span class="comment">/***************************************************************************\</span>
00214 <span class="comment">* xxxGotoNextMnem</span>
00215 <span class="comment">*</span>
00216 <span class="comment">* History:</span>
00217 <span class="comment">\***************************************************************************/</span>
00218 
<a name="l00219"></a><a class="code" href="../../d6/d0/usercli_8h.html#a758">00219</a> <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> <a class="code" href="../../d6/d0/usercli_8h.html#a758">xxxGotoNextMnem</a>(
00220     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndDlg,
00221     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd,
00222     WCHAR ch)
00223 {
00224     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> code;
00225     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndFirstFound = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00226     <span class="keywordtype">int</span> count = 0;
00227     <a class="code" href="../../d5/d1/struct__TL.html">TL</a> tlpwnd;
00228     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndT;
00229     HWND hwnd;
00230 
00231     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwndDlg);
00232     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwnd);
00233 
00234     <a class="code" href="../../d6/d0/usercli_8h.html#a36">ThreadLock</a>(pwnd, &amp;tlpwnd);
00235 
00236     <span class="comment">/*</span>
00237 <span class="comment">     * Loop for a long time but not long enough so we hang...</span>
00238 <span class="comment">     */</span>
00239     <span class="keywordflow">while</span> (count &lt; 256 * 2) {
00240 
00241         <span class="comment">/*</span>
00242 <span class="comment">         * If the dialog box doesn't has the mnemonic specified, return NULL.</span>
00243 <span class="comment">         */</span>
00244         <span class="keywordflow">if</span> ((pwnd = <a class="code" href="../../d5/d0/dmmnem_8c.html#a1">xxxGNM_FindNextMnem</a>(pwndDlg, pwnd, ch)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00245             <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwnd);
00246             <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00247         }
00248         hwnd = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(pwnd);
00249 
00250         <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwnd);
00251         <a class="code" href="../../d6/d0/usercli_8h.html#a36">ThreadLock</a>(pwnd, &amp;tlpwnd);
00252 
00253         code = (<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)<a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(hwnd, WM_GETDLGCODE, 0, 0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>);
00254 
00255         <span class="comment">/*</span>
00256 <span class="comment">         * If a non-disabled static item, then jump ahead to nearest tabstop.</span>
00257 <span class="comment">         */</span>
00258         <span class="keywordflow">if</span> (code &amp; DLGC_STATIC &amp;&amp; !<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a651">WFDISABLED</a>)) {
00259             pwndT = <a class="code" href="../../d6/d0/usercli_8h.html#a642">_GetNextDlgTabItem</a>(pwndDlg, pwnd, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00260 
00261             <span class="comment">/*</span>
00262 <span class="comment">             * If there is no other tab item, keep looking</span>
00263 <span class="comment">             */</span>
00264             <span class="keywordflow">if</span> (pwndT == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00265                 <span class="keywordflow">continue</span>;
00266             pwnd = pwndT;
00267             hwnd = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(pwnd);
00268 
00269             <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwnd);
00270             <a class="code" href="../../d6/d0/usercli_8h.html#a36">ThreadLock</a>(pwnd, &amp;tlpwnd);
00271 
00272             <span class="comment">/*</span>
00273 <span class="comment">             * I suppose we should do a getdlgcode here, but who is going to</span>
00274 <span class="comment">             * label a button with a static control?  The setup guys, that's</span>
00275 <span class="comment">             * who...  Also, generally useful for ownerdraw buttons which are</span>
00276 <span class="comment">             * labeled with a static text item.</span>
00277 <span class="comment">             */</span>
00278             code = (<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)<a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(hwnd, WM_GETDLGCODE, 0, 0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>);
00279         }
00280 
00281         <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a651">WFDISABLED</a>)) {
00282 
00283             <span class="comment">/*</span>
00284 <span class="comment">             * Is it a Pushbutton?</span>
00285 <span class="comment">             */</span>
00286             <span class="keywordflow">if</span> (!(code &amp; DLGC_BUTTON)) {
00287 
00288                 <span class="comment">/*</span>
00289 <span class="comment">                 * No, simply give it the focus.</span>
00290 <span class="comment">                 */</span>
00291                 <a class="code" href="../../d6/d0/usercli_8h.html#a759">DlgSetFocus</a>(hwnd);
00292             } <span class="keywordflow">else</span> {
00293 
00294                 <span class="comment">/*</span>
00295 <span class="comment">                 * Yes, click it, but don't give it the focus.</span>
00296 <span class="comment">                 */</span>
00297                 <span class="keywordflow">if</span> ((code &amp; DLGC_DEFPUSHBUTTON) || (code &amp; DLGC_UNDEFPUSHBUTTON)) {
00298 
00299                     <span class="comment">/*</span>
00300 <span class="comment">                     * Flash the button.</span>
00301 <span class="comment">                     */</span>
00302                     <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(hwnd, BM_SETSTATE, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>, 0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>);
00303 
00304                     <span class="comment">/*</span>
00305 <span class="comment">                     * Delay</span>
00306 <span class="comment">                     */</span>
00307 <span class="preprocessor">#ifdef LATER</span>
00308 <span class="preprocessor"></span><span class="comment">// JimA - 2/19/92</span>
00309 <span class="comment">// There oughta be a better way of doing this...</span>
00310                     <span class="keywordflow">for</span> (i = 0; i &lt; 10000; i++)
00311                         ;
00312 <span class="preprocessor">#else</span>
00313 <span class="preprocessor"></span>                    Sleep(1);
00314 <span class="preprocessor">#endif</span>
00315 <span class="preprocessor"></span>
00316                     <span class="comment">/*</span>
00317 <span class="comment">                     * Un-Flash it.</span>
00318 <span class="comment">                     */</span>
00319                     <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(hwnd, BM_SETSTATE, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>, 0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>);
00320 
00321                     <span class="comment">/*</span>
00322 <span class="comment">                     * Send the WM_COMMAND message.</span>
00323 <span class="comment">                     */</span>
00324                     pwndT = <a class="code" href="../../d6/d0/usercli_8h.html#a27">REBASEPWND</a>(pwnd, spwndParent);
00325                     <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a450">HW</a>(pwndT), WM_COMMAND,
00326                             MAKELONG(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a99">PTR_TO_ID</a>(pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o16">spmenu</a>), BN_CLICKED), (LPARAM)hwnd);
00327                     <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwnd);
00328                     <span class="keywordflow">return</span> (<a class="code" href="../../d6/d9/structtagWND.html">PWND</a>)1;
00329                 } <span class="keywordflow">else</span> {
00330 
00331                     <span class="comment">/*</span>
00332 <span class="comment">                     * Because BM_CLICK processing will result in BN_CLICK msg,</span>
00333 <span class="comment">                     * xxxSetFocus must be prevented from sending the same msg;</span>
00334 <span class="comment">                     * Otherwise, it will notify parent twice!</span>
00335 <span class="comment">                     * Fix for Bug #3024 -- SANKAR -- 09-22-89 --</span>
00336 <span class="comment">                     */</span>
00337                     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fIsNTButton;
00338                     <a class="code" href="../../d2/d9/structtagBUTN.html">PBUTN</a> pbutn;
00339 
00340                     fIsNTButton = (pwnd-&gt;fnid == <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a200">FNID_BUTTON</a>);
00341                     <span class="keywordflow">if</span> (fIsNTButton) {
00342                       pbutn = ((<a class="code" href="../../d3/d9/structtagBUTNWND.html">PBUTNWND</a>)pwnd)-&gt;pbutn;
00343                       <a class="code" href="../../d6/d0/usercli_8h.html#a43">BUTTONSTATE</a>(pbutn) |= <a class="code" href="../../d6/d0/usercli_8h.html#a48">BST_DONTCLICK</a>;
00344                     } <span class="keywordflow">else</span> {
00345                      RIPMSG0(RIP_WARNING, <span class="stringliteral">"xxxGotoNextMnem: fnid != FNID_BUTTON"</span>);
00346                     }
00347 
00348                     <a class="code" href="../../d6/d0/usercli_8h.html#a759">DlgSetFocus</a>(hwnd);
00349 
00350                     <span class="keywordflow">if</span> (fIsNTButton) {
00351                       <a class="code" href="../../d6/d0/usercli_8h.html#a43">BUTTONSTATE</a>(pbutn) &amp;= ~<a class="code" href="../../d6/d0/usercli_8h.html#a48">BST_DONTCLICK</a>;
00352                     }
00353 
00354                     <span class="comment">/*</span>
00355 <span class="comment">                     * Send click message if button has a UNIQUE mnemonic</span>
00356 <span class="comment">                     */</span>
00357                     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d0/dmmnem_8c.html#a1">xxxGNM_FindNextMnem</a>(pwndDlg, pwnd, ch) == pwnd) {
00358                         <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(hwnd, BM_CLICK, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>, 0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>);
00359                     }
00360                 }
00361             }
00362 
00363             <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwnd);
00364             <span class="keywordflow">return</span> pwnd;
00365         } <span class="keywordflow">else</span> {
00366 
00367             <span class="comment">/*</span>
00368 <span class="comment">             * Stop if we've looped back to the first item we checked</span>
00369 <span class="comment">             */</span>
00370             <span class="keywordflow">if</span> (pwnd == pwndFirstFound) {
00371                 <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwnd);
00372                 <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00373             }
00374 
00375             <span class="keywordflow">if</span> (pwndFirstFound == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00376                 pwndFirstFound = pwnd;
00377         }
00378 
00379         count++;
00380 
00381     }  <span class="comment">/* Loop for a long time */</span>
00382 
00383     <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwnd);
00384     <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00385 }
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:39:46 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
