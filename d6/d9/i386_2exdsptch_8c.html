<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: i386/exdsptch.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>exdsptch.c File Reference</h1><code>#include "<a class="el" href="../../d6/d8/ntrtlp_8h-source.html">ntrtlp.h</a>"</code><br>

<p>
<a href="../../d7/d8/i386_2exdsptch_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Classes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d6/struct__DISPATCHER__CONTEXT.html">_DISPATCHER_CONTEXT</a></td></tr>

<tr><td colspan=2><br><h2>Typedefs</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d0/d6/struct__DISPATCHER__CONTEXT.html">_DISPATCHER_CONTEXT</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d9/i386_2exdsptch_8c.html#a0">DISPATCHER_CONTEXT</a></td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>EXCEPTION_DISPOSITION&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d9/i386_2exdsptch_8c.html#a1">RtlpExecuteHandlerForException</a> (IN PEXCEPTION_RECORD ExceptionRecord, IN PVOID EstablisherFrame, IN OUT PCONTEXT ContextRecord, IN OUT PVOID DispatcherContext, IN PEXCEPTION_ROUTINE ExceptionRoutine)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>EXCEPTION_DISPOSITION&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d9/i386_2exdsptch_8c.html#a2">RtlpExecuteHandlerForUnwind</a> (IN PEXCEPTION_RECORD ExceptionRecord, IN PVOID EstablisherFrame, IN OUT PCONTEXT ContextRecord, IN OUT PVOID DispatcherContext, IN PEXCEPTION_ROUTINE ExceptionRoutine)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d9/i386_2exdsptch_8c.html#a3">RtlDispatchException</a> (IN PEXCEPTION_RECORD ExceptionRecord, IN PCONTEXT ContextRecord)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d9/i386_2exdsptch_8c.html#a4">RtlUnwind</a> (IN PVOID TargetFrame OPTIONAL, IN PVOID TargetIp OPTIONAL, IN PEXCEPTION_RECORD ExceptionRecord OPTIONAL, IN PVOID ReturnValue)</td></tr>

</table>
<hr><h2>Typedef Documentation</h2>
<a class="anchor" name="a0" doxytag="i386/exdsptch.c::DISPATCHER_CONTEXT" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d0/d6/struct__DISPATCHER__CONTEXT.html">_DISPATCHER_CONTEXT</a>  <a class="el" href="../../d0/d6/struct__DISPATCHER__CONTEXT.html">DISPATCHER_CONTEXT</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d6/d8/alpha_2exdsptch_8c-source.html#l00162">RtlDispatchException()</a>, and <a class="el" href="../../d7/d8/unwindr_8c-source.html#l00076">RtlUnwindRfp()</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a3" doxytag="i386/exdsptch.c::RtlDispatchException" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN RtlDispatchException           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PEXCEPTION_RECORD&nbsp;</td>
          <td class="mdname" nowrap> <em>ExceptionRecord</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCONTEXT&nbsp;</td>
          <td class="mdname" nowrap> <em>ContextRecord</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d8/i386_2exdsptch_8c-source.html#l00070">70</a> of file <a class="el" href="../../d7/d8/i386_2exdsptch_8c-source.html">i386/exdsptch.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00087">DISPATCH_LEVEL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00051">EXCEPTION_NESTED_CALL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00047">EXCEPTION_NONCONTINUABLE</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00050">EXCEPTION_STACK_INVALID</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00059">ExceptionContinueExecution</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00060">ExceptionContinueSearch</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00061">ExceptionNestedException</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d9/cmchek_8c-source.html#l00095">Index</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00069">KeGetCurrentPrcb</a>, <a class="el" href="../../d0/d2/ldrp_8h-source.html#l00370">NtGlobalFlag</a>, <a class="el" href="../../d6/d9/ntrtlppc_8h.html#a0">RtlpExecuteHandlerForException()</a>, <a class="el" href="../../d3/d9/ntrtli64_8h.html#a3">RtlpGetRegistrationHead()</a>, <a class="el" href="../../d9/d9/rtl_2ia64_2miscc_8c-source.html#l00126">RtlpGetStackLimits()</a>, <a class="el" href="../../d4/d8/excptdbg_8c-source.html#l00065">RtlpLogExceptionHandler()</a>, <a class="el" href="../../d5/d9/ntrtlp_8h.html#a49">RtlpLogLastExceptionDisposition()</a>, <a class="el" href="../../d0/d9/ppc_2exdsptch_8c-source.html#l00466">RtlRaiseException()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>00077                    :
00078 
00079     This function attempts to dispatch an exception to a call frame based
00080     handler by searching backwards through <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> stack based call frames. The
00081     search begins with <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> frame specified in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> context record and continues
00082     backward until either a handler <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> found that handles <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> exception, <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00083     stack <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> found to be invalid (i.e., out of limits or unaligned), or <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> end
00084     of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> call hierarchy <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> reached.
00085 
00086 Arguments:
00087 
00088     ExceptionRecord - Supplies a pointer to an exception record.
00089 
00090     ContextRecord - Supplies a pointer to a context record.
00091 
00092 Return Value:
00093 
00094     If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> exception <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> handled by one of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> frame based handlers, then
00095     a value of <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned. Otherwise a value of <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned.
00096 
00097 --*/
00098 
00099 {
00100 
00101     <a class="code" href="../../d0/d6/struct__DISPATCHER__CONTEXT.html">DISPATCHER_CONTEXT</a> DispatcherContext;
00102     EXCEPTION_DISPOSITION Disposition;
00103     PEXCEPTION_REGISTRATION_RECORD RegistrationPointer;
00104     PEXCEPTION_REGISTRATION_RECORD NestedRegistration;
00105     ULONG HighAddress;
00106     ULONG HighLimit;
00107     ULONG LowLimit;
00108     EXCEPTION_RECORD ExceptionRecord1;
00109 
00110 <span class="preprocessor">#if !defined(WX86_i386)</span>
00111 <span class="preprocessor"></span>
00112     ULONG <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>;
00113 
00114 <span class="preprocessor">#endif</span>
00115 <span class="preprocessor"></span>
00116     <span class="comment">//</span>
00117     <span class="comment">// Get current stack limits.</span>
00118     <span class="comment">//</span>
00119 
00120     <a class="code" href="../../d5/d9/ntrtlp_8h.html#a30">RtlpGetStackLimits</a>(&amp;LowLimit, &amp;HighLimit);
00121 
00122     <span class="comment">//</span>
00123     <span class="comment">// Start with the frame specified by the context record and search</span>
00124     <span class="comment">// backwards through the call frame hierarchy attempting to find an</span>
00125     <span class="comment">// exception handler that will handler the exception.</span>
00126     <span class="comment">//</span>
00127 
00128     RegistrationPointer = <a class="code" href="../../d3/d9/ntrtli64_8h.html#a3">RtlpGetRegistrationHead</a>();
00129     NestedRegistration = 0;
00130 
00131     <span class="keywordflow">while</span> (RegistrationPointer != EXCEPTION_CHAIN_END) {
00132 
00133         <span class="comment">//</span>
00134         <span class="comment">// If the call frame is not within the specified stack limits or the</span>
00135         <span class="comment">// call frame is unaligned, then set the stack invalid flag in the</span>
00136         <span class="comment">// exception record and return FALSE. Else check to determine if the</span>
00137         <span class="comment">// frame has an exception handler.</span>
00138         <span class="comment">//</span>
00139 
00140         HighAddress = (ULONG)RegistrationPointer +
00141             <span class="keyword">sizeof</span>(EXCEPTION_REGISTRATION_RECORD);
00142 
00143         <span class="keywordflow">if</span> ( ((ULONG)RegistrationPointer &lt; LowLimit) ||
00144              (HighAddress &gt; HighLimit) ||
00145              (((ULONG)RegistrationPointer &amp; 0x3) != 0) ) {
00146 
00147 <span class="preprocessor">#if defined(NTOS_KERNEL_RUNTIME)</span>
00148 <span class="preprocessor"></span>
00149             <span class="comment">//</span>
00150             <span class="comment">// Allow for the possibility that the problem occured on the</span>
00151             <span class="comment">// DPC stack.</span>
00152             <span class="comment">//</span>
00153 
00154             ULONG TestAddress = (ULONG)RegistrationPointer;
00155 
00156             <span class="keywordflow">if</span> (((TestAddress &amp; 0x3) == 0) &amp;&amp;
00157                 KeGetCurrentIrql() &gt;= <a class="code" href="../../d6/d7/halmips_8h.html#a53">DISPATCH_LEVEL</a>) {
00158 
00159                 PKPRCB Prcb = <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a2">KeGetCurrentPrcb</a>();
00160                 ULONG DpcStack = (ULONG)Prcb-&gt;DpcStack;
00161 
00162                 <span class="keywordflow">if</span> ((Prcb-&gt;DpcRoutineActive) &amp;&amp;
00163                     (HighAddress &lt;= DpcStack) &amp;&amp;
00164                     (TestAddress &gt;= DpcStack - KERNEL_STACK_SIZE)) {
00165 
00166                     <span class="comment">//</span>
00167                     <span class="comment">// This error occured on the DPC stack, switch</span>
00168                     <span class="comment">// stack limits to the DPC stack and restart </span>
00169                     <span class="comment">// the loop.</span>
00170                     <span class="comment">// </span>
00171 
00172                     HighLimit = DpcStack;
00173                     LowLimit = DpcStack - KERNEL_STACK_SIZE;
00174                     <span class="keywordflow">continue</span>;
00175                 }
00176             }
00177 
00178 <span class="preprocessor">#endif</span>
00179 <span class="preprocessor"></span>
00180             ExceptionRecord-&gt;ExceptionFlags |= <a class="code" href="../../d6/d7/halmips_8h.html#a28">EXCEPTION_STACK_INVALID</a>;
00181             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00182         } 
00183 
00184 <span class="preprocessor">#if !defined(WX86_i386)</span>
00185 <span class="preprocessor"></span>
00186         <span class="comment">//</span>
00187         <span class="comment">// The handler must be executed by calling another routine</span>
00188         <span class="comment">// that is written in assembler. This is required because</span>
00189         <span class="comment">// up level addressing of the handler information is required</span>
00190         <span class="comment">// when a nested exception is encountered.</span>
00191         <span class="comment">//</span>
00192 
00193         <span class="keywordflow">if</span> (<a class="code" href="../../d9/d2/ldrp_8h.html#a33">NtGlobalFlag</a> &amp; FLG_ENABLE_EXCEPTION_LOGGING) {
00194             <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = <a class="code" href="../../d5/d9/ntrtlp_8h.html#a48">RtlpLogExceptionHandler</a>(
00195                             ExceptionRecord,
00196                             ContextRecord,
00197                             0,
00198                             (PULONG)RegistrationPointer,
00199                             4 * <span class="keyword">sizeof</span>(ULONG));
00200                     <span class="comment">// can't use sizeof(EXCEPTION_REGISTRATION_RECORD</span>
00201                     <span class="comment">// because we need the 2 dwords above it.</span>
00202         }
00203 <span class="preprocessor">#endif</span>
00204 <span class="preprocessor"></span>
00205         Disposition = <a class="code" href="../../d6/d9/ntrtlppc_8h.html#a0">RtlpExecuteHandlerForException</a>(
00206             ExceptionRecord,
00207             (PVOID)RegistrationPointer,
00208             ContextRecord,
00209             (PVOID)&amp;DispatcherContext,
00210             (PEXCEPTION_ROUTINE)RegistrationPointer-&gt;Handler);
00211 
00212 <span class="preprocessor">#if !defined(WX86_i386)</span>
00213 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (<a class="code" href="../../d9/d2/ldrp_8h.html#a33">NtGlobalFlag</a> &amp; FLG_ENABLE_EXCEPTION_LOGGING) {
00214             <a class="code" href="../../d5/d9/ntrtlp_8h.html#a49">RtlpLogLastExceptionDisposition</a>(Index, Disposition);
00215         }
00216 <span class="preprocessor">#endif</span>
00217 <span class="preprocessor"></span>
00218 
00219         <span class="comment">//</span>
00220         <span class="comment">// If the current scan is within a nested context and the frame</span>
00221         <span class="comment">// just examined is the end of the context region, then clear</span>
00222         <span class="comment">// the nested context frame and the nested exception in the</span>
00223         <span class="comment">// exception flags.</span>
00224         <span class="comment">//</span>
00225 
00226         <span class="keywordflow">if</span> (NestedRegistration == RegistrationPointer) {
00227             ExceptionRecord-&gt;ExceptionFlags &amp;= (~<a class="code" href="../../d6/d7/halmips_8h.html#a29">EXCEPTION_NESTED_CALL</a>);
00228             NestedRegistration = 0;
00229         }
00230 
00231         <span class="comment">//</span>
00232         <span class="comment">// Case on the handler disposition.</span>
00233         <span class="comment">//</span>
00234 
00235         <span class="keywordflow">switch</span> (Disposition) {
00236 
00237             <span class="comment">//</span>
00238             <span class="comment">// The disposition is to continue execution. If the</span>
00239             <span class="comment">// exception is not continuable, then raise the exception</span>
00240             <span class="comment">// STATUS_NONCONTINUABLE_EXCEPTION. Otherwise return</span>
00241             <span class="comment">// TRUE.</span>
00242             <span class="comment">//</span>
00243 
00244         <span class="keywordflow">case</span> <a class="code" href="../../d6/d7/halmips_8h.html#a36">ExceptionContinueExecution</a> :
00245             <span class="keywordflow">if</span> ((ExceptionRecord-&gt;ExceptionFlags &amp;
00246                <a class="code" href="../../d6/d7/halmips_8h.html#a25">EXCEPTION_NONCONTINUABLE</a>) != 0) {
00247                 ExceptionRecord1.ExceptionCode =
00248                                         STATUS_NONCONTINUABLE_EXCEPTION;
00249                 ExceptionRecord1.ExceptionFlags = <a class="code" href="../../d6/d7/halmips_8h.html#a25">EXCEPTION_NONCONTINUABLE</a>;
00250                 ExceptionRecord1.ExceptionRecord = ExceptionRecord;
00251                 ExceptionRecord1.NumberParameters = 0;
00252                 <a class="code" href="../../d9/d9/ppc_2exdsptch_8c.html#a9">RtlRaiseException</a>(&amp;ExceptionRecord1);
00253             } <span class="keywordflow">else</span> {
00254                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00255             }
00256 
00257             <span class="comment">//</span>
00258             <span class="comment">// The disposition is to continue the search. Get next</span>
00259             <span class="comment">// frame address and continue the search.</span>
00260             <span class="comment">//</span>
00261 
00262         <span class="keywordflow">case</span> <a class="code" href="../../d6/d7/halmips_8h.html#a37">ExceptionContinueSearch</a> :
00263             <span class="keywordflow">break</span>;
00264 
00265             <span class="comment">//</span>
00266             <span class="comment">// The disposition is nested exception. Set the nested</span>
00267             <span class="comment">// context frame to the establisher frame address and set</span>
00268             <span class="comment">// nested exception in the exception flags.</span>
00269             <span class="comment">//</span>
00270 
00271         <span class="keywordflow">case</span> <a class="code" href="../../d6/d7/halmips_8h.html#a38">ExceptionNestedException</a> :
00272             ExceptionRecord-&gt;ExceptionFlags |= <a class="code" href="../../d6/d7/halmips_8h.html#a29">EXCEPTION_NESTED_CALL</a>;
00273             <span class="keywordflow">if</span> (DispatcherContext.RegistrationPointer &gt; NestedRegistration) {
00274                 NestedRegistration = DispatcherContext.RegistrationPointer;
00275             }
00276             <span class="keywordflow">break</span>;
00277 
00278             <span class="comment">//</span>
00279             <span class="comment">// All other disposition values are invalid. Raise</span>
00280             <span class="comment">// invalid disposition exception.</span>
00281             <span class="comment">//</span>
00282 
00283         <span class="keywordflow">default</span> :
00284             ExceptionRecord1.ExceptionCode = STATUS_INVALID_DISPOSITION;
00285             ExceptionRecord1.ExceptionFlags = <a class="code" href="../../d6/d7/halmips_8h.html#a25">EXCEPTION_NONCONTINUABLE</a>;
00286             ExceptionRecord1.ExceptionRecord = ExceptionRecord;
00287             ExceptionRecord1.NumberParameters = 0;
00288             <a class="code" href="../../d9/d9/ppc_2exdsptch_8c.html#a9">RtlRaiseException</a>(&amp;ExceptionRecord1);
00289             <span class="keywordflow">break</span>;
00290         }
00291 
00292         <span class="comment">//</span>
00293         <span class="comment">// If chain goes in wrong direction or loops, report an</span>
00294         <span class="comment">// invalid exception stack, otherwise go on to the next one.</span>
00295         <span class="comment">//</span>
00296 
00297         RegistrationPointer = RegistrationPointer-&gt;Next;
00298     }
00299     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00300 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="i386/exdsptch.c::RtlpExecuteHandlerForException" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> EXCEPTION_DISPOSITION RtlpExecuteHandlerForException           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PEXCEPTION_RECORD&nbsp;</td>
          <td class="mdname" nowrap> <em>ExceptionRecord</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>EstablisherFrame</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCONTEXT&nbsp;</td>
          <td class="mdname" nowrap> <em>ContextRecord</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>DispatcherContext</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PEXCEPTION_ROUTINE&nbsp;</td>
          <td class="mdname" nowrap> <em>ExceptionRoutine</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="i386/exdsptch.c::RtlpExecuteHandlerForUnwind" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> EXCEPTION_DISPOSITION RtlpExecuteHandlerForUnwind           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PEXCEPTION_RECORD&nbsp;</td>
          <td class="mdname" nowrap> <em>ExceptionRecord</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>EstablisherFrame</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCONTEXT&nbsp;</td>
          <td class="mdname" nowrap> <em>ContextRecord</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>DispatcherContext</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PEXCEPTION_ROUTINE&nbsp;</td>
          <td class="mdname" nowrap> <em>ExceptionRoutine</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="i386/exdsptch.c::RtlUnwind" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID RtlUnwind           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID TargetFrame&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID TargetIp&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PEXCEPTION_RECORD ExceptionRecord&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>ReturnValue</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d8/i386_2exdsptch_8c-source.html#l00303">303</a> of file <a class="el" href="../../d7/d8/i386_2exdsptch_8c-source.html">i386/exdsptch.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00240">CONTEXT_CONTROL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00242">CONTEXT_INTEGER</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00087">DISPATCH_LEVEL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00049">EXCEPTION_EXIT_UNWIND</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00047">EXCEPTION_NONCONTINUABLE</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00048">EXCEPTION_UNWINDING</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00062">ExceptionCollidedUnwind</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00060">ExceptionContinueSearch</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00069">KeGetCurrentPrcb</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d9/ntrtl386_8h.html#a0">RtlpCaptureContext()</a>, <a class="el" href="../../d6/d9/ntrtlppc_8h.html#a1">RtlpExecuteHandlerForUnwind()</a>, <a class="el" href="../../d3/d9/ntrtli64_8h.html#a3">RtlpGetRegistrationHead()</a>, <a class="el" href="../../d1/d9/ntrtl386_8h.html#a3">RtlpGetReturnAddress()</a>, <a class="el" href="../../d9/d9/rtl_2ia64_2miscc_8c-source.html#l00126">RtlpGetStackLimits()</a>, <a class="el" href="../../d8/d8/ia64_2exdsptch_8c-source.html#l00157">RtlpUnlinkHandler()</a>, <a class="el" href="../../d0/d9/ppc_2exdsptch_8c-source.html#l00466">RtlRaiseException()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>00312                    :
00313 
00314     This function initiates an unwind of <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a69">procedure</a> call frames. The machine
00315     state at <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> time of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> call to unwind <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> captured in a context record
00316     and <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> unwinding flag <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> set in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> exception flags of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> exception
00317     record. If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> TargetFrame parameter <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not specified, then <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d9/d1/fedefs_8h.html#a16">exit</a> unwind
00318     flag <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> also set in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> exception flags of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> exception record. <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> backward
00319     walk through <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a69">procedure</a> call frames <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> then performed to find <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> target
00320     of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> unwind operation.
00321 
00322     N.B.    The captured context passed to unwinding handlers will not be
00323             a  completely accurate context set <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> 386.  This <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> because
00324             there isn'<a class="code" href="../../d4/d1/genmips_8c.html#a17">t</a> a standard stack frame in which registers are stored.
00325 
00326             Only <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> integer registers are affected.  The segement and
00327             <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a58">control</a> registers (ebp, esp) will have correct values for
00328             the flat 32 bit environment.
00329 
00330     N.B.    If you change the number of arguments, make sure you change the
00331             adjustment of ESP after the call to RtlpCaptureContext (for
00332             STDCALL calling convention)
00333 
00334 Arguments:
00335 
00336     TargetFrame - Supplies an optional pointer to the call frame that is the
00337         target of the unwind. If this parameter is not specified, then an exit
00338         unwind is performed.
00339 
00340     TargetIp - Supplies an optional instruction address that specifies the
00341         continuation address of the unwind. This address is ignored if the
00342         target frame parameter is not specified.
00343 
00344     ExceptionRecord - Supplies an optional pointer to an exception record.
00345 
00346     ReturnValue - Supplies a value that is to be placed in the integer
00347         function return register just before continuing execution.
00348 
00349 Return Value:
00350 
00351     None.
00352 
00353 --*/
00354 
00355 {
00356     PCONTEXT ContextRecord;
00357     CONTEXT ContextRecord1;
00358     <a class="code" href="../../d0/d6/struct__DISPATCHER__CONTEXT.html">DISPATCHER_CONTEXT</a> DispatcherContext;
00359     EXCEPTION_DISPOSITION Disposition;
00360     PEXCEPTION_REGISTRATION_RECORD RegistrationPointer;
00361     PEXCEPTION_REGISTRATION_RECORD PriorPointer;
00362     ULONG HighAddress;
00363     ULONG HighLimit;
00364     ULONG LowLimit;
00365     EXCEPTION_RECORD ExceptionRecord1;
00366     EXCEPTION_RECORD ExceptionRecord2;
00367 
00368     <span class="comment">//</span>
00369     <span class="comment">// Get current stack limits.</span>
00370     <span class="comment">//</span>
00371 
00372     <a class="code" href="../../d5/d9/ntrtlp_8h.html#a30">RtlpGetStackLimits</a>(&amp;LowLimit, &amp;HighLimit);
00373 
00374     <span class="comment">//</span>
00375     <span class="comment">// If an exception record is not specified, then build a local exception</span>
00376     <span class="comment">// record for use in calling exception handlers during the unwind operation.</span>
00377     <span class="comment">//</span>
00378 
00379     <span class="keywordflow">if</span> (ARGUMENT_PRESENT(ExceptionRecord) == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00380         ExceptionRecord = &amp;ExceptionRecord1;
00381         ExceptionRecord1.ExceptionCode = STATUS_UNWIND;
00382         ExceptionRecord1.ExceptionFlags = 0;
00383         ExceptionRecord1.ExceptionRecord = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00384         ExceptionRecord1.ExceptionAddress = <a class="code" href="../../d1/d9/ntrtl386_8h.html#a3">RtlpGetReturnAddress</a>();
00385         ExceptionRecord1.NumberParameters = 0;
00386     }
00387 
00388     <span class="comment">//</span>
00389     <span class="comment">// If the target frame of the unwind is specified, then set EXCEPTION_UNWINDING</span>
00390     <span class="comment">// flag in the exception flags. Otherwise set both EXCEPTION_EXIT_UNWIND and</span>
00391     <span class="comment">// EXCEPTION_UNWINDING flags in the exception flags.</span>
00392     <span class="comment">//</span>
00393 
00394     <span class="keywordflow">if</span> (ARGUMENT_PRESENT(TargetFrame) == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
00395         ExceptionRecord-&gt;ExceptionFlags |= <a class="code" href="../../d6/d7/halmips_8h.html#a26">EXCEPTION_UNWINDING</a>;
00396     } <span class="keywordflow">else</span> {
00397         ExceptionRecord-&gt;ExceptionFlags |= (<a class="code" href="../../d6/d7/halmips_8h.html#a26">EXCEPTION_UNWINDING</a> |
00398                                                         <a class="code" href="../../d6/d7/halmips_8h.html#a27">EXCEPTION_EXIT_UNWIND</a>);
00399     }
00400 
00401     <span class="comment">//</span>
00402     <span class="comment">// Capture the context.</span>
00403     <span class="comment">//</span>
00404 
00405     ContextRecord = &amp;ContextRecord1;
00406     ContextRecord1.ContextFlags = <a class="code" href="../../d6/d7/halmips_8h.html#a155">CONTEXT_INTEGER</a> | <a class="code" href="../../d6/d7/halmips_8h.html#a153">CONTEXT_CONTROL</a> | CONTEXT_SEGMENTS;
00407     <a class="code" href="../../d1/d9/ntrtl386_8h.html#a0">RtlpCaptureContext</a>(ContextRecord);
00408 
00409 <span class="preprocessor">#ifdef STD_CALL</span>
00410 <span class="preprocessor"></span>    <span class="comment">//</span>
00411     <span class="comment">// Adjust captured context to pop our arguments off the stack</span>
00412     <span class="comment">//</span>
00413     ContextRecord-&gt;Esp += <span class="keyword">sizeof</span>(TargetFrame) +
00414                           <span class="keyword">sizeof</span>(TargetIp)    +
00415                           <span class="keyword">sizeof</span>(ExceptionRecord) +
00416                           <span class="keyword">sizeof</span>(ReturnValue);
00417 <span class="preprocessor">#endif</span>
00418 <span class="preprocessor"></span>    ContextRecord-&gt;Eax = (ULONG)ReturnValue;
00419 
00420     <span class="comment">//</span>
00421     <span class="comment">// Scan backward through the call frame hierarchy, calling exception</span>
00422     <span class="comment">// handlers as they are encountered, until the target frame of the unwind</span>
00423     <span class="comment">// is reached.</span>
00424     <span class="comment">//</span>
00425 
00426     RegistrationPointer = <a class="code" href="../../d3/d9/ntrtli64_8h.html#a3">RtlpGetRegistrationHead</a>();
00427     <span class="keywordflow">while</span> (RegistrationPointer != EXCEPTION_CHAIN_END) {
00428 
00429         <span class="comment">//</span>
00430         <span class="comment">// If this is the target of the unwind, then continue execution</span>
00431         <span class="comment">// by calling the continue system service.</span>
00432         <span class="comment">//</span>
00433 
00434         <span class="keywordflow">if</span> ((ULONG)RegistrationPointer == (ULONG)TargetFrame) {
00435             ZwContinue(ContextRecord, FALSE);
00436 
00437         <span class="comment">//</span>
00438         <span class="comment">// If the target frame is lower in the stack than the current frame,</span>
00439         <span class="comment">// then raise STATUS_INVALID_UNWIND exception.</span>
00440         <span class="comment">//</span>
00441 
00442         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( (ARGUMENT_PRESENT(TargetFrame) == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) &amp;&amp;
00443                     ((ULONG)TargetFrame &lt; (ULONG)RegistrationPointer) ) {
00444             ExceptionRecord2.ExceptionCode = STATUS_INVALID_UNWIND_TARGET;
00445             ExceptionRecord2.ExceptionFlags = <a class="code" href="../../d6/d7/halmips_8h.html#a25">EXCEPTION_NONCONTINUABLE</a>;
00446             ExceptionRecord2.ExceptionRecord = ExceptionRecord;
00447             ExceptionRecord2.NumberParameters = 0;
00448             <a class="code" href="../../d9/d9/ppc_2exdsptch_8c.html#a9">RtlRaiseException</a>(&amp;ExceptionRecord2);
00449         }
00450 
00451         <span class="comment">//</span>
00452         <span class="comment">// If the call frame is not within the specified stack limits or the</span>
00453         <span class="comment">// call frame is unaligned, then raise the exception STATUS_BAD_STACK.</span>
00454         <span class="comment">// Else restore the state from the specified frame to the context</span>
00455         <span class="comment">// record.</span>
00456         <span class="comment">//</span>
00457 
00458         HighAddress = (ULONG)RegistrationPointer +
00459             <span class="keyword">sizeof</span>(EXCEPTION_REGISTRATION_RECORD);
00460 
00461         <span class="keywordflow">if</span> ( ((ULONG)RegistrationPointer &lt; LowLimit) ||
00462              (HighAddress &gt; HighLimit) ||
00463              (((ULONG)RegistrationPointer &amp; 0x3) != 0) ) {
00464 
00465 <span class="preprocessor">#if defined(NTOS_KERNEL_RUNTIME)</span>
00466 <span class="preprocessor"></span>
00467             <span class="comment">//</span>
00468             <span class="comment">// Allow for the possibility that the problem occured on the</span>
00469             <span class="comment">// DPC stack.</span>
00470             <span class="comment">//</span>
00471 
00472             ULONG TestAddress = (ULONG)RegistrationPointer;
00473 
00474             <span class="keywordflow">if</span> (((TestAddress &amp; 0x3) == 0) &amp;&amp;
00475                 KeGetCurrentIrql() &gt;= <a class="code" href="../../d6/d7/halmips_8h.html#a53">DISPATCH_LEVEL</a>) {
00476 
00477                 PKPRCB Prcb = <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a2">KeGetCurrentPrcb</a>();
00478                 ULONG DpcStack = (ULONG)Prcb-&gt;DpcStack;
00479 
00480                 <span class="keywordflow">if</span> ((Prcb-&gt;DpcRoutineActive) &amp;&amp;
00481                     (HighAddress &lt;= DpcStack) &amp;&amp;
00482                     (TestAddress &gt;= DpcStack - KERNEL_STACK_SIZE)) {
00483 
00484                     <span class="comment">//</span>
00485                     <span class="comment">// This error occured on the DPC stack, switch</span>
00486                     <span class="comment">// stack limits to the DPC stack and restart </span>
00487                     <span class="comment">// the loop.</span>
00488                     <span class="comment">// </span>
00489 
00490                     HighLimit = DpcStack;
00491                     LowLimit = DpcStack - KERNEL_STACK_SIZE;
00492                     <span class="keywordflow">continue</span>;
00493                 }
00494             }
00495 
00496 <span class="preprocessor">#endif</span>
00497 <span class="preprocessor"></span>
00498             ExceptionRecord2.ExceptionCode = STATUS_BAD_STACK;
00499             ExceptionRecord2.ExceptionFlags = <a class="code" href="../../d6/d7/halmips_8h.html#a25">EXCEPTION_NONCONTINUABLE</a>;
00500             ExceptionRecord2.ExceptionRecord = ExceptionRecord;
00501             ExceptionRecord2.NumberParameters = 0;
00502             <a class="code" href="../../d9/d9/ppc_2exdsptch_8c.html#a9">RtlRaiseException</a>(&amp;ExceptionRecord2);
00503         } <span class="keywordflow">else</span> {
00504 
00505             <span class="comment">//</span>
00506             <span class="comment">// The handler must be executed by calling another routine</span>
00507             <span class="comment">// that is written in assembler. This is required because</span>
00508             <span class="comment">// up level addressing of the handler information is required</span>
00509             <span class="comment">// when a collided unwind is encountered.</span>
00510             <span class="comment">//</span>
00511 
00512             Disposition = <a class="code" href="../../d6/d9/ntrtlppc_8h.html#a1">RtlpExecuteHandlerForUnwind</a>(
00513                 ExceptionRecord,
00514                 (PVOID)RegistrationPointer,
00515                 ContextRecord,
00516                 (PVOID)&amp;DispatcherContext,
00517                 RegistrationPointer-&gt;Handler);
00518 
00519             <span class="comment">//</span>
00520             <span class="comment">// Case on the handler disposition.</span>
00521             <span class="comment">//</span>
00522 
00523             <span class="keywordflow">switch</span> (Disposition) {
00524 
00525                 <span class="comment">//</span>
00526                 <span class="comment">// The disposition is to continue the search. Get next</span>
00527                 <span class="comment">// frame address and continue the search.</span>
00528                 <span class="comment">//</span>
00529 
00530             <span class="keywordflow">case</span> <a class="code" href="../../d6/d7/halmips_8h.html#a37">ExceptionContinueSearch</a> :
00531                 <span class="keywordflow">break</span>;
00532 
00533                 <span class="comment">//</span>
00534                 <span class="comment">// The disposition is colided unwind. Maximize the target</span>
00535                 <span class="comment">// of the unwind and change the context record pointer.</span>
00536                 <span class="comment">//</span>
00537 
00538             <span class="keywordflow">case</span> <a class="code" href="../../d6/d7/halmips_8h.html#a39">ExceptionCollidedUnwind</a> :
00539 
00540                 <span class="comment">//</span>
00541                 <span class="comment">// Pick up the registration pointer that was active at</span>
00542                 <span class="comment">// the time of the unwind, and simply continue.</span>
00543                 <span class="comment">//</span>
00544 
00545                 RegistrationPointer = DispatcherContext.<a class="code" href="../../d0/d6/struct__DISPATCHER__CONTEXT.html#o0">RegistrationPointer</a>;
00546                 <span class="keywordflow">break</span>;
00547 
00548 
00549                 <span class="comment">//</span>
00550                 <span class="comment">// All other disposition values are invalid. Raise</span>
00551                 <span class="comment">// invalid disposition exception.</span>
00552                 <span class="comment">//</span>
00553 
00554             <span class="keywordflow">default</span> :
00555                 ExceptionRecord2.ExceptionCode = STATUS_INVALID_DISPOSITION;
00556                 ExceptionRecord2.ExceptionFlags = <a class="code" href="../../d6/d7/halmips_8h.html#a25">EXCEPTION_NONCONTINUABLE</a>;
00557                 ExceptionRecord2.ExceptionRecord = ExceptionRecord;
00558                 ExceptionRecord2.NumberParameters = 0;
00559                 <a class="code" href="../../d9/d9/ppc_2exdsptch_8c.html#a9">RtlRaiseException</a>(&amp;ExceptionRecord2);
00560                 <span class="keywordflow">break</span>;
00561             }
00562 
00563             <span class="comment">//</span>
00564             <span class="comment">// Step to next registration record</span>
00565             <span class="comment">//</span>
00566 
00567             PriorPointer = RegistrationPointer;
00568             RegistrationPointer = RegistrationPointer-&gt;Next;
00569 
00570             <span class="comment">//</span>
00571             <span class="comment">// Unlink the unwind handler, since it's been called.</span>
00572             <span class="comment">//</span>
00573 
00574             <a class="code" href="../../d3/d9/ntrtli64_8h.html#a2">RtlpUnlinkHandler</a>(PriorPointer);
00575 
00576             <span class="comment">//</span>
00577             <span class="comment">// If chain goes in wrong direction or loops, raise an</span>
00578             <span class="comment">// exception.</span>
00579             <span class="comment">//</span>
00580 
00581         }
00582     }
00583 
00584     <span class="keywordflow">if</span> (TargetFrame == EXCEPTION_CHAIN_END) {
00585 
00586         <span class="comment">//</span>
00587         <span class="comment">//  Caller simply wants to unwind all exception records.</span>
00588         <span class="comment">//  This differs from an exit_unwind in that no "exit" is desired.</span>
00589         <span class="comment">//  Do a normal continue, since we've effectively found the</span>
00590         <span class="comment">//  "target" the caller wanted.</span>
00591         <span class="comment">//</span>
00592 
00593         ZwContinue(ContextRecord, FALSE);
00594 
00595     } <span class="keywordflow">else</span> {
00596 
00597         <span class="comment">//</span>
00598         <span class="comment">//  Either (1) a real exit unwind was performed, or (2) the</span>
00599         <span class="comment">//  specified TargetFrame is not present in the exception handler</span>
00600         <span class="comment">//  list.  In either case, give debugger and subsystem a chance</span>
00601         <span class="comment">//  to see the unwind.</span>
00602         <span class="comment">//</span>
00603 
00604         ZwRaiseException(ExceptionRecord, ContextRecord, FALSE);
00605 
00606     }
00607     <span class="keywordflow">return</span>;
00608 }
}
</div></pre>    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:43:35 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
