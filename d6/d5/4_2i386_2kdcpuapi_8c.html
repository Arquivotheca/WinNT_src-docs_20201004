<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: 4/i386/kdcpuapi.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>kdcpuapi.c File Reference</h1><code>#include &lt;stdio.h&gt;</code><br>
<code>#include "<a class="el" href="../../d2/d6/4_2kdp_8h-source.html">kdp.h</a>"</code><br>

<p>
<a href="../../d7/d4/4_2i386_2kdcpuapi_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d5/4_2i386_2kdcpuapi_8c.html#a0">END_OF_CONTROL_SPACE</a></td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>LONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d5/4_2i386_2kdcpuapi_8c.html#a5">KdpLevelChange</a> (ULONG Pc, PCONTEXT ContextRecord, PBOOLEAN SpecialCall)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d5/4_2i386_2kdcpuapi_8c.html#a6">regValue</a> (UCHAR reg, PCONTEXT ContextRecord)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d5/4_2i386_2kdcpuapi_8c.html#a7">KdpIsSpecialCall</a> (ULONG Pc, PCONTEXT ContextRecord, UCHAR opcode, UCHAR ModRM)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d5/4_2i386_2kdcpuapi_8c.html#a8">KdpGetReturnAddress</a> (PCONTEXT ContextRecord)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d5/4_2i386_2kdcpuapi_8c.html#a9">KdpGetCallNextOffset</a> (ULONG Pc, PCONTEXT ContextRecord)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d5/4_2i386_2kdcpuapi_8c.html#a10">KdpIsTryFinallyReturn</a> (ULONG Pc, PCONTEXT ContextRecord)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d5/4_2i386_2kdcpuapi_8c.html#a11">KdpSetLoadState</a> (IN PDBGKD_WAIT_STATE_CHANGE64 WaitStateChange, IN PCONTEXT ContextRecord)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d5/4_2i386_2kdcpuapi_8c.html#a12">KdpSetStateChange</a> (IN PDBGKD_WAIT_STATE_CHANGE64 WaitStateChange, IN PEXCEPTION_RECORD ExceptionRecord, IN PCONTEXT ContextRecord, IN BOOLEAN SecondChance)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d5/4_2i386_2kdcpuapi_8c.html#a13">KdpGetStateChange</a> (IN PDBGKD_MANIPULATE_STATE64 ManipulateState, IN PCONTEXT ContextRecord)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d5/4_2i386_2kdcpuapi_8c.html#a14">KdpReadControlSpace</a> (IN PDBGKD_MANIPULATE_STATE64 m, IN PSTRING AdditionalData, IN PCONTEXT Context)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d5/4_2i386_2kdcpuapi_8c.html#a15">KdpWriteControlSpace</a> (IN PDBGKD_MANIPULATE_STATE64 m, IN PSTRING AdditionalData, IN PCONTEXT Context)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d5/4_2i386_2kdcpuapi_8c.html#a16">KdpReadIoSpace</a> (IN PDBGKD_MANIPULATE_STATE64 m, IN PSTRING AdditionalData, IN PCONTEXT Context)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d5/4_2i386_2kdcpuapi_8c.html#a17">KdpWriteIoSpace</a> (IN PDBGKD_MANIPULATE_STATE64 m, IN PSTRING AdditionalData, IN PCONTEXT Context)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d5/4_2i386_2kdcpuapi_8c.html#a18">KdpReadMachineSpecificRegister</a> (IN PDBGKD_MANIPULATE_STATE64 m, IN PSTRING AdditionalData, IN PCONTEXT Context)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d5/4_2i386_2kdcpuapi_8c.html#a19">KdpWriteMachineSpecificRegister</a> (IN PDBGKD_MANIPULATE_STATE64 m, IN PSTRING AdditionalData, IN PCONTEXT Context)</td></tr>

<tr><td colspan=2><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d5/4_2i386_2kdcpuapi_8c.html#a1">KdpCurrentSymbolStart</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d5/4_2i386_2kdcpuapi_8c.html#a2">KdpCurrentSymbolEnd</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d5/4_2i386_2kdcpuapi_8c.html#a3">KdSpecialCalls</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d5/4_2i386_2kdcpuapi_8c.html#a4">KdNumberOfSpecialCalls</a></td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a0" doxytag="4/i386/kdcpuapi.c::END_OF_CONTROL_SPACE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define END_OF_CONTROL_SPACE          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d4/4_2i386_2kdcpuapi_8c-source.html#l00028">28</a> of file <a class="el" href="../../d7/d4/4_2i386_2kdcpuapi_8c-source.html">4/i386/kdcpuapi.c</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a9" doxytag="4/i386/kdcpuapi.c::KdpGetCallNextOffset" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG KdpGetCallNextOffset           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Pc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PCONTEXT&nbsp;</td>
          <td class="mdname" nowrap> <em>ContextRecord</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="4/i386/kdcpuapi.c::KdpGetReturnAddress" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG KdpGetReturnAddress           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PCONTEXT&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>ContextRecord</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d3/d4/i386_2kdcpuapi_8c-source.html#l01222">KdpGetCallNextOffset()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="4/i386/kdcpuapi.c::KdpGetStateChange" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KdpGetStateChange           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PDBGKD_MANIPULATE_STATE64&nbsp;</td>
          <td class="mdname" nowrap> <em>ManipulateState</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCONTEXT&nbsp;</td>
          <td class="mdname" nowrap> <em>ContextRecord</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d4/4_2i386_2kdcpuapi_8c-source.html#l00728">728</a> of file <a class="el" href="../../d7/d4/4_2i386_2kdcpuapi_8c-source.html">4/i386/kdcpuapi.c</a>.
<p>
References <a class="el" href="../../d3/d4/i386_2kdcpuapi_8c-source.html#l00030">KdpCurrentSymbolEnd</a>, <a class="el" href="../../d3/d4/i386_2kdcpuapi_8c-source.html#l00030">KdpCurrentSymbolStart</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02776">KeNumberProcessors</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02782">KiProcessorBlock</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>00735                    :
00736 
00737     Extract continuation <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a58">control</a> data from Manipulate_State message
00738 
00739 Arguments:
00740 
00741     ManipulateState - supplies pointer to Manipulate_State packet
00742 
00743     ContextRecord - Supplies a pointer to a context record.
00744 
00745 Return Value:
00746 
00747     None.
00748 
00749 --*/
00750 
00751 {
00752     PKPRCB Prcb;
00753     ULONG  Processor;
00754 
00755     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(ManipulateState-&gt;u.Continue2.ContinueStatus) == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
00756 
00757         <span class="comment">//</span>
00758         <span class="comment">// If NT_SUCCESS returns TRUE, then the debugger is doing a</span>
00759         <span class="comment">// continue, and it makes sense to apply control changes.</span>
00760         <span class="comment">// Otherwise the debugger is saying that it doesn't know what</span>
00761         <span class="comment">// to do with this exception, so control values are ignored.</span>
00762         <span class="comment">//</span>
00763 
00764         <span class="keywordflow">if</span> (ManipulateState-&gt;u.Continue2.ControlSet.TraceFlag == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
00765             ContextRecord-&gt;EFlags |= 0x100<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>;
00766 
00767         } <span class="keywordflow">else</span> {
00768             ContextRecord-&gt;EFlags &amp;= ~0x100<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>;
00769 
00770         }
00771 
00772         <span class="keywordflow">for</span> (Processor = 0; Processor &lt; (ULONG)<a class="code" href="../../d4/d9/ke_8h.html#a133">KeNumberProcessors</a>; Processor++) {
00773             Prcb = <a class="code" href="../../d4/d9/ke_8h.html#a139">KiProcessorBlock</a>[Processor];
00774 
00775             Prcb-&gt;ProcessorState.SpecialRegisters.KernelDr7 =
00776                 ManipulateState-&gt;u.Continue2.ControlSet.Dr7;
00777 
00778             Prcb-&gt;ProcessorState.SpecialRegisters.KernelDr6 = 0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>;
00779         }
00780         <span class="keywordflow">if</span> (ManipulateState-&gt;u.Continue2.ControlSet.CurrentSymbolStart != 1) {
00781             <a class="code" href="../../d2/d5/i386_2kdcpuapi_8c.html#a1">KdpCurrentSymbolStart</a> = ManipulateState-&gt;u.Continue2.ControlSet.CurrentSymbolStart;
00782             <a class="code" href="../../d2/d5/i386_2kdcpuapi_8c.html#a2">KdpCurrentSymbolEnd</a> = ManipulateState-&gt;u.Continue2.ControlSet.CurrentSymbolEnd;
00783         }
00784     }
00785 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="4/i386/kdcpuapi.c::KdpIsSpecialCall" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN KdpIsSpecialCall           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Pc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PCONTEXT&nbsp;</td>
          <td class="mdname" nowrap> <em>ContextRecord</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>opcode</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>ModRM</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d3/d4/i386_2kdcpuapi_8c-source.html#l00183">KdpLevelChange()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="4/i386/kdcpuapi.c::KdpIsTryFinallyReturn" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN KdpIsTryFinallyReturn           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Pc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PCONTEXT&nbsp;</td>
          <td class="mdname" nowrap> <em>ContextRecord</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d4/4_2i386_2kdcpuapi_8c-source.html#l00096">96</a> of file <a class="el" href="../../d7/d4/4_2i386_2kdcpuapi_8c-source.html">4/i386/kdcpuapi.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d4/i386_2kdcpuapi_8c-source.html#l00030">KdpCurrentSymbolEnd</a>, <a class="el" href="../../d3/d4/i386_2kdcpuapi_8c-source.html#l00030">KdpCurrentSymbolStart</a>, <a class="el" href="../../d9/d5/kdmove_8c-source.html#l00031">KdpMoveMemory()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d3/d4/i386_2kdcpuapi_8c-source.html#l00183">KdpLevelChange()</a>.
<p>
<pre class="fragment"><div>00100 {
00101     ULONG retaddr;
00102     ULONG calldisp;
00103     UCHAR inst;
00104 
00105     <span class="comment">//</span>
00106     <span class="comment">//  The complier generates code for a try-finally that involves having</span>
00107     <span class="comment">//  a ret instruction that does not match with a call instruction.</span>
00108     <span class="comment">//  This ret never returns a value (ie, it's a c3 return and not a</span>
00109     <span class="comment">//  c2).  It always returns into the current symbol scope.  It is never</span>
00110     <span class="comment">//  preceeded by a leave, which (hopefully) should differentiate it</span>
00111     <span class="comment">//  from recursive returns.  Check for this, and if we find it count</span>
00112     <span class="comment">//  it as *0* level change.</span>
00113     <span class="comment">//</span>
00114     <span class="comment">//  As an optimization, the compiler will often change:</span>
00115     <span class="comment">//      CALL</span>
00116     <span class="comment">//      RET</span>
00117     <span class="comment">//  into:</span>
00118     <span class="comment">//      JMP</span>
00119     <span class="comment">//  In either case, we figure out the return address.  It's the first 4 bytes</span>
00120     <span class="comment">//  on the stack.</span>
00121     <span class="comment">//</span>
00122 
00123     <a class="code" href="../../d1/d7/4_2kdp_8h.html#a110">KdpMoveMemory</a>( (PCHAR)&amp;retaddr, (PCHAR)ContextRecord-&gt;Esp, 4 );
00124 
00125 <span class="comment">//  DPRINT(( "Start %x return %x end %x\n", KdpCurrentSymbolStart, retaddr, KdpCurrentSymbolEnd ));</span>
00126 
00127     <span class="keywordflow">if</span> ( (<a class="code" href="../../d2/d5/i386_2kdcpuapi_8c.html#a1">KdpCurrentSymbolStart</a> &lt; retaddr) &amp;&amp; (retaddr &lt; <a class="code" href="../../d2/d5/i386_2kdcpuapi_8c.html#a2">KdpCurrentSymbolEnd</a>) ) {
00128 
00129         <span class="comment">//</span>
00130         <span class="comment">//  Well, things aren't this nice.  We may have transferred but not yet</span>
00131         <span class="comment">//  updated the start/end.  This case occurs in a call to a thunk.  We</span>
00132         <span class="comment">//  look to see if the instruction before the return address is a call.</span>
00133         <span class="comment">//  Gross and not 100% reliable.</span>
00134         <span class="comment">//</span>
00135 
00136         <a class="code" href="../../d1/d7/4_2kdp_8h.html#a110">KdpMoveMemory</a>( (PCHAR)&amp;inst, (PCHAR)retaddr - 5, 1 );
00137         <a class="code" href="../../d1/d7/4_2kdp_8h.html#a110">KdpMoveMemory</a>( (PCHAR)&amp;calldisp, (PCHAR)retaddr - 4, 4 );
00138 
00139         <span class="keywordflow">if</span> (inst == 0xe8 &amp;&amp; calldisp + retaddr == Pc) {
00140 <span class="comment">//  DPRINT(( "call to thunk @ %x\n", Pc ));</span>
00141             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00142         }
00143 
00144         <span class="comment">//</span>
00145         <span class="comment">//  returning to the current function.  Either a finally</span>
00146         <span class="comment">//  or a recursive return.  Check for a leave.  This is not 100%</span>
00147         <span class="comment">//  reliable since we are betting on an instruction longer than a byte</span>
00148         <span class="comment">//  and not ending with 0xc9.</span>
00149         <span class="comment">//</span>
00150 
00151         <a class="code" href="../../d1/d7/4_2kdp_8h.html#a110">KdpMoveMemory</a>( (PCHAR)&amp;inst, (PCHAR)Pc-1, 1 );
00152 
00153         <span class="keywordflow">if</span> ( inst != 0xc9 ) {
00154             <span class="comment">// not a leave.  Assume a try-finally.</span>
00155 <span class="comment">//  DPRINT(( "transfer at %x is try-finally\n", Pc ));</span>
00156             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00157         }
00158     }
00159 
00160     <span class="comment">//</span>
00161     <span class="comment">//  This appears to be a true RET instruction</span>
00162     <span class="comment">//</span>
00163 
00164     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00165 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="4/i386/kdcpuapi.c::KdpLevelChange" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LONG KdpLevelChange           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Pc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PCONTEXT&nbsp;</td>
          <td class="mdname" nowrap> <em>ContextRecord</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PBOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>SpecialCall</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a14" doxytag="4/i386/kdcpuapi.c::KdpReadControlSpace" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KdpReadControlSpace           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PDBGKD_MANIPULATE_STATE64&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSTRING&nbsp;</td>
          <td class="mdname" nowrap> <em>AdditionalData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCONTEXT&nbsp;</td>
          <td class="mdname" nowrap> <em>Context</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d4/4_2i386_2kdcpuapi_8c-source.html#l00789">789</a> of file <a class="el" href="../../d7/d4/4_2i386_2kdcpuapi_8c-source.html">4/i386/kdcpuapi.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d9/d5/kdmove_8c-source.html#l00031">KdpMoveMemory()</a>, <a class="el" href="../../d0/d4/kdcomio_8c-source.html#l00683">KdpSendPacket()</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02776">KeNumberProcessors</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02782">KiProcessorBlock</a>, <a class="el" href="../../d5/d0/genmips_8c-source.html#l00109">t()</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
<pre class="fragment"><div>00797                    :
00798 
00799     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called in response of a read <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a58">control</a> space state
00800     manipulation message.  Its function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to read implementation
00801     specific system data.
00802 
00803     IMPLEMENTATION NOTE:
00804 
00805         On <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> X86, <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a58">control</a> space <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> defined as follows:
00806 
00807             0:  Base of KPROCESSOR_STATE structure. (KPRCB.ProcessorState)
00808                     This includes CONTEXT record,
00809                     followed by a SPECIAL_REGISTERs record
00810 
00811 Arguments:
00812 
00813     m - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> state manipulation message.
00814 
00815     AdditionalData - Supplies any additional data <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> message.
00816 
00817     Context - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current context.
00818 
00819 Return Value:
00820 
00821     None.
00822 
00823 --*/
00824 
00825 {
00826     PDBGKD_READ_MEMORY64 a = &amp;m-&gt;u.ReadMemory;
00827     STRING MessageHeader;
00828     ULONG Length, <a class="code" href="../../d4/d1/genmips_8c.html#a17">t</a>;
00829     PVOID StartAddr;
00830 
00831     MessageHeader.Length = <span class="keyword">sizeof</span>(*m);
00832     MessageHeader.Buffer = (PCHAR)m;
00833 
00834     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(AdditionalData-&gt;Length == 0);
00835 
00836     <span class="keywordflow">if</span> (a-&gt;TransferCount &gt; (PACKET_MAX_SIZE - <span class="keyword">sizeof</span>(DBGKD_MANIPULATE_STATE64))) {
00837         Length = PACKET_MAX_SIZE - <span class="keyword">sizeof</span>(DBGKD_MANIPULATE_STATE64);
00838     } <span class="keywordflow">else</span> {
00839         Length = a-&gt;TransferCount;
00840     }
00841     <span class="keywordflow">if</span> ((a-&gt;TargetBaseAddress &lt; (ULONG64)(<span class="keyword">sizeof</span>(KPROCESSOR_STATE))) &amp;&amp;
00842         (m-&gt;Processor &lt; (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)<a class="code" href="../../d4/d9/ke_8h.html#a133">KeNumberProcessors</a>)) {
00843         <a class="code" href="../../d4/d1/genmips_8c.html#a17">t</a> = (ULONG)(<span class="keyword">sizeof</span>(KPROCESSOR_STATE)) - (ULONG)(a-&gt;TargetBaseAddress);
00844         <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/genmips_8c.html#a17">t</a> &lt; Length) {
00845             Length = <a class="code" href="../../d4/d1/genmips_8c.html#a17">t</a>;
00846         }
00847         StartAddr = (PVOID)((ULONG)a-&gt;TargetBaseAddress +
00848                             (ULONG)&amp;(<a class="code" href="../../d4/d9/ke_8h.html#a139">KiProcessorBlock</a>[m-&gt;Processor]-&gt;ProcessorState));
00849         AdditionalData-&gt;Length = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)<a class="code" href="../../d1/d7/4_2kdp_8h.html#a110">KdpMoveMemory</a>(
00850                                     AdditionalData-&gt;Buffer,
00851                                     StartAddr,
00852                                     Length
00853                                     );
00854 
00855         <span class="keywordflow">if</span> (Length == AdditionalData-&gt;Length) {
00856             m-&gt;ReturnStatus = STATUS_SUCCESS;
00857         } <span class="keywordflow">else</span> {
00858             m-&gt;ReturnStatus = STATUS_UNSUCCESSFUL;
00859         }
00860         a-&gt;ActualBytesRead = AdditionalData-&gt;Length;
00861 
00862     } <span class="keywordflow">else</span> {
00863         AdditionalData-&gt;Length = 0;
00864         m-&gt;ReturnStatus = STATUS_UNSUCCESSFUL;
00865         a-&gt;ActualBytesRead = 0;
00866     }
00867 
00868     <a class="code" href="../../d1/d7/4_2kdp_8h.html#a116">KdpSendPacket</a>(
00869         PACKET_TYPE_KD_STATE_MANIPULATE,
00870         &amp;MessageHeader,
00871         AdditionalData
00872         );
00873     UNREFERENCED_PARAMETER(Context);
00874 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a16" doxytag="4/i386/kdcpuapi.c::KdpReadIoSpace" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KdpReadIoSpace           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PDBGKD_MANIPULATE_STATE64&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSTRING&nbsp;</td>
          <td class="mdname" nowrap> <em>AdditionalData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCONTEXT&nbsp;</td>
          <td class="mdname" nowrap> <em>Context</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d4/4_2i386_2kdcpuapi_8c-source.html#l00950">950</a> of file <a class="el" href="../../d7/d4/4_2i386_2kdcpuapi_8c-source.html">4/i386/kdcpuapi.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d0/d4/kdcomio_8c-source.html#l00683">KdpSendPacket()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00085">PUSHORT</a>.
<p>
<pre class="fragment"><div>00958                    :
00959 
00960     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called in response of a read io space state
00961     manipulation message.  Its function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to read system io
00962     locations.
00963 
00964 Arguments:
00965 
00966     m - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> state manipulation message.
00967 
00968     AdditionalData - Supplies any additional data <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> message.
00969 
00970     Context - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current context.
00971 
00972 Return Value:
00973 
00974     None.
00975 
00976 --*/
00977 
00978 {
00979     PDBGKD_READ_WRITE_IO64 a = &amp;m-&gt;u.ReadWriteIo;
00980     STRING MessageHeader;
00981 
00982     MessageHeader.Length = <span class="keyword">sizeof</span>(*m);
00983     MessageHeader.Buffer = (PCHAR)m;
00984 
00985     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(AdditionalData-&gt;Length == 0);
00986 
00987     m-&gt;ReturnStatus = STATUS_SUCCESS;
00988 
00989     <span class="comment">//</span>
00990     <span class="comment">// Check Size and Alignment</span>
00991     <span class="comment">//</span>
00992 
00993     <span class="keywordflow">switch</span> ( a-&gt;DataSize ) {
00994         <span class="keywordflow">case</span> 1:
00995             a-&gt;DataValue = (ULONG)READ_PORT_UCHAR((PUCHAR)a-&gt;IoAddress);
00996             <span class="keywordflow">break</span>;
00997         <span class="keywordflow">case</span> 2:
00998             <span class="keywordflow">if</span> ((ULONG)a-&gt;IoAddress &amp; 1 ) {
00999                 m-&gt;ReturnStatus = STATUS_DATATYPE_MISALIGNMENT;
01000             } <span class="keywordflow">else</span> {
01001                 a-&gt;DataValue = (ULONG)READ_PORT_USHORT((PUSHORT)a-&gt;IoAddress);
01002             }
01003             <span class="keywordflow">break</span>;
01004         <span class="keywordflow">case</span> 4:
01005             <span class="keywordflow">if</span> ((ULONG)a-&gt;IoAddress &amp; 3 ) {
01006                 m-&gt;ReturnStatus = STATUS_DATATYPE_MISALIGNMENT;
01007             } <span class="keywordflow">else</span> {
01008                 a-&gt;DataValue = READ_PORT_ULONG((PULONG)a-&gt;IoAddress);
01009             }
01010             <span class="keywordflow">break</span>;
01011         <span class="keywordflow">default</span>:
01012             m-&gt;ReturnStatus = STATUS_INVALID_PARAMETER;
01013     }
01014 
01015     <a class="code" href="../../d1/d7/4_2kdp_8h.html#a116">KdpSendPacket</a>(
01016         PACKET_TYPE_KD_STATE_MANIPULATE,
01017         &amp;MessageHeader,
01018         NULL
01019         );
01020     UNREFERENCED_PARAMETER(Context);
01021 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a18" doxytag="4/i386/kdcpuapi.c::KdpReadMachineSpecificRegister" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KdpReadMachineSpecificRegister           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PDBGKD_MANIPULATE_STATE64&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSTRING&nbsp;</td>
          <td class="mdname" nowrap> <em>AdditionalData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCONTEXT&nbsp;</td>
          <td class="mdname" nowrap> <em>Context</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d4/4_2i386_2kdcpuapi_8c-source.html#l01098">1098</a> of file <a class="el" href="../../d7/d4/4_2i386_2kdcpuapi_8c-source.html">4/i386/kdcpuapi.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00055">EXCEPTION_EXECUTE_HANDLER</a>, <a class="el" href="../../d0/d4/kdcomio_8c-source.html#l00683">KdpSendPacket()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d5/d3/i386_8h.html#a52">RDMSR()</a>.
<p>
Referenced by <a class="el" href="../../d9/d2/kdapi_8c-source.html#l00847">KdpSendWaitContinue()</a>.
<p>
<pre class="fragment"><div>01106                    :
01107 
01108     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called in response of a read MSR
01109     manipulation message.  Its function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to read <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> MSR.
01110 
01111 Arguments:
01112 
01113     m - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> state manipulation message.
01114 
01115     AdditionalData - Supplies any additional data <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> message.
01116 
01117     Context - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current context.
01118 
01119 Return Value:
01120 
01121     None.
01122 
01123 --*/
01124 
01125 {
01126     PDBGKD_READ_WRITE_MSR a = &amp;m-&gt;u.ReadWriteMsr;
01127     STRING MessageHeader;
01128     LARGE_INTEGER l;
01129 
01130     MessageHeader.Length = <span class="keyword">sizeof</span>(*m);
01131     MessageHeader.Buffer = (PCHAR)m;
01132 
01133     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(AdditionalData-&gt;Length == 0);
01134 
01135     m-&gt;ReturnStatus = STATUS_SUCCESS;
01136 
01137     <span class="keywordflow">try</span> {
01138         l.QuadPart = <a class="code" href="../../d5/d3/i386_8h.html#a52">RDMSR</a>(a-&gt;Msr);
01139     } except (EXCEPTION_EXECUTE_HANDLER) {
01140         l.QuadPart = 0;
01141         m-&gt;ReturnStatus = STATUS_NO_SUCH_DEVICE;
01142     }
01143 
01144     a-&gt;DataValueLow  = l.LowPart;
01145     a-&gt;DataValueHigh = l.HighPart;
01146 
01147     <a class="code" href="../../d1/d7/4_2kdp_8h.html#a116">KdpSendPacket</a>(
01148         PACKET_TYPE_KD_STATE_MANIPULATE,
01149         &amp;MessageHeader,
01150         NULL
01151         );
01152     UNREFERENCED_PARAMETER(Context);
01153 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="4/i386/kdcpuapi.c::KdpSetLoadState" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KdpSetLoadState           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PDBGKD_WAIT_STATE_CHANGE64&nbsp;</td>
          <td class="mdname" nowrap> <em>WaitStateChange</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCONTEXT&nbsp;</td>
          <td class="mdname" nowrap> <em>ContextRecord</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d4/4_2i386_2kdcpuapi_8c-source.html#l00523">523</a> of file <a class="el" href="../../d7/d4/4_2i386_2kdcpuapi_8c-source.html">4/i386/kdcpuapi.c</a>.
<p>
References <a class="el" href="../../d5/d9/cmconfig_8c-source.html#l00051">Count</a>, <a class="el" href="../../d0/d1/config_2i386_2init386_8c-source.html#l00050">End</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d3/kdbreak_8c-source.html#l00902">KdpDeleteBreakpointRange()</a>, <a class="el" href="../../d9/d5/kdmove_8c-source.html#l00031">KdpMoveMemory()</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00069">KeGetCurrentPrcb</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
<pre class="fragment"><div>00530                    :
00531 
00532     Fill in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Wait_State_Change message record <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> load symbol <span class="keywordflow">case</span>.
00533 
00534 Arguments:
00535 
00536     WaitStateChange - Supplies pointer to record to fill in
00537 
00538     ContextRecord - Supplies a pointer to a context record.
00539 
00540 Return Value:
00541 
00542     None.
00543 
00544 --*/
00545 
00546 {
00547 
00548     ULONG <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a>;
00549     PVOID <a class="code" href="../../d9/d1/config_2i386_2init386_8c.html#a19">End</a>;
00550     PKPRCB Prcb;
00551 
00552     <span class="comment">//</span>
00553     <span class="comment">// Store the special x86 register into the control report structure.</span>
00554     <span class="comment">//</span>
00555 
00556     Prcb = <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a2">KeGetCurrentPrcb</a>();
00557     WaitStateChange-&gt;ControlReport.Dr6 = Prcb-&gt;ProcessorState.SpecialRegisters.KernelDr6;
00558     WaitStateChange-&gt;ControlReport.Dr7 = Prcb-&gt;ProcessorState.SpecialRegisters.KernelDr7;
00559 
00560     <span class="comment">//</span>
00561     <span class="comment">// Copy the immediate instruction stream into the control report structure.</span>
00562     <span class="comment">//</span>
00563 
00564     <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a> = <a class="code" href="../../d1/d7/4_2kdp_8h.html#a110">KdpMoveMemory</a>((PCHAR)(&amp;(WaitStateChange-&gt;ControlReport.InstructionStream[0])),
00565                           (PCHAR)(WaitStateChange-&gt;ProgramCounter),
00566                           DBGKD_MAXSTREAM);
00567 
00568     WaitStateChange-&gt;ControlReport.InstructionCount = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)<a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a>;
00569 
00570     <span class="comment">//</span>
00571     <span class="comment">// Clear breakpoints in the copied instruction stream. If any breakpoints</span>
00572     <span class="comment">// are cleared, then recopy the instruction stream.</span>
00573     <span class="comment">//</span>
00574 
00575     <a class="code" href="../../d9/d1/config_2i386_2init386_8c.html#a19">End</a> = (PVOID)((PUCHAR)(WaitStateChange-&gt;ProgramCounter) + <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a> - 1);
00576     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d7/4_2kdp_8h.html#a106">KdpDeleteBreakpointRange</a>((PVOID)WaitStateChange-&gt;ProgramCounter, End) != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00577         <a class="code" href="../../d1/d7/4_2kdp_8h.html#a110">KdpMoveMemory</a>(&amp;WaitStateChange-&gt;ControlReport.InstructionStream[0],
00578                       (PVOID)WaitStateChange-&gt;ProgramCounter,
00579                       Count);
00580     }
00581 
00582     <span class="comment">//</span>
00583     <span class="comment">// Store the segment registers into the control report structure and set the</span>
00584     <span class="comment">// control flags.</span>
00585     <span class="comment">//</span>
00586 
00587     WaitStateChange-&gt;ControlReport.SegCs = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)(ContextRecord-&gt;SegCs);
00588     WaitStateChange-&gt;ControlReport.SegDs = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)(ContextRecord-&gt;SegDs);
00589     WaitStateChange-&gt;ControlReport.SegEs = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)(ContextRecord-&gt;SegEs);
00590     WaitStateChange-&gt;ControlReport.SegFs = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)(ContextRecord-&gt;SegFs);
00591     WaitStateChange-&gt;ControlReport.EFlags = ContextRecord-&gt;EFlags;
00592     WaitStateChange-&gt;ControlReport.ReportFlags = REPORT_INCLUDES_SEGS;
00593 
00594     <span class="comment">//</span>
00595     <span class="comment">//  Copy context record into wait state change structure.</span>
00596     <span class="comment">//</span>
00597 
00598     <a class="code" href="../../d1/d7/4_2kdp_8h.html#a110">KdpMoveMemory</a>((PCHAR)(&amp;WaitStateChange-&gt;Context),
00599                   (PCHAR)ContextRecord,
00600                   <span class="keyword">sizeof</span>(CONTEXT));
00601 
00602     <span class="keywordflow">return</span>;
00603 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="4/i386/kdcpuapi.c::KdpSetStateChange" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KdpSetStateChange           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PDBGKD_WAIT_STATE_CHANGE64&nbsp;</td>
          <td class="mdname" nowrap> <em>WaitStateChange</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PEXCEPTION_RECORD&nbsp;</td>
          <td class="mdname" nowrap> <em>ExceptionRecord</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCONTEXT&nbsp;</td>
          <td class="mdname" nowrap> <em>ContextRecord</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>SecondChance</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d4/4_2i386_2kdcpuapi_8c-source.html#l00607">607</a> of file <a class="el" href="../../d7/d4/4_2i386_2kdcpuapi_8c-source.html">4/i386/kdcpuapi.c</a>.
<p>
References <a class="el" href="../../d1/d3/kdbreak_8c-source.html#l00902">KdpDeleteBreakpointRange()</a>, <a class="el" href="../../d9/d5/kdmove_8c-source.html#l00031">KdpMoveMemory()</a>, <a class="el" href="../../d9/d5/kdmove_8c-source.html#l00150">KdpQuickMoveMemory()</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00069">KeGetCurrentPrcb</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00070">KeGetCurrentThread</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02776">KeNumberProcessors</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02778">KeProcessorLevel</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
<pre class="fragment"><div>00616                    :
00617 
00618     Fill in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Wait_State_Change message record.
00619 
00620 Arguments:
00621 
00622     WaitStateChange - Supplies pointer to record to fill in
00623 
00624     ExceptionRecord - Supplies a pointer to an exception record.
00625 
00626     ContextRecord - Supplies a pointer to a context record.
00627 
00628     SecondChance - Supplies a <span class="keywordtype">boolean</span> value that determines whether <span class="keyword">this</span> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
00629         <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> first or second chance <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> exception.
00630 
00631 Return Value:
00632 
00633     None.
00634 
00635 --*/
00636 
00637 {
00638     PKPRCB Prcb;
00639     BOOLEAN status;
00640 
00641     <span class="comment">//</span>
00642     <span class="comment">//  Set up description of event, including exception record</span>
00643     <span class="comment">//</span>
00644 
00645     WaitStateChange-&gt;NewState = DbgKdExceptionStateChange;
00646     WaitStateChange-&gt;ProcessorLevel = <a class="code" href="../../d4/d9/ke_8h.html#a135">KeProcessorLevel</a>;
00647     WaitStateChange-&gt;Processor = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a2">KeGetCurrentPrcb</a>()-&gt;Number;
00648     WaitStateChange-&gt;NumberProcessors = (ULONG)<a class="code" href="../../d4/d9/ke_8h.html#a133">KeNumberProcessors</a>;
00649     WaitStateChange-&gt;Thread = (ULONG64)(LONG64)(LONG_PTR) <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a3">KeGetCurrentThread</a>();
00650     WaitStateChange-&gt;ProgramCounter = (ULONG64)(LONG64)(LONG_PTR) CONTEXT_TO_PROGRAM_COUNTER(ContextRecord);
00651     <span class="keywordflow">if</span> (<span class="keyword">sizeof</span>(EXCEPTION_RECORD) == <span class="keyword">sizeof</span>(WaitStateChange-&gt;u.Exception.ExceptionRecord)) {
00652         <a class="code" href="../../d1/d7/4_2kdp_8h.html#a111">KdpQuickMoveMemory</a>((PCHAR)&amp;WaitStateChange-&gt;u.Exception.ExceptionRecord,
00653                            (PCHAR)ExceptionRecord,
00654                            <span class="keyword">sizeof</span>(EXCEPTION_RECORD));
00655     } <span class="keywordflow">else</span> {
00656         ExceptionRecord32To64((PEXCEPTION_RECORD32)ExceptionRecord,
00657                               &amp;WaitStateChange-&gt;u.Exception.ExceptionRecord
00658                               );
00659     }
00660     WaitStateChange-&gt;u.Exception.FirstChance = !SecondChance;
00661 
00662     <span class="comment">//</span>
00663     <span class="comment">//  Copy instruction stream immediately following location of event</span>
00664     <span class="comment">//</span>
00665 
00666     WaitStateChange-&gt;ControlReport.InstructionCount =
00667         (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)<a class="code" href="../../d1/d7/4_2kdp_8h.html#a110">KdpMoveMemory</a>(
00668             (PCHAR)(&amp;(WaitStateChange-&gt;ControlReport.InstructionStream[0])),
00669             (PCHAR)(WaitStateChange-&gt;ProgramCounter),
00670             DBGKD_MAXSTREAM
00671             );
00672 
00673     <span class="comment">//</span>
00674     <span class="comment">//  Copy context record immediately following instruction stream</span>
00675     <span class="comment">//</span>
00676 
00677     <a class="code" href="../../d1/d7/4_2kdp_8h.html#a110">KdpMoveMemory</a>(
00678         (PCHAR)(&amp;WaitStateChange-&gt;Context),
00679         (PCHAR)ContextRecord,
00680         <span class="keyword">sizeof</span>(*ContextRecord)
00681         );
00682 
00683     <span class="comment">//</span>
00684     <span class="comment">//  Clear breakpoints in copied area</span>
00685     <span class="comment">//</span>
00686 
00687     status = <a class="code" href="../../d1/d7/4_2kdp_8h.html#a106">KdpDeleteBreakpointRange</a>(
00688         (PVOID)WaitStateChange-&gt;ProgramCounter,
00689         (PVOID)((PUCHAR)WaitStateChange-&gt;ProgramCounter +
00690             WaitStateChange-&gt;ControlReport.InstructionCount - 1)
00691         );
00692 
00693     <span class="comment">//</span>
00694     <span class="comment">//  If there were any breakpoints cleared, recopy the area without them</span>
00695     <span class="comment">//</span>
00696 
00697     <span class="keywordflow">if</span> (status == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
00698         <a class="code" href="../../d1/d7/4_2kdp_8h.html#a110">KdpMoveMemory</a>(
00699             (PUCHAR) &amp;(WaitStateChange-&gt;ControlReport.InstructionStream[0]),
00700             (PUCHAR) WaitStateChange-&gt;ProgramCounter,
00701             WaitStateChange-&gt;ControlReport.InstructionCount
00702             );
00703     }
00704 
00705 
00706     <span class="comment">//</span>
00707     <span class="comment">//  Special registers for the x86</span>
00708     <span class="comment">//</span>
00709     Prcb = <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a2">KeGetCurrentPrcb</a>();
00710 
00711     WaitStateChange-&gt;ControlReport.Dr6 =
00712         Prcb-&gt;ProcessorState.SpecialRegisters.KernelDr6;
00713 
00714     WaitStateChange-&gt;ControlReport.Dr7 =
00715         Prcb-&gt;ProcessorState.SpecialRegisters.KernelDr7;
00716 
00717     WaitStateChange-&gt;ControlReport.SegCs  = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)(ContextRecord-&gt;SegCs);
00718     WaitStateChange-&gt;ControlReport.SegDs  = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)(ContextRecord-&gt;SegDs);
00719     WaitStateChange-&gt;ControlReport.SegEs  = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)(ContextRecord-&gt;SegEs);
00720     WaitStateChange-&gt;ControlReport.SegFs  = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)(ContextRecord-&gt;SegFs);
00721     WaitStateChange-&gt;ControlReport.EFlags = ContextRecord-&gt;EFlags;
00722 
00723     WaitStateChange-&gt;ControlReport.ReportFlags = REPORT_INCLUDES_SEGS;
00724 
00725 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a15" doxytag="4/i386/kdcpuapi.c::KdpWriteControlSpace" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KdpWriteControlSpace           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PDBGKD_MANIPULATE_STATE64&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSTRING&nbsp;</td>
          <td class="mdname" nowrap> <em>AdditionalData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCONTEXT&nbsp;</td>
          <td class="mdname" nowrap> <em>Context</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d4/4_2i386_2kdcpuapi_8c-source.html#l00877">877</a> of file <a class="el" href="../../d7/d4/4_2i386_2kdcpuapi_8c-source.html">4/i386/kdcpuapi.c</a>.
<p>
References <a class="el" href="../../d9/d5/kdmove_8c-source.html#l00031">KdpMoveMemory()</a>, <a class="el" href="../../d0/d4/kdcomio_8c-source.html#l00683">KdpSendPacket()</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02776">KeNumberProcessors</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02782">KiProcessorBlock</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
<pre class="fragment"><div>00885                    :
00886 
00887     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called in response of a write <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a58">control</a> space state
00888     manipulation message.  Its function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to write implementation
00889     specific system data.
00890 
00891     Control space <span class="keywordflow">for</span> x86 <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> as defined above.
00892 
00893 Arguments:
00894 
00895     m - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> state manipulation message.
00896 
00897     AdditionalData - Supplies any additional data <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> message.
00898 
00899     Context - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current context.
00900 
00901 Return Value:
00902 
00903     None.
00904 
00905 --*/
00906 
00907 {
00908     PDBGKD_WRITE_MEMORY64 a = &amp;m-&gt;u.WriteMemory;
00909     ULONG Length;
00910     STRING MessageHeader;
00911     PVOID StartAddr;
00912 
00913     MessageHeader.Length = <span class="keyword">sizeof</span>(*m);
00914     MessageHeader.Buffer = (PCHAR)m;
00915 
00916     <span class="keywordflow">if</span> ((((PUCHAR)a-&gt;TargetBaseAddress + a-&gt;TransferCount) &lt;=
00917         (PUCHAR)(<span class="keyword">sizeof</span>(KPROCESSOR_STATE))) &amp;&amp; (m-&gt;Processor &lt; (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)<a class="code" href="../../d4/d9/ke_8h.html#a133">KeNumberProcessors</a>)) {
00918 
00919         StartAddr = (PVOID)((ULONG)a-&gt;TargetBaseAddress +
00920                             (ULONG)&amp;(<a class="code" href="../../d4/d9/ke_8h.html#a139">KiProcessorBlock</a>[m-&gt;Processor]-&gt;ProcessorState));
00921 
00922         Length = <a class="code" href="../../d1/d7/4_2kdp_8h.html#a110">KdpMoveMemory</a>(
00923                             StartAddr,
00924                             AdditionalData-&gt;Buffer,
00925                             AdditionalData-&gt;Length
00926                             );
00927 
00928         <span class="keywordflow">if</span> (Length == AdditionalData-&gt;Length) {
00929             m-&gt;ReturnStatus = STATUS_SUCCESS;
00930         } <span class="keywordflow">else</span> {
00931             m-&gt;ReturnStatus = STATUS_UNSUCCESSFUL;
00932         }
00933         a-&gt;ActualBytesWritten = Length;
00934 
00935     } <span class="keywordflow">else</span> {
00936         AdditionalData-&gt;Length = 0;
00937         m-&gt;ReturnStatus = STATUS_UNSUCCESSFUL;
00938         a-&gt;ActualBytesWritten = 0;
00939     }
00940 
00941     <a class="code" href="../../d1/d7/4_2kdp_8h.html#a116">KdpSendPacket</a>(
00942         PACKET_TYPE_KD_STATE_MANIPULATE,
00943         &amp;MessageHeader,
00944         AdditionalData
00945         );
00946     UNREFERENCED_PARAMETER(Context);
00947 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a17" doxytag="4/i386/kdcpuapi.c::KdpWriteIoSpace" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KdpWriteIoSpace           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PDBGKD_MANIPULATE_STATE64&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSTRING&nbsp;</td>
          <td class="mdname" nowrap> <em>AdditionalData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCONTEXT&nbsp;</td>
          <td class="mdname" nowrap> <em>Context</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d4/4_2i386_2kdcpuapi_8c-source.html#l01024">1024</a> of file <a class="el" href="../../d7/d4/4_2i386_2kdcpuapi_8c-source.html">4/i386/kdcpuapi.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d0/d4/kdcomio_8c-source.html#l00683">KdpSendPacket()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00085">PUSHORT</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
<pre class="fragment"><div>01032                    :
01033 
01034     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called in response of a write io space state
01035     manipulation message.  Its function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to write to system io
01036     locations.
01037 
01038 Arguments:
01039 
01040     m - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> state manipulation message.
01041 
01042     AdditionalData - Supplies any additional data <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> message.
01043 
01044     Context - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current context.
01045 
01046 Return Value:
01047 
01048     None.
01049 
01050 --*/
01051 
01052 {
01053     PDBGKD_READ_WRITE_IO64 a = &amp;m-&gt;u.ReadWriteIo;
01054     STRING MessageHeader;
01055 
01056     MessageHeader.Length = <span class="keyword">sizeof</span>(*m);
01057     MessageHeader.Buffer = (PCHAR)m;
01058 
01059     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(AdditionalData-&gt;Length == 0);
01060 
01061     m-&gt;ReturnStatus = STATUS_SUCCESS;
01062 
01063     <span class="comment">//</span>
01064     <span class="comment">// Check Size and Alignment</span>
01065     <span class="comment">//</span>
01066 
01067     <span class="keywordflow">switch</span> ( a-&gt;DataSize ) {
01068         <span class="keywordflow">case</span> 1:
01069             WRITE_PORT_UCHAR((PUCHAR)a-&gt;IoAddress, (UCHAR)a-&gt;DataValue);
01070             <span class="keywordflow">break</span>;
01071         <span class="keywordflow">case</span> 2:
01072             <span class="keywordflow">if</span> ((ULONG)a-&gt;IoAddress &amp; 1 ) {
01073                 m-&gt;ReturnStatus = STATUS_DATATYPE_MISALIGNMENT;
01074             } <span class="keywordflow">else</span> {
01075                 WRITE_PORT_USHORT((PUSHORT)a-&gt;IoAddress, (USHORT)a-&gt;DataValue);
01076             }
01077             <span class="keywordflow">break</span>;
01078         <span class="keywordflow">case</span> 4:
01079             <span class="keywordflow">if</span> ((ULONG)a-&gt;IoAddress &amp; 3 ) {
01080                 m-&gt;ReturnStatus = STATUS_DATATYPE_MISALIGNMENT;
01081             } <span class="keywordflow">else</span> {
01082                 WRITE_PORT_ULONG((PULONG)a-&gt;IoAddress, a-&gt;DataValue);
01083             }
01084             <span class="keywordflow">break</span>;
01085         <span class="keywordflow">default</span>:
01086             m-&gt;ReturnStatus = STATUS_INVALID_PARAMETER;
01087     }
01088 
01089     <a class="code" href="../../d1/d7/4_2kdp_8h.html#a116">KdpSendPacket</a>(
01090         PACKET_TYPE_KD_STATE_MANIPULATE,
01091         &amp;MessageHeader,
01092         NULL
01093         );
01094     UNREFERENCED_PARAMETER(Context);
01095 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a19" doxytag="4/i386/kdcpuapi.c::KdpWriteMachineSpecificRegister" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KdpWriteMachineSpecificRegister           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PDBGKD_MANIPULATE_STATE64&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSTRING&nbsp;</td>
          <td class="mdname" nowrap> <em>AdditionalData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCONTEXT&nbsp;</td>
          <td class="mdname" nowrap> <em>Context</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d4/4_2i386_2kdcpuapi_8c-source.html#l01156">1156</a> of file <a class="el" href="../../d7/d4/4_2i386_2kdcpuapi_8c-source.html">4/i386/kdcpuapi.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00055">EXCEPTION_EXECUTE_HANDLER</a>, <a class="el" href="../../d0/d4/kdcomio_8c-source.html#l00683">KdpSendPacket()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d5/d3/i386_8h.html#a53">WRMSR()</a>.
<p>
Referenced by <a class="el" href="../../d9/d2/kdapi_8c-source.html#l00847">KdpSendWaitContinue()</a>.
<p>
<pre class="fragment"><div>01164                    :
01165 
01166     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called in response of a write of a MSR
01167     manipulation message.  Its function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to write to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> MSR
01168 
01169 Arguments:
01170 
01171     m - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> state manipulation message.
01172 
01173     AdditionalData - Supplies any additional data <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> message.
01174 
01175     Context - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current context.
01176 
01177 Return Value:
01178 
01179     None.
01180 
01181 --*/
01182 
01183 {
01184     PDBGKD_READ_WRITE_MSR a = &amp;m-&gt;u.ReadWriteMsr;
01185     STRING MessageHeader;
01186     LARGE_INTEGER l;
01187 
01188     MessageHeader.Length = <span class="keyword">sizeof</span>(*m);
01189     MessageHeader.Buffer = (PCHAR)m;
01190 
01191     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(AdditionalData-&gt;Length == 0);
01192 
01193     m-&gt;ReturnStatus = STATUS_SUCCESS;
01194 
01195     l.HighPart = a-&gt;DataValueHigh;
01196     l.LowPart = a-&gt;DataValueLow;
01197 
01198     <span class="keywordflow">try</span> {
01199         <a class="code" href="../../d5/d3/i386_8h.html#a53">WRMSR</a> (a-&gt;Msr, l.QuadPart);
01200     } except (EXCEPTION_EXECUTE_HANDLER) {
01201         m-&gt;ReturnStatus = STATUS_NO_SUCH_DEVICE;
01202     }
01203 
01204     <a class="code" href="../../d1/d7/4_2kdp_8h.html#a116">KdpSendPacket</a>(
01205         PACKET_TYPE_KD_STATE_MANIPULATE,
01206         &amp;MessageHeader,
01207         NULL
01208         );
01209     UNREFERENCED_PARAMETER(Context);
01210 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="4/i386/kdcpuapi.c::regValue" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LONG regValue           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">UCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>reg</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PCONTEXT&nbsp;</td>
          <td class="mdname" nowrap> <em>ContextRecord</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d3/d4/i386_2kdcpuapi_8c-source.html#l00332">KdpIsSpecialCall()</a>.    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="a4" doxytag="4/i386/kdcpuapi.c::KdNumberOfSpecialCalls" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d1/d7/4_2kdp_8h.html#a49">KdNumberOfSpecialCalls</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d4/4_2i386_2kdcpuapi_8c-source.html#l00032">32</a> of file <a class="el" href="../../d7/d4/4_2i386_2kdcpuapi_8c-source.html">4/i386/kdcpuapi.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="4/i386/kdcpuapi.c::KdpCurrentSymbolEnd" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d1/d7/4_2kdp_8h.html#a46">KdpCurrentSymbolEnd</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d4/4_2i386_2kdcpuapi_8c-source.html#l00030">30</a> of file <a class="el" href="../../d7/d4/4_2i386_2kdcpuapi_8c-source.html">4/i386/kdcpuapi.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="4/i386/kdcpuapi.c::KdpCurrentSymbolStart" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d1/d7/4_2kdp_8h.html#a45">KdpCurrentSymbolStart</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d4/4_2i386_2kdcpuapi_8c-source.html#l00030">30</a> of file <a class="el" href="../../d7/d4/4_2i386_2kdcpuapi_8c-source.html">4/i386/kdcpuapi.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="4/i386/kdcpuapi.c::KdSpecialCalls" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d1/d7/4_2kdp_8h.html#a48">KdSpecialCalls</a>[]          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d4/4_2i386_2kdcpuapi_8c-source.html#l00031">31</a> of file <a class="el" href="../../d7/d4/4_2i386_2kdcpuapi_8c-source.html">4/i386/kdcpuapi.c</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:44:25 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
