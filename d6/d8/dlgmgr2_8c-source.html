<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: dlgmgr2.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>dlgmgr2.c</h1><a href="../../d5/d9/dlgmgr2_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/***************************************************************************\</span>
00002 <span class="comment">*</span>
00003 <span class="comment">*  DLGMGR2.C</span>
00004 <span class="comment">*</span>
00005 <span class="comment">* Copyright (c) 1985 - 1999, Microsoft Corporation</span>
00006 <span class="comment">*</span>
00007 <span class="comment">*      Dialog Management Routines</span>
00008 <span class="comment">*</span>
00009 <span class="comment">* ??-???-???? mikeke    Ported from Win 3.0 sources</span>
00010 <span class="comment">* 12-Feb-1991 mikeke    Added Revalidation code</span>
00011 <span class="comment">\***************************************************************************/</span>
00012 
00013 <span class="preprocessor">#include "<a class="code" href="../../d7/d3/w32_2ntuser_2client_2precomp_8h.html">precomp.h</a>"</span>
00014 <span class="preprocessor">#pragma hdrstop</span>
00015 <span class="preprocessor"></span>
00016 <span class="comment">/***************************************************************************\</span>
00017 <span class="comment">* xxxRemoveDefaultButton</span>
00018 <span class="comment">*</span>
00019 <span class="comment">* Scan through all the controls in the dialog box and remove the default</span>
00020 <span class="comment">* button style from any button that has it.  This is done since at times we</span>
00021 <span class="comment">* do not know who has the default button.</span>
00022 <span class="comment">*</span>
00023 <span class="comment">* History:</span>
00024 <span class="comment">*</span>
00025 <span class="comment">* Bug 19449 - joejo</span>
00026 <span class="comment">*</span>
00027 <span class="comment">*   Stop infinite loop when pwnd != pwndStart but pwnd == pwnd after calling</span>
00028 <span class="comment">*   _NextControl!</span>
00029 <span class="comment">\***************************************************************************/</span>
00030 
<a name="l00031"></a><a class="code" href="../../d6/d0/usercli_8h.html#a756">00031</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/d0/usercli_8h.html#a756">xxxRemoveDefaultButton</a>(
00032     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndRoot,
00033     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndStart)
00034 {
00035     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> code;
00036     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd;
00037     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndDup;
00038     <a class="code" href="../../d5/d1/struct__TL.html">TL</a> tlpwnd;
00039 
00040     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwndRoot);
00041     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwndStart);
00042 
00043     <span class="keywordflow">if</span> (!pwndStart || <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwndStart, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a627">WEFCONTROLPARENT</a>))
00044         pwndStart = <a class="code" href="../../d6/d0/usercli_8h.html#a639">_NextControl</a>(pwndRoot, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, CWP_SKIPINVISIBLE | CWP_SKIPDISABLED);
00045     <span class="keywordflow">else</span>
00046         pwndStart = <a class="code" href="../../d6/d0/usercli_8h.html#a643">_GetChildControl</a>(pwndRoot, pwndStart);
00047 
00048     <span class="keywordflow">if</span> (!pwndStart)
00049         <span class="keywordflow">return</span>;
00050 
00051     pwnd = pwndStart;
00052     <span class="keywordflow">do</span> {
00053         pwndDup = pwnd;
00054         
00055         <a class="code" href="../../d6/d0/usercli_8h.html#a36">ThreadLock</a>(pwnd, &amp;tlpwnd);
00056 
00057         code = (<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)<a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(pwnd), WM_GETDLGCODE, 0, 0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>);
00058 
00059         <span class="keywordflow">if</span> (code &amp; DLGC_DEFPUSHBUTTON) {
00060             <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(pwnd), BM_SETSTYLE, BS_PUSHBUTTON, (LONG)<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00061         }
00062 
00063         pwnd = <a class="code" href="../../d6/d0/usercli_8h.html#a639">_NextControl</a>(pwndRoot, pwnd, 0);
00064 
00065         <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwnd);
00066 
00067     } <span class="keywordflow">while</span> (pwnd &amp;&amp; (pwnd != pwndStart) &amp;&amp; (pwnd != pwndDup));
00068     
00069 <span class="preprocessor">#if DBG</span>
00070 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (pwnd &amp;&amp; (pwnd != pwndStart) &amp;&amp; (pwnd != pwndDup)) {
00071         RIPMSG0(RIP_WARNING, <span class="stringliteral">"xxxRemoveDefaultButton bailing potential infinite loop!"</span>);
00072     }
00073 <span class="preprocessor">#endif</span>
00074 <span class="preprocessor"></span>    
00075 }
00076 
00077 
00078 <span class="comment">/***************************************************************************\</span>
00079 <span class="comment">* xxxCheckDefPushButton</span>
00080 <span class="comment">*</span>
00081 <span class="comment">* History:</span>
00082 <span class="comment">\***************************************************************************/</span>
00083 
<a name="l00084"></a><a class="code" href="../../d6/d0/usercli_8h.html#a757">00084</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/d0/usercli_8h.html#a757">xxxCheckDefPushButton</a>(
00085     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndDlg,
00086     HWND hwndOldFocus,
00087     HWND hwndNewFocus)
00088 {
00089     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndNewFocus;
00090     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndOldFocus;
00091     <a class="code" href="../../d5/d1/struct__TL.html">TL</a> tlpwndT;
00092     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndT;
00093     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> codeNewFocus = 0;
00094     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> styleT;
00095     LONG lT;
00096     <span class="keywordtype">int</span> <span class="keywordtype">id</span>;
00097 
00098     <span class="keywordflow">if</span> (hwndNewFocus)
00099         pwndNewFocus = <a class="code" href="../../d4/d0/immcli_8h.html#a4">ValidateHwnd</a>(hwndNewFocus);
00100     <span class="keywordflow">else</span>
00101         pwndNewFocus = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00102 
00103      <span class="keywordflow">if</span> (hwndOldFocus)
00104          pwndOldFocus = <a class="code" href="../../d4/d0/immcli_8h.html#a4">ValidateHwnd</a>(hwndOldFocus);
00105      <span class="keywordflow">else</span>
00106          pwndOldFocus = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00107 
00108     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwndDlg);
00109     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwndNewFocus);
00110     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwndOldFocus);
00111 
00112     <span class="keywordflow">if</span> (pwndNewFocus)
00113     {
00114         <span class="comment">// Do nothing if clicking on dialog background or recursive dialog</span>
00115         <span class="comment">// background.</span>
00116         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwndNewFocus, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a627">WEFCONTROLPARENT</a>))
00117             <span class="keywordflow">return</span>;
00118 
00119         codeNewFocus = (<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)<a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(hwndNewFocus, WM_GETDLGCODE, 0, 0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>);
00120     }
00121 
00122     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d0/usercli_8h.html#a15">SAMEWOWHANDLE</a>(hwndOldFocus, hwndNewFocus)) {
00123         <span class="comment">//</span>
00124         <span class="comment">// NEW FOR 4.0:</span>
00125         <span class="comment">//</span>
00126         <span class="comment">// There is a very common frustrating scenario for ISVs who try to</span>
00127         <span class="comment">// set the default ID.  Our dialog manager assumes that if a push</span>
00128         <span class="comment">// button has the focus, it is the default button also.  As such</span>
00129         <span class="comment">// it passes in the focus window to this routine.  If someone tries</span>
00130         <span class="comment">// to change the focus or set the def ID such that they reside with</span>
00131         <span class="comment">// two different push buttons, the double-default-push button case</span>
00132         <span class="comment">// will result shortly.</span>
00133         <span class="comment">//</span>
00134         <span class="comment">// As such, for 4.0 dialogs, we will go check the def ID and see if</span>
00135         <span class="comment">// is the same as hwndOldFocus' ID.  If not, then we will find IT</span>
00136         <span class="comment">// and use that dude as hwndOldFocus</span>
00137         <span class="comment">//</span>
00138         <span class="keywordflow">if</span> (codeNewFocus &amp; DLGC_UNDEFPUSHBUTTON)
00139         {
00140            <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwndDlg, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a593">WFWIN40COMPAT</a>) &amp;&amp; hwndOldFocus)
00141            {
00142                lT = (LONG)<a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(pwndDlg), DM_GETDEFID, 0, 0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>);
00143                <span class="keywordtype">id</span> = (HIWORD(lT) == DC_HASDEFID ? LOWORD(lT) : IDOK);
00144                lT = MAKELONG(<span class="keywordtype">id</span>, 0);
00145 
00146                <span class="keywordflow">if</span> (lT != PtrToLong(pwndNewFocus-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o16">spmenu</a>))
00147                {
00148                    <span class="keywordflow">if</span> (pwndOldFocus = <a class="code" href="../../d6/d0/usercli_8h.html#a752">_FindDlgItem</a>(pwndDlg, lT))
00149                    {
00150                        hwndOldFocus = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a450">HW</a>(pwndOldFocus);
00151                        <span class="keywordflow">if</span> (<a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(hwndOldFocus, WM_GETDLGCODE, 0, 0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>) &amp; DLGC_DEFPUSHBUTTON)
00152                        {
00153                            <a class="code" href="../../d6/d0/usercli_8h.html#a756">xxxRemoveDefaultButton</a>(pwndDlg, pwndOldFocus);
00154                            <span class="keywordflow">goto</span> SetNewDefault;
00155                        }
00156                    }
00157                }
00158            }
00159 
00160            <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(hwndNewFocus, BM_SETSTYLE, BS_DEFPUSHBUTTON, (LONG)<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00161         }
00162         <span class="keywordflow">return</span>;
00163     }
00164 
00165     <span class="comment">/*</span>
00166 <span class="comment">     * If the focus is changing to or from a pushbutton, then remove the</span>
00167 <span class="comment">     * default style from the current default button</span>
00168 <span class="comment">     */</span>
00169     <span class="keywordflow">if</span> ((hwndOldFocus != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> &amp;&amp; (<a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(hwndOldFocus, WM_GETDLGCODE,
00170                 0, 0) &amp; (DLGC_DEFPUSHBUTTON | DLGC_UNDEFPUSHBUTTON))) ||
00171             (hwndNewFocus != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> &amp;&amp;
00172                 (codeNewFocus &amp; (DLGC_DEFPUSHBUTTON | DLGC_UNDEFPUSHBUTTON)))) {
00173         <a class="code" href="../../d6/d0/usercli_8h.html#a756">xxxRemoveDefaultButton</a>(pwndDlg, pwndNewFocus);
00174     }
00175 
00176 SetNewDefault:
00177     <span class="comment">/*</span>
00178 <span class="comment">     * If moving to a button, make that button the default.</span>
00179 <span class="comment">     */</span>
00180     <span class="keywordflow">if</span> (codeNewFocus &amp; DLGC_UNDEFPUSHBUTTON) {
00181         <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(hwndNewFocus, BM_SETSTYLE, BS_DEFPUSHBUTTON, (LONG)<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00182     } <span class="keywordflow">else</span> {
00183 
00184         <span class="comment">/*</span>
00185 <span class="comment">         * Otherwise, make sure the original default button is default</span>
00186 <span class="comment">         * and no others.</span>
00187 <span class="comment">         */</span>
00188 
00189         <span class="comment">/*</span>
00190 <span class="comment">         * Get the original default button handle</span>
00191 <span class="comment">         */</span>
00192         lT = (LONG)<a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(pwndDlg), DM_GETDEFID, 0, 0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>);
00193         <span class="keywordtype">id</span> = (HIWORD(lT) == DC_HASDEFID ? LOWORD(lT) : IDOK);
00194         pwndT = <a class="code" href="../../d6/d0/usercli_8h.html#a752">_FindDlgItem</a>(pwndDlg, <span class="keywordtype">id</span>);
00195 
00196         <span class="keywordflow">if</span> (pwndT == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00197             <span class="keywordflow">return</span>;
00198         <a class="code" href="../../d6/d0/usercli_8h.html#a37">ThreadLockAlways</a>(pwndT, &amp;tlpwndT);
00199 
00200         <span class="comment">/*</span>
00201 <span class="comment">         * If it already has the default button style, do nothing.</span>
00202 <span class="comment">         */</span>
00203         <span class="keywordflow">if</span> ((styleT = (<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)<a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(pwndT), WM_GETDLGCODE, 0, 0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>)) &amp; DLGC_DEFPUSHBUTTON) {
00204             <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwndT);
00205             <span class="keywordflow">return</span>;
00206         }
00207 
00208         <span class="comment">/*</span>
00209 <span class="comment">         * Also check to make sure it is really a button.</span>
00210 <span class="comment">         */</span>
00211         <span class="keywordflow">if</span> (!(styleT &amp; DLGC_UNDEFPUSHBUTTON)) {
00212             <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwndT);
00213             <span class="keywordflow">return</span>;
00214         }
00215 
00216         <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwndT, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a651">WFDISABLED</a>)) {
00217             <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(pwndT), BM_SETSTYLE, BS_DEFPUSHBUTTON, (LONG)<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00218         }
00219         <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwndT);
00220     }
00221 }
00222 
00223 
00224 <span class="comment">/***************************************************************************\</span>
00225 <span class="comment">* IsDialogMessage (API)</span>
00226 <span class="comment">*</span>
00227 <span class="comment">* History:</span>
00228 <span class="comment">\***************************************************************************/</span>
00229 
<a name="l00230"></a><a class="code" href="../../d5/d9/dlgmgr2_8c.html#a2">00230</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d5/d9/dlgmgr2_8c.html#a2">IsDialogMessageA</a>(
00231     HWND hwndDlg,
00232     LPMSG lpmsg)
00233 {
00234     WPARAM wParamSaved = lpmsg-&gt;wParam;
00235     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> bRet;
00236 
00237     <span class="keywordflow">switch</span> (lpmsg-&gt;message) {
00238 <span class="preprocessor">#ifdef FE_SB // IsDialogMessageA()</span>
00239 <span class="preprocessor"></span>    <span class="keywordflow">case</span> WM_CHAR:
00240     <span class="keywordflow">case</span> EM_SETPASSWORDCHAR:
00241         <span class="comment">/*</span>
00242 <span class="comment">         * BUILD_DBCS_MESSAGE_TO_CLIENTW_FROM_CLIENTA() macro will return TRUE</span>
00243 <span class="comment">         * for DBCS leadbyte message everytime, then we check there is some</span>
00244 <span class="comment">         * possibility the return value become FALSE, here.</span>
00245 <span class="comment">         *</span>
00246 <span class="comment">         * These code originally come from IsDialogMessageW().</span>
00247 <span class="comment">         */</span>
00248          <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a125">IS_DBCS_ENABLED</a>()) {
00249             <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndDlg, pwnd;
00250             <a class="code" href="../../d5/d1/struct__TL.html">TL</a> tlpwndDlg;
00251             <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fLockDlg = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00252 
00253             <span class="keywordflow">if</span> ((pwndDlg = <a class="code" href="../../d3/d9/client_2wow_8c.html#a1">ValidateHwndNoRip</a>(hwndDlg)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00254                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00255             }
00256 
00257             <span class="keywordflow">if</span> (lpmsg-&gt;hwnd == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00258                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00259             }
00260 
00261             pwnd = <a class="code" href="../../d4/d0/immcli_8h.html#a4">ValidateHwnd</a>(lpmsg-&gt;hwnd);
00262             <span class="comment">//</span>
00263             <span class="comment">// THIS IS FOR MFC.</span>
00264             <span class="comment">//</span>
00265             <span class="comment">// This solves many problems with apps that use MFC but want to take</span>
00266             <span class="comment">// advantage of DS_CONTROL.  MFC blindly passes in child dialogs sometimes</span>
00267             <span class="comment">// to IsDialogMessage, which can screw up tabbing etc.</span>
00268             <span class="comment">//</span>
00269             <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwndDlg, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a627">WEFCONTROLPARENT</a>) &amp;&amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwndDlg, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a654">WFCHILD</a>)) {
00270                 pwndDlg = <a class="code" href="../../d6/d0/usercli_8h.html#a755">GetParentDialog</a>(pwndDlg);
00271                 <a class="code" href="../../d6/d0/usercli_8h.html#a36">ThreadLock</a>(pwndDlg, &amp;tlpwndDlg);
00272                 fLockDlg = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00273                 hwndDlg = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(pwndDlg);
00274             }
00275 
00276             <span class="keywordflow">if</span> (pwnd != pwndDlg &amp;&amp; !<a class="code" href="../../d6/d9/rtl_2wow_8c.html#a16">_IsChild</a>(pwndDlg, pwnd)) {
00277                 <span class="keywordflow">if</span> (fLockDlg)
00278                     <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwndDlg);
00279                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00280             }
00281 
00282             <span class="comment">/*</span>
00283 <span class="comment">             * Build DBCS-aware message.</span>
00284 <span class="comment">             */</span>
00285             <a class="code" href="../../d6/d0/usercli_8h.html#a295">BUILD_DBCS_MESSAGE_TO_CLIENTW_FROM_CLIENTA</a>(lpmsg-&gt;message,lpmsg-&gt;wParam,<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00286 
00287             <span class="comment">/*</span>
00288 <span class="comment">             * Fall through.....</span>
00289 <span class="comment">             */</span>
00290         }
00291 <span class="preprocessor">#else</span>
00292 <span class="preprocessor"></span>    <span class="keywordflow">case</span> WM_CHAR:
00293     <span class="keywordflow">case</span> EM_SETPASSWORDCHAR:
00294 <span class="preprocessor">#endif // FE_SB</span>
00295 <span class="preprocessor"></span>    <span class="keywordflow">case</span> WM_CHARTOITEM:
00296     <span class="keywordflow">case</span> WM_DEADCHAR:
00297     <span class="keywordflow">case</span> WM_SYSCHAR:
00298     <span class="keywordflow">case</span> WM_SYSDEADCHAR:
00299     <span class="keywordflow">case</span> WM_MENUCHAR:
00300 <span class="preprocessor">#ifdef FE_IME // IsDialogMessageA()</span>
00301 <span class="preprocessor"></span>    <span class="keywordflow">case</span> WM_IME_CHAR:
00302     <span class="keywordflow">case</span> WM_IME_COMPOSITION:
00303 <span class="preprocessor">#endif // FE_IME</span>
00304 <span class="preprocessor"></span>
00305         <a class="code" href="../../d5/d6/chartran_8c.html#a5">RtlMBMessageWParamCharToWCS</a>(lpmsg-&gt;message, &amp;lpmsg-&gt;wParam);
00306     }
00307 
00308     bRet = <a class="code" href="../../d5/d9/dlgmgr2_8c.html#a3">IsDialogMessageW</a>(hwndDlg, lpmsg);
00309 
00310     <span class="comment">/*</span>
00311 <span class="comment">     * Restore the original ANSI char.</span>
00312 <span class="comment">     */</span>
00313     lpmsg-&gt;wParam = wParamSaved;
00314     <span class="keywordflow">return</span> bRet;
00315 }
00316 
<a name="l00317"></a><a class="code" href="../../d5/d9/dlgmgr2_8c.html#a3">00317</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d5/d9/dlgmgr2_8c.html#a3">IsDialogMessageW</a>(
00318     HWND hwndDlg,
00319     LPMSG lpMsg)
00320 {
00321     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndDlg;
00322     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd;
00323     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd2;
00324     HWND hwnd2;
00325     HWND hwndFocus;
00326     <span class="keywordtype">int</span> iOK;
00327     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fBack;
00328     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> code;
00329     LONG lT;
00330     <a class="code" href="../../d5/d1/struct__TL.html">TL</a> tlpwnd;
00331     <a class="code" href="../../d5/d1/struct__TL.html">TL</a> tlpwndDlg;
00332     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fLockDlg = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00333     <a class="code" href="../../d5/d1/struct__TL.html">TL</a> tlpwnd2;
00334     WORD langID;
00335 
00336     langID = PRIMARYLANGID(LANGIDFROMLCID(GetUserDefaultLCID()));
00337 
00338     <span class="keywordflow">if</span> ((pwndDlg = <a class="code" href="../../d3/d9/client_2wow_8c.html#a1">ValidateHwndNoRip</a>(hwndDlg)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00339         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00340     }
00341 
00342     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwndDlg);
00343 
00344     <span class="comment">/*</span>
00345 <span class="comment">     * If this is a synchronous-only message (takes a pointer in wParam or</span>
00346 <span class="comment">     * lParam), then don't allow this message to go through since those</span>
00347 <span class="comment">     * parameters have not been thunked, and are pointing into outer-space</span>
00348 <span class="comment">     * (which would case exceptions to occur).</span>
00349 <span class="comment">     *</span>
00350 <span class="comment">     * (This api is only called in the context of a message loop, and you</span>
00351 <span class="comment">     * don't get synchronous-only messages in a message loop).</span>
00352 <span class="comment">     */</span>
00353     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a918">TESTSYNCONLYMESSAGE</a>(lpMsg-&gt;message, lpMsg-&gt;wParam)) {
00354         <span class="comment">/*</span>
00355 <span class="comment">         * Fail if 32 bit app is calling.</span>
00356 <span class="comment">         */</span>
00357         <span class="keywordflow">if</span> (!(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a16">GetClientInfo</a>()-&gt;dwTIFlags &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a796">TIF_16BIT</a>)) {
00358             RIPERR0(ERROR_MESSAGE_SYNC_ONLY, RIP_WARNING, <span class="stringliteral">"IsDialogMessage: must be sync only"</span>);
00359             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00360         }
00361 
00362         <span class="comment">/*</span>
00363 <span class="comment">         * For wow apps, allow it to go through (for compatibility). Change</span>
00364 <span class="comment">         * the message id so our code doesn't understand the message - wow</span>
00365 <span class="comment">         * will get the message and strip out this bit before dispatching</span>
00366 <span class="comment">         * the message to the application.</span>
00367 <span class="comment">         */</span>
00368         lpMsg-&gt;message |= <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a544">MSGFLAG_WOW_RESERVED</a>;
00369     }
00370 
00371     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d8/ntcftxt_8h.html#a38">CallMsgFilter</a>(lpMsg, MSGF_DIALOGBOX))
00372         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00373 
00374     <span class="keywordflow">if</span> (lpMsg-&gt;hwnd == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00375         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00376     }
00377 
00378     pwnd = <a class="code" href="../../d4/d0/immcli_8h.html#a4">ValidateHwnd</a>(lpMsg-&gt;hwnd);
00379     <span class="comment">//</span>
00380     <span class="comment">// THIS IS FOR MFC.</span>
00381     <span class="comment">//</span>
00382     <span class="comment">// This solves many problems with apps that use MFC but want to take</span>
00383     <span class="comment">// advantage of DS_CONTROL.  MFC blindly passes in child dialogs sometimes</span>
00384     <span class="comment">// to IsDialogMessage, which can screw up tabbing etc.</span>
00385     <span class="comment">//</span>
00386     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwndDlg, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a627">WEFCONTROLPARENT</a>) &amp;&amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwndDlg, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a654">WFCHILD</a>)) {
00387         pwndDlg = <a class="code" href="../../d6/d0/usercli_8h.html#a755">GetParentDialog</a>(pwndDlg);
00388         <a class="code" href="../../d6/d0/usercli_8h.html#a36">ThreadLock</a>(pwndDlg, &amp;tlpwndDlg);
00389         fLockDlg = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00390         hwndDlg = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(pwndDlg);
00391     }
00392 
00393     <span class="keywordflow">if</span> (pwnd != pwndDlg &amp;&amp; !<a class="code" href="../../d6/d9/rtl_2wow_8c.html#a16">_IsChild</a>(pwndDlg, pwnd)) {
00394         <span class="keywordflow">if</span> (fLockDlg)
00395             <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwndDlg);
00396         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00397     }
00398     <a class="code" href="../../d6/d0/usercli_8h.html#a36">ThreadLock</a>(pwnd, &amp;tlpwnd);
00399 
00400     fBack = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00401     iOK = IDCANCEL;
00402     <span class="keywordflow">switch</span> (lpMsg-&gt;message) {
00403     <span class="keywordflow">case</span> WM_LBUTTONDOWN:
00404 
00405         <span class="comment">/*</span>
00406 <span class="comment">         * Move the default button styles around on button clicks in the</span>
00407 <span class="comment">         * same way as TABs.</span>
00408 <span class="comment">         */</span>
00409         <span class="keywordflow">if</span> ((pwnd != pwndDlg) &amp;&amp; ((hwndFocus = <a class="code" href="../../d3/d8/winmgrc_8c.html#a11">GetFocus</a>()) != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)) {
00410             <a class="code" href="../../d6/d0/usercli_8h.html#a757">xxxCheckDefPushButton</a>(pwndDlg, hwndFocus, lpMsg-&gt;hwnd);
00411         }
00412         <span class="keywordflow">break</span>;
00413 
00414     <span class="keywordflow">case</span> WM_SYSCHAR:
00415 
00416         <span class="comment">/*</span>
00417 <span class="comment">         * If no control has focus, and Alt not down, then ignore.</span>
00418 <span class="comment">         */</span>
00419         <span class="keywordflow">if</span> ((<a class="code" href="../../d3/d8/winmgrc_8c.html#a11">GetFocus</a>() == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) &amp;&amp; (<a class="code" href="../../d8/d9/client_2ntstubs_8c.html#a16">GetKeyState</a>(VK_MENU) &gt;= 0)) {
00420             <span class="keywordflow">if</span> (lpMsg-&gt;wParam == VK_RETURN &amp;&amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a653">WFMINIMIZED</a>)) {
00421 
00422                 <span class="comment">/*</span>
00423 <span class="comment">                 * If this is an iconic dialog box window and the user hits</span>
00424 <span class="comment">                 * return, send the message off to DefWindowProc so that it</span>
00425 <span class="comment">                 * can be restored.  Especially useful for apps whose top</span>
00426 <span class="comment">                 * level window is a dialog box.</span>
00427 <span class="comment">                 */</span>
00428                 <span class="keywordflow">goto</span> CallDefWindowProcAndReturnTrue;
00429             } <span class="keywordflow">else</span> {
00430                 <a class="code" href="../../d6/d0/usercli_8h.html#a219">NtUserMessageBeep</a>(0);
00431             }
00432 
00433             <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwnd);
00434             <span class="keywordflow">if</span> (fLockDlg)
00435                 <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwndDlg);
00436             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00437         }
00438 
00439         <span class="comment">/*</span>
00440 <span class="comment">         * If alt+menuchar, process as menu.</span>
00441 <span class="comment">         */</span>
00442         <span class="keywordflow">if</span> (lpMsg-&gt;wParam == <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a772">MENUSYSMENU</a>) {
00443             <a class="code" href="../../d6/d0/usercli_8h.html#a610">DefWindowProcWorker</a>(pwndDlg, lpMsg-&gt;message, lpMsg-&gt;wParam,
00444                     lpMsg-&gt;lParam, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00445             <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwnd);
00446             <span class="keywordflow">if</span> (fLockDlg)
00447                 <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwndDlg);
00448             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00449         }
00450 
00451     <span class="comment">/*</span>
00452 <span class="comment">     *** FALL THRU **</span>
00453 <span class="comment">     */</span>
00454 
00455     <span class="keywordflow">case</span> WM_CHAR:
00456 
00457         <span class="comment">/*</span>
00458 <span class="comment">         * Ignore chars sent to the dialog box (rather than the control).</span>
00459 <span class="comment">         */</span>
00460         <span class="keywordflow">if</span> (pwnd == pwndDlg) {
00461             <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwnd);
00462             <span class="keywordflow">if</span> (fLockDlg)
00463                 <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwndDlg);
00464             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00465         }
00466 
00467         code = (<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)<a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(lpMsg-&gt;hwnd, WM_GETDLGCODE, lpMsg-&gt;wParam,
00468                 (LPARAM)lpMsg);
00469 
00470         <span class="comment">/*</span>
00471 <span class="comment">         * If the control wants to process the message, then don't check for</span>
00472 <span class="comment">         * possible mnemonic key.</span>
00473 <span class="comment">         */</span>
00474         <span class="keywordflow">if</span> ((lpMsg-&gt;message == WM_CHAR) &amp;&amp; (code &amp; (DLGC_WANTCHARS | DLGC_WANTMESSAGE)))
00475             <span class="keywordflow">break</span>;
00476 
00477         <span class="comment">/* If the control wants tabs, then don't let tab fall thru here</span>
00478 <span class="comment">         */</span>
00479         <span class="keywordflow">if</span> ((lpMsg-&gt;wParam == VK_TAB) &amp;&amp; (code &amp; DLGC_WANTTAB))
00480             <span class="keywordflow">break</span>;
00481 
00482 
00483         <span class="comment">/*</span>
00484 <span class="comment">         * HACK ALERT</span>
00485 <span class="comment">         *</span>
00486 <span class="comment">         * If ALT is held down (i.e., SYSCHARs), then ALWAYS do mnemonic</span>
00487 <span class="comment">         * processing.  If we do away with SYSCHARS, then we should</span>
00488 <span class="comment">         * check key state of ALT instead.</span>
00489 <span class="comment">         */</span>
00490 
00491         <span class="comment">/*</span>
00492 <span class="comment">         * Space is not a valid mnemonic, but it IS the char that toggles</span>
00493 <span class="comment">         * button states.  Don't look for it as a mnemonic or we will</span>
00494 <span class="comment">         * beep when it is typed....</span>
00495 <span class="comment">         */</span>
00496         <span class="keywordflow">if</span> (lpMsg-&gt;wParam == VK_SPACE) {
00497             <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwnd);
00498             <span class="keywordflow">if</span> (fLockDlg)
00499                 <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwndDlg);
00500             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00501         }
00502 
00503         <span class="keywordflow">if</span> (!(pwnd2 = <a class="code" href="../../d6/d0/usercli_8h.html#a758">xxxGotoNextMnem</a>(pwndDlg, pwnd, (WCHAR)lpMsg-&gt;wParam))) {
00504 
00505             <span class="keywordflow">if</span> (code &amp; DLGC_WANTMESSAGE)
00506                 <span class="keywordflow">break</span>;
00507 
00508             <span class="comment">/*</span>
00509 <span class="comment">             * No mnemonic could be found so we will send the sys char over</span>
00510 <span class="comment">             * to xxxDefWindowProc so that any menu bar on the dialog box is</span>
00511 <span class="comment">             * handled properly.</span>
00512 <span class="comment">             */</span>
00513             <span class="keywordflow">if</span> (lpMsg-&gt;message == WM_SYSCHAR) {
00514 CallDefWindowProcAndReturnTrue:
00515                 <a class="code" href="../../d6/d0/usercli_8h.html#a610">DefWindowProcWorker</a>(pwndDlg, lpMsg-&gt;message, lpMsg-&gt;wParam,
00516                         lpMsg-&gt;lParam, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00517 
00518                 <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwnd);
00519                 <span class="keywordflow">if</span> (fLockDlg)
00520                     <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwndDlg);
00521                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00522             }
00523             <a class="code" href="../../d6/d0/usercli_8h.html#a219">NtUserMessageBeep</a>(0);
00524         } <span class="keywordflow">else</span> {
00525 
00526             <span class="comment">/*</span>
00527 <span class="comment">             * pwnd2 is 1 if the mnemonic took us to a pushbutton.  We</span>
00528 <span class="comment">             * don't change the default button status here since doing this</span>
00529 <span class="comment">             * doesn't change the focus.</span>
00530 <span class="comment">             */</span>
00531             <span class="keywordflow">if</span> (pwnd2 != (<a class="code" href="../../d6/d9/structtagWND.html">PWND</a>)1) {
00532                 <a class="code" href="../../d6/d0/usercli_8h.html#a37">ThreadLockAlways</a>(pwnd2, &amp;tlpwnd2);
00533                 <a class="code" href="../../d6/d0/usercli_8h.html#a757">xxxCheckDefPushButton</a>(pwndDlg, lpMsg-&gt;hwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(pwnd2));
00534                 <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwnd2);
00535             }
00536         }
00537 
00538         <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwnd);
00539         <span class="keywordflow">if</span> (fLockDlg)
00540             <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwndDlg);
00541         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00542 
00543     <span class="keywordflow">case</span> WM_SYSKEYDOWN:
00544         <span class="comment">/*</span>
00545 <span class="comment">         * If Alt is down, deal with keyboard cues</span>
00546 <span class="comment">         */</span>
00547         <span class="keywordflow">if</span> ((HIWORD(lpMsg-&gt;lParam) &amp; <a class="code" href="../../d3/d5/editsl_8c.html#a0">SYS_ALTERNATE</a>) &amp;&amp; <a class="code" href="../../d1/d0/inc_2user_8h.html#a384">TEST_KbdCuesPUSIF</a>) {
00548             <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d1/d0/inc_2user_8h.html#a622">WEFPUIFOCUSHIDDEN</a>) || (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d1/d0/inc_2user_8h.html#a623">WEFPUIACCELHIDDEN</a>))) {
00549                     <a class="code" href="../../d6/d0/usercli_8h.html#a600">SendMessageWorker</a>(pwndDlg, WM_CHANGEUISTATE,
00550                                       MAKEWPARAM(UIS_CLEAR, UISF_HIDEACCEL | UISF_HIDEFOCUS), 0, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00551                 }
00552         }
00553         <span class="keywordflow">break</span>;
00554 
00555     <span class="keywordflow">case</span> WM_KEYDOWN:
00556         code = (<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)<a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(lpMsg-&gt;hwnd, WM_GETDLGCODE, lpMsg-&gt;wParam,
00557                 (LPARAM)lpMsg);
00558         <span class="keywordflow">if</span> (code &amp; (DLGC_WANTALLKEYS | DLGC_WANTMESSAGE))
00559             <span class="keywordflow">break</span>;
00560 
00561         <span class="keywordflow">switch</span> (lpMsg-&gt;wParam) {
00562         <span class="keywordflow">case</span> VK_TAB:
00563             <span class="keywordflow">if</span> (code &amp; DLGC_WANTTAB)
00564                 <span class="keywordflow">break</span>;
00565             pwnd2 = <a class="code" href="../../d6/d0/usercli_8h.html#a642">_GetNextDlgTabItem</a>(pwndDlg, pwnd,
00566                     (<a class="code" href="../../d8/d9/client_2ntstubs_8c.html#a16">GetKeyState</a>(VK_SHIFT) &amp; 0x8000));
00567 
00568             <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/inc_2user_8h.html#a384">TEST_KbdCuesPUSIF</a>) {
00569                 <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d1/d0/inc_2user_8h.html#a622">WEFPUIFOCUSHIDDEN</a>)) {
00570                     <a class="code" href="../../d6/d0/usercli_8h.html#a600">SendMessageWorker</a>(pwndDlg, WM_CHANGEUISTATE,
00571                                           MAKEWPARAM(UIS_CLEAR, UISF_HIDEFOCUS), 0, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00572                 }
00573             }
00574 
00575             <span class="keywordflow">if</span> (pwnd2 != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00576                 hwnd2 = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(pwnd2);
00577                 <a class="code" href="../../d6/d0/usercli_8h.html#a37">ThreadLockAlways</a>(pwnd2, &amp;tlpwnd2);
00578                 <a class="code" href="../../d6/d0/usercli_8h.html#a759">DlgSetFocus</a>(hwnd2);
00579                 <a class="code" href="../../d6/d0/usercli_8h.html#a757">xxxCheckDefPushButton</a>(pwndDlg, lpMsg-&gt;hwnd, hwnd2);
00580                 <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwnd2);
00581             }
00582             <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwnd);
00583             <span class="keywordflow">if</span> (fLockDlg)
00584                 <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwndDlg);
00585             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00586 
00587         <span class="comment">/*</span>
00588 <span class="comment">         * For Arabic and Hebrew locales the arrow keys are reversed. Also reverse them if</span>
00589 <span class="comment">         * the dialog is RTL mirrored.</span>
00590 <span class="comment">         */</span>
00591         <span class="keywordflow">case</span> VK_LEFT:
00592             <span class="keywordflow">if</span> ((((langID == LANG_ARABIC) || (langID == LANG_HEBREW)) &amp;&amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwndDlg,<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a625">WEFRTLREADING</a>))
00593 <span class="preprocessor">#ifdef USE_MIRRORING</span>
00594 <span class="preprocessor"></span>               ^ (!!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwndDlg, WEFLAYOUTRTL))
00595 <span class="preprocessor">#endif</span>
00596 <span class="preprocessor"></span>               )
00597                 <span class="keywordflow">goto</span> DoKeyStuff;
00598         <span class="keywordflow">case</span> VK_UP:
00599             fBack = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00600             <span class="keywordflow">goto</span> DoKeyStuff;
00601 
00602         <span class="comment">/*</span>
00603 <span class="comment">         *** FALL THRU **</span>
00604 <span class="comment">         */</span>
00605         <span class="keywordflow">case</span> VK_RIGHT:
00606             <span class="keywordflow">if</span> ((((langID == LANG_ARABIC) || (langID == LANG_HEBREW)) &amp;&amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwndDlg,<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a625">WEFRTLREADING</a>)) 
00607 <span class="preprocessor">#ifdef USE_MIRRORING</span>
00608 <span class="preprocessor"></span>                 ^ (!!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwndDlg, WEFLAYOUTRTL))
00609 <span class="preprocessor">#endif</span>
00610 <span class="preprocessor"></span>               )
00611                 fBack = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00612         <span class="keywordflow">case</span> VK_DOWN:
00613 DoKeyStuff:
00614             <span class="keywordflow">if</span> (code &amp; DLGC_WANTARROWS)
00615                 <span class="keywordflow">break</span>;
00616 
00617             <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/inc_2user_8h.html#a384">TEST_KbdCuesPUSIF</a>) {
00618                 <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d1/d0/inc_2user_8h.html#a622">WEFPUIFOCUSHIDDEN</a>)) {
00619                         <a class="code" href="../../d6/d0/usercli_8h.html#a600">SendMessageWorker</a>(pwndDlg, WM_CHANGEUISTATE,
00620                                           MAKEWPARAM(UIS_CLEAR, UISF_HIDEFOCUS), 0, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00621                     }
00622             }
00623 
00624             pwnd2 = <a class="code" href="../../d6/d0/usercli_8h.html#a641">_GetNextDlgGroupItem</a>(pwndDlg, pwnd, fBack);
00625             <span class="keywordflow">if</span> (pwnd2 == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00626                 <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwnd);
00627                 <span class="keywordflow">if</span> (fLockDlg)
00628                     <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwndDlg);
00629                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00630             }
00631             hwnd2 = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(pwnd2);
00632             <a class="code" href="../../d6/d0/usercli_8h.html#a37">ThreadLockAlways</a>(pwnd2, &amp;tlpwnd2);
00633 
00634             code = (<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)<a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(hwnd2, WM_GETDLGCODE, lpMsg-&gt;wParam,
00635                     (LPARAM)lpMsg);
00636 
00637             <span class="comment">/*</span>
00638 <span class="comment">             * We are just moving the focus rect around! So, do not send</span>
00639 <span class="comment">             * BN_CLICK messages, when WM_SETFOCUSing.  Fix for Bug</span>
00640 <span class="comment">             * #4358.</span>
00641 <span class="comment">             */</span>
00642             <span class="keywordflow">if</span> (code &amp; (DLGC_UNDEFPUSHBUTTON | DLGC_DEFPUSHBUTTON)) {
00643                 <a class="code" href="../../d2/d9/structtagBUTN.html">PBUTN</a> pbutn;
00644                 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fIsNTButton = (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a232">GETFNID</a>(pwnd2) == <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a200">FNID_BUTTON</a>);
00645                 <span class="keywordflow">if</span> (fIsNTButton) {
00646                     pbutn = ((<a class="code" href="../../d3/d9/structtagBUTNWND.html">PBUTNWND</a>)pwnd2)-&gt;pbutn;
00647                     <a class="code" href="../../d6/d0/usercli_8h.html#a43">BUTTONSTATE</a>(pbutn) |= <a class="code" href="../../d6/d0/usercli_8h.html#a48">BST_DONTCLICK</a>;
00648                 }
00649                 <a class="code" href="../../d6/d0/usercli_8h.html#a759">DlgSetFocus</a>(hwnd2);
00650                 <span class="keywordflow">if</span> (fIsNTButton) {
00651                     <a class="code" href="../../d6/d0/usercli_8h.html#a43">BUTTONSTATE</a>(pbutn) &amp;= ~<a class="code" href="../../d6/d0/usercli_8h.html#a48">BST_DONTCLICK</a>;
00652                 }
00653                 <a class="code" href="../../d6/d0/usercli_8h.html#a757">xxxCheckDefPushButton</a>(pwndDlg, lpMsg-&gt;hwnd, hwnd2);
00654             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (code &amp; DLGC_RADIOBUTTON) {
00655                 <a class="code" href="../../d6/d0/usercli_8h.html#a759">DlgSetFocus</a>(hwnd2);
00656                 <a class="code" href="../../d6/d0/usercli_8h.html#a757">xxxCheckDefPushButton</a>(pwndDlg, lpMsg-&gt;hwnd, hwnd2);
00657                 <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd2, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a659">BFTYPEMASK</a>) == <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(BS_AUTORADIOBUTTON)) {
00658 
00659                     <span class="comment">/*</span>
00660 <span class="comment">                     * So that auto radio buttons get clicked on</span>
00661 <span class="comment">                     */</span>
00662                     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(hwnd2, BM_GETCHECK, 0, 0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>)) {
00663                         <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(hwnd2, BM_CLICK, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>, 0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>);
00664                     }
00665                 }
00666             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!(code &amp; DLGC_STATIC)) {
00667                 <a class="code" href="../../d6/d0/usercli_8h.html#a759">DlgSetFocus</a>(hwnd2);
00668                 <a class="code" href="../../d6/d0/usercli_8h.html#a757">xxxCheckDefPushButton</a>(pwndDlg, lpMsg-&gt;hwnd, hwnd2);
00669             }
00670             <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwnd2);
00671             <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwnd);
00672             <span class="keywordflow">if</span> (fLockDlg)
00673                 <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwndDlg);
00674             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00675 
00676         <span class="keywordflow">case</span> VK_EXECUTE:
00677         <span class="keywordflow">case</span> VK_RETURN:
00678 
00679             <span class="comment">/*</span>
00680 <span class="comment">             * Guy pressed return - if button with focus is</span>
00681 <span class="comment">             * defpushbutton, return its ID.  Otherwise, return id</span>
00682 <span class="comment">             * of original defpushbutton.</span>
00683 <span class="comment">             */</span>
00684             <span class="keywordflow">if</span> (!(hwndFocus = <a class="code" href="../../d3/d8/winmgrc_8c.html#a11">GetFocus</a>()))
00685                 code = 0;
00686             <span class="keywordflow">else</span>
00687             {
00688                 code = (WORD)(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)<a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(hwndFocus, WM_GETDLGCODE,
00689                     0, 0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>);
00690             }
00691 
00692             <span class="keywordflow">if</span> (code &amp; DLGC_DEFPUSHBUTTON)
00693             {
00694                 iOK = <a class="code" href="../../d4/d9/nt6_2dlgmgr_8c.html#a11">GetDlgCtrlID</a>(hwndFocus);
00695                 pwnd2 = <a class="code" href="../../d4/d0/immcli_8h.html#a4">ValidateHwnd</a>(hwndFocus);
00696                 <span class="keywordflow">goto</span> HaveWindow;
00697             }
00698             <span class="keywordflow">else</span>
00699             {
00700                 lT = (LONG)<a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(hwndDlg, DM_GETDEFID, 0, 0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>);
00701                 iOK = MAKELONG(
00702                     (HIWORD(lT)==DC_HASDEFID ? LOWORD(lT) : IDOK),
00703                     0);
00704             }
00705             <span class="comment">// FALL THRU</span>
00706 
00707         <span class="keywordflow">case</span> VK_ESCAPE:
00708         <span class="keywordflow">case</span> VK_CANCEL:
00709 
00710             <span class="comment">/*</span>
00711 <span class="comment">             * Make sure button is not disabled.</span>
00712 <span class="comment">             */</span>
00713             pwnd2 = <a class="code" href="../../d6/d0/usercli_8h.html#a752">_FindDlgItem</a>(pwndDlg, iOK);
00714 HaveWindow:
00715             <span class="keywordflow">if</span> (pwnd2 != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> &amp;&amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd2, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a651">WFDISABLED</a>)) {
00716                 <a class="code" href="../../d6/d0/usercli_8h.html#a219">NtUserMessageBeep</a>(0);
00717             } <span class="keywordflow">else</span> {
00718                 <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(hwndDlg, WM_COMMAND,
00719                         MAKELONG(iOK, BN_CLICKED), (LPARAM)<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a450">HW</a>(pwnd2));
00720             }
00721 
00722             <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwnd);
00723             <span class="keywordflow">if</span> (fLockDlg)
00724                 <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwndDlg);
00725             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00726         }
00727         <span class="keywordflow">break</span>;
00728     }
00729 
00730     <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwnd);
00731     <span class="keywordflow">if</span> (fLockDlg)
00732         <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwndDlg);
00733 
00734     <a class="code" href="../../d8/d9/client_2ntstubs_8c.html#a21">TranslateMessage</a>(lpMsg);
00735     <a class="code" href="../../d5/d9/cltxt_8h.html#a24">DispatchMessage</a>(lpMsg);
00736 
00737     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00738 }
00739 
00740 <span class="comment">/***************************************************************************\</span>
00741 <span class="comment">*</span>
00742 <span class="comment">* FindDlgItem32()</span>
00743 <span class="comment">*</span>
00744 <span class="comment">* Given a dialog, finds the window with the given ID anywhere w/in the</span>
00745 <span class="comment">* descendant chain.</span>
00746 <span class="comment">*</span>
00747 <span class="comment">\***************************************************************************/</span>
00748 
<a name="l00749"></a><a class="code" href="../../d6/d0/usercli_8h.html#a752">00749</a> <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> <a class="code" href="../../d6/d0/usercli_8h.html#a752">_FindDlgItem</a>(<a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndParent, DWORD <span class="keywordtype">id</span>)
00750 {
00751     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a>    pwndChild;
00752     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a>    pwndOrig;
00753 
00754     <span class="comment">// QUICK TRY:</span>
00755     pwndChild = <a class="code" href="../../d3/d9/client_2wow_8c.html#a5">_GetDlgItem</a>(pwndParent, <span class="keywordtype">id</span>);
00756     <span class="keywordflow">if</span> (pwndChild || !<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwndParent, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a593">WFWIN40COMPAT</a>))
00757         <span class="keywordflow">return</span>(pwndChild);
00758 
00759     pwndOrig = <a class="code" href="../../d6/d0/usercli_8h.html#a639">_NextControl</a>(pwndParent, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, CWP_SKIPINVISIBLE);
00760     <span class="keywordflow">if</span> (pwndOrig == pwndParent)
00761         <span class="keywordflow">return</span>(<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00762 
00763     pwndChild = pwndOrig;
00764 
00765 <span class="comment">//    VerifyWindow(pwndChild);</span>
00766 
00767     <span class="keywordflow">do</span>
00768     {
00769         <span class="keywordflow">if</span> (PtrToUlong(pwndChild-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o16">spmenu</a>) == <span class="keywordtype">id</span>)
00770             <span class="keywordflow">return</span>(pwndChild);
00771 
00772         pwndChild = <a class="code" href="../../d6/d0/usercli_8h.html#a639">_NextControl</a>(pwndParent, pwndChild, CWP_SKIPINVISIBLE);
00773     }
00774     <span class="keywordflow">while</span> (pwndChild &amp;&amp; (pwndChild != pwndOrig));
00775 
00776     <span class="keywordflow">return</span>(<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00777 }
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:39:45 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
