<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: clinit.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>clinit.c File Reference</h1><code>#include "<a class="el" href="../../d8/d2/w32_2ntuser_2client_2precomp_8h-source.html">precomp.h</a>"</code><br>
<code>#include &lt;conroute.h&gt;</code><br>
<code>#include "<a class="el" href="../../d1/d9/csrhlpr_8h-source.html">csrhlpr.h</a>"</code><br>
<code>#include "badapps.h"</code><br>

<p>
<a href="../../d7/d7/clinit_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d8/clinit_8c.html#a0">DLLPATCH_NAME</a>&nbsp;&nbsp;&nbsp;L"DllPatch"</td></tr>

<tr><td colspan=2><br><h2>Typedefs</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>typedef BOOL(*&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d8/clinit_8c.html#a12">PFNLOADPATCHDLL</a> )(LPSTR pwszPatchDll)</td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d8/clinit_8c.html#a16">GdiProcessSetup</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d8/clinit_8c.html#a17">GdiDllInitialize</a> (IN PVOID hmod, IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> Reason, IN PCONTEXT pctx OPTIONAL)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d8/clinit_8c.html#a18">UserClientDllInitialize</a> (IN PVOID hmod, IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> Reason, IN PCONTEXT pctx OPTIONAL)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d8/clinit_8c.html#a19">LoadCursorsAndIcons</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d8/clinit_8c.html#a20">RW_RegisterControls</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d8/clinit_8c.html#a21">RW_RegisterDDEML</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LPSTR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d8/clinit_8c.html#a22">GetBadAppCmdLine</a> (IN LPCWSTR lpApplicationName)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d8/clinit_8c.html#a23">CheckBadApp</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d8/clinit_8c.html#a24">LoadAppDlls</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d8/clinit_8c.html#a25">InitOemXlateTables</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d8/clinit_8c.html#a26">ClientThreadSetup</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>HLOCAL WINAPI&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d8/clinit_8c.html#a27">DispatchLocalAlloc</a> (UINT uFlags, UINT uBytes, HANDLE hInstance)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>HLOCAL WINAPI&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d8/clinit_8c.html#a28">DispatchLocalReAlloc</a> (HLOCAL hMem, UINT uBytes, UINT uFlags, HANDLE hInstance, PVOID *ppv)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a> WINAPI&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d8/clinit_8c.html#a29">DispatchLocalLock</a> (HLOCAL hMem, HANDLE hInstance)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL WINAPI&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d8/clinit_8c.html#a30">DispatchLocalUnlock</a> (HLOCAL hMem, HANDLE hInstance)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>UINT WINAPI&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d8/clinit_8c.html#a31">DispatchLocalSize</a> (HLOCAL hMem, HANDLE hInstance)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>HLOCAL WINAPI&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d8/clinit_8c.html#a32">DispatchLocalFree</a> (HLOCAL hMem, HANDLE hInstance)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PVOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d8/clinit_8c.html#a33">UserRtlAllocMem</a> (ULONG uBytes)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d8/clinit_8c.html#a34">UserRtlFreeMem</a> (PVOID pMem)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d8/clinit_8c.html#a35">UserRtlRaiseStatus</a> (NTSTATUS <a class="el" href="../../d2/d1/cttoken_8c.html#a18">Status</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d8/clinit_8c.html#a36">InitClientDrawing</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d8/clinit_8c.html#a37">InitializeLpkHooks</a> (CONST FARPROC *lpfpLpkHooks)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d8/clinit_8c.html#a38">CtxInitUser32</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d8/clinit_8c.html#a39">GetRipComponent</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d8/clinit_8c.html#a40">GetDbgTagFlags</a> (int tag)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d8/clinit_8c.html#a41">GetRipPID</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d8/clinit_8c.html#a42">GetRipFlags</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d8/clinit_8c.html#a43">SetRipFlags</a> (<a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwRipFlags, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwRipPID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d8/clinit_8c.html#a44">SetDbgTag</a> (int tag, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwBitFlags)</td></tr>

<tr><td colspan=2><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d8/clinit_8c.html#a1">gfFirstThread</a> = TRUE</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d1/d3/structtagDESKTOPINFO.html">PDESKTOPINFO</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d8/clinit_8c.html#a2">pdiLocal</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d8/clinit_8c.html#a3">gbIhaveBeenInited</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d8/clinit_8c.html#a4">gdwLpkEntryPoints</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>CONST WCHAR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d8/clinit_8c.html#a5">pwszWindowsKey</a> [] = L"\\Registry\\Machine\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Windows"</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>CONST WCHAR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d8/clinit_8c.html#a6">szAppInit</a> [] = L"AppInit_DLLs"</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>CONST WCHAR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d8/clinit_8c.html#a7">gwszShimDll</a> [] = L"shim.dll"</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>CONST <a class="el" href="../../d2/d1/bench_8h.html#a8">CHAR</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d8/clinit_8c.html#a8">gszLoadPathDll</a> [] = "LoadPatchDll"</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>WCHAR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d8/clinit_8c.html#a9">szWindowStationDirectory</a> [MAX_SESSION_PATH]</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>CONST PCSR_CALLBACK_ROUTINE&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d8/clinit_8c.html#a10">apfnDispatch</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>CONST ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d8/clinit_8c.html#a11">ulMaxApiIndex</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>const <a class="el" href="../../d0/d5/struct__PFNCLIENT.html">PFNCLIENT</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d8/clinit_8c.html#a13">pfnClientA</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>const <a class="el" href="../../d0/d5/struct__PFNCLIENT.html">PFNCLIENT</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d8/clinit_8c.html#a14">pfnClientW</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>const <a class="el" href="../../d1/d5/struct__PFNCLIENTWORKER.html">PFNCLIENTWORKER</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d8/clinit_8c.html#a15">pfnClientWorker</a></td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a0" doxytag="clinit.c::DLLPATCH_NAME" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define DLLPATCH_NAME&nbsp;&nbsp;&nbsp;L"DllPatch"          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d7/d7/clinit_8c-source.html#l00598">GetBadAppCmdLine()</a>.    </td>
  </tr>
</table>
<hr><h2>Typedef Documentation</h2>
<a class="anchor" name="a12" doxytag="clinit.c::PFNLOADPATCHDLL" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef BOOL(* <a class="el" href="../../d6/d8/clinit_8c.html#a12">PFNLOADPATCHDLL</a>)(LPSTR pwszPatchDll)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d7/clinit_8c-source.html#l00875">875</a> of file <a class="el" href="../../d7/d7/clinit_8c-source.html">clinit.c</a>.
<p>
Referenced by <a class="el" href="../../d7/d7/clinit_8c-source.html#l00877">CheckBadApp()</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a23" doxytag="clinit.c::CheckBadApp" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL CheckBadApp           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d7/clinit_8c-source.html#l00877">877</a> of file <a class="el" href="../../d7/d7/clinit_8c-source.html">clinit.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d7/clinit_8c-source.html#l00598">GetBadAppCmdLine()</a>, <a class="el" href="../../d7/d7/clinit_8c-source.html#l00033">gszLoadPathDll</a>, <a class="el" href="../../d7/d7/clinit_8c-source.html#l00032">gwszShimDll</a>, <a class="el" href="../../d4/d8/arcinst_8c-source.html#l00065">MAX_PATH</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d7/clinit_8c-source.html#l00875">PFNLOADPATCHDLL</a>, <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html#l00023">RtlFreeHeap</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d7/d7/clinit_8c-source.html#l01219">ClientThreadSetup()</a>.
<p>
<pre class="fragment"><div>00878 {
00879     WCHAR           wszAppName[<a class="code" href="../../d3/d9/arcinst_8c.html#a6">MAX_PATH</a>];
00880     <a class="code" href="../../d6/d8/clinit_8c.html#a12">PFNLOADPATCHDLL</a> pfnLoadPatchDll;
00881     LPSTR           pszCmdLine;
00882     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>            bRet;
00883     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>           dwSize;
00884     HMODULE         hMod;
00885 
00886     dwSize = GetModuleFileNameW(NULL, wszAppName, MAX_PATH);
00887 
00888     UserAssert(dwSize &gt; 0);
00889     
00890     pszCmdLine = <a class="code" href="../../d6/d8/clinit_8c.html#a22">GetBadAppCmdLine</a>(wszAppName);
00891 
00892     <span class="keywordflow">if</span> (pszCmdLine == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00893         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00894     }
00895     
00896     <span class="keywordflow">if</span> ( _stricmp( pszCmdLine, <span class="stringliteral">"disable"</span> ) == 0 ) {
00897        <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00898     }
00899 
00900     hMod = LoadLibraryW(gwszShimDll);
00901 
00902     <span class="keywordflow">if</span> (hMod == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00903         RIPMSG0(RIP_WARNING, <span class="stringliteral">"Couldn't load SHIM.DLL"</span>);
00904         <span class="keywordflow">goto</span> Exit;
00905     }
00906     pfnLoadPatchDll = (<a class="code" href="../../d6/d8/clinit_8c.html#a12">PFNLOADPATCHDLL</a>)GetProcAddress(hMod, gszLoadPathDll);
00907 
00908     <span class="keywordflow">if</span> (pfnLoadPatchDll == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00909         RIPMSG1(RIP_WARNING, <span class="stringliteral">"Couldn't find '%s' in SHIM.DLL"</span>,
00910                 gszLoadPathDll);
00911         
00912         FreeLibrary(hMod);
00913         <span class="keywordflow">goto</span> Exit;
00914     }
00915 
00916     bRet = (*pfnLoadPatchDll)(pszCmdLine);
00917 
00918     UserAssert(bRet);
00919 
00920 Exit:
00921     
00922     <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a1">RtlFreeHeap</a>(RtlProcessHeap(), 0, pszCmdLine);
00923     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00924 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a26" doxytag="clinit.c::ClientThreadSetup" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL ClientThreadSetup           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d7/clinit_8c-source.html#l01219">1219</a> of file <a class="el" href="../../d7/d7/clinit_8c-source.html">clinit.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d9/d0/btnctl_8c-source.html#l01907">ButtonWndProcA()</a>, <a class="el" href="../../d9/d0/btnctl_8c-source.html#l01929">ButtonWndProcW()</a>, <a class="el" href="../../d9/d0/btnctl_8c-source.html#l01338">ButtonWndProcWorker()</a>, <a class="el" href="../../d7/d7/clinit_8c-source.html#l00877">CheckBadApp()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00508">_CLIENTINFO::CI_flags</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00550">CI_INITIALIZED</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00552">CI_REGISTERCLASSES</a>, <a class="el" href="../../d2/d3/combo_8c-source.html#l01335">ComboBoxWndProcA()</a>, <a class="el" href="../../d2/d3/combo_8c-source.html#l01359">ComboBoxWndProcW()</a>, <a class="el" href="../../d2/d3/combo_8c-source.html#l00207">ComboBoxWndProcWorker()</a>, <a class="el" href="../../d7/d0/lb1_8c-source.html#l00788">ComboListBoxWndProcA()</a>, <a class="el" href="../../d7/d0/lb1_8c-source.html#l00810">ComboListBoxWndProcW()</a>, <a class="el" href="../../d4/d8/dlgmgr_8c-source.html#l01014">DefDlgProcA()</a>, <a class="el" href="../../d4/d8/dlgmgr_8c-source.html#l00999">DefDlgProcW()</a>, <a class="el" href="../../d4/d8/dlgmgr_8c-source.html#l00460">DefDlgProcWorker()</a>, <a class="el" href="../../d0/d0/client_2nt6_2user_8h.html#a1069">DESKTOPINFO</a>, <a class="el" href="../../d1/d8/clmsg_8c-source.html#l00099">DesktopWndProcA()</a>, <a class="el" href="../../d1/d8/clmsg_8c-source.html#l00108">DesktopWndProcW()</a>, <a class="el" href="../../d4/d7/client_8c-source.html#l02822">DispatchClientMessage()</a>, <a class="el" href="../../d6/d0/usercli_8h.html#a573">DispatchHookA()</a>, <a class="el" href="../../d6/d0/usercli_8h.html#a572">DispatchHookW()</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01364">_USERCONNECT::dwDispatchCount</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l02787">EditWndProcA()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l02808">EditWndProcW()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l02831">EditWndProcWorker()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d6/d0/usercli_8h.html#a571">fnHkINLPCWPRETSTRUCTA()</a>, <a class="el" href="../../d6/d0/usercli_8h.html#a570">fnHkINLPCWPRETSTRUCTW()</a>, <a class="el" href="../../d6/d0/usercli_8h.html#a569">fnHkINLPCWPSTRUCTA()</a>, <a class="el" href="../../d6/d0/usercli_8h.html#a568">fnHkINLPCWPSTRUCTW()</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00092">gcsAccelCache</a>, <a class="el" href="../../d6/d8/clinit_8c.html#a16">GdiProcessSetup()</a>, <a class="el" href="../../d9/d5/ntuser_2client_2globals_8h-source.html#l00026">gDispatchTableValues</a>, <a class="el" href="../../d7/d7/clinit_8c-source.html#l00027">gdwLpkEntryPoints</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00192">GetClientInfo</a>, <a class="el" href="../../d7/d7/clinit_8c-source.html#l00024">gfFirstThread</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00056">gfServerProcess</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00057">gfSystemInitialized</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l03362">ghbrBlack</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l03361">ghbrWhite</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00101">ghdcBits2</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00051">gpsi</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00052">gSharedInfo</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00053">hmodUser</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l03667">tagMSG_TABLE_ENTRY::iFunction</a>, <a class="el" href="../../d0/d9/imectl_8c-source.html#l00240">ImeWndProcA()</a>, <a class="el" href="../../d0/d9/imectl_8c-source.html#l00256">ImeWndProcW()</a>, <a class="el" href="../../d0/d9/imectl_8c-source.html#l00083">ImeWndProcWorker()</a>, <a class="el" href="../../d6/d0/usercli_8h.html#a545">InitClientDrawing()</a>, <a class="el" href="../../d7/d7/clinit_8c-source.html#l01062">InitOemXlateTables()</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00025">INT</a>, <a class="el" href="../../d7/d0/lb1_8c-source.html#l00744">ListBoxWndProcA()</a>, <a class="el" href="../../d7/d0/lb1_8c-source.html#l00766">ListBoxWndProcW()</a>, <a class="el" href="../../d7/d0/lb1_8c-source.html#l00032">ListBoxWndProcWorker()</a>, <a class="el" href="../../d7/d7/clinit_8c-source.html#l00933">LoadAppDlls()</a>, <a class="el" href="../../d7/d7/clinit_8c-source.html#l00307">LoadCursorsAndIcons()</a>, <a class="el" href="../../d7/d3/msgbox_8c-source.html#l01866">MB_DlgProcA()</a>, <a class="el" href="../../d7/d3/msgbox_8c-source.html#l01875">MB_DlgProcW()</a>, <a class="el" href="../../d6/d4/mdimenu_8c-source.html#l00917">MDIActivateDlgProcA()</a>, <a class="el" href="../../d6/d4/mdimenu_8c-source.html#l00926">MDIActivateDlgProcW()</a>, <a class="el" href="../../d7/d4/mdiwin_8c-source.html#l02063">MDIClientWndProcA()</a>, <a class="el" href="../../d7/d4/mdiwin_8c-source.html#l02078">MDIClientWndProcW()</a>, <a class="el" href="../../d7/d4/mdiwin_8c-source.html#l01657">MDIClientWndProcWorker()</a>, <a class="el" href="../../d1/d8/clmsg_8c-source.html#l00165">MenuWndProcA()</a>, <a class="el" href="../../d1/d8/clmsg_8c-source.html#l00174">MenuWndProcW()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l03524">MessageTable</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l04510">NtUserCallNoParam()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l04526">NtUserCallOneParam()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l01455">NtUserGetThreadDesktop()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l01508">NtUserInitializeClientPfnArrays()</a>, <a class="el" href="../../d0/d6/kernel_2server_8c-source.html#l02788">NtUserProcessConnect()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d7/clinit_8c-source.html#l00025">pdiLocal</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00863">_PFNCLIENT::pfnButtonWndProc</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00884">_PFNCLIENTWORKER::pfnButtonWndProc</a>, <a class="el" href="../../d7/d7/clinit_8c-source.html#l01156">pfnClientA</a>, <a class="el" href="../../d7/d7/clinit_8c-source.html#l01178">pfnClientW</a>, <a class="el" href="../../d7/d7/clinit_8c-source.html#l01200">pfnClientWorker</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00864">_PFNCLIENT::pfnComboBoxWndProc</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00885">_PFNCLIENTWORKER::pfnComboBoxWndProc</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00865">_PFNCLIENT::pfnComboListBoxProc</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00886">_PFNCLIENTWORKER::pfnComboListBoxProc</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00859">_PFNCLIENT::pfnDefWindowProc</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00858">_PFNCLIENT::pfnDesktopWndProc</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00866">_PFNCLIENT::pfnDialogWndProc</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00887">_PFNCLIENTWORKER::pfnDialogWndProc</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00877">_PFNCLIENT::pfnDispatchHook</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00878">_PFNCLIENT::pfnDispatchMessage</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00867">_PFNCLIENT::pfnEditWndProc</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00888">_PFNCLIENTWORKER::pfnEditWndProc</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00876">_PFNCLIENT::pfnHkINLPCWPRETSTRUCT</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00875">_PFNCLIENT::pfnHkINLPCWPSTRUCT</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00871">_PFNCLIENT::pfnImeWndProc</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00892">_PFNCLIENTWORKER::pfnImeWndProc</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00868">_PFNCLIENT::pfnListBoxWndProc</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00889">_PFNCLIENTWORKER::pfnListBoxWndProc</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00879">_PFNCLIENT::pfnMB_DlgProc</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00880">_PFNCLIENT::pfnMDIActivateDlgProc</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00869">_PFNCLIENT::pfnMDIClientWndProc</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00890">_PFNCLIENTWORKER::pfnMDIClientWndProc</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00857">_PFNCLIENT::pfnMenuWndProc</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00855">_PFNCLIENT::pfnScrollBarWndProc</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00870">_PFNCLIENT::pfnStaticWndProc</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00891">_PFNCLIENTWORKER::pfnStaticWndProc</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00856">_PFNCLIENT::pfnTitleWndProc</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01277">tagSHAREDINFO::psi</a>, <a class="el" href="../../d7/d7/clinit_8c-source.html#l00378">RW_RegisterControls()</a>, <a class="el" href="../../d0/d4/ddemlcli_8h.html#a94">RW_RegisterDDEML()</a>, <a class="el" href="../../d1/d8/clmsg_8c-source.html#l00242">ScrollBarWndProcA()</a>, <a class="el" href="../../d1/d8/clmsg_8c-source.html#l00251">ScrollBarWndProcW()</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01365">_USERCONNECT::siClient</a>, <a class="el" href="../../d6/d4/statctl_8c-source.html#l01173">StaticWndProcA()</a>, <a class="el" href="../../d6/d4/statctl_8c-source.html#l01188">StaticWndProcW()</a>, <a class="el" href="../../d6/d4/statctl_8c-source.html#l00840">StaticWndProcWorker()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01362">_USERCONNECT::ulVersion</a>, and <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01305">USERCURRENTVERSION</a>.
<p>
Referenced by <a class="el" href="../../d7/d2/queue_8c-source.html#l01501">xxxCreateThreadInfo()</a>.
<p>
<pre class="fragment"><div>01220 {
01221     <a class="code" href="../../d2/d2/struct__CLIENTINFO.html">PCLIENTINFO</a> pci;
01222     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>        fFirstThread;
01223     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>       ConnectState;
01224 
01225 <span class="preprocessor">#ifdef TRACE_THREAD_INIT</span>
01226 <span class="preprocessor"></span>    KdPrint((<span class="stringliteral">"USER32: ClientThreadSetup (pteb: %#p)\n"</span>, NtCurrentTeb()));
01227 <span class="preprocessor">#endif</span>
01228 <span class="preprocessor"></span>
01229     <span class="comment">/*</span>
01230 <span class="comment">     * BUG 268642: Only the first thread calls GdiProcessSetup but all the other</span>
01231 <span class="comment">     * threads must wait until the setup for GDI is finished.</span>
01232 <span class="comment">     *</span>
01233 <span class="comment">     * We can safely use gcsAccelCache critical section to protect this (even</span>
01234 <span class="comment">     * though the name is not intuitive at all)</span>
01235 <span class="comment">     */</span>
01236 
01237     RtlEnterCriticalSection(&amp;gcsAccelCache);
01238 
01239     fFirstThread = <a class="code" href="../../d6/d8/clinit_8c.html#a1">gfFirstThread</a>;
01240 
01241     <span class="comment">/*</span>
01242 <span class="comment">     * setup GDI before continuing</span>
01243 <span class="comment">     */</span>
01244     <span class="keywordflow">if</span> (fFirstThread) {
01245         <a class="code" href="../../d6/d8/clinit_8c.html#a1">gfFirstThread</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01246         <a class="code" href="../../d6/d8/clinit_8c.html#a16">GdiProcessSetup</a>();
01247     }
01248 
01249     RtlLeaveCriticalSection(&amp;gcsAccelCache);
01250 
01251     <span class="comment">/*</span>
01252 <span class="comment">     * We've already checked to see if we need to connect</span>
01253 <span class="comment">     * (i.e. NtCurrentTeb()-&gt;Win32ThreadInfo == NULL)  This routine</span>
01254 <span class="comment">     * just does the connecting.  If we've already been through here</span>
01255 <span class="comment">     * once, don't do it again.</span>
01256 <span class="comment">     */</span>
01257     pci = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a16">GetClientInfo</a>();
01258     <span class="keywordflow">if</span> (pci-&gt;<a class="code" href="../../d2/d2/struct__CLIENTINFO.html#o0">CI_flags</a> &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a115">CI_INITIALIZED</a>) {
01259         RIPMSG0(RIP_ERROR, <span class="stringliteral">"Already initialized!"</span>);
01260         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01261     }
01262 
01263     <span class="comment">/*</span>
01264 <span class="comment">     * Create the queue info and thread info. Only once for this process do</span>
01265 <span class="comment">     * we pass client side addresses to the server (for server callbacks).</span>
01266 <span class="comment">     */</span>
01267     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d8/clglobal_8c.html#a8">gfServerProcess</a> &amp;&amp; fFirstThread) {
01268 
01269         <a class="code" href="../../d6/d4/struct__USERCONNECT.html">USERCONNECT</a> userconnect;
01270         <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>    <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01271 
01272         <span class="comment">/*</span>
01273 <span class="comment">         * We know that the shared info is now available in</span>
01274 <span class="comment">         * the kernel.  Map it into the server process.</span>
01275 <span class="comment">         */</span>
01276         userconnect.<a class="code" href="../../d6/d4/struct__USERCONNECT.html#o0">ulVersion</a> = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a409">USERCURRENTVERSION</a>;
01277         userconnect.<a class="code" href="../../d6/d4/struct__USERCONNECT.html#o2">dwDispatchCount</a> = <a class="code" href="../../d8/d6/ntuser_2client_2globals_8h.html#a11">gDispatchTableValues</a>;
01278         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d9/d6/kernel_2server_8c.html#a84">NtUserProcessConnect</a>(NtCurrentProcess(),
01279                                       &amp;userconnect,
01280                                       <span class="keyword">sizeof</span>(<a class="code" href="../../d6/d4/struct__USERCONNECT.html">USERCONNECT</a>));
01281         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status))
01282             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01283 
01284         <a class="code" href="../../d1/d8/clglobal_8c.html#a5">gSharedInfo</a> = userconnect.<a class="code" href="../../d6/d4/struct__USERCONNECT.html#o3">siClient</a>;
01285         <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a> = <a class="code" href="../../d1/d8/clglobal_8c.html#a5">gSharedInfo</a>.<a class="code" href="../../d4/d6/structtagSHAREDINFO.html#o0">psi</a>;
01286         UserAssert(gpsi);
01287 
01288         UserAssert(<a class="code" href="../../d6/d8/clinit_8c.html#a13">pfnClientA</a>.<a class="code" href="../../d0/d5/struct__PFNCLIENT.html#o0">pfnScrollBarWndProc</a>   == (KPROC)ScrollBarWndProcA);
01289         UserAssert(<a class="code" href="../../d6/d8/clinit_8c.html#a13">pfnClientA</a>.<a class="code" href="../../d0/d5/struct__PFNCLIENT.html#o1">pfnTitleWndProc</a>       == (KPROC)DefWindowProcA);
01290         UserAssert(<a class="code" href="../../d6/d8/clinit_8c.html#a13">pfnClientA</a>.<a class="code" href="../../d0/d5/struct__PFNCLIENT.html#o2">pfnMenuWndProc</a>        == (KPROC)MenuWndProcA);
01291         UserAssert(<a class="code" href="../../d6/d8/clinit_8c.html#a13">pfnClientA</a>.<a class="code" href="../../d0/d5/struct__PFNCLIENT.html#o3">pfnDesktopWndProc</a>     == (KPROC)DesktopWndProcA);
01292         UserAssert(<a class="code" href="../../d6/d8/clinit_8c.html#a13">pfnClientA</a>.<a class="code" href="../../d0/d5/struct__PFNCLIENT.html#o4">pfnDefWindowProc</a>      == (KPROC)DefWindowProcA);
01293         UserAssert(<a class="code" href="../../d6/d8/clinit_8c.html#a13">pfnClientA</a>.<a class="code" href="../../d0/d5/struct__PFNCLIENT.html#o14">pfnHkINLPCWPSTRUCT</a>    == (KPROC)fnHkINLPCWPSTRUCTA);
01294         UserAssert(<a class="code" href="../../d6/d8/clinit_8c.html#a13">pfnClientA</a>.<a class="code" href="../../d0/d5/struct__PFNCLIENT.html#o15">pfnHkINLPCWPRETSTRUCT</a> == (KPROC)fnHkINLPCWPRETSTRUCTA);
01295         UserAssert(<a class="code" href="../../d6/d8/clinit_8c.html#a13">pfnClientA</a>.<a class="code" href="../../d0/d5/struct__PFNCLIENT.html#o5">pfnButtonWndProc</a>      == (KPROC)ButtonWndProcA);
01296         UserAssert(<a class="code" href="../../d6/d8/clinit_8c.html#a13">pfnClientA</a>.<a class="code" href="../../d0/d5/struct__PFNCLIENT.html#o6">pfnComboBoxWndProc</a>    == (KPROC)ComboBoxWndProcA);
01297         UserAssert(<a class="code" href="../../d6/d8/clinit_8c.html#a13">pfnClientA</a>.<a class="code" href="../../d0/d5/struct__PFNCLIENT.html#o7">pfnComboListBoxProc</a>   == (KPROC)ComboListBoxWndProcA);
01298         UserAssert(<a class="code" href="../../d6/d8/clinit_8c.html#a13">pfnClientA</a>.<a class="code" href="../../d0/d5/struct__PFNCLIENT.html#o8">pfnDialogWndProc</a>      == (KPROC)DefDlgProcA);
01299         UserAssert(<a class="code" href="../../d6/d8/clinit_8c.html#a13">pfnClientA</a>.<a class="code" href="../../d0/d5/struct__PFNCLIENT.html#o9">pfnEditWndProc</a>        == (KPROC)EditWndProcA);
01300         UserAssert(<a class="code" href="../../d6/d8/clinit_8c.html#a13">pfnClientA</a>.<a class="code" href="../../d0/d5/struct__PFNCLIENT.html#o10">pfnListBoxWndProc</a>     == (KPROC)ListBoxWndProcA);
01301         UserAssert(<a class="code" href="../../d6/d8/clinit_8c.html#a13">pfnClientA</a>.<a class="code" href="../../d0/d5/struct__PFNCLIENT.html#o18">pfnMB_DlgProc</a>         == (KPROC)MB_DlgProcA);
01302         UserAssert(<a class="code" href="../../d6/d8/clinit_8c.html#a13">pfnClientA</a>.<a class="code" href="../../d0/d5/struct__PFNCLIENT.html#o19">pfnMDIActivateDlgProc</a> == (KPROC)MDIActivateDlgProcA);
01303         UserAssert(<a class="code" href="../../d6/d8/clinit_8c.html#a13">pfnClientA</a>.<a class="code" href="../../d0/d5/struct__PFNCLIENT.html#o11">pfnMDIClientWndProc</a>   == (KPROC)MDIClientWndProcA);
01304         UserAssert(<a class="code" href="../../d6/d8/clinit_8c.html#a13">pfnClientA</a>.<a class="code" href="../../d0/d5/struct__PFNCLIENT.html#o12">pfnStaticWndProc</a>      == (KPROC)StaticWndProcA);
01305         UserAssert(<a class="code" href="../../d6/d8/clinit_8c.html#a13">pfnClientA</a>.<a class="code" href="../../d0/d5/struct__PFNCLIENT.html#o16">pfnDispatchHook</a>       == (KPROC)DispatchHookA);
01306         UserAssert(<a class="code" href="../../d6/d8/clinit_8c.html#a13">pfnClientA</a>.<a class="code" href="../../d0/d5/struct__PFNCLIENT.html#o17">pfnDispatchMessage</a>    == (KPROC)DispatchClientMessage);
01307         UserAssert(<a class="code" href="../../d6/d8/clinit_8c.html#a13">pfnClientA</a>.<a class="code" href="../../d0/d5/struct__PFNCLIENT.html#o13">pfnImeWndProc</a>         == (KPROC)ImeWndProcA);
01308 
01309         UserAssert(<a class="code" href="../../d6/d8/clinit_8c.html#a14">pfnClientW</a>.<a class="code" href="../../d0/d5/struct__PFNCLIENT.html#o0">pfnScrollBarWndProc</a>   == (KPROC)ScrollBarWndProcW);
01310         UserAssert(<a class="code" href="../../d6/d8/clinit_8c.html#a14">pfnClientW</a>.<a class="code" href="../../d0/d5/struct__PFNCLIENT.html#o1">pfnTitleWndProc</a>       == (KPROC)DefWindowProcW);
01311         UserAssert(<a class="code" href="../../d6/d8/clinit_8c.html#a14">pfnClientW</a>.<a class="code" href="../../d0/d5/struct__PFNCLIENT.html#o2">pfnMenuWndProc</a>        == (KPROC)MenuWndProcW);
01312         UserAssert(<a class="code" href="../../d6/d8/clinit_8c.html#a14">pfnClientW</a>.<a class="code" href="../../d0/d5/struct__PFNCLIENT.html#o3">pfnDesktopWndProc</a>     == (KPROC)DesktopWndProcW);
01313         UserAssert(<a class="code" href="../../d6/d8/clinit_8c.html#a14">pfnClientW</a>.<a class="code" href="../../d0/d5/struct__PFNCLIENT.html#o4">pfnDefWindowProc</a>      == (KPROC)DefWindowProcW);
01314         UserAssert(<a class="code" href="../../d6/d8/clinit_8c.html#a14">pfnClientW</a>.<a class="code" href="../../d0/d5/struct__PFNCLIENT.html#o14">pfnHkINLPCWPSTRUCT</a>    == (KPROC)fnHkINLPCWPSTRUCTW);
01315         UserAssert(<a class="code" href="../../d6/d8/clinit_8c.html#a14">pfnClientW</a>.<a class="code" href="../../d0/d5/struct__PFNCLIENT.html#o15">pfnHkINLPCWPRETSTRUCT</a> == (KPROC)fnHkINLPCWPRETSTRUCTW);
01316         UserAssert(<a class="code" href="../../d6/d8/clinit_8c.html#a14">pfnClientW</a>.<a class="code" href="../../d0/d5/struct__PFNCLIENT.html#o5">pfnButtonWndProc</a>      == (KPROC)ButtonWndProcW);
01317         UserAssert(<a class="code" href="../../d6/d8/clinit_8c.html#a14">pfnClientW</a>.<a class="code" href="../../d0/d5/struct__PFNCLIENT.html#o6">pfnComboBoxWndProc</a>    == (KPROC)ComboBoxWndProcW);
01318         UserAssert(<a class="code" href="../../d6/d8/clinit_8c.html#a14">pfnClientW</a>.<a class="code" href="../../d0/d5/struct__PFNCLIENT.html#o7">pfnComboListBoxProc</a>   == (KPROC)ComboListBoxWndProcW);
01319         UserAssert(<a class="code" href="../../d6/d8/clinit_8c.html#a14">pfnClientW</a>.<a class="code" href="../../d0/d5/struct__PFNCLIENT.html#o8">pfnDialogWndProc</a>      == (KPROC)DefDlgProcW);
01320         UserAssert(<a class="code" href="../../d6/d8/clinit_8c.html#a14">pfnClientW</a>.<a class="code" href="../../d0/d5/struct__PFNCLIENT.html#o9">pfnEditWndProc</a>        == (KPROC)EditWndProcW);
01321         UserAssert(<a class="code" href="../../d6/d8/clinit_8c.html#a14">pfnClientW</a>.<a class="code" href="../../d0/d5/struct__PFNCLIENT.html#o10">pfnListBoxWndProc</a>     == (KPROC)ListBoxWndProcW);
01322         UserAssert(<a class="code" href="../../d6/d8/clinit_8c.html#a14">pfnClientW</a>.<a class="code" href="../../d0/d5/struct__PFNCLIENT.html#o18">pfnMB_DlgProc</a>         == (KPROC)MB_DlgProcW);
01323         UserAssert(<a class="code" href="../../d6/d8/clinit_8c.html#a14">pfnClientW</a>.<a class="code" href="../../d0/d5/struct__PFNCLIENT.html#o19">pfnMDIActivateDlgProc</a> == (KPROC)MDIActivateDlgProcW);
01324         UserAssert(<a class="code" href="../../d6/d8/clinit_8c.html#a14">pfnClientW</a>.<a class="code" href="../../d0/d5/struct__PFNCLIENT.html#o11">pfnMDIClientWndProc</a>   == (KPROC)MDIClientWndProcW);
01325         UserAssert(<a class="code" href="../../d6/d8/clinit_8c.html#a14">pfnClientW</a>.<a class="code" href="../../d0/d5/struct__PFNCLIENT.html#o12">pfnStaticWndProc</a>      == (KPROC)StaticWndProcW);
01326         UserAssert(<a class="code" href="../../d6/d8/clinit_8c.html#a14">pfnClientW</a>.<a class="code" href="../../d0/d5/struct__PFNCLIENT.html#o16">pfnDispatchHook</a>       == (KPROC)DispatchHookW);
01327         UserAssert(<a class="code" href="../../d6/d8/clinit_8c.html#a14">pfnClientW</a>.<a class="code" href="../../d0/d5/struct__PFNCLIENT.html#o17">pfnDispatchMessage</a>    == (KPROC)DispatchClientMessage);
01328         UserAssert(<a class="code" href="../../d6/d8/clinit_8c.html#a14">pfnClientW</a>.<a class="code" href="../../d0/d5/struct__PFNCLIENT.html#o13">pfnImeWndProc</a>         == (KPROC)ImeWndProcW);
01329 
01330         UserAssert(<a class="code" href="../../d6/d8/clinit_8c.html#a15">pfnClientWorker</a>.<a class="code" href="../../d1/d5/struct__PFNCLIENTWORKER.html#o0">pfnButtonWndProc</a>      == (KPROC)ButtonWndProcWorker);
01331         UserAssert(<a class="code" href="../../d6/d8/clinit_8c.html#a15">pfnClientWorker</a>.<a class="code" href="../../d1/d5/struct__PFNCLIENTWORKER.html#o1">pfnComboBoxWndProc</a>    == (KPROC)ComboBoxWndProcWorker);
01332         UserAssert(<a class="code" href="../../d6/d8/clinit_8c.html#a15">pfnClientWorker</a>.<a class="code" href="../../d1/d5/struct__PFNCLIENTWORKER.html#o2">pfnComboListBoxProc</a>   == (KPROC)ListBoxWndProcWorker);
01333         UserAssert(<a class="code" href="../../d6/d8/clinit_8c.html#a15">pfnClientWorker</a>.<a class="code" href="../../d1/d5/struct__PFNCLIENTWORKER.html#o3">pfnDialogWndProc</a>      == (KPROC)DefDlgProcWorker);
01334         UserAssert(<a class="code" href="../../d6/d8/clinit_8c.html#a15">pfnClientWorker</a>.<a class="code" href="../../d1/d5/struct__PFNCLIENTWORKER.html#o4">pfnEditWndProc</a>        == (KPROC)EditWndProcWorker);
01335         UserAssert(<a class="code" href="../../d6/d8/clinit_8c.html#a15">pfnClientWorker</a>.<a class="code" href="../../d1/d5/struct__PFNCLIENTWORKER.html#o5">pfnListBoxWndProc</a>     == (KPROC)ListBoxWndProcWorker);
01336         UserAssert(<a class="code" href="../../d6/d8/clinit_8c.html#a15">pfnClientWorker</a>.<a class="code" href="../../d1/d5/struct__PFNCLIENTWORKER.html#o6">pfnMDIClientWndProc</a>   == (KPROC)MDIClientWndProcWorker);
01337         UserAssert(<a class="code" href="../../d6/d8/clinit_8c.html#a15">pfnClientWorker</a>.<a class="code" href="../../d1/d5/struct__PFNCLIENTWORKER.html#o7">pfnStaticWndProc</a>      == (KPROC)StaticWndProcWorker);
01338         UserAssert(<a class="code" href="../../d6/d8/clinit_8c.html#a15">pfnClientWorker</a>.<a class="code" href="../../d1/d5/struct__PFNCLIENTWORKER.html#o8">pfnImeWndProc</a>         == (KPROC)ImeWndProcWorker);
01339 
01340 <span class="preprocessor">#if DBG</span>
01341 <span class="preprocessor"></span>        {
01342             PULONG_PTR pdw;
01343 
01344             <span class="comment">/*</span>
01345 <span class="comment">             * Make sure that everyone got initialized</span>
01346 <span class="comment">             */</span>
01347             <span class="keywordflow">for</span> (pdw = (PULONG_PTR)&amp;<a class="code" href="../../d6/d8/clinit_8c.html#a13">pfnClientA</a>;
01348                  (ULONG_PTR)pdw&lt;(ULONG_PTR)(&amp;<a class="code" href="../../d6/d8/clinit_8c.html#a13">pfnClientA</a>) + <span class="keyword">sizeof</span>(<a class="code" href="../../d6/d8/clinit_8c.html#a13">pfnClientA</a>);
01349                  pdw++) {
01350                 UserAssert(*pdw);
01351             }
01352 
01353             <span class="keywordflow">for</span> (pdw = (PULONG_PTR)&amp;<a class="code" href="../../d6/d8/clinit_8c.html#a14">pfnClientW</a>;
01354                  (ULONG_PTR)pdw&lt;(ULONG_PTR)(&amp;<a class="code" href="../../d6/d8/clinit_8c.html#a14">pfnClientW</a>) + <span class="keyword">sizeof</span>(<a class="code" href="../../d6/d8/clinit_8c.html#a14">pfnClientW</a>);
01355                  pdw++) {
01356                 UserAssert(*pdw);
01357             }
01358         }
01359 <span class="preprocessor">#endif</span>
01360 <span class="preprocessor"></span>
01361 <span class="preprocessor">#if DBG</span>
01362 <span class="preprocessor"></span>    {
01363         <span class="keyword">extern</span> CONST <a class="code" href="../../d9/d5/ndismain_8h.html#a263">INT</a> gcapfnScSendMessage;
01364         BOOLEAN apfnCheckMessage[64];
01365         <span class="keywordtype">int</span> i;
01366 
01367         <span class="comment">/*</span>
01368 <span class="comment">         * Do some verification of the message table. Since we only have</span>
01369 <span class="comment">         * 6 bits to store the function index, the function table can have</span>
01370 <span class="comment">         * at most 64 entries. Also verify that none of the indexes point</span>
01371 <span class="comment">         * past the end of the table and that all the function entries</span>
01372 <span class="comment">         * are used.</span>
01373 <span class="comment">         */</span>
01374         UserAssert(gcapfnScSendMessage &lt;= 64);
01375         RtlZeroMemory(apfnCheckMessage, <span class="keyword">sizeof</span>(apfnCheckMessage));
01376         <span class="keywordflow">for</span> (i = 0; i &lt; WM_USER; i++) {
01377             UserAssert(MessageTable[i].iFunction &lt; gcapfnScSendMessage);
01378             apfnCheckMessage[<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a1144">MessageTable</a>[i].<a class="code" href="../../d6/d2/structtagMSG__TABLE__ENTRY.html#o0">iFunction</a>] = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01379         }
01380 
01381         <span class="keywordflow">for</span> (i = 0; i &lt; gcapfnScSendMessage; i++) {
01382             UserAssert(apfnCheckMessage[i]);
01383         }
01384     }
01385 <span class="preprocessor">#endif</span>
01386 <span class="preprocessor"></span>
01387     }
01388 
01389     <span class="comment">/*</span>
01390 <span class="comment">     * Pass the function pointer arrays to the kernel.  This also establishes</span>
01391 <span class="comment">     * the kernel state for the thread.  If ClientThreadSetup is called from</span>
01392 <span class="comment">     * CsrConnectToUser this call will raise an exception if the thread</span>
01393 <span class="comment">     * cannot be converted to a gui thread.  The exception is handled in</span>
01394 <span class="comment">     * CsrConnectToUser.</span>
01395 <span class="comment">     */</span>
01396 <span class="preprocessor">#if DBG &amp;&amp; !defined(BUILD_WOW6432)</span>
01397 <span class="preprocessor"></span>    <span class="comment">/*</span>
01398 <span class="comment">     * On debug systems, go to the kernel for all processes to verify we're</span>
01399 <span class="comment">     * loading user32.dll at the right address.</span>
01400 <span class="comment">     */</span>
01401     <span class="keywordflow">if</span> (fFirstThread) {
01402 <span class="preprocessor">#elif defined(BUILD_WOW6432)</span>
01403 <span class="preprocessor"></span>    <span class="comment">/*</span>
01404 <span class="comment">     * On WOW64 allways register the client fns</span>
01405 <span class="comment">     */</span>
01406     {
01407 <span class="preprocessor">#else</span>
01408 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (<a class="code" href="../../d1/d8/clglobal_8c.html#a8">gfServerProcess</a> &amp;&amp; fFirstThread) {
01409 <span class="preprocessor">#endif</span>
01410 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a102">NtUserInitializeClientPfnArrays</a>(&amp;pfnClientA, &amp;pfnClientW, &amp;pfnClientWorker, hmodUser))) {
01411 
01412             RIPERR0(ERROR_OUTOFMEMORY,
01413                     RIP_WARNING,
01414                     <span class="stringliteral">"NtUserInitializeClientPfnArrays failed"</span>);
01415 
01416             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01417         }
01418     }
01419 
01420     <span class="comment">/*</span>
01421 <span class="comment">     * Mark this thread as being initialized.  If the connection to</span>
01422 <span class="comment">     * the server fails, NtCurrentTeb()-&gt;Win32ThreadInfo will remain</span>
01423 <span class="comment">     * NULL.</span>
01424 <span class="comment">     */</span>
01425     pci-&gt;<a class="code" href="../../d2/d2/struct__CLIENTINFO.html#o0">CI_flags</a> |= <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a115">CI_INITIALIZED</a>;
01426 
01427     <span class="comment">/*</span>
01428 <span class="comment">     * Some initialization only has to occur once per process</span>
01429 <span class="comment">     */</span>
01430     <span class="keywordflow">if</span> (fFirstThread) {
01431 
01432         ConnectState = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)<a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a173">NtUserCallNoParam</a>(SFI_REMOTECONNECTSTATE);
01433 
01434         <span class="comment">/*</span>
01435 <span class="comment">         * Winstation Winlogon and CSR must do graphics initialization</span>
01436 <span class="comment">         * after the connect.</span>
01437 <span class="comment">         */</span>
01438 
01439         <span class="keywordflow">if</span> (ConnectState != CTX_W32_CONNECT_STATE_IDLE) {
01440 
01441             <span class="keywordflow">if</span> ((<a class="code" href="../../d1/d8/clglobal_8c.html#a26">ghdcBits2</a> = CreateCompatibleDC(NULL)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01442                 RIPERR0(ERROR_OUTOFMEMORY, RIP_WARNING, <span class="stringliteral">"ghdcBits2 creation failed"</span>);
01443                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01444             }
01445 
01446             <span class="comment">/*</span>
01447 <span class="comment">             * Get things we need from Gdi.</span>
01448 <span class="comment">             */</span>
01449             <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a1134">ghbrWhite</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
01450                 <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a1134">ghbrWhite</a> = GetStockObject(WHITE_BRUSH);
01451 
01452             <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a1135">ghbrBlack</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
01453                 <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a1135">ghbrBlack</a> = GetStockObject(BLACK_BRUSH);
01454 
01455             <a class="code" href="../../d6/d0/usercli_8h.html#a545">InitClientDrawing</a>();
01456         }
01457 
01458         <a class="code" href="../../d1/d8/clglobal_8c.html#a9">gfSystemInitialized</a> = <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a100">NtUserGetThreadDesktop</a>(GetCurrentThreadId(),
01459                                                      NULL) != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01460 
01461         <span class="comment">/*</span>
01462 <span class="comment">         * If an lpk is loaded for this process notify the kernel</span>
01463 <span class="comment">         */</span>
01464         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d8/clinit_8c.html#a4">gdwLpkEntryPoints</a>) {
01465             <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a174">NtUserCallOneParam</a>(gdwLpkEntryPoints, SFI_REGISTERLPK);
01466         }
01467 
01468         <span class="keywordflow">if</span> (<a class="code" href="../../d1/d8/clglobal_8c.html#a8">gfServerProcess</a> || (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a16">GetClientInfo</a>()-&gt;pDeskInfo == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)) {
01469 
01470             <span class="comment">/*</span>
01471 <span class="comment">             * Perform any server initialization.</span>
01472 <span class="comment">             */</span>
01473             UserAssert(gpsi);
01474 
01475             <span class="keywordflow">if</span> (<a class="code" href="../../d6/d8/clinit_8c.html#a2">pdiLocal</a> = LocalAlloc(LPTR, <span class="keyword">sizeof</span>(<a class="code" href="../../d1/d3/structtagDESKTOPINFO.html">DESKTOPINFO</a>))) {
01476 
01477                 <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a16">GetClientInfo</a>()-&gt;pDeskInfo = <a class="code" href="../../d6/d8/clinit_8c.html#a2">pdiLocal</a>;
01478 
01479             } <span class="keywordflow">else</span> {
01480 
01481                 RIPERR0(ERROR_OUTOFMEMORY, RIP_WARNING, <span class="stringliteral">"pdiLocal creation failed"</span>);
01482 
01483                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01484             }
01485         }
01486 
01487         <span class="keywordflow">if</span> (<a class="code" href="../../d1/d8/clglobal_8c.html#a8">gfServerProcess</a>) {
01488             <span class="comment">/*</span>
01489 <span class="comment">             * Winstation Winlogon and CSR must do graphics initialization</span>
01490 <span class="comment">             * after the connect.</span>
01491 <span class="comment">             */</span>
01492             <span class="keywordflow">if</span> (ConnectState != CTX_W32_CONNECT_STATE_IDLE) {
01493                 <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d8/clinit_8c.html#a19">LoadCursorsAndIcons</a>()) {
01494                     RIPERR0(ERROR_OUTOFMEMORY, RIP_WARNING, <span class="stringliteral">"LoadCursorsAndIcons failed"</span>);
01495                     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01496                 }
01497             }
01498 
01499             <a class="code" href="../../d6/d8/clinit_8c.html#a25">InitOemXlateTables</a>();
01500         }
01501 
01502         <span class="keywordflow">if</span> ( ! <a class="code" href="../../d6/d8/clinit_8c.html#a23">CheckBadApp</a>() ) {
01503             RIPERR0(ERROR_OUTOFMEMORY, RIP_WARNING, <span class="stringliteral">"Don't start app for server appliance"</span>);
01504             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01505         }
01506 
01507         <a class="code" href="../../d6/d8/clinit_8c.html#a24">LoadAppDlls</a>();
01508     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d1/d8/clglobal_8c.html#a8">gfServerProcess</a>) {
01509         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a16">GetClientInfo</a>()-&gt;pDeskInfo = <a class="code" href="../../d6/d8/clinit_8c.html#a2">pdiLocal</a>;
01510     }
01511 
01512     <span class="comment">/*</span>
01513 <span class="comment">     * Kernel sets CI_REGISTERCLASSES when appropriate (i.e. always</span>
01514 <span class="comment">     * for the first thread and for other threads if the last GUI</span>
01515 <span class="comment">     * thread for a process has exited) except for the CSR proces.</span>
01516 <span class="comment">     * For the CSR process, you must register the classes on the</span>
01517 <span class="comment">     * first thread anyways.</span>
01518 <span class="comment">     */</span>
01519 
01520     <span class="keywordflow">if</span> (fFirstThread || (pci-&gt;<a class="code" href="../../d2/d2/struct__CLIENTINFO.html#o0">CI_flags</a> &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a117">CI_REGISTERCLASSES</a>)) {
01521 
01522         <span class="comment">/*</span>
01523 <span class="comment">         * If it's the first thread we already made it to the kernel</span>
01524 <span class="comment">         * to get the ConnectState...</span>
01525 <span class="comment">         */</span>
01526         <span class="keywordflow">if</span> (!fFirstThread) {
01527             ConnectState = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)<a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a173">NtUserCallNoParam</a>(SFI_REMOTECONNECTSTATE);
01528         }
01529         
01530         <span class="keywordflow">if</span> (ConnectState != CTX_W32_CONNECT_STATE_IDLE) {
01531 
01532             <span class="comment">/*</span>
01533 <span class="comment">             * Register the control classes.</span>
01534 <span class="comment">             */</span>
01535             <a class="code" href="../../d6/d8/clinit_8c.html#a20">RW_RegisterControls</a>();
01536             <a class="code" href="../../d0/d4/ddemlcli_8h.html#a94">RW_RegisterDDEML</a>();
01537         }
01538     }
01539 
01540     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01541 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a38" doxytag="clinit.c::CtxInitUser32" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL CtxInitUser32           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d7/clinit_8c-source.html#l01729">1729</a> of file <a class="el" href="../../d7/d7/clinit_8c-source.html">clinit.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00056">gfServerProcess</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l03362">ghbrBlack</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l03361">ghbrWhite</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00101">ghdcBits2</a>, <a class="el" href="../../d6/d0/usercli_8h.html#a545">InitClientDrawing()</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00293">ISREMOTESESSION</a>, <a class="el" href="../../d7/d7/clinit_8c-source.html#l00307">LoadCursorsAndIcons()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d7/clinit_8c-source.html#l00378">RW_RegisterControls()</a>, <a class="el" href="../../d0/d4/ddemlcli_8h.html#a94">RW_RegisterDDEML()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d4/d7/client_8c-source.html#l02154">CommonCreateWindowStation()</a>, and <a class="el" href="../../d3/d7/api_8c-source.html#l00504">W32WinStationDoConnect()</a>.
<p>
<pre class="fragment"><div>01731 {
01732     <span class="comment">/*</span>
01733 <span class="comment">     * Only do once.</span>
01734 <span class="comment">     */</span>
01735     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d8/clglobal_8c.html#a26">ghdcBits2</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> || !<a class="code" href="../../d6/d0/usercli_8h.html#a30">ISREMOTESESSION</a>())
01736         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01737 
01738     <a class="code" href="../../d1/d8/clglobal_8c.html#a26">ghdcBits2</a> = CreateCompatibleDC(NULL);
01739 
01740     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d8/clglobal_8c.html#a26">ghdcBits2</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01741         RIPMSG0(RIP_WARNING, <span class="stringliteral">"Could not allocate ghdcBits2"</span>);
01742         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01743     }
01744 
01745     <span class="comment">/*</span>
01746 <span class="comment">     * Get things we need from Gdi.</span>
01747 <span class="comment">     */</span>
01748     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a1134">ghbrWhite</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
01749         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a1134">ghbrWhite</a> = GetStockObject(WHITE_BRUSH);
01750 
01751     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a1135">ghbrBlack</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
01752         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a1135">ghbrBlack</a> = GetStockObject(BLACK_BRUSH);
01753 
01754     UserAssert(ghbrWhite != NULL &amp;&amp; ghbrBlack != NULL);
01755 
01756     <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d0/usercli_8h.html#a545">InitClientDrawing</a>()) {
01757         RIPMSG0(RIP_WARNING, <span class="stringliteral">"InitClientDrawing failed"</span>);
01758         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01759     }
01760 
01761     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d8/clglobal_8c.html#a8">gfServerProcess</a>) {
01762         <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d8/clinit_8c.html#a19">LoadCursorsAndIcons</a>()) {
01763             RIPMSG0(RIP_WARNING, <span class="stringliteral">"LoadCursorsAndIcons failed"</span>);
01764             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01765         }
01766     }
01767 
01768     <span class="comment">/*</span>
01769 <span class="comment">     * Register the control classes.</span>
01770 <span class="comment">     */</span>
01771     <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d8/clinit_8c.html#a20">RW_RegisterControls</a>())
01772         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01773 
01774     <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d4/ddemlcli_8h.html#a94">RW_RegisterDDEML</a>())
01775         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01776 
01777     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01778 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a27" doxytag="clinit.c::DispatchLocalAlloc" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HLOCAL WINAPI DispatchLocalAlloc           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>uFlags</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>uBytes</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>hInstance</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d7/clinit_8c-source.html#l01549">1549</a> of file <a class="el" href="../../d7/d7/clinit_8c-source.html">clinit.c</a>.
<p>
<pre class="fragment"><div>01553 {
01554     UNREFERENCED_PARAMETER(hInstance);
01555 
01556     <span class="keywordflow">return</span> LocalAlloc(uFlags, uBytes);
01557 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a32" doxytag="clinit.c::DispatchLocalFree" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HLOCAL WINAPI DispatchLocalFree           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HLOCAL&nbsp;</td>
          <td class="mdname" nowrap> <em>hMem</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>hInstance</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d7/clinit_8c-source.html#l01599">1599</a> of file <a class="el" href="../../d7/d7/clinit_8c-source.html">clinit.c</a>.
<p>
<pre class="fragment"><div>01602 {
01603     UNREFERENCED_PARAMETER(hInstance);
01604 
01605     <span class="keywordflow">return</span> LocalFree(hMem);
01606 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a29" doxytag="clinit.c::DispatchLocalLock" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a> WINAPI DispatchLocalLock           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HLOCAL&nbsp;</td>
          <td class="mdname" nowrap> <em>hMem</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>hInstance</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d7/clinit_8c-source.html#l01572">1572</a> of file <a class="el" href="../../d7/d7/clinit_8c-source.html">clinit.c</a>.
<p>
References <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">LPVOID</a>.
<p>
<pre class="fragment"><div>01575 {
01576     UNREFERENCED_PARAMETER(hInstance);
01577 
01578     <span class="keywordflow">return</span> LocalLock(hMem);
01579 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a28" doxytag="clinit.c::DispatchLocalReAlloc" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HLOCAL WINAPI DispatchLocalReAlloc           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HLOCAL&nbsp;</td>
          <td class="mdname" nowrap> <em>hMem</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>uBytes</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>uFlags</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>hInstance</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PVOID *&nbsp;</td>
          <td class="mdname" nowrap> <em>ppv</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d7/clinit_8c-source.html#l01559">1559</a> of file <a class="el" href="../../d7/d7/clinit_8c-source.html">clinit.c</a>.
<p>
<pre class="fragment"><div>01565 {
01566     UNREFERENCED_PARAMETER(hInstance);
01567     UNREFERENCED_PARAMETER(ppv);
01568 
01569     <span class="keywordflow">return</span> LocalReAlloc(hMem, uBytes, uFlags);
01570 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a31" doxytag="clinit.c::DispatchLocalSize" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> UINT WINAPI DispatchLocalSize           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HLOCAL&nbsp;</td>
          <td class="mdname" nowrap> <em>hMem</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>hInstance</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d7/clinit_8c-source.html#l01590">1590</a> of file <a class="el" href="../../d7/d7/clinit_8c-source.html">clinit.c</a>.
<p>
References <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>.
<p>
<pre class="fragment"><div>01593 {
01594     UNREFERENCED_PARAMETER(hInstance);
01595 
01596     <span class="keywordflow">return</span> (<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)LocalSize(hMem);
01597 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a30" doxytag="clinit.c::DispatchLocalUnlock" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL WINAPI DispatchLocalUnlock           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HLOCAL&nbsp;</td>
          <td class="mdname" nowrap> <em>hMem</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>hInstance</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d7/clinit_8c-source.html#l01581">1581</a> of file <a class="el" href="../../d7/d7/clinit_8c-source.html">clinit.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>.
<p>
<pre class="fragment"><div>01584 {
01585     UNREFERENCED_PARAMETER(hInstance);
01586 
01587     <span class="keywordflow">return</span> LocalUnlock(hMem);
01588 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a17" doxytag="clinit.c::GdiDllInitialize" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL GdiDllInitialize           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>hmod</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Reason</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCONTEXT pctx&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d7/d7/clinit_8c-source.html#l00059">UserClientDllInitialize()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a16" doxytag="clinit.c::GdiProcessSetup" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL GdiProcessSetup           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d7/d7/clinit_8c-source.html#l01219">ClientThreadSetup()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a22" doxytag="clinit.c::GetBadAppCmdLine" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LPSTR GetBadAppCmdLine           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN LPCWSTR&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>lpApplicationName</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d7/clinit_8c-source.html#l00598">598</a> of file <a class="el" href="../../d7/d7/clinit_8c-source.html">clinit.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d6/d8/clinit_8c.html#a0">DLLPATCH_NAME</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d6/d9/obclose_8c-source.html#l00037">NtClose()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l00756">NtEnumerateValueKey()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l01870">NtOpenKey()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l02187">NtQueryValueKey()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">PBYTE</a>, <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html#l00022">RtlAllocateHeap</a>, <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html#l00023">RtlFreeHeap</a>, <a class="el" href="../../d3/d6/string_8c-source.html#l00148">RtlInitUnicodeString()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d7/d7/clinit_8c-source.html#l00877">CheckBadApp()</a>.
<p>
<pre class="fragment"><div>00600 {
00601 
00602 <span class="preprocessor">#define DLLPATCH_NAME       L"DllPatch"</span>
00603 <span class="preprocessor"></span>
00604     UNICODE_STRING      strKeyPath;
00605     UNICODE_STRING      strDllPatchName;
00606     OBJECT_ATTRIBUTES   objA;
00607     WCHAR               strBuffer[256];
00608     WCHAR               strDllPatch[64];
00609     WCHAR               strName[32];
00610     HANDLE              hkey;
00611     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>            <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00612     WCHAR*              lpShortName;
00613     BADAPP_DATA         badAppData;
00614     BADAPP_PROP         badAppProp;
00615     ULONG               iValue, cbSize, cbCrtSize;
00616     LPSTR               pszCmdLine = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00617     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>                bRet;
00618     
00619     PKEY_VALUE_FULL_INFORMATION pKeyValueInformation;
00620 
00621 <span class="preprocessor">#if DBG</span>
00622 <span class="preprocessor"></span>    <span class="comment">/*</span>
00623 <span class="comment">     * Assert that there is at least one path separator</span>
00624 <span class="comment">     */</span>
00625     
00626     lpShortName = (LPWSTR)lpApplicationName;
00627     
00628     <span class="keywordflow">while</span> (*lpShortName != 0) {
00629         <span class="keywordflow">if</span> (*lpShortName == OBJ_NAME_PATH_SEPARATOR) {
00630             <span class="keywordflow">break</span>;
00631         }
00632         lpShortName++;
00633     }
00634 
00635     UserAssert(*lpShortName == OBJ_NAME_PATH_SEPARATOR);
00636 <span class="preprocessor">#endif // DBG</span>
00637 <span class="preprocessor"></span>
00638     <span class="comment">/*</span>
00639 <span class="comment">     * Get the short name of the file</span>
00640 <span class="comment">     */</span>
00641     lpShortName = (WCHAR*)lpApplicationName + wcslen(lpApplicationName) - 1;
00642 
00643     
00644     <span class="keywordflow">while</span> (*lpShortName != OBJ_NAME_PATH_SEPARATOR) {
00645         lpShortName--;
00646     }
00647 
00648     <span class="comment">/*</span>
00649 <span class="comment">     * Prepare the registry key</span>
00650 <span class="comment">     */</span>
00651     wcscpy(strBuffer,
00652            L<span class="stringliteral">"\\Registry\\Machine\\System\\CurrentControlSet\\Control\\Session Manager\\AppCompatibility"</span>);
00653     
00654     wcscat(strBuffer, lpShortName);
00655     
00656     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;strKeyPath, strBuffer);
00657     
00658     InitializeObjectAttributes(&amp;objA,
00659                                &amp;strKeyPath,
00660                                OBJ_CASE_INSENSITIVE,
00661                                NULL,
00662                                NULL);
00663     
00664     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d7/ntapi_8c.html#a23">NtOpenKey</a>(&amp;hkey, GENERIC_READ, &amp;objA);
00665 
00666     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00667         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00668     }
00669     
00670     <span class="comment">/*</span>
00671 <span class="comment">     * Now verify that this is the actual version of the app</span>
00672 <span class="comment">     */</span>
00673     
00674     pKeyValueInformation = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00675     cbCrtSize = 0;
00676 
00677     badAppProp.Size     = <span class="keyword">sizeof</span>(BADAPP_PROP);
00678     badAppData.Size     = <span class="keyword">sizeof</span>(BADAPP_DATA);
00679     badAppData.FilePath = (LPCWSTR)lpApplicationName;
00680 
00681     <span class="comment">/*</span>
00682 <span class="comment">     * Presume innocent</span>
00683 <span class="comment">     */</span>
00684     bRet = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00685     
00686     <span class="keywordflow">for</span> (iValue = 0; ; iValue++) {
00687         
00688         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d7/ntapi_8c.html#a18">NtEnumerateValueKey</a>(hkey,
00689                                      iValue,
00690                                      KeyValueFullInformation,
00691                                      pKeyValueInformation,
00692                                      cbCrtSize,
00693                                      &amp;cbSize);
00694 
00695         <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> == STATUS_NO_MORE_ENTRIES) {
00696             <span class="keywordflow">break</span>;
00697         }
00698 
00699         <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> == STATUS_BUFFER_TOO_SMALL ||
00700             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> == STATUS_BUFFER_OVERFLOW) {
00701             
00702             <span class="keywordflow">if</span> (pKeyValueInformation != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00703                 <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a1">RtlFreeHeap</a>(RtlProcessHeap(), 0, pKeyValueInformation);
00704             }
00705 
00706             pKeyValueInformation = <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a0">RtlAllocateHeap</a>(RtlProcessHeap(),
00707                                                    0,
00708                                                    cbSize);
00709 
00710             <span class="keywordflow">if</span> (pKeyValueInformation == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00711                 
00712                 <span class="comment">/*</span>
00713 <span class="comment">                 * Print some memory allocation error message</span>
00714 <span class="comment">                 */</span>
00715                 TAGMSG0(DBGTAG_Shim, <span class="stringliteral">"Memory allocation error"</span>);
00716                 <span class="keywordflow">break</span>;
00717             }
00718             
00719             cbCrtSize = cbSize;
00720             
00721             <span class="comment">/*</span>
00722 <span class="comment">             * Enumerate the key again. This time it should have</span>
00723 <span class="comment">             * a big enough buffer.</span>
00724 <span class="comment">             */</span>
00725             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d7/ntapi_8c.html#a18">NtEnumerateValueKey</a>(hkey,
00726                                          iValue,
00727                                          KeyValueFullInformation,
00728                                          pKeyValueInformation,
00729                                          cbCrtSize,
00730                                          &amp;cbSize);
00731         
00732             UserAssert(!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status) || (cbCrtSize == cbSize));
00733         }
00734 
00735 
00736         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status) &amp;&amp; pKeyValueInformation-&gt;Type == REG_BINARY) {
00737             
00738             RtlCopyMemory(strName,
00739                           pKeyValueInformation-&gt;Name,
00740                           pKeyValueInformation-&gt;NameLength);
00741             
00742             strName[pKeyValueInformation-&gt;NameLength / <span class="keyword">sizeof</span>(WCHAR)] = 0;
00743             
00744             badAppData.Blob = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)pKeyValueInformation + 
00745                               pKeyValueInformation-&gt;DataOffset;
00746             
00747             badAppData.BlobSize = pKeyValueInformation-&gt;DataLength;
00748 
00749             <span class="keywordflow">if</span> (SHIsBadApp(&amp;badAppData, &amp;badAppProp)) {
00750                 
00751                 TAGMSG0(DBGTAG_Shim, <span class="stringliteral">"SHIsBadApp returned TRUE"</span>);
00752                 
00753                 bRet = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00754                 <span class="keywordflow">break</span>;
00755             } <span class="keywordflow">else</span> {
00756                 TAGMSG0(DBGTAG_Shim, <span class="stringliteral">"SHIsBadApp returned FALSE"</span>);
00757             }
00758         } <span class="keywordflow">else</span> {
00759             <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00760                 TAGMSG1(DBGTAG_Shim, <span class="stringliteral">"failed reading key. Status 0x%x"</span>,
00761                         Status);
00762             }
00763         }
00764     }
00765 
00766     <span class="keywordflow">if</span> (pKeyValueInformation != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00767         <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a1">RtlFreeHeap</a>(RtlProcessHeap(), 0, pKeyValueInformation);
00768         pKeyValueInformation = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00769     }
00770 
00771 
00772     <span class="keywordflow">if</span> (bRet) {
00773         
00774         <span class="comment">/*</span>
00775 <span class="comment">         * Read the REG_SZ for 'DllPatch-name'</span>
00776 <span class="comment">         */</span>
00777         wsprintf(strDllPatch, L<span class="stringliteral">"%ws-%ws"</span>, DLLPATCH_NAME, strName);
00778         
00779         <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;strDllPatchName, strDllPatch);
00780 
00781         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d7/ntapi_8c.html#a25">NtQueryValueKey</a>(hkey,
00782                                  &amp;strDllPatchName,
00783                                  KeyValueFullInformation,
00784                                  NULL,
00785                                  0,
00786                                  &amp;cbSize);
00787         
00788         <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> == STATUS_BUFFER_TOO_SMALL ||
00789             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> == STATUS_BUFFER_OVERFLOW) {
00790             
00791             LPWSTR pwszCmdLine;
00792             
00793             pKeyValueInformation = <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a0">RtlAllocateHeap</a>(RtlProcessHeap(),
00794                                                    0,
00795                                                    cbSize);
00796 
00797             <span class="keywordflow">if</span> (pKeyValueInformation == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00798                 
00799                 <span class="comment">/*</span>
00800 <span class="comment">                 * Print some memory allocation error message</span>
00801 <span class="comment">                 */</span>
00802                 TAGMSG0(DBGTAG_Shim, <span class="stringliteral">"Memory allocation error"</span>);
00803                 <span class="keywordflow">goto</span> Exit;
00804             }
00805             
00806             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d7/ntapi_8c.html#a25">NtQueryValueKey</a>(hkey,
00807                                      &amp;strDllPatchName,
00808                                      KeyValueFullInformation,
00809                                      pKeyValueInformation,
00810                                      cbSize,
00811                                      &amp;cbCrtSize);
00812             
00813             <span class="comment">/*</span>
00814 <span class="comment">             * Bail out if this is not of the type we expect</span>
00815 <span class="comment">             */</span>
00816             <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status) || pKeyValueInformation-&gt;Type != REG_SZ) {
00817                 TAGMSG1(DBGTAG_Shim, <span class="stringliteral">"The key '%s' is not of REG_SZ type"</span>,
00818                         strDllPatch);
00819                 <span class="keywordflow">goto</span> Exit;
00820             }
00821 
00822             pwszCmdLine = (PWCHAR)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)pKeyValueInformation +
00823                                    pKeyValueInformation-&gt;DataOffset +
00824                                    pKeyValueInformation-&gt;DataLength);
00825 
00826             <span class="comment">/*</span>
00827 <span class="comment">             * NULL terminate the string</span>
00828 <span class="comment">             */</span>
00829             *(pwszCmdLine - 1) = 0;
00830 
00831             pwszCmdLine = (LPWSTR)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)pKeyValueInformation +
00832                                    pKeyValueInformation-&gt;DataOffset);
00833             
00834             TAGMSG2(DBGTAG_Shim, <span class="stringliteral">"The app '%ws' has a patch DLL '%ws'"</span>,
00835                     lpApplicationName,
00836                     pwszCmdLine);
00837 
00838             cbSize = wcslen(pwszCmdLine);
00839 
00840             pszCmdLine = <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a0">RtlAllocateHeap</a>(RtlProcessHeap(),
00841                                          0,
00842                                          cbSize + 1);
00843             
00844             <span class="keywordflow">if</span> (pszCmdLine == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00845                 TAGMSG0(DBGTAG_Shim, <span class="stringliteral">"Memory allocation error"</span>);
00846                 <span class="keywordflow">goto</span> Exit;
00847             }
00848             
00849             WideCharToMultiByte(CP_OEMCP,
00850                                 0,
00851                                 pwszCmdLine,
00852                                 cbSize + 1,
00853                                 pszCmdLine,
00854                                 cbSize + 1,
00855                                 (LPSTR)NULL,
00856                                 (LPBOOL)NULL);
00857         }
00858     }
00859 
00860 Exit:    
00861     
00862     <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(hkey);
00863     
00864     <span class="keywordflow">return</span> pszCmdLine;
00865 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a40" doxytag="clinit.c::GetDbgTagFlags" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> GetDbgTagFlags           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>tag</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d7/clinit_8c-source.html#l01782">1782</a> of file <a class="el" href="../../d7/d7/clinit_8c-source.html">clinit.c</a>.
<p>
References <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00051">gpsi</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
<pre class="fragment"><div>01783 {
01784 <span class="preprocessor">#if DEBUGTAGS</span>
01785 <span class="preprocessor"></span>    <span class="keywordflow">return</span> (<a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ? <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;adwDBGTAGFlags[tag] : 0);
01786 <span class="preprocessor">#else</span>
01787 <span class="preprocessor"></span>    <span class="keywordflow">return</span> 0;
01788     UNREFERENCED_PARAMETER(tag);
01789 <span class="preprocessor">#endif // DEBUGTAGS</span>
01790 <span class="preprocessor"></span>}
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a39" doxytag="clinit.c::GetRipComponent" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> GetRipComponent           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d7/clinit_8c-source.html#l01780">1780</a> of file <a class="el" href="../../d7/d7/clinit_8c-source.html">clinit.c</a>.
<p>
References <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>.
<p>
<pre class="fragment"><div>01780 { <span class="keywordflow">return</span> RIP_USER; }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a42" doxytag="clinit.c::GetRipFlags" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> GetRipFlags           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d7/clinit_8c-source.html#l01793">1793</a> of file <a class="el" href="../../d7/d7/clinit_8c-source.html">clinit.c</a>.
<p>
References <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00051">gpsi</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01166">RIPF_DEFAULT</a>, and <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01265">tagSERVERINFO::wRIPFlags</a>.
<p>
<pre class="fragment"><div>01793 { <span class="keywordflow">return</span> (<a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ? <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o0">wRIPFlags</a> : <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a393">RIPF_DEFAULT</a>); }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a41" doxytag="clinit.c::GetRipPID" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> GetRipPID           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d7/clinit_8c-source.html#l01792">1792</a> of file <a class="el" href="../../d7/d7/clinit_8c-source.html">clinit.c</a>.
<p>
References <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00051">gpsi</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01267">tagSERVERINFO::wRIPPID</a>.
<p>
<pre class="fragment"><div>01792 { <span class="keywordflow">return</span> (<a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ? <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o2">wRIPPID</a> : 0); }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a36" doxytag="clinit.c::InitClientDrawing" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL InitClientDrawing           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d7/clinit_8c-source.html#l01639">1639</a> of file <a class="el" href="../../d7/d7/clinit_8c-source.html">clinit.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00105">gcxGray</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00106">gcyGray</a>, <a class="el" href="../../d4/d8/client_2wow_8c-source.html#l00366">GetSysColor()</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00104">ghbrWindowText</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00102">ghdcGray</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00103">ghFontSys</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00051">gpsi</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>01640 {
01641     <span class="keyword">static</span> CONST WORD patGray[8] = {0x55, 0xaa, 0x55, 0xaa, 0x55, 0xaa, 0x55, 0xaa};
01642     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fSuccess = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01643 
01644     HBITMAP hbmGray = CreateBitmap(8, 8, 1, 1, (LPBYTE)patGray);;
01645 
01646     fSuccess &amp;= !!hbmGray;
01647 
01648     <span class="comment">/*</span>
01649 <span class="comment">     * Create the global-objects for client drawing.</span>
01650 <span class="comment">     */</span>
01651     <a class="code" href="../../d1/d8/clglobal_8c.html#a29">ghbrWindowText</a> = CreateSolidBrush(<a class="code" href="../../d3/d9/client_2wow_8c.html#a15">GetSysColor</a>(COLOR_WINDOWTEXT));
01652     fSuccess &amp;= !!<a class="code" href="../../d1/d8/clglobal_8c.html#a29">ghbrWindowText</a>;
01653 
01654     <a class="code" href="../../d1/d8/clglobal_8c.html#a28">ghFontSys</a> = GetStockObject(SYSTEM_FONT);
01655     fSuccess &amp;= !!<a class="code" href="../../d1/d8/clglobal_8c.html#a28">ghFontSys</a>;
01656 
01657     <a class="code" href="../../d1/d8/clglobal_8c.html#a27">ghdcGray</a> = CreateCompatibleDC(NULL);
01658     fSuccess &amp;= !!<a class="code" href="../../d1/d8/clglobal_8c.html#a27">ghdcGray</a>;
01659 
01660     <span class="keywordflow">if</span> (!fSuccess) {
01661         RIPMSG0(RIP_WARNING, <span class="stringliteral">"InitClientDrawing failed to allocate resources"</span>);
01662         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01663     }
01664 
01665     <span class="comment">/*</span>
01666 <span class="comment">     * Setup the gray surface.</span>
01667 <span class="comment">     */</span>
01668     SelectObject(ghdcGray, hbmGray);
01669     SelectObject(ghdcGray, ghFontSys);
01670     SelectObject(ghdcGray, <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;hbrGray);
01671 
01672     <span class="comment">/*</span>
01673 <span class="comment">     * Setup the gray attributes.</span>
01674 <span class="comment">     */</span>
01675     SetBkMode(ghdcGray, OPAQUE);
01676     SetTextColor(ghdcGray, 0x00000000L);
01677     SetBkColor(ghdcGray, 0x00FFFFFFL);
01678 
01679     <a class="code" href="../../d1/d8/clglobal_8c.html#a30">gcxGray</a> = 8;
01680     <a class="code" href="../../d1/d8/clglobal_8c.html#a31">gcyGray</a> = 8;
01681 
01682     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01683 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a37" doxytag="clinit.c::InitializeLpkHooks" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID InitializeLpkHooks           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">CONST FARPROC *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>lpfpLpkHooks</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d7/clinit_8c-source.html#l01686">1686</a> of file <a class="el" href="../../d7/d7/clinit_8c-source.html">clinit.c</a>.
<p>
References <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l03228">FPLPKDRAWTEXTEX</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00110">fpLpkDrawTextEx</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00111">fpLpkEditControl</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l03225">FPLPKPSMTEXTOUT</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00109">fpLpkPSMTextOut</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l03222">FPLPKTABBEDTEXTOUT</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00108">fpLpkTabbedTextOut</a>, and <a class="el" href="../../d7/d7/clinit_8c-source.html#l00027">gdwLpkEntryPoints</a>.
<p>
<pre class="fragment"><div>01689 {
01690     <span class="comment">/*</span>
01691 <span class="comment">     * Called from GdiInitializeLanguagePack().  Remember what entry points</span>
01692 <span class="comment">     * are supported.  Pass the information to the kernel the first time</span>
01693 <span class="comment">     * this process connects in ClientThreadSetup().</span>
01694 <span class="comment">     */</span>
01695     <span class="keywordflow">if</span> (lpfpLpkHooks[LPK_TABBED_TEXT_OUT]) {
01696         <a class="code" href="../../d1/d8/clglobal_8c.html#a32">fpLpkTabbedTextOut</a> = (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a1110">FPLPKTABBEDTEXTOUT</a>)lpfpLpkHooks[LPK_TABBED_TEXT_OUT];
01697         <a class="code" href="../../d6/d8/clinit_8c.html#a4">gdwLpkEntryPoints</a> |= (1 &lt;&lt; LPK_TABBED_TEXT_OUT);
01698     }
01699     <span class="keywordflow">if</span> (lpfpLpkHooks[LPK_PSM_TEXT_OUT]) {
01700         <a class="code" href="../../d1/d8/clglobal_8c.html#a33">fpLpkPSMTextOut</a> = (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a1111">FPLPKPSMTEXTOUT</a>)lpfpLpkHooks[LPK_PSM_TEXT_OUT];
01701         <a class="code" href="../../d6/d8/clinit_8c.html#a4">gdwLpkEntryPoints</a> |= (1 &lt;&lt; LPK_PSM_TEXT_OUT);
01702     }
01703     <span class="keywordflow">if</span> (lpfpLpkHooks[LPK_DRAW_TEXT_EX]) {
01704         <a class="code" href="../../d1/d8/clglobal_8c.html#a34">fpLpkDrawTextEx</a> = (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a1112">FPLPKDRAWTEXTEX</a>)lpfpLpkHooks[LPK_DRAW_TEXT_EX];
01705         <a class="code" href="../../d6/d8/clinit_8c.html#a4">gdwLpkEntryPoints</a> |= (1 &lt;&lt; LPK_DRAW_TEXT_EX);
01706     }
01707     <span class="keywordflow">if</span> (lpfpLpkHooks[LPK_EDIT_CONTROL]) {
01708         <a class="code" href="../../d1/d8/clglobal_8c.html#a35">fpLpkEditControl</a> = (<a class="code" href="../../d2/d0/structtagLPKEDITCALLOUT.html">PLPKEDITCALLOUT</a>)lpfpLpkHooks[LPK_EDIT_CONTROL];
01709         <a class="code" href="../../d6/d8/clinit_8c.html#a4">gdwLpkEntryPoints</a> |= (1 &lt;&lt; LPK_EDIT_CONTROL);
01710     }
01711 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a25" doxytag="clinit.c::InitOemXlateTables" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID InitOemXlateTables           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d7/clinit_8c-source.html#l01062">1062</a> of file <a class="el" href="../../d7/d7/clinit_8c-source.html">clinit.c</a>.
<p>
References <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00025">INT</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01061">NCHARS</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01062">NCTRLS</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l04648">NtUserCallTwoParam()</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
Referenced by <a class="el" href="../../d7/d7/clinit_8c-source.html#l01219">ClientThreadSetup()</a>.
<p>
<pre class="fragment"><div>01063 {
01064     <span class="keywordtype">char</span> ach[<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a362">NCHARS</a>];
01065     WCHAR awch[<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a362">NCHARS</a>];
01066     WCHAR awchCtrl[<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a363">NCTRLS</a>];
01067     <a class="code" href="../../d9/d5/ndismain_8h.html#a263">INT</a> i;
01068     <a class="code" href="../../d9/d5/ndismain_8h.html#a263">INT</a> cch;
01069     <span class="keywordtype">char</span> OemToAnsi[<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a362">NCHARS</a>];
01070     <span class="keywordtype">char</span> AnsiToOem[<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a362">NCHARS</a>];
01071 
01072     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a362">NCHARS</a>; i++) {
01073         ach[i] = (<span class="keywordtype">char</span>)i;
01074     }
01075 
01076     <span class="comment">/*</span>
01077 <span class="comment">     * First generate pAnsiToOem table.</span>
01078 <span class="comment">     */</span>
01079 
01080     <span class="keywordflow">if</span> (GetOEMCP() == GetACP()) {
01081         <span class="comment">/*</span>
01082 <span class="comment">         * For far east code pages using MultiByteToWideChar below</span>
01083 <span class="comment">         * won't work.  Conveniently for these code pages the OEM</span>
01084 <span class="comment">         * CP equals the ANSI codepage making it trivial to compute</span>
01085 <span class="comment">         * pOemToAnsi and pAnsiToOem arrays</span>
01086 <span class="comment">         *</span>
01087 <span class="comment">         */</span>
01088 
01089         RtlCopyMemory(OemToAnsi, ach, NCHARS);
01090         RtlCopyMemory(AnsiToOem, ach, NCHARS);
01091 
01092     }
01093     <span class="keywordflow">else</span>
01094     {
01095         cch = MultiByteToWideChar(
01096             CP_ACP,                           <span class="comment">// ANSI -&gt; Unicode</span>
01097             MB_PRECOMPOSED,                   <span class="comment">// map to precomposed</span>
01098             ach, NCHARS,                      <span class="comment">// source &amp; length</span>
01099             awch, NCHARS);                    <span class="comment">// destination &amp; length</span>
01100 
01101         UserAssert(cch == NCHARS);
01102 
01103         WideCharToMultiByte(
01104             CP_OEMCP,                         <span class="comment">// Unicode -&gt; OEM</span>
01105             0,                                <span class="comment">// gives best visual match</span>
01106             awch, NCHARS,                     <span class="comment">// source &amp; length</span>
01107             AnsiToOem, NCHARS,               <span class="comment">// dest &amp; max poss. length</span>
01108             <span class="stringliteral">"_"</span>,                              <span class="comment">// default char</span>
01109             NULL);                            <span class="comment">// (don't care whether defaulted)</span>
01110         <span class="comment">/*</span>
01111 <span class="comment">         * Now generate pOemToAnsi table.</span>
01112 <span class="comment">         */</span>
01113         cch = MultiByteToWideChar(
01114             CP_OEMCP,                         <span class="comment">// OEM -&gt; Unicode</span>
01115             MB_PRECOMPOSED | MB_USEGLYPHCHARS,<span class="comment">// visual map to precomposed</span>
01116             ach, NCHARS,                      <span class="comment">// source &amp; length</span>
01117             awch, NCHARS);                    <span class="comment">// destination</span>
01118 
01119         UserAssert(cch == NCHARS);
01120 
01121         <span class="comment">/*</span>
01122 <span class="comment">         * Now patch special cases for Win3.1 compatibility</span>
01123 <span class="comment">         *</span>
01124 <span class="comment">         * 0x07 BULLET              (glyph 0x2022) must become 0x0007 BELL</span>
01125 <span class="comment">         * 0x0F WHITE STAR WITH SUN (glyph 0x263C) must become 0x00A4 CURRENCY SIGN</span>
01126 <span class="comment">         * 0x7F HOUSE               (glyph 0x2302) must become 0x007f DELETE</span>
01127 <span class="comment">         */</span>
01128         awch[0x07] = 0x0007;
01129         awch[0x0F] = 0x00a4;
01130         awch[0x7f] = 0x007f;
01131 
01132         WideCharToMultiByte(
01133             CP_ACP,                           <span class="comment">// Unicode -&gt; ANSI</span>
01134             0,                                <span class="comment">// gives best visual match</span>
01135             awch, NCHARS,                     <span class="comment">// source &amp; length</span>
01136             OemToAnsi, NCHARS,               <span class="comment">// dest &amp; max poss. length</span>
01137             <span class="stringliteral">"_"</span>,                              <span class="comment">// default char</span>
01138             NULL);                            <span class="comment">// (don't care whether defaulted)</span>
01139 
01140         <span class="comment">/*</span>
01141 <span class="comment">         * Now for all OEM chars &lt; 0x20 (control chars), test whether the glyph</span>
01142 <span class="comment">         * we have is really in CP_ACP or not.  If not, then restore the</span>
01143 <span class="comment">         * original control character. Note: 0x00 remains 0x00.</span>
01144 <span class="comment">         */</span>
01145         MultiByteToWideChar(CP_ACP, 0, OemToAnsi, NCTRLS, awchCtrl, NCTRLS);
01146 
01147         <span class="keywordflow">for</span> (i = 1; i &lt; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a363">NCTRLS</a>; i++) {
01148             <span class="keywordflow">if</span> (awchCtrl[i] != awch[i]) {
01149                 OemToAnsi[i] = (<span class="keywordtype">char</span>)i;
01150             }
01151         }
01152     }
01153     <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a180">NtUserCallTwoParam</a>((ULONG_PTR)OemToAnsi, (ULONG_PTR)AnsiToOem, SFI_INITANSIOEM);
01154 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a24" doxytag="clinit.c::LoadAppDlls" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID LoadAppDlls           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d7/clinit_8c-source.html#l00933">933</a> of file <a class="el" href="../../d7/d7/clinit_8c-source.html">clinit.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d4/d7/client_8c-source.html#l00079">gfLogonProcess</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00056">gfServerProcess</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d6/d9/obclose_8c-source.html#l00037">NtClose()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l01870">NtOpenKey()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l02187">NtQueryValueKey()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d7/clinit_8c-source.html#l00029">pwszWindowsKey</a>, <a class="el" href="../../d9/d8/imagedir_8c-source.html#l00029">RtlImageNtHeader()</a>, <a class="el" href="../../d3/d6/string_8c-source.html#l00148">RtlInitUnicodeString()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d7/d7/clinit_8c-source.html#l00030">szAppInit</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00124">UserGlobalFree</a>, and <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>.
<p>
Referenced by <a class="el" href="../../d7/d7/clinit_8c-source.html#l01219">ClientThreadSetup()</a>.
<p>
<pre class="fragment"><div>00934 {
00935     <span class="keyword">extern</span> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d3/d8/client_8c.html#a18">gfLogonProcess</a>;
00936     UNICODE_STRING UnicodeString;
00937     OBJECT_ATTRIBUTES ObjA;
00938     HKEY hKeyWindows;
00939     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00940     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cbSize;
00941     <span class="keyword">struct </span>{
00942         KEY_VALUE_PARTIAL_INFORMATION KeyInfo;
00943         WCHAR awch[24];
00944     } KeyFile;
00945     PKEY_VALUE_PARTIAL_INFORMATION  lpKeyFile = (PKEY_VALUE_PARTIAL_INFORMATION)&amp;KeyFile;
00946     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cbSizeCurrent = <span class="keyword">sizeof</span>(KeyFile);
00947     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> bAlloc = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00948 
00949     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d8/client_8c.html#a18">gfLogonProcess</a> || <a class="code" href="../../d1/d8/clglobal_8c.html#a8">gfServerProcess</a>) {
00950 
00951         <span class="comment">/*</span>
00952 <span class="comment">         * Don't let the logon process load appdlls because if the dll</span>
00953 <span class="comment">         * sets any hooks or creates any windows, the logon process</span>
00954 <span class="comment">         * will fail SetThreadDesktop().  This hack fixes that. (SAS)</span>
00955 <span class="comment">         */</span>
00956         <span class="keywordflow">return</span>;
00957     }
00958 
00959     <span class="comment">/*</span>
00960 <span class="comment">     * If the image is an NT Native image, we are running in the</span>
00961 <span class="comment">     * context of the server.</span>
00962 <span class="comment">     */</span>
00963     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d9/imagedir_8c.html#a0">RtlImageNtHeader</a>(NtCurrentPeb()-&gt;ImageBaseAddress)-&gt;
00964         OptionalHeader.Subsystem == IMAGE_SUBSYSTEM_NATIVE) {
00965         <span class="keywordflow">return</span>;
00966     }
00967 
00968     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;UnicodeString, pwszWindowsKey);
00969     InitializeObjectAttributes(&amp;ObjA,
00970             &amp;UnicodeString,
00971             OBJ_CASE_INSENSITIVE,
00972             NULL,
00973             NULL);
00974 
00975 
00976     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d7/ntapi_8c.html#a23">NtOpenKey</a>(&amp;hKeyWindows,
00977                     KEY_READ,
00978                     &amp;ObjA);
00979 
00980 
00981     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status))
00982         <span class="keywordflow">return</span>;
00983 
00984     <span class="comment">/*</span>
00985 <span class="comment">     * Read the "AppInit_Dlls" value.</span>
00986 <span class="comment">     */</span>
00987     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;UnicodeString, szAppInit);
00988 
00989     <span class="keywordflow">while</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
00990         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d7/ntapi_8c.html#a25">NtQueryValueKey</a>(hKeyWindows,
00991             &amp;UnicodeString,
00992             KeyValuePartialInformation,
00993             lpKeyFile,
00994             cbSizeCurrent,
00995             &amp;cbSize);
00996 
00997         <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> == STATUS_BUFFER_OVERFLOW) {
00998             <span class="keywordflow">if</span> (bAlloc) {
00999                 <a class="code" href="../../d6/d0/usercli_8h.html#a2">UserGlobalFree</a>(lpKeyFile);
01000             }
01001             lpKeyFile = GlobalAlloc(LPTR, cbSize);
01002             <span class="keywordflow">if</span> (!lpKeyFile) {
01003                 RIPERR0(ERROR_OUTOFMEMORY,
01004                     RIP_WARNING,
01005                     <span class="stringliteral">"LoadAppDlls failed"</span>);
01006                 <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(hKeyWindows);
01007                 <span class="keywordflow">return</span>;
01008             }
01009             bAlloc = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01010             cbSizeCurrent = cbSize;
01011             <span class="keywordflow">continue</span>;
01012         }
01013         <span class="keywordflow">break</span>;
01014     }
01015     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01016         LPWSTR pszSrc;
01017         LPWSTR pszDst;
01018         LPWSTR pszBase;
01019         WCHAR  ch;
01020 
01021     <span class="comment">/*</span>
01022 <span class="comment">     * Process the DLL data.</span>
01023 <span class="comment">     */</span>
01024         pszBase = pszDst = pszSrc = (LPWSTR)lpKeyFile-&gt;Data;
01025         <span class="keywordflow">while</span> (*pszSrc != TEXT(<span class="charliteral">'\0'</span>)) {
01026 
01027             <span class="keywordflow">while</span> (*pszSrc == TEXT(<span class="charliteral">' '</span>) || *pszSrc  == TEXT(<span class="charliteral">','</span>))
01028                 pszSrc++;
01029 
01030             <span class="keywordflow">if</span> (*pszSrc == TEXT(<span class="charliteral">'\0'</span>))
01031                 <span class="keywordflow">break</span>;
01032 
01033             <span class="keywordflow">while</span> (*pszSrc != TEXT(<span class="charliteral">','</span>)  &amp;&amp;
01034                    *pszSrc != TEXT(<span class="charliteral">'\0'</span>) &amp;&amp;
01035                    *pszSrc != TEXT(<span class="charliteral">' '</span>)) {
01036                 *pszDst++ = *pszSrc++;
01037             }
01038 
01039             ch = *pszSrc;               <span class="comment">// get it here cuz its being done in-place.</span>
01040             *pszDst++ = TEXT(<span class="charliteral">'\0'</span>);     <span class="comment">// '\0' is dll name delimiter</span>
01041 
01042             LoadLibrary(pszBase);
01043             pszBase = pszDst;
01044 
01045             pszSrc++;
01046 
01047             <span class="keywordflow">if</span> (ch == TEXT(<span class="charliteral">'\0'</span>))
01048                 <span class="keywordflow">break</span>;
01049         }
01050 
01051     }
01052 
01053 
01054     <span class="keywordflow">if</span> (bAlloc) {
01055         <a class="code" href="../../d6/d0/usercli_8h.html#a2">UserGlobalFree</a>(lpKeyFile);
01056     }
01057     <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(hKeyWindows);
01058 
01059 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a19" doxytag="clinit.c::LoadCursorsAndIcons" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL LoadCursorsAndIcons           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d7/clinit_8c-source.html#l00307">307</a> of file <a class="el" href="../../d7/d7/clinit_8c-source.html">clinit.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d5/d8/clres_8c-source.html#l02657">LoadIcoCur()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l04510">NtUserCallNoParam()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00202">SYSMET</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d7/d7/clinit_8c-source.html#l01219">ClientThreadSetup()</a>, and <a class="el" href="../../d7/d7/clinit_8c-source.html#l01729">CtxInitUser32()</a>.
<p>
<pre class="fragment"><div>00308 {
00309     <span class="keywordtype">int</span>    i;
00310     HANDLE h;
00311     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>   fSuccess = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00312 
00313     <span class="keywordflow">for</span> (i = 0; i &lt; COIC_CONFIGURABLE; i++) {
00314         <span class="comment">/*</span>
00315 <span class="comment">         * load the small version of WINLOGO which will be set into</span>
00316 <span class="comment">         * gpsi-&gt;hIconSmWindows on the kernel side.</span>
00317 <span class="comment">         */</span>
00318         <span class="keywordflow">if</span> (i == OIC_WINLOGO_DEFAULT - OIC_FIRST_DEFAULT) {
00319             h = <a class="code" href="../../d6/d0/usercli_8h.html#a655">LoadIcoCur</a>(NULL,
00320                            (LPCWSTR)UIntToPtr( (OIC_FIRST_DEFAULT + i) ),
00321                            RT_ICON,
00322                            <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXSMICON),
00323                            <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYSMICON),
00324                            LR_GLOBAL);
00325 
00326             fSuccess &amp;= !!h;
00327         }
00328         h = <a class="code" href="../../d6/d0/usercli_8h.html#a655">LoadIcoCur</a>(NULL,
00329                        (LPCWSTR)UIntToPtr( (OIC_FIRST_DEFAULT + i) ),
00330                        RT_ICON,
00331                        0,
00332                        0,
00333                        LR_SHARED | LR_GLOBAL);
00334 
00335         fSuccess &amp;= !!h;
00336     }
00337 
00338     <span class="keywordflow">for</span> (i = 0; i &lt; COCR_CONFIGURABLE; i++) {
00339         h = <a class="code" href="../../d6/d0/usercli_8h.html#a655">LoadIcoCur</a>(NULL,
00340                        (LPCWSTR)UIntToPtr( (OCR_FIRST_DEFAULT + i) ),
00341                        RT_CURSOR,
00342                        0,
00343                        0,
00344                        LR_SHARED | LR_GLOBAL);
00345 
00346         fSuccess &amp;= !!h;
00347     }
00348 
00349     <span class="keywordflow">if</span> (!fSuccess) {
00350         RIPMSG0(RIP_WARNING, <span class="stringliteral">"LoadCursorsAndIcons failed to load cursors"</span>);
00351     }
00352 
00353     <span class="comment">/*</span>
00354 <span class="comment">     * Now go to the kernel and fixup the IDs from DEFAULT values</span>
00355 <span class="comment">     * to standard values.</span>
00356 <span class="comment">     */</span>
00357     <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a173">NtUserCallNoParam</a>(SFI__LOADCURSORSANDICONS);
00358 
00359     <span class="keywordflow">return</span> fSuccess;
00360 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a20" doxytag="clinit.c::RW_RegisterControls" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL RW_RegisterControls           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d7/clinit_8c-source.html#l00378">378</a> of file <a class="el" href="../../d7/d7/clinit_8c-source.html">clinit.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d0/d0/client_2nt6_2user_8h.html#a1099">BUTNWND</a>, <a class="el" href="../../d9/d0/btnctl_8c-source.html#l01929">ButtonWndProcW()</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00478">CBEDITEXTRA</a>, <a class="el" href="../../d2/d3/combo_8c-source.html#l01359">ComboBoxWndProcW()</a>, <a class="el" href="../../d7/d0/lb1_8c-source.html#l00810">ComboListBoxWndProcW()</a>, <a class="el" href="../../d0/d0/client_2nt6_2user_8h.html#a1052">COMBOWND</a>, <a class="el" href="../../d4/d8/dlgmgr_8c-source.html#l00999">DefDlgProcW()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00290">DIALOGCLASS</a>, <a class="el" href="../../d6/d0/usercli_8h.html#a362">EDITWND</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l02808">EditWndProcW()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00793">FNID_BUTTON</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00794">FNID_COMBOBOX</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00795">FNID_COMBOLISTBOX</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00796">FNID_DIALOG</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00797">FNID_EDIT</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00802">FNID_IME</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00798">FNID_LISTBOX</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00799">FNID_MDICLIENT</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00800">FNID_STATIC</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00053">hmodUser</a>, <a class="el" href="../../d0/d0/client_2nt6_2user_8h.html#a1103">IMEWND</a>, <a class="el" href="../../d0/d9/imectl_8c-source.html#l00256">ImeWndProcW()</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d0/d0/client_2nt6_2user_8h.html#a1058">LBWND</a>, <a class="el" href="../../d7/d0/lb1_8c-source.html#l00766">ListBoxWndProcW()</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l00332">max</a>, <a class="el" href="../../d7/d4/mdiwin_8c-source.html#l02078">MDIClientWndProcW()</a>, <a class="el" href="../../d1/d0/inc_2user_8h.html#a1061">MDIWND</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d6/d0/usercli_8h.html#a636">RegisterClassExWOWW()</a>, <a class="el" href="../../d6/d4/statctl_8c-source.html#l01188">StaticWndProcW()</a>, <a class="el" href="../../d6/d0/usercli_8h.html#a373">STATWND</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>.
<p>
Referenced by <a class="el" href="../../d7/d7/clinit_8c-source.html#l01219">ClientThreadSetup()</a>, and <a class="el" href="../../d7/d7/clinit_8c-source.html#l01729">CtxInitUser32()</a>.
<p>
<pre class="fragment"><div>00379 {
00380     <span class="keywordtype">int</span>        i;
00381     WNDCLASSEX wndcls;
00382     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>       fSuccess = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00383 
00384     <span class="keyword">static</span> CONST <span class="keyword">struct </span>{
00385         <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>    style;
00386         WNDPROC lpfnWndProcW;
00387         <span class="keywordtype">int</span>     cbWndExtra;
00388         LPCTSTR lpszCursor;
00389         HBRUSH  hbrBackground;
00390         LPCTSTR lpszClassName;
00391         WORD    fnid;
00392     } rc[] = {
00393 
00394         {CS_GLOBALCLASS | CS_PARENTDC | CS_DBLCLKS | CS_HREDRAW | CS_VREDRAW,
00395          <a class="code" href="../../d8/d1/btnctl_8c.html#a34">ButtonWndProcW</a>,
00396          <span class="keyword">sizeof</span>(<a class="code" href="../../d3/d9/structtagBUTNWND.html">BUTNWND</a>) - <span class="keyword">sizeof</span>(<a class="code" href="../../d6/d9/structtagWND.html">WND</a>),
00397          IDC_ARROW,
00398          <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00399          <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"Button"</span>,
00400          <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a200">FNID_BUTTON</a>
00401         },
00402 
00403         {CS_GLOBALCLASS | CS_DBLCLKS | CS_PARENTDC | CS_VREDRAW | CS_HREDRAW,
00404          <a class="code" href="../../d1/d4/combo_8c.html#a9">ComboBoxWndProcW</a>,
00405          <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d1/structtagCOMBOWND.html">COMBOWND</a>) - <span class="keyword">sizeof</span>(<a class="code" href="../../d6/d9/structtagWND.html">WND</a>),
00406          IDC_ARROW,
00407          <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00408          <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"ComboBox"</span>,
00409          <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a201">FNID_COMBOBOX</a>
00410         },
00411 
00412         {CS_GLOBALCLASS | CS_DBLCLKS | CS_SAVEBITS,
00413          <a class="code" href="../../d6/d1/lb1_8c.html#a5">ComboListBoxWndProcW</a>,
00414          <span class="keyword">sizeof</span>(<a class="code" href="../../d9/d9/structtagLBWND.html">LBWND</a>) - <span class="keyword">sizeof</span>(<a class="code" href="../../d6/d9/structtagWND.html">WND</a>),
00415          IDC_ARROW,
00416          <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00417          <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"ComboLBox"</span>,
00418          <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a202">FNID_COMBOLISTBOX</a>
00419         },
00420 
00421         {CS_GLOBALCLASS | CS_DBLCLKS | CS_SAVEBITS,
00422          <a class="code" href="../../d3/d9/dlgmgr_8c.html#a18">DefDlgProcW</a>,
00423          DLGWINDOWEXTRA,
00424          IDC_ARROW,
00425          <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00426          <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a40">DIALOGCLASS</a>,
00427          <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a203">FNID_DIALOG</a>
00428         },
00429 
00430         {CS_GLOBALCLASS | CS_PARENTDC | CS_DBLCLKS,
00431          <a class="code" href="../../d8/d4/editec_8c.html#a43">EditWndProcW</a>,
00432          <a class="code" href="../../d8/d6/sertl_8c.html#a1">max</a>((<span class="keyword">sizeof</span>(<a class="code" href="../../d4/d4/structtagEDITWND.html">EDITWND</a>) - <span class="keyword">sizeof</span>(<a class="code" href="../../d6/d9/structtagWND.html">WND</a>)), CBEDITEXTRA),
00433          IDC_IBEAM,
00434          <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00435          <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"Edit"</span>,
00436          <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a204">FNID_EDIT</a>
00437         },
00438 
00439         {CS_GLOBALCLASS | CS_PARENTDC | CS_DBLCLKS,
00440          <a class="code" href="../../d6/d1/lb1_8c.html#a3">ListBoxWndProcW</a>,
00441          <span class="keyword">sizeof</span>(<a class="code" href="../../d9/d9/structtagLBWND.html">LBWND</a>) - <span class="keyword">sizeof</span>(<a class="code" href="../../d6/d9/structtagWND.html">WND</a>),
00442          IDC_ARROW,
00443          <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00444          <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"ListBox"</span>,
00445          <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a205">FNID_LISTBOX</a>
00446         },
00447 
00448         {CS_GLOBALCLASS,
00449          <a class="code" href="../../d6/d5/mdiwin_8c.html#a31">MDIClientWndProcW</a>,
00450          <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d1/structtagMDIWND.html">MDIWND</a>) - <span class="keyword">sizeof</span>(<a class="code" href="../../d6/d9/structtagWND.html">WND</a>),
00451          IDC_ARROW,
00452          (HBRUSH)(COLOR_APPWORKSPACE + 1),
00453          <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"MDIClient"</span>,
00454          <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a206">FNID_MDICLIENT</a>
00455         },
00456 
00457         {CS_GLOBALCLASS,
00458          <a class="code" href="../../d9/d9/imectl_8c.html#a33">ImeWndProcW</a>,
00459          <span class="keyword">sizeof</span>(<a class="code" href="../../d5/d8/structtagIMEWND.html">IMEWND</a>) - <span class="keyword">sizeof</span>(<a class="code" href="../../d6/d9/structtagWND.html">WND</a>),
00460          IDC_ARROW,
00461          <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00462          <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"IME"</span>,
00463          <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a208">FNID_IME</a>
00464         },
00465 
00466         {CS_GLOBALCLASS | CS_PARENTDC | CS_DBLCLKS,
00467          <a class="code" href="../../d5/d5/statctl_8c.html#a22">StaticWndProcW</a>,
00468          <span class="keyword">sizeof</span>(<a class="code" href="../../d3/d7/structtagSTATWND.html">STATWND</a>) - <span class="keyword">sizeof</span>(<a class="code" href="../../d6/d9/structtagWND.html">WND</a>),
00469          IDC_ARROW,
00470          <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00471          <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"Static"</span>,
00472          <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a207">FNID_STATIC</a>
00473         }
00474     };
00475 
00476 
00477     <span class="comment">/*</span>
00478 <span class="comment">     * Classes are registered via the table.</span>
00479 <span class="comment">     */</span>
00480     RtlZeroMemory(&amp;wndcls, <span class="keyword">sizeof</span>(wndcls));
00481     wndcls.cbSize       = <span class="keyword">sizeof</span>(wndcls);
00482     wndcls.hInstance    = <a class="code" href="../../d1/d8/clglobal_8c.html#a6">hmodUser</a>;
00483 
00484     <span class="keywordflow">for</span> (i = 0; i &lt; (<span class="keyword">sizeof</span>(rc)/<span class="keyword">sizeof</span>(rc[0])); i++) {
00485         wndcls.style        = rc[i].style;
00486         wndcls.lpfnWndProc  = rc[i].lpfnWndProcW;
00487         wndcls.cbWndExtra   = rc[i].cbWndExtra;
00488         wndcls.hCursor      = LoadCursor(NULL, rc[i].lpszCursor);
00489         wndcls.hbrBackground= rc[i].hbrBackground;
00490         wndcls.lpszClassName= rc[i].lpszClassName;
00491 
00492         fSuccess &amp;= !!<a class="code" href="../../d6/d0/usercli_8h.html#a636">RegisterClassExWOWW</a>(&amp;wndcls, NULL, rc[i].fnid);
00493     }
00494 
00495     <span class="keywordflow">if</span> (!fSuccess) {
00496         RIPMSG0(RIP_WARNING, <span class="stringliteral">"RW_RegisterControls failed to register classes"</span>);
00497     }
00498 
00499     <span class="keywordflow">return</span> fSuccess;
00500 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a21" doxytag="clinit.c::RW_RegisterDDEML" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL RW_RegisterDDEML           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d7/clinit_8c-source.html#l00511">511</a> of file <a class="el" href="../../d7/d7/clinit_8c-source.html">clinit.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d4/d3/ddemlwp_8c-source.html#l00376">DDEMLClientWndProc()</a>, <a class="el" href="../../d4/d3/ddemlwp_8c-source.html#l00027">DDEMLMotherWndProc()</a>, <a class="el" href="../../d4/d3/ddemlwp_8c-source.html#l00496">DDEMLServerWndProc()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00835">FNID_DDE_BIT</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00053">hmodUser</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d0/d4/ddemlcli_8h.html#a75">PSVR_CONV_INFO</a>, <a class="el" href="../../d6/d0/usercli_8h.html#a635">RegisterClassExWOWA()</a>, <a class="el" href="../../d6/d0/usercli_8h.html#a636">RegisterClassExWOWW()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>00512 {
00513     WNDCLASSEXA wndclsa;
00514     WNDCLASSEXW wndclsw;
00515     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>        fSuccess = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00516 
00517     RtlZeroMemory(&amp;wndclsw, <span class="keyword">sizeof</span>(wndclsw));
00518     wndclsw.cbSize        = <span class="keyword">sizeof</span>(wndclsw);
00519     wndclsw.lpfnWndProc   = <a class="code" href="../../d0/d4/ddemlcli_8h.html#a133">DDEMLMotherWndProc</a>;
00520     wndclsw.cbWndExtra    = <span class="keyword">sizeof</span>(<a class="code" href="../../d2/d0/structtagCL__INSTANCE__INFO.html">PCL_INSTANCE_INFO</a>);
00521     wndclsw.hInstance     = <a class="code" href="../../d1/d8/clglobal_8c.html#a6">hmodUser</a>;
00522     wndclsw.lpszClassName = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"DDEMLMom"</span>;
00523 
00524     fSuccess &amp;= !!<a class="code" href="../../d6/d0/usercli_8h.html#a636">RegisterClassExWOWW</a>(&amp;wndclsw, NULL, FNID_DDE_BIT);
00525 
00526     RtlZeroMemory(&amp;wndclsa, <span class="keyword">sizeof</span>(wndclsa));
00527     wndclsa.cbSize        = <span class="keyword">sizeof</span>(wndclsa);
00528     wndclsa.lpfnWndProc   = <a class="code" href="../../d0/d4/ddemlcli_8h.html#a134">DDEMLClientWndProc</a>;
00529     wndclsa.cbWndExtra    =
00530             <span class="keyword">sizeof</span>(<a class="code" href="../../d1/d0/structtagCL__CONV__INFO.html">PCL_CONV_INFO</a>) +     <span class="comment">// GWL_PCI</span>
00531             <span class="keyword">sizeof</span>(CONVCONTEXT)   +     <span class="comment">// GWL_CONVCONTEXT</span>
00532             <span class="keyword">sizeof</span>(LONG)          +     <span class="comment">// GWL_CONVSTATE</span>
00533             <span class="keyword">sizeof</span>(HANDLE)        +     <span class="comment">// GWL_CHINST</span>
00534             <span class="keyword">sizeof</span>(HANDLE);             <span class="comment">// GWL_SHINST</span>
00535     wndclsa.hInstance     = <a class="code" href="../../d1/d8/clglobal_8c.html#a6">hmodUser</a>;
00536     wndclsa.lpszClassName = <span class="stringliteral">"DDEMLAnsiClient"</span>;
00537 
00538     fSuccess &amp;= !!<a class="code" href="../../d6/d0/usercli_8h.html#a635">RegisterClassExWOWA</a>(&amp;wndclsa, NULL, FNID_DDE_BIT);
00539 
00540     wndclsw.cbSize        = <span class="keyword">sizeof</span>(wndclsw);
00541     wndclsw.lpfnWndProc   = <a class="code" href="../../d0/d4/ddemlcli_8h.html#a134">DDEMLClientWndProc</a>;
00542     wndclsw.cbWndExtra    =
00543             <span class="keyword">sizeof</span>(<a class="code" href="../../d1/d0/structtagCL__CONV__INFO.html">PCL_CONV_INFO</a>) +     <span class="comment">// GWL_PCI</span>
00544             <span class="keyword">sizeof</span>(CONVCONTEXT)   +     <span class="comment">// GWL_CONVCONTEXT</span>
00545             <span class="keyword">sizeof</span>(LONG)          +     <span class="comment">// GWL_CONVSTATE</span>
00546             <span class="keyword">sizeof</span>(HANDLE)        +     <span class="comment">// GWL_CHINST</span>
00547             <span class="keyword">sizeof</span>(HANDLE);             <span class="comment">// GWL_SHINST</span>
00548     wndclsw.hInstance     = <a class="code" href="../../d1/d8/clglobal_8c.html#a6">hmodUser</a>;
00549     wndclsw.lpszClassName = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"DDEMLUnicodeClient"</span>;
00550 
00551     fSuccess &amp;= !!<a class="code" href="../../d6/d0/usercli_8h.html#a636">RegisterClassExWOWW</a>(&amp;wndclsw, NULL, FNID_DDE_BIT);
00552 
00553     wndclsa.cbSize        = <span class="keyword">sizeof</span>(wndclsa);
00554     wndclsa.lpfnWndProc   = <a class="code" href="../../d0/d4/ddemlcli_8h.html#a135">DDEMLServerWndProc</a>;
00555     wndclsa.cbWndExtra    = <span class="keyword">sizeof</span>(<a class="code" href="../../d5/d7/structtagSVR__CONV__INFO.html">PSVR_CONV_INFO</a>);     <span class="comment">// GWL_PSI</span>
00556     wndclsa.hInstance     = <a class="code" href="../../d1/d8/clglobal_8c.html#a6">hmodUser</a>;
00557     wndclsa.lpszClassName = <span class="stringliteral">"DDEMLAnsiServer"</span>;
00558 
00559     fSuccess &amp;= !!<a class="code" href="../../d6/d0/usercli_8h.html#a635">RegisterClassExWOWA</a>(&amp;wndclsa, NULL, FNID_DDE_BIT);
00560 
00561     wndclsw.cbSize        = <span class="keyword">sizeof</span>(wndclsw);
00562     wndclsw.lpfnWndProc   = <a class="code" href="../../d0/d4/ddemlcli_8h.html#a135">DDEMLServerWndProc</a>;
00563     wndclsw.cbWndExtra    = <span class="keyword">sizeof</span>(<a class="code" href="../../d5/d7/structtagSVR__CONV__INFO.html">PSVR_CONV_INFO</a>);     <span class="comment">// GWL_PSI</span>
00564     wndclsw.hInstance     = <a class="code" href="../../d1/d8/clglobal_8c.html#a6">hmodUser</a>;
00565     wndclsw.lpszClassName = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"DDEMLUnicodeServer"</span>;
00566 
00567     fSuccess &amp;= !!<a class="code" href="../../d6/d0/usercli_8h.html#a636">RegisterClassExWOWW</a>(&amp;wndclsw, NULL, FNID_DDE_BIT);
00568 
00569     <span class="keywordflow">if</span> (!fSuccess) {
00570         RIPMSG0(RIP_WARNING, <span class="stringliteral">"RW_RegisterDDEML failed to register classes"</span>);
00571     }
00572 
00573     <span class="keywordflow">return</span> fSuccess;
00574 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a44" doxytag="clinit.c::SetDbgTag" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SetDbgTag           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>tag</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwBitFlags</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d7/clinit_8c-source.html#l01800">1800</a> of file <a class="el" href="../../d7/d7/clinit_8c-source.html">clinit.c</a>.
<p>
References <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l04500">NtUserSetDbgTag()</a>, and <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>.
<p>
<pre class="fragment"><div>01801 {
01802     <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a172">NtUserSetDbgTag</a>(tag, dwBitFlags);
01803 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a43" doxytag="clinit.c::SetRipFlags" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SetRipFlags           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwRipFlags</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwRipPID</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d7/clinit_8c-source.html#l01795">1795</a> of file <a class="el" href="../../d7/d7/clinit_8c-source.html">clinit.c</a>.
<p>
References <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l04490">NtUserSetRipFlags()</a>, and <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>.
<p>
<pre class="fragment"><div>01796 {
01797     <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a171">NtUserSetRipFlags</a>(dwRipFlags, dwRipPID);
01798 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a18" doxytag="clinit.c::UserClientDllInitialize" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL UserClientDllInitialize           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>hmod</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Reason</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCONTEXT pctx&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d7/clinit_8c-source.html#l00059">59</a> of file <a class="el" href="../../d7/d7/clinit_8c-source.html">clinit.c</a>.
<p>
References <a class="el" href="../../d7/d7/clinit_8c-source.html#l00056">apfnDispatch</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l02540">fpImmRegisterClient</a>, <a class="el" href="../../d7/d7/clinit_8c-source.html#l00026">gbIhaveBeenInited</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00092">gcsAccelCache</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00091">gcsClipboard</a>, <a class="el" href="../../d0/d3/ddemlcli_8c-source.html#l00018">gcsDDEML</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00090">gcsHdc</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00089">gcsLookaside</a>, <a class="el" href="../../d6/d8/clinit_8c.html#a17">GdiDllInitialize()</a>, <a class="el" href="../../d3/d0/fareast_8c-source.html#l00213">GetImmFileName()</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00056">gfServerProcess</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00054">gHighestUserAddress</a>, <a class="el" href="../../d3/d0/fareast_8c-source.html#l00207">ghImm32</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00161">ghinstOLE</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00181">ghinstWinStaDll</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00051">gpsi</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00052">gSharedInfo</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00053">hmodUser</a>, <a class="el" href="../../d3/d0/fareast_8c-source.html#l00338">InitializeImmEntryTable()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00591">IS_IME_ENABLED</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l03600">ISTS</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d4/d8/arcinst_8c-source.html#l00065">MAX_PATH</a>, <a class="el" href="../../d9/d8/dllinit_8c-source.html#l00056">MAX_SESSION_PATH</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d7/d7/sysinfo_8c-source.html#l00941">NtQuerySystemInformation()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00118">pfnFindResourceExA</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00119">pfnFindResourceExW</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00120">pfnLoadResource</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00124">pfnSizeofResource</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01277">tagSHAREDINFO::psi</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00061">pUserHeap</a>, <a class="el" href="../../d2/d8/rtl_2heap_8c-source.html#l00191">RtlCreateHeap()</a>, <a class="el" href="../../d8/d7/dll_2resource_8c-source.html#l01474">RtlDeleteCriticalSection()</a>, <a class="el" href="../../d2/d8/rtl_2heap_8c-source.html#l01133">RtlDestroyHeap()</a>, <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l01432">RtlGetNtGlobalFlags()</a>, <a class="el" href="../../d8/d7/dll_2resource_8c-source.html#l01210">RtlInitializeCriticalSection()</a>, <a class="el" href="../../d3/d6/string_8c-source.html#l00148">RtlInitUnicodeString()</a>, <a class="el" href="../../d9/d8/dllinit_8c-source.html#l00057">SESSION_ROOT</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01365">_USERCONNECT::siClient</a>, <a class="el" href="../../d4/d7/client_8c-source.html#l00081">strRootDirectory</a>, <a class="el" href="../../d7/d7/clinit_8c-source.html#l00041">szWindowStationDirectory</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01362">_USERCONNECT::ulVersion</a>, <a class="el" href="../../d0/d0/client_2nt6_2user_8h.html#a1005">USERCONNECT</a>, <a class="el" href="../../d1/d9/csrhlpr_8h-source.html#l00055">UserConnectToServer()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01305">USERCURRENTVERSION</a>, <a class="el" href="../../d4/d7/client_8c-source.html#l01434">WaitForInputIdle()</a>, and <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00369">WINSTA_DIR</a>.
<p>
<pre class="fragment"><div>00063 {
00064     SYSTEM_BASIC_INFORMATION SystemInformation;
00065     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> bRet = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00066 
00067     DBG_UNREFERENCED_PARAMETER(pctx);
00068 
00069 <span class="preprocessor">#if DBG</span>
00070 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (<a class="code" href="../../d4/d7/rtl_2regutil_8c.html#a25">RtlGetNtGlobalFlags</a>() &amp; FLG_SHOW_LDR_SNAPS) {
00071         RIPMSG1(RIP_WARNING,
00072                 <span class="stringliteral">"UserClientDllInitialize: entered for reason %x"</span>,
00073                 Reason);
00074     }
00075 <span class="preprocessor">#endif</span>
00076 <span class="preprocessor"></span>
00077     <span class="keywordflow">if</span> (Reason == DLL_PROCESS_ATTACH) {
00078 
00079         <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>    status;
00080         <a class="code" href="../../d6/d4/struct__USERCONNECT.html">USERCONNECT</a> userconnect;
00081         ULONG       ulConnect = <span class="keyword">sizeof</span>(<a class="code" href="../../d6/d4/struct__USERCONNECT.html">USERCONNECT</a>);
00082         ULONG       SessionId = NtCurrentPeb()-&gt;SessionId;
00083         WCHAR       szSessionDir[<a class="code" href="../../d8/d9/dllinit_8c.html#a1">MAX_SESSION_PATH</a>];
00084 
00085         DisableThreadLibraryCalls(hmod);
00086 
00087         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d8/clinit_8c.html#a3">gbIhaveBeenInited</a>) {
00088             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00089         }
00090 
00091         <a class="code" href="../../d6/d8/clinit_8c.html#a3">gbIhaveBeenInited</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00092 
00093         status  = <a class="code" href="../../d7/d8/dll_2resource_8c.html#a24">RtlInitializeCriticalSection</a>(&amp;gcsClipboard);
00094         status |= <a class="code" href="../../d7/d8/dll_2resource_8c.html#a24">RtlInitializeCriticalSection</a>(&amp;gcsLookaside);
00095         status |= <a class="code" href="../../d7/d8/dll_2resource_8c.html#a24">RtlInitializeCriticalSection</a>(&amp;gcsHdc);
00096         status |= <a class="code" href="../../d7/d8/dll_2resource_8c.html#a24">RtlInitializeCriticalSection</a>(&amp;gcsAccelCache);
00097         status |= <a class="code" href="../../d7/d8/dll_2resource_8c.html#a24">RtlInitializeCriticalSection</a>(&amp;gcsDDEML);
00098 
00099 <span class="preprocessor">#ifdef WX86</span>
00100 <span class="preprocessor"></span>        status |= <a class="code" href="../../d7/d8/dll_2resource_8c.html#a24">RtlInitializeCriticalSection</a>(&amp;gcsWx86Load);
00101 <span class="preprocessor">#endif</span>
00102 <span class="preprocessor"></span>
00103         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
00104             RIPMSG1(RIP_WARNING,
00105                     <span class="stringliteral">"UserClientDllInitialize: Failed to create critical sections. Status %x"</span>,
00106                     status);
00107             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00108         }
00109 <span class="preprocessor">#if DBG</span>
00110 <span class="preprocessor"></span>        gpDDEMLHeap = <a class="code" href="../../d1/d9/rtl_2heap_8c.html#a15">RtlCreateHeap</a>(HEAP_GROWABLE | HEAP_CLASS_1
00111                               | HEAP_TAIL_CHECKING_ENABLED | HEAP_FREE_CHECKING_ENABLED
00112                               , NULL, 8 * 1024, 2 * 1024, NULL, NULL);
00113 
00114         <span class="keywordflow">if</span> (gpDDEMLHeap == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00115             gpDDEMLHeap = RtlProcessHeap();
00116         }
00117 <span class="preprocessor">#endif</span>
00118 <span class="preprocessor"></span>
00119         status = <a class="code" href="../../d6/d8/sysinfo_8c.html#a49">NtQuerySystemInformation</a>(SystemBasicInformation,
00120                                           &amp;SystemInformation,
00121                                           <span class="keyword">sizeof</span>(SystemInformation),
00122                                           NULL);
00123         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
00124             RIPMSG1(RIP_WARNING,
00125                     <span class="stringliteral">"UserClientDllInitialize: NtQuerySystemInformation failed with Status %x"</span>,
00126                     status);
00127             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00128         }
00129         <a class="code" href="../../d1/d8/clglobal_8c.html#a7">gHighestUserAddress</a> = SystemInformation.MaximumUserModeAddress;
00130 
00131         userconnect.<a class="code" href="../../d6/d4/struct__USERCONNECT.html#o0">ulVersion</a> = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a409">USERCURRENTVERSION</a>;
00132 
00133         <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/inc_2user_8h.html#a882">ISTS</a>()) {
00134 
00135             <span class="keywordflow">if</span> (SessionId == 0) {
00136                 wcscpy(szSessionDir, WINSS_OBJECT_DIRECTORY_NAME);
00137             } <span class="keywordflow">else</span> {
00138                 swprintf(szSessionDir, L<span class="stringliteral">"%ws\\%ld%ws"</span>,
00139                          SESSION_ROOT,
00140                          SessionId,
00141                          WINSS_OBJECT_DIRECTORY_NAME);
00142             }
00143 
00144             status = <a class="code" href="../../d0/d0/csrhlpr_8h.html#a5">UserConnectToServer</a>(szSessionDir,
00145                                          &amp;userconnect,
00146                                          &amp;ulConnect,
00147                                          (PBOOLEAN)&amp;gfServerProcess);
00148 
00149         } <span class="keywordflow">else</span> {
00150 
00151             status = <a class="code" href="../../d0/d0/csrhlpr_8h.html#a5">UserConnectToServer</a>(WINSS_OBJECT_DIRECTORY_NAME,
00152                                          &amp;userconnect,
00153                                          &amp;ulConnect,
00154                                          (PBOOLEAN)&amp;gfServerProcess);
00155         }
00156 
00157         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
00158             RIPMSG1(RIP_WARNING,
00159                     <span class="stringliteral">"UserClientDllInitialize: UserConnectToServer failed with status %x"</span>,
00160                     status);
00161             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00162         }
00163 
00164 
00165         <span class="comment">/*</span>
00166 <span class="comment">         * If this is the server process, the shared info is not</span>
00167 <span class="comment">         * yet valid, so don't copy out the returned info.</span>
00168 <span class="comment">         */</span>
00169         <span class="keywordflow">if</span> (!<a class="code" href="../../d1/d8/clglobal_8c.html#a8">gfServerProcess</a>) {
00170             HINSTANCE hImm32 = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00171 
00172             <a class="code" href="../../d1/d8/clglobal_8c.html#a5">gSharedInfo</a> = userconnect.<a class="code" href="../../d6/d4/struct__USERCONNECT.html#o3">siClient</a>;
00173             <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a> = <a class="code" href="../../d1/d8/clglobal_8c.html#a5">gSharedInfo</a>.<a class="code" href="../../d4/d6/structtagSHAREDINFO.html#o0">psi</a>;
00174 
00175             <span class="comment">// make sure the stub (dummy) routine works</span>
00176             UserAssert(<span class="keyword">sizeof</span>(LRESULT) == <span class="keyword">sizeof</span>(ULONG_PTR));
00177             UserAssert(<span class="keyword">sizeof</span>(PVOID) == <span class="keyword">sizeof</span>(ULONG_PTR));
00178             <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a126">IS_IME_ENABLED</a>()) {
00179                 WCHAR wszImmFile[<a class="code" href="../../d3/d9/arcinst_8c.html#a6">MAX_PATH</a>];
00180 
00181                 <a class="code" href="../../d6/d0/usercli_8h.html#a786">InitializeImmEntryTable</a>();
00182                 <a class="code" href="../../d6/d0/usercli_8h.html#a787">GetImmFileName</a>(wszImmFile);
00183                 hImm32 = GetModuleHandleW(wszImmFile);
00184             }
00185             <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d0/usercli_8h.html#a315">fpImmRegisterClient</a>(&amp;userconnect.<a class="code" href="../../d6/d4/struct__USERCONNECT.html#o3">siClient</a>, hImm32)) {
00186                 RIPMSG0(RIP_WARNING,
00187                         <span class="stringliteral">"UserClientDllInitialize: ImmRegisterClient failed"</span>);
00188                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00189             }
00190         }
00191 
00192         <a class="code" href="../../d1/d8/clglobal_8c.html#a36">pfnFindResourceExA</a> = (PFNFINDA)FindResourceExA;
00193         <a class="code" href="../../d1/d8/clglobal_8c.html#a37">pfnFindResourceExW</a> = (PFNFINDW)FindResourceExW;
00194         <a class="code" href="../../d1/d8/clglobal_8c.html#a38">pfnLoadResource</a>    = (PFNLOAD)LoadResource;
00195         <a class="code" href="../../d1/d8/clglobal_8c.html#a42">pfnSizeofResource</a>  = (PFNSIZEOF)SizeofResource;
00196 
00197         <span class="comment">/*</span>
00198 <span class="comment">         * Register with the base the USER hook it should call when it</span>
00199 <span class="comment">         * does a WinExec() (this is soft-linked because some people still</span>
00200 <span class="comment">         * use charmode nt!</span>
00201 <span class="comment">         */</span>
00202         RegisterWaitForInputIdle(WaitForInputIdle);
00203 
00204 
00205         <span class="comment">/*</span>
00206 <span class="comment">         * Remember USER.DLL's hmodule so we can grab resources from it later.</span>
00207 <span class="comment">         */</span>
00208         <a class="code" href="../../d1/d8/clglobal_8c.html#a6">hmodUser</a> = hmod;
00209 
00210         <a class="code" href="../../d1/d8/clglobal_8c.html#a11">pUserHeap</a> = RtlProcessHeap();
00211 
00212         <span class="comment">/*</span>
00213 <span class="comment">         * Initialize callback table</span>
00214 <span class="comment">         */</span>
00215         NtCurrentPeb()-&gt;KernelCallbackTable = <a class="code" href="../../d6/d8/clinit_8c.html#a10">apfnDispatch</a>;
00216         NtCurrentPeb()-&gt;PostProcessInitRoutine = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00217 
00218         <span class="keywordflow">if</span> (SessionId != 0) {
00219             swprintf(szWindowStationDirectory,L<span class="stringliteral">"%ws\\%ld%ws"</span>,SESSION_ROOT,SessionId,WINSTA_DIR);
00220             <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;strRootDirectory, szWindowStationDirectory);
00221 
00222         } <span class="keywordflow">else</span> {
00223             <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;strRootDirectory, WINSTA_DIR);
00224         }
00225 
00226 <span class="preprocessor">#ifdef _JANUS_</span>
00227 <span class="preprocessor"></span>        gfEMIEnable = InitInstrument(&amp;gdwEMIControl);
00228         <span class="keywordflow">if</span> (<a class="code" href="../../d1/d8/clglobal_8c.html#a8">gfServerProcess</a>) {
00229             gfEMIEnable = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00230         }
00231 <span class="preprocessor">#endif</span>
00232 <span class="preprocessor"></span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Reason == DLL_PROCESS_DETACH) {
00233 
00234         <span class="keywordflow">if</span> (<a class="code" href="../../d2/d1/fareast_8c.html#a6">ghImm32</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00235             <span class="comment">// IMM32.DLL is loaded by USER32, so free it.</span>
00236             FreeLibrary(ghImm32);
00237         }
00238 
00239         <span class="comment">/*</span>
00240 <span class="comment">         * If we loaded OLE, tell it we're done.</span>
00241 <span class="comment">         */</span>
00242         <span class="keywordflow">if</span> (<a class="code" href="../../d1/d8/clglobal_8c.html#a61">ghinstOLE</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00243             <span class="comment">/*</span>
00244 <span class="comment">             * Later5.0 GerardoB. This causes check OLE32.DLL to fault</span>
00245 <span class="comment">             *  because they get their DLL_PROCESS_DETACH first</span>
00246 <span class="comment">             * (*(OLEUNINITIALIZEPROC)gpfnOLEOleUninitialize)();</span>
00247 <span class="comment">             */</span>
00248             RIPMSG0(RIP_WARNING, <span class="stringliteral">"OLE would fault if I call OleUninitialize now"</span>);
00249             FreeLibrary(ghinstOLE);
00250         }
00251 
00252         <span class="comment">/*</span>
00253 <span class="comment">         * If we loaded WinSta.Dll for Terminal Services, then</span>
00254 <span class="comment">         * unload it now.</span>
00255 <span class="comment">         */</span>
00256         <span class="keywordflow">if</span> (<a class="code" href="../../d1/d8/clglobal_8c.html#a69">ghinstWinStaDll</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00257             FreeLibrary(ghinstWinStaDll);
00258         }
00259 
00260 <span class="preprocessor">#ifdef _JANUS_</span>
00261 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (gfEMIEnable &amp;&amp; (ghAdvApi != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)) {
00262             FreeLibrary(ghAdvApi);
00263         }
00264 <span class="preprocessor">#endif</span>
00265 <span class="preprocessor"></span>
00266         <a class="code" href="../../d7/d8/dll_2resource_8c.html#a29">RtlDeleteCriticalSection</a>(&amp;gcsClipboard);
00267         <a class="code" href="../../d7/d8/dll_2resource_8c.html#a29">RtlDeleteCriticalSection</a>(&amp;gcsLookaside);
00268         <a class="code" href="../../d7/d8/dll_2resource_8c.html#a29">RtlDeleteCriticalSection</a>(&amp;gcsHdc);
00269         <a class="code" href="../../d7/d8/dll_2resource_8c.html#a29">RtlDeleteCriticalSection</a>(&amp;gcsAccelCache);
00270         <a class="code" href="../../d7/d8/dll_2resource_8c.html#a29">RtlDeleteCriticalSection</a>(&amp;gcsDDEML);
00271 <span class="preprocessor">#if DBG</span>
00272 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (gpDDEMLHeap != RtlProcessHeap()) {
00273             <a class="code" href="../../d1/d9/rtl_2heap_8c.html#a16">RtlDestroyHeap</a>(gpDDEMLHeap);
00274         }
00275 <span class="preprocessor">#endif</span>
00276 <span class="preprocessor"></span>
00277 
00278 <span class="preprocessor">#ifdef WX86</span>
00279 <span class="preprocessor"></span>        <a class="code" href="../../d7/d8/dll_2resource_8c.html#a29">RtlDeleteCriticalSection</a>(&amp;gcsWx86Load);
00280 <span class="preprocessor">#endif</span>
00281 <span class="preprocessor"></span>
00282     }
00283 
00284     bRet = <a class="code" href="../../d6/d8/clinit_8c.html#a17">GdiDllInitialize</a>(hmod, Reason, pctx);
00285     <span class="keywordflow">if</span> (!bRet) {
00286         RIPMSG0(RIP_WARNING,
00287                 <span class="stringliteral">"UserClientDllInitialize: GdiDllInitialize failed"</span>);
00288     }
00289 
00290     <span class="keywordflow">return</span>(bRet);
00291 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a33" doxytag="clinit.c::UserRtlAllocMem" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PVOID UserRtlAllocMem           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">ULONG&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>uBytes</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d7/clinit_8c-source.html#l01614">1614</a> of file <a class="el" href="../../d7/d7/clinit_8c-source.html">clinit.c</a>.
<p>
<pre class="fragment"><div>01616 {
01617     <span class="keywordflow">return</span> <a class="code" href="../../d6/d0/usercli_8h.html#a136">UserLocalAlloc</a>(HEAP_ZERO_MEMORY, uBytes);
01618 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a34" doxytag="clinit.c::UserRtlFreeMem" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID UserRtlFreeMem           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PVOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pMem</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d7/clinit_8c-source.html#l01620">1620</a> of file <a class="el" href="../../d7/d7/clinit_8c-source.html">clinit.c</a>.
<p>
<pre class="fragment"><div>01622 {
01623     <a class="code" href="../../d6/d0/usercli_8h.html#a138">UserLocalFree</a>(pMem);
01624 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a35" doxytag="clinit.c::UserRtlRaiseStatus" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID UserRtlRaiseStatus           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">NTSTATUS&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Status</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d7/clinit_8c-source.html#l01626">1626</a> of file <a class="el" href="../../d7/d7/clinit_8c-source.html">clinit.c</a>.
<p>
References <a class="el" href="../../d0/d9/ppc_2exdsptch_8c-source.html#l00563">RtlRaiseStatus()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>.
<p>
<pre class="fragment"><div>01628 {
01629     <a class="code" href="../../d9/d9/ppc_2exdsptch_8c.html#a10">RtlRaiseStatus</a>(Status);
01630 }
</div></pre>    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="a10" doxytag="clinit.c::apfnDispatch" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> CONST PCSR_CALLBACK_ROUTINE <a class="el" href="../../d6/d8/clinit_8c.html#a10">apfnDispatch</a>[]          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d7/clinit_8c-source.html#l00056">56</a> of file <a class="el" href="../../d7/d7/clinit_8c-source.html">clinit.c</a>.
<p>
Referenced by <a class="el" href="../../d7/d7/clinit_8c-source.html#l00059">UserClientDllInitialize()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="clinit.c::gbIhaveBeenInited" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL <a class="el" href="../../d6/d8/clinit_8c.html#a3">gbIhaveBeenInited</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d7/clinit_8c-source.html#l00026">26</a> of file <a class="el" href="../../d7/d7/clinit_8c-source.html">clinit.c</a>.
<p>
Referenced by <a class="el" href="../../d7/d7/clinit_8c-source.html#l00059">UserClientDllInitialize()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="clinit.c::gdwLpkEntryPoints" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="el" href="../../d6/d8/clinit_8c.html#a4">gdwLpkEntryPoints</a><code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d7/clinit_8c-source.html#l00027">27</a> of file <a class="el" href="../../d7/d7/clinit_8c-source.html">clinit.c</a>.
<p>
Referenced by <a class="el" href="../../d7/d7/clinit_8c-source.html#l01219">ClientThreadSetup()</a>, and <a class="el" href="../../d7/d7/clinit_8c-source.html#l01686">InitializeLpkHooks()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="clinit.c::gfFirstThread" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL <a class="el" href="../../d6/d8/clinit_8c.html#a1">gfFirstThread</a> = TRUE          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d7/clinit_8c-source.html#l00024">24</a> of file <a class="el" href="../../d7/d7/clinit_8c-source.html">clinit.c</a>.
<p>
Referenced by <a class="el" href="../../d7/d7/clinit_8c-source.html#l01219">ClientThreadSetup()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="clinit.c::gszLoadPathDll" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> CONST <a class="el" href="../../d2/d1/bench_8h.html#a8">CHAR</a> <a class="el" href="../../d6/d8/clinit_8c.html#a8">gszLoadPathDll</a>[] = "LoadPatchDll"          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d7/clinit_8c-source.html#l00033">33</a> of file <a class="el" href="../../d7/d7/clinit_8c-source.html">clinit.c</a>.
<p>
Referenced by <a class="el" href="../../d7/d7/clinit_8c-source.html#l00877">CheckBadApp()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="clinit.c::gwszShimDll" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> CONST WCHAR <a class="el" href="../../d6/d8/clinit_8c.html#a7">gwszShimDll</a>[] = L"shim.dll"          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d7/clinit_8c-source.html#l00032">32</a> of file <a class="el" href="../../d7/d7/clinit_8c-source.html">clinit.c</a>.
<p>
Referenced by <a class="el" href="../../d7/d7/clinit_8c-source.html#l00877">CheckBadApp()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="clinit.c::pdiLocal" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d1/d3/structtagDESKTOPINFO.html">PDESKTOPINFO</a> <a class="el" href="../../d6/d8/clinit_8c.html#a2">pdiLocal</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d7/clinit_8c-source.html#l00025">25</a> of file <a class="el" href="../../d7/d7/clinit_8c-source.html">clinit.c</a>.
<p>
Referenced by <a class="el" href="../../d7/d7/clinit_8c-source.html#l01219">ClientThreadSetup()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="clinit.c::pfnClientA" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> const <a class="el" href="../../d0/d5/struct__PFNCLIENT.html">PFNCLIENT</a> <a class="el" href="../../d6/d8/clinit_8c.html#a13">pfnClientA</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Initial value:</b><pre class="fragment"><div> {
        (KPROC)<a class="code" href="../../d0/d9/clmsg_8c.html#a17">ScrollBarWndProcA</a>,
        (KPROC)DefWindowProcA,
        (KPROC)<a class="code" href="../../d0/d9/clmsg_8c.html#a14">MenuWndProcA</a>,
        (KPROC)<a class="code" href="../../d0/d9/clmsg_8c.html#a11">DesktopWndProcA</a>,
        (KPROC)DefWindowProcA,
        (KPROC)<a class="code" href="../../d8/d1/btnctl_8c.html#a33">ButtonWndProcA</a>,
        (KPROC)<a class="code" href="../../d1/d4/combo_8c.html#a8">ComboBoxWndProcA</a>,
        (KPROC)<a class="code" href="../../d6/d1/lb1_8c.html#a4">ComboListBoxWndProcA</a>,
        (KPROC)<a class="code" href="../../d3/d9/dlgmgr_8c.html#a19">DefDlgProcA</a>,
        (KPROC)<a class="code" href="../../d8/d4/editec_8c.html#a42">EditWndProcA</a>,
        (KPROC)<a class="code" href="../../d6/d1/lb1_8c.html#a2">ListBoxWndProcA</a>,
        (KPROC)<a class="code" href="../../d6/d5/mdiwin_8c.html#a30">MDIClientWndProcA</a>,
        (KPROC)<a class="code" href="../../d5/d5/statctl_8c.html#a21">StaticWndProcA</a>,
        (KPROC)<a class="code" href="../../d9/d9/imectl_8c.html#a32">ImeWndProcA</a>,
        (KPROC)<a class="code" href="../../d6/d0/usercli_8h.html#a569">fnHkINLPCWPSTRUCTA</a>,
        (KPROC)<a class="code" href="../../d6/d0/usercli_8h.html#a571">fnHkINLPCWPRETSTRUCTA</a>,
        (KPROC)<a class="code" href="../../d6/d0/usercli_8h.html#a573">DispatchHookA</a>,
        (KPROC)<a class="code" href="../../d3/d8/client_8c.html#a87">DispatchClientMessage</a>,
        (KPROC)<a class="code" href="../../d6/d4/msgbox_8c.html#a32">MB_DlgProcA</a>,
        (KPROC)<a class="code" href="../../d5/d5/mdimenu_8c.html#a13">MDIActivateDlgProcA</a>}
</div></pre>
<p>
Definition at line <a class="el" href="../../d7/d7/clinit_8c-source.html#l01156">1156</a> of file <a class="el" href="../../d7/d7/clinit_8c-source.html">clinit.c</a>.
<p>
Referenced by <a class="el" href="../../d7/d7/clinit_8c-source.html#l01219">ClientThreadSetup()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a14" doxytag="clinit.c::pfnClientW" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> const <a class="el" href="../../d0/d5/struct__PFNCLIENT.html">PFNCLIENT</a> <a class="el" href="../../d6/d8/clinit_8c.html#a14">pfnClientW</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Initial value:</b><pre class="fragment"><div> {
        (KPROC)<a class="code" href="../../d0/d9/clmsg_8c.html#a18">ScrollBarWndProcW</a>,
        (KPROC)DefWindowProcW,
        (KPROC)<a class="code" href="../../d0/d9/clmsg_8c.html#a15">MenuWndProcW</a>,
        (KPROC)<a class="code" href="../../d0/d9/clmsg_8c.html#a12">DesktopWndProcW</a>,
        (KPROC)DefWindowProcW,
        (KPROC)<a class="code" href="../../d8/d1/btnctl_8c.html#a34">ButtonWndProcW</a>,
        (KPROC)<a class="code" href="../../d1/d4/combo_8c.html#a9">ComboBoxWndProcW</a>,
        (KPROC)<a class="code" href="../../d6/d1/lb1_8c.html#a5">ComboListBoxWndProcW</a>,
        (KPROC)<a class="code" href="../../d3/d9/dlgmgr_8c.html#a18">DefDlgProcW</a>,
        (KPROC)<a class="code" href="../../d8/d4/editec_8c.html#a43">EditWndProcW</a>,
        (KPROC)<a class="code" href="../../d6/d1/lb1_8c.html#a3">ListBoxWndProcW</a>,
        (KPROC)<a class="code" href="../../d6/d5/mdiwin_8c.html#a31">MDIClientWndProcW</a>,
        (KPROC)<a class="code" href="../../d5/d5/statctl_8c.html#a22">StaticWndProcW</a>,
        (KPROC)<a class="code" href="../../d9/d9/imectl_8c.html#a33">ImeWndProcW</a>,
        (KPROC)<a class="code" href="../../d6/d0/usercli_8h.html#a568">fnHkINLPCWPSTRUCTW</a>,
        (KPROC)<a class="code" href="../../d6/d0/usercli_8h.html#a570">fnHkINLPCWPRETSTRUCTW</a>,
        (KPROC)<a class="code" href="../../d6/d0/usercli_8h.html#a572">DispatchHookW</a>,
        (KPROC)<a class="code" href="../../d3/d8/client_8c.html#a87">DispatchClientMessage</a>,
        (KPROC)<a class="code" href="../../d6/d4/msgbox_8c.html#a33">MB_DlgProcW</a>,
        (KPROC)<a class="code" href="../../d5/d5/mdimenu_8c.html#a14">MDIActivateDlgProcW</a>}
</div></pre>
<p>
Definition at line <a class="el" href="../../d7/d7/clinit_8c-source.html#l01178">1178</a> of file <a class="el" href="../../d7/d7/clinit_8c-source.html">clinit.c</a>.
<p>
Referenced by <a class="el" href="../../d7/d7/clinit_8c-source.html#l01219">ClientThreadSetup()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a15" doxytag="clinit.c::pfnClientWorker" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> const <a class="el" href="../../d1/d5/struct__PFNCLIENTWORKER.html">PFNCLIENTWORKER</a> <a class="el" href="../../d6/d8/clinit_8c.html#a15">pfnClientWorker</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Initial value:</b><pre class="fragment"><div> {
        (KPROC)<a class="code" href="../../d8/d1/btnctl_8c.html#a32">ButtonWndProcWorker</a>,
        (KPROC)<a class="code" href="../../d1/d4/combo_8c.html#a7">ComboBoxWndProcWorker</a>,
        (KPROC)<a class="code" href="../../d6/d1/lb1_8c.html#a1">ListBoxWndProcWorker</a>,
        (KPROC)<a class="code" href="../../d3/d9/dlgmgr_8c.html#a17">DefDlgProcWorker</a>,
        (KPROC)<a class="code" href="../../d8/d4/editec_8c.html#a44">EditWndProcWorker</a>,
        (KPROC)<a class="code" href="../../d6/d1/lb1_8c.html#a1">ListBoxWndProcWorker</a>,
        (KPROC)<a class="code" href="../../d6/d5/mdiwin_8c.html#a29">MDIClientWndProcWorker</a>,
        (KPROC)<a class="code" href="../../d5/d5/statctl_8c.html#a20">StaticWndProcWorker</a>,
        (KPROC)<a class="code" href="../../d9/d9/imectl_8c.html#a31">ImeWndProcWorker</a>}
</div></pre>
<p>
Definition at line <a class="el" href="../../d7/d7/clinit_8c-source.html#l01200">1200</a> of file <a class="el" href="../../d7/d7/clinit_8c-source.html">clinit.c</a>.
<p>
Referenced by <a class="el" href="../../d7/d7/clinit_8c-source.html#l01219">ClientThreadSetup()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="clinit.c::pwszWindowsKey" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> CONST WCHAR <a class="el" href="../../d6/d8/clinit_8c.html#a5">pwszWindowsKey</a>[] = L"\\Registry\\Machine\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Windows"          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d7/clinit_8c-source.html#l00029">29</a> of file <a class="el" href="../../d7/d7/clinit_8c-source.html">clinit.c</a>.
<p>
Referenced by <a class="el" href="../../d7/d7/clinit_8c-source.html#l00933">LoadAppDlls()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="clinit.c::szAppInit" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> CONST WCHAR <a class="el" href="../../d6/d8/clinit_8c.html#a6">szAppInit</a>[] = L"AppInit_DLLs"          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d7/clinit_8c-source.html#l00030">30</a> of file <a class="el" href="../../d7/d7/clinit_8c-source.html">clinit.c</a>.
<p>
Referenced by <a class="el" href="../../d7/d7/clinit_8c-source.html#l00933">LoadAppDlls()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="clinit.c::szWindowStationDirectory" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> WCHAR <a class="el" href="../../d9/d6/ntuser_2kernel_2globals_8h.html#a283">szWindowStationDirectory</a>[MAX_SESSION_PATH]          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d7/clinit_8c-source.html#l00041">41</a> of file <a class="el" href="../../d7/d7/clinit_8c-source.html">clinit.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d6/kernel_2server_8c-source.html#l01417">InitCreateObjectDirectory()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l00891">NtUserCreateWindowStation()</a>, <a class="el" href="../../d7/d7/clinit_8c-source.html#l00059">UserClientDllInitialize()</a>, <a class="el" href="../../d0/d6/kernel_2server_8c-source.html#l02004">UserInitialize()</a>, <a class="el" href="../../d0/d6/desktop_8c-source.html#l04821">xxxResolveDesktop()</a>, and <a class="el" href="../../d0/d6/desktop_8c-source.html#l04588">xxxResolveDesktopForWOW()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="clinit.c::ulMaxApiIndex" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> CONST ULONG <a class="el" href="../../d6/d8/clinit_8c.html#a11">ulMaxApiIndex</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d7/clinit_8c-source.html#l00057">57</a> of file <a class="el" href="../../d7/d7/clinit_8c-source.html">clinit.c</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:43:05 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
