<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: sep.h File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>sep.h File Reference</h1><code>#include "<a class="el" href="../../d0/d8/ntos_8h-source.html">ntos.h</a>"</code><br>
<code>#include &lt;ntrmlsa.h&gt;</code><br>
<code>#include "seopaque.h"</code><br>

<p>
<a href="../../d7/d5/sep_8h-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Classes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d1/struct__SEP__LSA__WORK__ITEM.html">_SEP_LSA_WORK_ITEM</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d2/struct__SEP__WORK__ITEM.html">_SEP_WORK_ITEM</a></td></tr>

<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d6/sep_8h.html#a0">IF_SE_GLOBAL</a>(FlagName)&nbsp;&nbsp;&nbsp;if (FALSE)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d6/sep_8h.html#a1">SeDiagPrint</a>(FlagName, _Text_)&nbsp;&nbsp;&nbsp;;</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d6/sep_8h.html#a2">SE_DIAG_SD_TRACKING</a>&nbsp;&nbsp;&nbsp;((ULONG) 0x00000001L)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d6/sep_8h.html#a3">SepAreFlagsSet</a>(Mask, Bits)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d6/sep_8h.html#a4">SepSetFlags</a>(Mask, Bits)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d6/sep_8h.html#a5">SepClearFlags</a>(Mask, Bits)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d6/sep_8h.html#a6">SepPrivilegeSetSize</a>(PrivilegeSet)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d6/sep_8h.html#a7">EffectiveToken</a>(SubjectSecurityContext)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d6/sep_8h.html#a8">SepTokenUserSid</a>(<a class="el" href="../../d2/d1/cttoken_8c.html#a28">Token</a>)&nbsp;&nbsp;&nbsp;((<a class="el" href="../../d8/d3/tokenp_8h.html#a15">PTOKEN</a>)(<a class="el" href="../../d2/d1/cttoken_8c.html#a28">Token</a>))-&gt;UserAndGroups-&gt;Sid</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d6/sep_8h.html#a9">SepTokenAuthenticationId</a>(<a class="el" href="../../d2/d1/cttoken_8c.html#a28">Token</a>)&nbsp;&nbsp;&nbsp;(((<a class="el" href="../../d8/d3/tokenp_8h.html#a15">PTOKEN</a>)(<a class="el" href="../../d2/d1/cttoken_8c.html#a28">Token</a>))-&gt;AuthenticationId)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d6/sep_8h.html#a10">SepBadImpersonationLevel</a>(IL, SIR)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d6/sep_8h.html#a11">IsValidElementCount</a>(<a class="el" href="../../d6/d0/cmdat_8c.html#a5">Count</a>, STRUCTURE)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d6/sep_8h.html#a12">SEP_MAX_GROUP_COUNT</a>&nbsp;&nbsp;&nbsp;4096</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d6/sep_8h.html#a13">SEP_MAX_PRIVILEGE_COUNT</a>&nbsp;&nbsp;&nbsp;4096</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d6/sep_8h.html#a14">SepLockLsaQueue</a>()</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d6/sep_8h.html#a15">SepUnlockLsaQueue</a>()</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d6/sep_8h.html#a16">SepWorkListHead</a>()&nbsp;&nbsp;&nbsp;((<a class="el" href="../../d8/d1/struct__SEP__LSA__WORK__ITEM.html">PSEP_LSA_WORK_ITEM</a>)(&amp;<a class="el" href="../../d6/d6/sep_8h.html#a23">SepLsaQueue</a>)-&gt;Flink)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d6/sep_8h.html#a17">ExAllocatePool</a>(a, b)&nbsp;&nbsp;&nbsp;ExAllocatePoolWithTag(a,b,'  eS')</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d6/sep_8h.html#a18">ExAllocatePoolWithQuota</a>(a, b)&nbsp;&nbsp;&nbsp;ExAllocatePoolWithQuotaTag(a,b,'  eS')</td></tr>

<tr><td colspan=2><br><h2>Typedefs</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>typedef VOID(*&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d6/sep_8h.html#a24">PSEP_LSA_WORKER_CLEANUP_ROUTINE</a> )(IN PVOID Parameter)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef enum <a class="el" href="../../d6/d6/sep_8h.html#a77">_SEP_LSA_WORK_ITEM_TAG</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d6/sep_8h.html#a25">SEP_LSA_WORK_ITEM_TAG</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef enum <a class="el" href="../../d6/d6/sep_8h.html#a77">_SEP_LSA_WORK_ITEM_TAG</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d6/sep_8h.html#a26">PSEP_LSA_WORK_ITEM_TAG</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d8/d1/struct__SEP__LSA__WORK__ITEM.html">_SEP_LSA_WORK_ITEM</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d6/sep_8h.html#a27">SEP_LSA_WORK_ITEM</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d8/d1/struct__SEP__LSA__WORK__ITEM.html">_SEP_LSA_WORK_ITEM</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d6/sep_8h.html#a28">PSEP_LSA_WORK_ITEM</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d2/d2/struct__SEP__WORK__ITEM.html">_SEP_WORK_ITEM</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d6/sep_8h.html#a29">SEP_WORK_ITEM</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d2/d2/struct__SEP__WORK__ITEM.html">_SEP_WORK_ITEM</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d6/sep_8h.html#a30">PSEP_WORK_ITEM</a></td></tr>

<tr><td colspan=2><br><h2>Enumerations</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>enum &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d6/sep_8h.html#a77">_SEP_LSA_WORK_ITEM_TAG</a> { <a class="el" href="../../d6/d6/sep_8h.html#a77a33">SepDeleteLogon</a>, 
<a class="el" href="../../d6/d6/sep_8h.html#a77a34">SepAuditRecord</a>
 }</td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d6/sep_8h.html#a35">SepDevelopmentTest</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d6/sep_8h.html#a36">SepInitializationPhase0</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d6/sep_8h.html#a37">SepInitializationPhase1</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d6/sep_8h.html#a38">SepVariableInitialization</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d6/sep_8h.html#a39">SepCreateToken</a> (OUT PHANDLE TokenHandle, IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> RequestorMode, IN ACCESS_MASK DesiredAccess, IN POBJECT_ATTRIBUTES <a class="el" href="../../d8/d0/ctlpcqos_8c.html#a1">ObjectAttributes</a> OPTIONAL, IN TOKEN_TYPE TokenType, IN SECURITY_IMPERSONATION_LEVEL ImpersonationLevel OPTIONAL, IN PLUID AuthenticationId, IN PLARGE_INTEGER ExpirationTime, IN PSID_AND_ATTRIBUTES User, IN ULONG GroupCount, IN PSID_AND_ATTRIBUTES Groups, IN ULONG GroupsLength, IN ULONG PrivilegeCount, IN PLUID_AND_ATTRIBUTES Privileges, IN ULONG PrivilegesLength, IN PSID <a class="el" href="../../d2/d1/cttoken_8c.html#a53">Owner</a> OPTIONAL, IN PSID PrimaryGroup, IN PACL DefaultDacl OPTIONAL, IN PTOKEN_SOURCE TokenSource, IN BOOLEAN SystemToken, IN PSECURITY_TOKEN_PROXY_DATA ProxyData OPTIONAL, IN PSECURITY_TOKEN_AUDIT_DATA AuditData OPTIONAL)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d6/sep_8h.html#a40">SepReferenceLogonSession</a> (IN PLUID LogonId)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d6/sep_8h.html#a41">SepDeReferenceLogonSession</a> (IN PLUID LogonId)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d6/sep_8h.html#a42">SepLockSubjectContext</a> (IN <a class="el" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">PSECURITY_SUBJECT_CONTEXT</a> SubjectContext)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d6/sep_8h.html#a43">SepFreeSubjectContext</a> (IN <a class="el" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">PSECURITY_SUBJECT_CONTEXT</a> SubjectContext)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d6/sep_8h.html#a44">SepGetDefaultsSubjectContext</a> (IN <a class="el" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">PSECURITY_SUBJECT_CONTEXT</a> SubjectContext, OUT PSID *<a class="el" href="../../d2/d1/cttoken_8c.html#a53">Owner</a>, OUT PSID *<a class="el" href="../../d2/d1/cttoken_8c.html#a54">Group</a>, OUT PSID *ServerOwner, OUT PSID *ServerGroup, OUT PACL *<a class="el" href="../../d2/d1/cttoken_8c.html#a55">Dacl</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d6/sep_8h.html#a45">SepValidOwnerSubjectContext</a> (IN <a class="el" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">PSECURITY_SUBJECT_CONTEXT</a> SubjectContext, IN PSID <a class="el" href="../../d2/d1/cttoken_8c.html#a53">Owner</a>, IN BOOLEAN ServerObject)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d6/sep_8h.html#a46">SepIdAssignableAsGroup</a> (IN PACCESS_TOKEN <a class="el" href="../../d2/d1/cttoken_8c.html#a28">Token</a>, IN PSID <a class="el" href="../../d2/d1/cttoken_8c.html#a54">Group</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d6/sep_8h.html#a47">SepCheckAcl</a> (IN PACL Acl, IN ULONG Length)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d6/sep_8h.html#a48">SepAuditAlarm</a> (IN PUNICODE_STRING SubsystemName, IN PVOID HandleId, IN PUNICODE_STRING ObjectTypeName, IN PUNICODE_STRING ObjectName, IN PSECURITY_DESCRIPTOR SecurityDescriptor, IN ACCESS_MASK DesiredAccess, IN BOOLEAN ObjectCreation, IN ACCESS_MASK GrantedAccess, OUT PBOOLEAN GenerateOnClose)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d6/sep_8h.html#a49">SepSinglePrivilegeCheck</a> (LUID DesiredPrivilege, IN PACCESS_TOKEN EffectiveToken, IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> PreviousMode)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d6/sep_8h.html#a50">SepRmCallLsa</a> (<a class="el" href="../../d2/d2/struct__SEP__WORK__ITEM.html">PSEP_WORK_ITEM</a> SepWorkItem)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d6/sep_8h.html#a51">SepInitializeWorkList</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d6/sep_8h.html#a52">SepRmInitPhase0</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d6/sep_8h.html#a53">SepConcatenatePrivileges</a> (IN PPRIVILEGE_SET TargetPrivilegeSet, IN ULONG TargetBufferSize, IN PPRIVILEGE_SET SourcePrivilegeSet)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d6/sep_8h.html#a54">SepTokenIsOwner</a> (IN PACCESS_TOKEN <a class="el" href="../../d2/d1/cttoken_8c.html#a28">Token</a>, IN PSECURITY_DESCRIPTOR SecurityDescriptor, IN BOOLEAN TokenLocked)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d6/sep_8h.html#a55">SepPrintAcl</a> (IN PACL Acl)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d6/sep_8h.html#a56">SepPrintSid</a> (IN PSID Sid)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d6/sep_8h.html#a57">SepDumpSecurityDescriptor</a> (IN PSECURITY_DESCRIPTOR SecurityDescriptor, IN PSZ TitleString)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d6/sep_8h.html#a58">SepSidTranslation</a> (PSID Sid, PSTRING AccountName)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d6/sep_8h.html#a59">SepDumpTokenInfo</a> (IN PACCESS_TOKEN <a class="el" href="../../d2/d1/cttoken_8c.html#a28">Token</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d6/sep_8h.html#a60">SepDumpString</a> (IN PUNICODE_STRING <a class="el" href="../../d0/d0/tdetach_8c.html#a0">String</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d6/sep_8h.html#a61">SepSidInToken</a> (IN PACCESS_TOKEN <a class="el" href="../../d2/d1/cttoken_8c.html#a28">Token</a>, IN PSID PrincipalSelfSid, IN PSID Sid, IN BOOLEAN DenyAce)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d6/sep_8h.html#a62">SepExamineSacl</a> (IN PACL Sacl, IN PACCESS_TOKEN <a class="el" href="../../d2/d1/cttoken_8c.html#a28">Token</a>, IN ACCESS_MASK DesiredAccess, IN BOOLEAN AccessGranted, OUT PBOOLEAN GenerateAudit, OUT PBOOLEAN GenerateAlarm)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d6/sep_8h.html#a63">SepCopyString</a> (IN PUNICODE_STRING <a class="el" href="../../d0/d2/usrbench_8h.html#a33">SourceString</a>, OUT PUNICODE_STRING *<a class="el" href="../../d0/d2/usrbench_8h.html#a35">DestString</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d6/sep_8h.html#a64">SepAssemblePrivileges</a> (IN ULONG PrivilegeCount, IN BOOLEAN SystemSecurity, IN BOOLEAN WriteOwner, OUT PPRIVILEGE_SET *Privileges)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PUNICODE_STRING&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d6/sep_8h.html#a65">SepQueryTypeString</a> (IN PVOID Object)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>POBJECT_NAME_INFORMATION&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d6/sep_8h.html#a66">SepQueryNameString</a> (IN PVOID Object)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">*++  <a href="#a66"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d6/sep_8h.html#a67">SepFilterPrivilegeAudits</a> (IN PPRIVILEGE_SET PrivilegeSet)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d6/sep_8h.html#a68">SepQueueWorkItem</a> (IN <a class="el" href="../../d8/d1/struct__SEP__LSA__WORK__ITEM.html">PSEP_LSA_WORK_ITEM</a> LsaWorkItem, IN BOOLEAN ForceQueue)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d6/sep_8h.html#a69">SepAdtGenerateDiscardAudit</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d6/sep_8h.html#a70">SepAdtValidateAuditBounds</a> (ULONG Upper, ULONG Lower)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d6/sep_8h.html#a71">SepAdtInitializeCrashOnFail</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d6/sep_8h.html#a72">SepAdtInitializePrivilegeAuditing</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d6/sep_8h.html#a73">SepCopyProxyData</a> (OUT PSECURITY_TOKEN_PROXY_DATA *DestProxyData, IN PSECURITY_TOKEN_PROXY_DATA SourceProxyData)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d6/sep_8h.html#a74">SepFreeProxyData</a> (IN PSECURITY_TOKEN_PROXY_DATA ProxyData)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d6/sep_8h.html#a75">SepProbeAndCaptureQosData</a> (IN PSECURITY_ADVANCED_QUALITY_OF_SERVICE CapturedSecurityQos)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PACCESS_TOKEN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d6/sep_8h.html#a76">SeMakeAnonymousToken</a> ()</td></tr>

<tr><td colspan=2><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>HANDLE&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d6/sep_8h.html#a19">SepLsaHandle</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d6/sep_8h.html#a20">SepAuditShutdownEvents</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d6/d4/struct__ERESOURCE.html">ERESOURCE</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d6/sep_8h.html#a21">SepLsaQueueLock</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d6/sep_8h.html#a22">SepLsaQueueLength</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LIST_ENTRY&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d6/sep_8h.html#a23">SepLsaQueue</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d2/d2/struct__SEP__WORK__ITEM.html">SEP_WORK_ITEM</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d6/sep_8h.html#a31">SepExWorkItem</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d8/d1/struct__SEP__LSA__WORK__ITEM.html">PSEP_LSA_WORK_ITEM</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d6/sep_8h.html#a32">SepDequeueWorkItem</a> (VOID)</td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a7" doxytag="sep.h::EffectiveToken" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define EffectiveToken          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">SubjectSecurityContext&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div>(                            \
                 (SubjectSecurityContext)-&gt;ClientToken ?                      \
                 (SubjectSecurityContext)-&gt;ClientToken :                      \
                 (SubjectSecurityContext)-&gt;PrimaryToken                       \
                 )                                                            \
</div></pre>
<p>
Definition at line <a class="el" href="../../d7/d5/sep_8h-source.html#l00165">165</a> of file <a class="el" href="../../d7/d5/sep_8h-source.html">sep.h</a>.
<p>
Referenced by <a class="el" href="../../d4/d4/seaudit_8c-source.html#l02492">NtCloseObjectAuditAlarm()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l02627">NtDeleteObjectAuditAlarm()</a>, <a class="el" href="../../d1/d3/accessck_8c-source.html#l03323">SeAccessCheck()</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l02573">SeAuditHandleDuplication()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l04648">SeAuditingFileOrGlobalEvents()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l03826">SeCloseObjectAuditAlarm()</a>, <a class="el" href="../../d3/d4/seastate_8c-source.html#l00180">SeCreateAccessState()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l03538">SeCreateObjectAuditAlarm()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l03892">SeDeleteObjectAuditAlarm()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l03660">SeObjectReferenceAuditAlarm()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l02765">SeOpenObjectAuditAlarm()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l03085">SeOpenObjectForDeleteAuditAlarm()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l01050">SepAccessCheckAndAuditAlarm()</a>, <a class="el" href="../../d1/d7/subject_8c-source.html#l00234">SepGetDefaultsSubjectContext()</a>, <a class="el" href="../../d9/d3/privileg_8c-source.html#l00158">SePrivilegeCheck()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l00989">SePrivilegedServiceAuditAlarm()</a>, <a class="el" href="../../d1/d3/accessck_8c-source.html#l03652">SePrivilegePolicyCheck()</a>, <a class="el" href="../../d1/d3/accessck_8c-source.html#l03796">SepTokenIsOwner()</a>, <a class="el" href="../../d1/d7/subject_8c-source.html#l00381">SepValidOwnerSubjectContext()</a>, <a class="el" href="../../d1/d7/subject_8c-source.html#l00529">SeQueryAuthenticationIdSubjectContext()</a>, and <a class="el" href="../../d4/d4/seaudit_8c-source.html#l03429">SeTraverseAuditAlarm()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a17" doxytag="sep.h::ExAllocatePool" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define ExAllocatePool          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">a,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>b&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;ExAllocatePoolWithTag(a,b,'  eS')</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d5/sep_8h-source.html#l00296">296</a> of file <a class="el" href="../../d7/d5/sep_8h-source.html">sep.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a18" doxytag="sep.h::ExAllocatePoolWithQuota" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define ExAllocatePoolWithQuota          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">a,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>b&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;ExAllocatePoolWithQuotaTag(a,b,'  eS')</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d5/sep_8h-source.html#l00299">299</a> of file <a class="el" href="../../d7/d5/sep_8h-source.html">sep.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="sep.h::IF_SE_GLOBAL" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define IF_SE_GLOBAL          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">FlagName&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;if (FALSE)</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d5/sep_8h-source.html#l00079">79</a> of file <a class="el" href="../../d7/d5/sep_8h-source.html">sep.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="sep.h::IsValidElementCount" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define IsValidElementCount          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d0/cmdat_8c.html#a5">Count</a>,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>STRUCTURE&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div>( <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a> &lt; ( (ULONG_PTR) ( (PUCHAR) ( (PUCHAR) (LONG_PTR)(LONG)0xFFFFFFFF - (PUCHAR) MM_SYSTEM_RANGE_START ) + 1 ) \
        / <span class="keyword">sizeof</span>( STRUCTURE ) ) )
</div></pre>
<p>
Definition at line <a class="el" href="../../d7/d5/sep_8h-source.html#l00242">242</a> of file <a class="el" href="../../d7/d5/sep_8h-source.html">sep.h</a>.
<p>
Referenced by <a class="el" href="../../d4/d4/seaudit_8c-source.html#l02072">NtOpenObjectAuditAlarm()</a>, <a class="el" href="../../d9/d3/privileg_8c-source.html#l00231">NtPrivilegeCheck()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l00731">NtPrivilegedServiceAuditAlarm()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l00406">NtPrivilegeObjectAuditAlarm()</a>, <a class="el" href="../../d1/d3/accessck_8c-source.html#l02704">SeAccessCheckByType()</a>, <a class="el" href="../../d1/d3/accessck_8c-source.html#l00144">SeCaptureObjectTypeList()</a>, and <a class="el" href="../../d4/d4/seaudit_8c-source.html#l01050">SepAccessCheckAndAuditAlarm()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="sep.h::SE_DIAG_SD_TRACKING" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define SE_DIAG_SD_TRACKING&nbsp;&nbsp;&nbsp;((ULONG) 0x00000001L)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d5/sep_8h-source.html#l00102">102</a> of file <a class="el" href="../../d7/d5/sep_8h-source.html">sep.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="sep.h::SeDiagPrint" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define SeDiagPrint          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">FlagName,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>_Text_&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;;</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d5/sep_8h-source.html#l00085">85</a> of file <a class="el" href="../../d7/d5/sep_8h-source.html">sep.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="sep.h::SEP_MAX_GROUP_COUNT" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define SEP_MAX_GROUP_COUNT&nbsp;&nbsp;&nbsp;4096          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d5/sep_8h-source.html#l00254">254</a> of file <a class="el" href="../../d7/d5/sep_8h-source.html">sep.h</a>.
<p>
Referenced by <a class="el" href="../../d3/d4/se_2capture_8c-source.html#l01850">SeCaptureSidAndAttributesArray()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="sep.h::SEP_MAX_PRIVILEGE_COUNT" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define SEP_MAX_PRIVILEGE_COUNT&nbsp;&nbsp;&nbsp;4096          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d5/sep_8h-source.html#l00255">255</a> of file <a class="el" href="../../d7/d5/sep_8h-source.html">sep.h</a>.
<p>
Referenced by <a class="el" href="../../d3/d4/se_2capture_8c-source.html#l01608">SeCaptureLuidAndAttributesArray()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="sep.h::SepAreFlagsSet" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define SepAreFlagsSet          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">Mask,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>Bits&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div>(                                                                  \
            ((Mask) &amp; ( Bits )) == ( Bits )                                    \
            )
</div></pre>
<p>
Definition at line <a class="el" href="../../d7/d5/sep_8h-source.html#l00117">117</a> of file <a class="el" href="../../d7/d5/sep_8h-source.html">sep.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="sep.h::SepBadImpersonationLevel" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define SepBadImpersonationLevel          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IL,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>SIR&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div>((                                   \
            ((IL) == SecurityAnonymous) || ((IL) == SecurityIdentification) || \
            ( (SIR) &amp;&amp; ((IL) != SecurityDelegation) )                          \
            ) ? <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> : <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> )
</div></pre>
<p>
Definition at line <a class="el" href="../../d7/d5/sep_8h-source.html#l00225">225</a> of file <a class="el" href="../../d7/d5/sep_8h-source.html">sep.h</a>.
<p>
Referenced by <a class="el" href="../../d5/d4/seclient_8c-source.html#l00062">SepCreateClientSecurity()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="sep.h::SepClearFlags" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define SepClearFlags          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">Mask,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>Bits&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div>(                                                                  \
            ( Mask ) &amp;= ~( Bits )                                              \
            )
</div></pre>
<p>
Definition at line <a class="el" href="../../d7/d5/sep_8h-source.html#l00135">135</a> of file <a class="el" href="../../d7/d5/sep_8h-source.html">sep.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a14" doxytag="sep.h::SepLockLsaQueue" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define SepLockLsaQueue          </td>
          <td class="md" valign="top">(&nbsp;</td>
&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div><a class="code" href="../../d4/d9/ke_8h.html#a28">KeEnterCriticalRegion</a>();                           \
                           <a class="code" href="../../d5/d8/ex_8h.html#a70">ExAcquireResourceExclusive</a>(&amp;SepLsaQueueLock, TRUE)
</div></pre>
<p>
Definition at line <a class="el" href="../../d7/d5/sep_8h-source.html#l00287">287</a> of file <a class="el" href="../../d7/d5/sep_8h-source.html">sep.h</a>.
<p>
Referenced by <a class="el" href="../../d1/d4/adtlog_8c-source.html#l00738">SepDequeueWorkItem()</a>, and <a class="el" href="../../d1/d4/adtlog_8c-source.html#l00600">SepQueueWorkItem()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="sep.h::SepPrivilegeSetSize" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define SepPrivilegeSetSize          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PrivilegeSet&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div>( ( PrivilegeSet ) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ? 0 :                                       \
        ((( PrivilegeSet )-&gt;PrivilegeCount &gt; 0)                                \
         ?                                                                     \
         ((ULONG)<span class="keyword">sizeof</span>(PRIVILEGE_SET) +                                       \
           (                                                                   \
             (( PrivilegeSet )-&gt;PrivilegeCount  -  <a class="code" href="../../d5/d4/acpitabl_8h.html#a44">ANYSIZE_ARRAY</a>) *            \
             (ULONG)<span class="keyword">sizeof</span>(LUID_AND_ATTRIBUTES)                                \
           )                                                                   \
         )                                                                     \
         : ((ULONG)<span class="keyword">sizeof</span>(PRIVILEGE_SET) - (ULONG)<span class="keyword">sizeof</span>(LUID_AND_ATTRIBUTES)) \
        ))
</div></pre>
<p>
Definition at line <a class="el" href="../../d7/d5/sep_8h-source.html#l00147">147</a> of file <a class="el" href="../../d7/d5/sep_8h-source.html">sep.h</a>.
<p>
Referenced by <a class="el" href="../../d1/d3/accessck_8c-source.html#l02704">SeAccessCheckByType()</a>, <a class="el" href="../../d3/d4/seastate_8c-source.html#l00434">SeAppendPrivileges()</a>, and <a class="el" href="../../d3/d4/seastate_8c-source.html#l00543">SepConcatenatePrivileges()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="sep.h::SepSetFlags" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define SepSetFlags          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">Mask,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>Bits&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div>(                                                                  \
            ( Mask ) |= ( Bits )                                               \
            )
</div></pre>
<p>
Definition at line <a class="el" href="../../d7/d5/sep_8h-source.html#l00126">126</a> of file <a class="el" href="../../d7/d5/sep_8h-source.html">sep.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="sep.h::SepTokenAuthenticationId" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define SepTokenAuthenticationId          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d2/d1/cttoken_8c.html#a28">Token</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;(((<a class="el" href="../../d8/d3/tokenp_8h.html#a15">PTOKEN</a>)(<a class="el" href="../../d2/d1/cttoken_8c.html#a28">Token</a>))-&gt;AuthenticationId)</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d5/sep_8h-source.html#l00183">183</a> of file <a class="el" href="../../d7/d5/sep_8h-source.html">sep.h</a>.
<p>
Referenced by <a class="el" href="../../d4/d4/seaudit_8c-source.html#l02492">NtCloseObjectAuditAlarm()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l02627">NtDeleteObjectAuditAlarm()</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l02466">SeAuditProcessCreation()</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l02653">SeAuditProcessExit()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l03826">SeCloseObjectAuditAlarm()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l03538">SeCreateObjectAuditAlarm()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l03892">SeDeleteObjectAuditAlarm()</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l01907">SepAdtObjectReferenceAuditAlarm()</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l00571">SepAdtOpenObjectAuditAlarm()</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l01003">SepAdtOpenObjectForDeleteAuditAlarm()</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l00346">SepAdtPrivilegedServiceAuditAlarm()</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l00125">SepAdtPrivilegeObjectAuditAlarm()</a>, and <a class="el" href="../../d4/d4/seaudit_8c-source.html#l03429">SeTraverseAuditAlarm()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="sep.h::SepTokenUserSid" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define SepTokenUserSid          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d2/d1/cttoken_8c.html#a28">Token</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;((<a class="el" href="../../d8/d3/tokenp_8h.html#a15">PTOKEN</a>)(<a class="el" href="../../d2/d1/cttoken_8c.html#a28">Token</a>))-&gt;UserAndGroups-&gt;Sid</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d5/sep_8h-source.html#l00176">176</a> of file <a class="el" href="../../d7/d5/sep_8h-source.html">sep.h</a>.
<p>
Referenced by <a class="el" href="../../d4/d4/seaudit_8c-source.html#l02492">NtCloseObjectAuditAlarm()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l02627">NtDeleteObjectAuditAlarm()</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l02573">SeAuditHandleDuplication()</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l02466">SeAuditProcessCreation()</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l02653">SeAuditProcessExit()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l03826">SeCloseObjectAuditAlarm()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l03538">SeCreateObjectAuditAlarm()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l03892">SeDeleteObjectAuditAlarm()</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l01907">SepAdtObjectReferenceAuditAlarm()</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l00571">SepAdtOpenObjectAuditAlarm()</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l01003">SepAdtOpenObjectForDeleteAuditAlarm()</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l00346">SepAdtPrivilegedServiceAuditAlarm()</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l00125">SepAdtPrivilegeObjectAuditAlarm()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l00989">SePrivilegedServiceAuditAlarm()</a>, and <a class="el" href="../../d4/d4/seaudit_8c-source.html#l03429">SeTraverseAuditAlarm()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a15" doxytag="sep.h::SepUnlockLsaQueue" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define SepUnlockLsaQueue          </td>
          <td class="md" valign="top">(&nbsp;</td>
&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div><a class="code" href="../../d5/d8/ex_8h.html#a66">ExReleaseResource</a>(&amp;SepLsaQueueLock);              \
                            <a class="code" href="../../d4/d9/ke_8h.html#a29">KeLeaveCriticalRegion</a>()
</div></pre>
<p>
Definition at line <a class="el" href="../../d7/d5/sep_8h-source.html#l00290">290</a> of file <a class="el" href="../../d7/d5/sep_8h-source.html">sep.h</a>.
<p>
Referenced by <a class="el" href="../../d1/d4/adtlog_8c-source.html#l00738">SepDequeueWorkItem()</a>, and <a class="el" href="../../d1/d4/adtlog_8c-source.html#l00600">SepQueueWorkItem()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a16" doxytag="sep.h::SepWorkListHead" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define SepWorkListHead          </td>
          <td class="md" valign="top">(&nbsp;</td>
&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;((<a class="el" href="../../d8/d1/struct__SEP__LSA__WORK__ITEM.html">PSEP_LSA_WORK_ITEM</a>)(&amp;<a class="el" href="../../d6/d6/sep_8h.html#a23">SepLsaQueue</a>)-&gt;Flink)</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d5/sep_8h-source.html#l00293">293</a> of file <a class="el" href="../../d7/d5/sep_8h-source.html">sep.h</a>.
<p>
Referenced by <a class="el" href="../../d1/d9/rmmain_8c-source.html#l00907">SepRmCallLsa()</a>.    </td>
  </tr>
</table>
<hr><h2>Typedef Documentation</h2>
<a class="anchor" name="a28" doxytag="sep.h::PSEP_LSA_WORK_ITEM" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d8/d1/struct__SEP__LSA__WORK__ITEM.html">_SEP_LSA_WORK_ITEM</a> * <a class="el" href="../../d8/d1/struct__SEP__LSA__WORK__ITEM.html">PSEP_LSA_WORK_ITEM</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d0/d9/rmlogon_8c-source.html#l00777">SepInformLsaOfDeletedLogon()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a26" doxytag="sep.h::PSEP_LSA_WORK_ITEM_TAG" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef enum <a class="el" href="../../d6/d6/sep_8h.html#a77">_SEP_LSA_WORK_ITEM_TAG</a> * <a class="el" href="../../d6/d6/sep_8h.html#a26">PSEP_LSA_WORK_ITEM_TAG</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a24" doxytag="sep.h::PSEP_LSA_WORKER_CLEANUP_ROUTINE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef VOID(* <a class="el" href="../../d6/d6/sep_8h.html#a24">PSEP_LSA_WORKER_CLEANUP_ROUTINE</a>)(IN PVOID Parameter)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d5/sep_8h-source.html#l00304">304</a> of file <a class="el" href="../../d7/d5/sep_8h-source.html">sep.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a30" doxytag="sep.h::PSEP_WORK_ITEM" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d2/d2/struct__SEP__WORK__ITEM.html">_SEP_WORK_ITEM</a> * <a class="el" href="../../d2/d2/struct__SEP__WORK__ITEM.html">PSEP_WORK_ITEM</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d1/d9/rmmain_8c-source.html#l00907">SepRmCallLsa()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a27" doxytag="sep.h::SEP_LSA_WORK_ITEM" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d8/d1/struct__SEP__LSA__WORK__ITEM.html">_SEP_LSA_WORK_ITEM</a>  <a class="el" href="../../d8/d1/struct__SEP__LSA__WORK__ITEM.html">SEP_LSA_WORK_ITEM</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d1/d4/adtlog_8c-source.html#l00052">SepAdtLogAuditRecord()</a>, and <a class="el" href="../../d0/d9/rmlogon_8c-source.html#l00777">SepInformLsaOfDeletedLogon()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a25" doxytag="sep.h::SEP_LSA_WORK_ITEM_TAG" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef enum <a class="el" href="../../d6/d6/sep_8h.html#a77">_SEP_LSA_WORK_ITEM_TAG</a>  <a class="el" href="../../d6/d6/sep_8h.html#a25">SEP_LSA_WORK_ITEM_TAG</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a29" doxytag="sep.h::SEP_WORK_ITEM" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d2/d2/struct__SEP__WORK__ITEM.html">_SEP_WORK_ITEM</a>  <a class="el" href="../../d2/d2/struct__SEP__WORK__ITEM.html">SEP_WORK_ITEM</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<hr><h2>Enumeration Type Documentation</h2>
<a class="anchor" name="a77" doxytag="sep.h::_SEP_LSA_WORK_ITEM_TAG" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> enum <a class="el" href="../../d6/d6/sep_8h.html#a77">_SEP_LSA_WORK_ITEM_TAG</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<dl compact><dt><b>Enumeration values: </b></dt><dd>
<table border=0 cellspacing=2 cellpadding=0>
<tr><td valign=top><em><a class="anchor" name="a77a33" doxytag="SepDeleteLogon" ></a>SepDeleteLogon</em>&nbsp;</td><td>
</td></tr>
<tr><td valign=top><em><a class="anchor" name="a77a34" doxytag="SepAuditRecord" ></a>SepAuditRecord</em>&nbsp;</td><td>
</td></tr>
</table>
</dl>

<p>
Definition at line <a class="el" href="../../d7/d5/sep_8h-source.html#l00309">309</a> of file <a class="el" href="../../d7/d5/sep_8h-source.html">sep.h</a>.
<p>
<pre class="fragment"><div>00309                                     {
00310     <a class="code" href="../../d6/d6/sep_8h.html#a77a33">SepDeleteLogon</a>,
00311     <a class="code" href="../../d6/d6/sep_8h.html#a77a34">SepAuditRecord</a>
00312 } <a class="code" href="../../d6/d6/sep_8h.html#a25">SEP_LSA_WORK_ITEM_TAG</a>, *<a class="code" href="../../d6/d6/sep_8h.html#a26">PSEP_LSA_WORK_ITEM_TAG</a>;
</div></pre>    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a76" doxytag="sep.h::SeMakeAnonymousToken" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PACCESS_TOKEN SeMakeAnonymousToken           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a69" doxytag="sep.h::SepAdtGenerateDiscardAudit" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SepAdtGenerateDiscardAudit           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l02717">2717</a> of file <a class="el" href="../../d8/d5/sepaudit_8c-source.html">sepaudit.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01628">SeLocalSystemSid</a>, <a class="el" href="../../d2/d4/adtp_8h-source.html#l00056">SepAdtCountEventsDiscarded</a>, <a class="el" href="../../d1/d4/adtlog_8c-source.html#l00052">SepAdtLogAuditRecord()</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l00051">SepSetParmTypeSid</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l00059">SepSetParmTypeString</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l00076">SepSetParmTypeUlong</a>, and <a class="el" href="../../d1/d4/se_8h-source.html#l01711">SeSubsystemName</a>.
<p>
Referenced by <a class="el" href="../../d1/d4/adtlog_8c-source.html#l00600">SepQueueWorkItem()</a>.
<p>
<pre class="fragment"><div>02723                    :
02724 
02725     Generates an 'audits discarded' audit.
02726 
02727 Arguments:
02728 
02729     none
02730 
02731 Return Value:
02732 
02733     None.
02734 
02735 --*/
02736 
02737 {
02738 
02739     SE_ADT_PARAMETER_ARRAY AuditParameters;
02740     PSID UserSid;
02741 
02742     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
02743 
02744     UserSid = <a class="code" href="../../d0/d5/se_8h.html#a54">SeLocalSystemSid</a>;
02745 
02746     RtlZeroMemory (
02747        (PVOID) &amp;AuditParameters,
02748        <span class="keyword">sizeof</span>( AuditParameters )
02749        );
02750 
02751 
02752     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( SeAdtParmTypeNone == 0 );
02753 
02754     AuditParameters.CategoryId = SE_CATEGID_SYSTEM;
02755     AuditParameters.AuditId = SE_AUDITID_AUDITS_DISCARDED;
02756     AuditParameters.ParameterCount = 0;
02757     AuditParameters.Type = EVENTLOG_AUDIT_SUCCESS;
02758 
02759     <a class="code" href="../../d7/d6/sepaudit_8c.html#a0">SepSetParmTypeSid</a>( AuditParameters, AuditParameters.ParameterCount, UserSid );
02760     AuditParameters.ParameterCount++;
02761 
02762     <a class="code" href="../../d7/d6/sepaudit_8c.html#a1">SepSetParmTypeString</a>( AuditParameters, AuditParameters.ParameterCount, &amp;SeSubsystemName );
02763     AuditParameters.ParameterCount++;
02764 
02765     <a class="code" href="../../d7/d6/sepaudit_8c.html#a3">SepSetParmTypeUlong</a>( AuditParameters, AuditParameters.ParameterCount, SepAdtCountEventsDiscarded );
02766     AuditParameters.ParameterCount++;
02767 
02768     <a class="code" href="../../d0/d5/adtlog_8c.html#a0">SepAdtLogAuditRecord</a>( &amp;AuditParameters );
02769 }
}
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a71" doxytag="sep.h::SepAdtInitializeCrashOnFail" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS SepAdtInitializeCrashOnFail           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d4/adtinit_8c-source.html#l00242">242</a> of file <a class="el" href="../../d0/d4/adtinit_8c-source.html">adtinit.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d2/d0/bench_8c-source.html#l00050">CHAR</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d9/d9/rtbatcr_8c-source.html#l00059">KeyName</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d6/d9/obclose_8c-source.html#l00037">NtClose()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l01870">NtOpenKey()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l02187">NtQueryValueKey()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d3/d6/string_8c-source.html#l00148">RtlInitUnicodeString()</a>, <a class="el" href="../../d2/d4/adtp_8h-source.html#l00077">SepCrashOnAuditFail</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d2/d0/rtdelval_8c-source.html#l00047">ValueName</a>.
<p>
Referenced by <a class="el" href="../../d1/d9/rmmain_8c-source.html#l00060">SeRmInitPhase1()</a>.
<p>
<pre class="fragment"><div>00248                    :
00249 
00250     Reads <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> registry to see <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> user has told us to crash <span class="keywordflow">if</span> an audit fails.
00251 
00252 Arguments:
00253 
00254     None.
00255 
00256 Return Value:
00257 
00258     STATUS_SUCCESS
00259 
00260 --*/
00261 
00262 {
00263     HANDLE KeyHandle;
00264     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00265     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> TmpStatus;
00266     OBJECT_ATTRIBUTES Obja;
00267     ULONG ResultLength;
00268     UNICODE_STRING <a class="code" href="../../d8/d0/rtbatcr_8c.html#a3">KeyName</a>;
00269     UNICODE_STRING <a class="code" href="../../d1/d1/rtdelval_8c.html#a3">ValueName</a>;
00270     <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a> KeyInfo[<span class="keyword">sizeof</span>(KEY_VALUE_PARTIAL_INFORMATION) + <span class="keyword">sizeof</span>(BOOLEAN)];
00271     PKEY_VALUE_PARTIAL_INFORMATION pKeyInfo;
00272 
00273     <a class="code" href="../../d1/d5/adtp_8h.html#a12">SepCrashOnAuditFail</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00274 
00275     <span class="comment">//</span>
00276     <span class="comment">// Check the value of the CrashOnAudit flag in the registry.</span>
00277     <span class="comment">//</span>
00278 
00279     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;KeyName, L<span class="stringliteral">"\\Registry\\Machine\\System\\CurrentControlSet\\Control\\Lsa"</span>);
00280 
00281     InitializeObjectAttributes( &amp;Obja,
00282                                 &amp;KeyName,
00283                                 OBJ_CASE_INSENSITIVE,
00284                                 NULL,
00285                                 NULL
00286                                 );
00287 
00288     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d7/ntapi_8c.html#a23">NtOpenKey</a>(
00289                  &amp;KeyHandle,
00290                  KEY_QUERY_VALUE | KEY_SET_VALUE,
00291                  &amp;Obja
00292                  );
00293 
00294     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> == STATUS_OBJECT_NAME_NOT_FOUND) {
00295         <span class="keywordflow">return</span>( STATUS_SUCCESS );
00296     }
00297 
00298     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;ValueName, CRASH_ON_AUDIT_FAIL_VALUE );
00299 
00300     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d7/ntapi_8c.html#a25">NtQueryValueKey</a>(
00301                  KeyHandle,
00302                  &amp;ValueName,
00303                  KeyValuePartialInformation,
00304                  KeyInfo,
00305                  <span class="keyword">sizeof</span>(KeyInfo),
00306                  &amp;ResultLength
00307                  );
00308 
00309     TmpStatus = <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(KeyHandle);
00310     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(TmpStatus));
00311 
00312     <span class="comment">//</span>
00313     <span class="comment">// If the key isn't there, don't turn on CrashOnFail.</span>
00314     <span class="comment">//</span>
00315 
00316     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00317 
00318         pKeyInfo = (PKEY_VALUE_PARTIAL_INFORMATION)KeyInfo;
00319         <span class="keywordflow">if</span> ((UCHAR) *(pKeyInfo-&gt;Data) == LSAP_CRASH_ON_AUDIT_FAIL) {
00320             <a class="code" href="../../d1/d5/adtp_8h.html#a12">SepCrashOnAuditFail</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00321         }
00322     }
00323 
00324     <span class="keywordflow">return</span>( STATUS_SUCCESS );
00325 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a72" doxytag="sep.h::SepAdtInitializePrivilegeAuditing" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN SepAdtInitializePrivilegeAuditing           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d4/adtinit_8c-source.html#l00329">329</a> of file <a class="el" href="../../d0/d4/adtinit_8c-source.html">adtinit.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d2/d0/bench_8c-source.html#l00050">CHAR</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d4/adtp_8h-source.html#l00083">FULL_PRIVILEGE_AUDITING</a>, <a class="el" href="../../d9/d9/rtbatcr_8c-source.html#l00059">KeyName</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d6/d9/obclose_8c-source.html#l00037">NtClose()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l01870">NtOpenKey()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l02187">NtQueryValueKey()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d3/d6/string_8c-source.html#l00148">RtlInitUnicodeString()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l04556">SepInitializePrivilegeFilter()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d2/d0/rtdelval_8c-source.html#l00047">ValueName</a>.
<p>
Referenced by <a class="el" href="../../d1/d9/rmmain_8c-source.html#l00060">SeRmInitPhase1()</a>.
<p>
<pre class="fragment"><div>00335                    :
00336 
00337     Checks to see <span class="keywordflow">if</span> there <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> an entry in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> registry telling us to <span class="keywordflow">do</span> full privilege auditing
00338     (which currently means audit everything we normall audit, plus backup and restore privileges).
00339 
00340 Arguments:
00341 
00342     None
00343 
00344 Return Value:
00345 
00346     BOOLEAN - <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <span class="keywordflow">if</span> Auditing has been initialized correctly, <span class="keywordflow">else</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>.
00347 
00348 --*/
00349 
00350 {
00351     HANDLE KeyHandle;
00352     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00353     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> TmpStatus;
00354     OBJECT_ATTRIBUTES Obja;
00355     ULONG ResultLength;
00356     UNICODE_STRING <a class="code" href="../../d8/d0/rtbatcr_8c.html#a3">KeyName</a>;
00357     UNICODE_STRING <a class="code" href="../../d1/d1/rtdelval_8c.html#a3">ValueName</a>;
00358     <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a> KeyInfo[<span class="keyword">sizeof</span>(KEY_VALUE_PARTIAL_INFORMATION) + <span class="keyword">sizeof</span>(BOOLEAN)];
00359     PKEY_VALUE_PARTIAL_INFORMATION pKeyInfo;
00360     BOOLEAN Verbose;
00361 
00362     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00363 
00364     <span class="comment">//</span>
00365     <span class="comment">// Query the registry to set up the privilege auditing filter.</span>
00366     <span class="comment">//</span>
00367 
00368     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;KeyName, L<span class="stringliteral">"\\Registry\\Machine\\System\\CurrentControlSet\\Control\\Lsa"</span>);
00369 
00370     InitializeObjectAttributes( &amp;Obja,
00371                                 &amp;KeyName,
00372                                 OBJ_CASE_INSENSITIVE,
00373                                 NULL,
00374                                 NULL
00375                                 );
00376 
00377     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d7/ntapi_8c.html#a23">NtOpenKey</a>(
00378                  &amp;KeyHandle,
00379                  KEY_QUERY_VALUE | KEY_SET_VALUE,
00380                  &amp;Obja
00381                  );
00382 
00383 
00384     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00385 
00386         <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> == STATUS_OBJECT_NAME_NOT_FOUND) {
00387 
00388             <span class="keywordflow">return</span> ( <a class="code" href="../../d3/d5/seaudit_8c.html#a33">SepInitializePrivilegeFilter</a>( FALSE ));
00389 
00390         } <span class="keywordflow">else</span> {
00391 
00392             <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> );
00393         }
00394     }
00395 
00396     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;ValueName, FULL_PRIVILEGE_AUDITING );
00397 
00398     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d7/ntapi_8c.html#a25">NtQueryValueKey</a>(
00399                  KeyHandle,
00400                  &amp;ValueName,
00401                  KeyValuePartialInformation,
00402                  KeyInfo,
00403                  <span class="keyword">sizeof</span>(KeyInfo),
00404                  &amp;ResultLength
00405                  );
00406 
00407     TmpStatus = <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(KeyHandle);
00408     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(TmpStatus));
00409 
00410     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00411 
00412         Verbose = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00413 
00414     } <span class="keywordflow">else</span> {
00415 
00416         pKeyInfo = (PKEY_VALUE_PARTIAL_INFORMATION)KeyInfo;
00417         Verbose = (BOOLEAN) *(pKeyInfo-&gt;Data);
00418     }
00419 
00420     <span class="keywordflow">return</span> ( <a class="code" href="../../d3/d5/seaudit_8c.html#a33">SepInitializePrivilegeFilter</a>( Verbose ));
00421 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a70" doxytag="sep.h::SepAdtValidateAuditBounds" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN SepAdtValidateAuditBounds           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Upper</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Lower</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d4/adtinit_8c-source.html#l00039">39</a> of file <a class="el" href="../../d0/d4/adtinit_8c-source.html">adtinit.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d0/d4/adtinit_8c-source.html#l00117">SepAdtInitializeBounds()</a>.
<p>
<pre class="fragment"><div>00046                    :
00047 
00048     Examines <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> audit queue <a class="code" href="../../d2/d3/fetypes_8h.html#a457a417">high</a> and <a class="code" href="../../d2/d3/fetypes_8h.html#a457a418">low</a> water mark values and performs
00049     a general sanity check on them.
00050 
00051 Arguments:
00052 
00053     Upper - High water mark.
00054 
00055     Lower - Low water mark.
00056 
00057 Return Value:
00058 
00059     <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> - values are acceptable.
00060 
00061     <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> - values are unacceptable.
00062 
00063 
00064 --*/
00065 
00066 {
00067     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00068 
00069     <span class="keywordflow">if</span> ( Lower &gt;= Upper ) {
00070         <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> );
00071     }
00072 
00073     <span class="keywordflow">if</span> ( Lower &lt; 16 ) {
00074         <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> );
00075     }
00076 
00077     <span class="keywordflow">if</span> ( (Upper - Lower) &lt; 16 ) {
00078         <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> );
00079     }
00080 
00081     <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> );
00082 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a64" doxytag="sep.h::SepAssemblePrivileges" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SepAssemblePrivileges           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>PrivilegeCount</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>SystemSecurity</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>WriteOwner</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PPRIVILEGE_SET *&nbsp;</td>
          <td class="mdname" nowrap> <em>Privileges</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d4/seglobal_8c-source.html#l01071">1071</a> of file <a class="el" href="../../d9/d4/seglobal_8c-source.html">seglobal.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d9/d4/seglobal_8c-source.html#l00225">DoublePrivilegeSetSize</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l00253">ExAllocatePoolWithTag</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l00144">POOL_RAISE_IF_ALLOCATION_FAILURE</a>, <a class="el" href="../../d9/d4/seglobal_8c-source.html#l00229">SepDoublePrivilegeSet</a>, <a class="el" href="../../d9/d4/seglobal_8c-source.html#l00227">SepSystemSecurityPrivilegeSet</a>, <a class="el" href="../../d9/d4/seglobal_8c-source.html#l00228">SepTakeOwnershipPrivilegeSet</a>, and <a class="el" href="../../d9/d4/seglobal_8c-source.html#l00224">SinglePrivilegeSetSize</a>.
<p>
Referenced by <a class="el" href="../../d1/d3/accessck_8c-source.html#l01564">SepAccessCheck()</a>.
<p>
<pre class="fragment"><div>01079                    :
01080 
01081     This routine takes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> results of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> various privilege checks
01082     in <a class="code" href="../../d0/d5/se_8h.html#a135">SeAccessCheck</a> and returns an appropriate privilege set.
01083 
01084 Arguments:
01085 
01086     PrivilegeCount - The number of privileges granted.
01087 
01088     SystemSecurity - Provides a <span class="keywordtype">boolean</span> indicating whether to put
01089         <a class="code" href="../../d0/d5/se_8h.html#a85">SeSecurityPrivilege</a> into <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> output privilege set.
01090 
01091     WriteOwner - Provides a <span class="keywordtype">boolean</span> indicating whether to put
01092         <a class="code" href="../../d0/d5/se_8h.html#a86">SeTakeOwnershipPrivilege</a> into <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> output privilege set.
01093 
01094     Privileges - Supplies a pointer that will <span class="keywordflow">return</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> privilege
01095         set.  Should be freed with <a class="code" href="../../d6/d3/cmwraper_8c.html#a26">ExFreePool</a> when no longer needed.
01096 
01097 Return Value:
01098 
01099     None.
01100 
01101 --*/
01102 {
01103     PPRIVILEGE_SET PrivilegeSet;
01104     ULONG SizeRequired;
01105 
01106     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
01107 
01108     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( (PrivilegeCount != 0) &amp;&amp; (PrivilegeCount &lt;= 2) );
01109 
01110     <span class="keywordflow">if</span> ( !ARGUMENT_PRESENT( Privileges ) ) {
01111         <span class="keywordflow">return</span>;
01112     }
01113 
01114     <span class="keywordflow">if</span> ( PrivilegeCount == 1 ) {
01115 
01116         SizeRequired = <a class="code" href="../../d8/d5/seglobal_8c.html#a83">SinglePrivilegeSetSize</a>;
01117 
01118         <span class="keywordflow">if</span> ( SystemSecurity ) {
01119 
01120             PrivilegeSet = <a class="code" href="../../d8/d5/seglobal_8c.html#a85">SepSystemSecurityPrivilegeSet</a>;
01121 
01122         } <span class="keywordflow">else</span> {
01123 
01124             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( WriteOwner );
01125 
01126             PrivilegeSet = <a class="code" href="../../d8/d5/seglobal_8c.html#a86">SepTakeOwnershipPrivilegeSet</a>;
01127         }
01128 
01129     } <span class="keywordflow">else</span> {
01130 
01131         SizeRequired = <a class="code" href="../../d8/d5/seglobal_8c.html#a84">DoublePrivilegeSetSize</a>;
01132         PrivilegeSet = <a class="code" href="../../d8/d5/seglobal_8c.html#a87">SepDoublePrivilegeSet</a>;
01133     }
01134 
01135     *Privileges = <a class="code" href="../../d5/d8/ex_8h.html#a4">ExAllocatePoolWithTag</a>( PagedPool | POOL_RAISE_IF_ALLOCATION_FAILURE, SizeRequired, 'rPeS' );
01136 
01137     <span class="keywordflow">if</span> ( *Privileges != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
01138 
01139         RtlCopyMemory (
01140            *Privileges,
01141            PrivilegeSet,
01142            SizeRequired
01143            );
01144     }
01145 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a48" doxytag="sep.h::SepAuditAlarm" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN SepAuditAlarm           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap> <em>SubsystemName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>HandleId</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap> <em>ObjectTypeName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap> <em>ObjectName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSECURITY_DESCRIPTOR&nbsp;</td>
          <td class="mdname" nowrap> <em>SecurityDescriptor</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ACCESS_MASK&nbsp;</td>
          <td class="mdname" nowrap> <em>DesiredAccess</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>ObjectCreation</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ACCESS_MASK&nbsp;</td>
          <td class="mdname" nowrap> <em>GrantedAccess</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PBOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>GenerateOnClose</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a47" doxytag="sep.h::SepCheckAcl" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN SepCheckAcl           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PACL&nbsp;</td>
          <td class="mdname" nowrap> <em>Acl</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Length</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d5/sep_8c-source.html#l00036">36</a> of file <a class="el" href="../../d6/d5/sep_8c-source.html">sep.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, and <a class="el" href="../../d3/d3/acledit_8c-source.html#l00187">RtlValidAcl()</a>.
<p>
Referenced by <a class="el" href="../../d3/d4/se_2capture_8c-source.html#l01370">SeCaptureAcl()</a>, and <a class="el" href="../../d3/d4/se_2capture_8c-source.html#l00053">SeCaptureSecurityDescriptor()</a>.
<p>
<pre class="fragment"><div>00043                    :
00044 
00045     This <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> a <span class="keyword">private</span> routine that checks that an acl <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> well formed.
00046 
00047 Arguments:
00048 
00049     Acl - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> acl to check
00050 
00051     Length - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> real size of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> acl.  The internal acl size
00052         must agree.
00053 
00054 Return Value:
00055 
00056     BOOLEAN - <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> acl <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> well formed and <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> otherwise
00057 
00058 --*/
00059 {
00060     <span class="keywordflow">if</span> ((Length &lt; <span class="keyword">sizeof</span>(ACL)) || (Length != Acl-&gt;AclSize)) {
00061         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00062     }
00063     <span class="keywordflow">return</span> <a class="code" href="../../d2/d4/acledit_8c.html#a7">RtlValidAcl</a>( Acl );
00064 }
}
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a53" doxytag="sep.h::SepConcatenatePrivileges" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SepConcatenatePrivileges           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PPRIVILEGE_SET&nbsp;</td>
          <td class="mdname" nowrap> <em>TargetPrivilegeSet</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>TargetBufferSize</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PPRIVILEGE_SET&nbsp;</td>
          <td class="mdname" nowrap> <em>SourcePrivilegeSet</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/seastate_8c-source.html#l00543">543</a> of file <a class="el" href="../../d3/d4/seastate_8c-source.html">seastate.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d3/d4/seastate_8c-source.html#l00049">SEP_PRIVILEGE_SET_HEADER_SIZE</a>, and <a class="el" href="../../d7/d5/sep_8h-source.html#l00147">SepPrivilegeSetSize</a>.
<p>
Referenced by <a class="el" href="../../d3/d4/seastate_8c-source.html#l00434">SeAppendPrivileges()</a>.
<p>
<pre class="fragment"><div>00551                    :
00552 
00553     Takes two privilege sets and appends <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> second to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> end of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00554     first.
00555 
00556     There must be enough space left at <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> end of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> first privilege
00557     set to contain <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> second.
00558 
00559 Arguments:
00560 
00561     TargetPrivilegeSet - Supplies a buffer containing a privilege set.
00562         The buffer must be large enough to contain <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> second privilege
00563         set.
00564 
00565     TargetBufferSize - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> size of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> target buffer.
00566 
00567     SourcePrivilegeSet - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> privilege set to be copied
00568         into <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> target buffer.
00569 
00570 Return Value:
00571 
00572     None
00573 
00574 --*/
00575 
00576 {
00577     PVOID Base;
00578     PVOID Source;
00579     ULONG Length;
00580 
00581     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00582 
00583     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( ((ULONG)<a class="code" href="../../d6/d6/sep_8h.html#a6">SepPrivilegeSetSize</a>( TargetPrivilegeSet ) +
00584              (ULONG)<a class="code" href="../../d6/d6/sep_8h.html#a6">SepPrivilegeSetSize</a>( SourcePrivilegeSet ) -
00585              SEP_PRIVILEGE_SET_HEADER_SIZE  ) &lt;=
00586             TargetBufferSize
00587           );
00588 
00589     Base = (PVOID)((ULONG_PTR)TargetPrivilegeSet + <a class="code" href="../../d6/d6/sep_8h.html#a6">SepPrivilegeSetSize</a>( TargetPrivilegeSet ));
00590 
00591     Source = (PVOID) ((ULONG_PTR)SourcePrivilegeSet + <a class="code" href="../../d2/d5/seastate_8c.html#a1">SEP_PRIVILEGE_SET_HEADER_SIZE</a>);
00592 
00593     Length = SourcePrivilegeSet-&gt;PrivilegeCount * <span class="keyword">sizeof</span>(LUID_AND_ATTRIBUTES);
00594 
00595     RtlMoveMemory(
00596         Base,
00597         Source,
00598         Length
00599         );
00600 
00601     TargetPrivilegeSet-&gt;PrivilegeCount += SourcePrivilegeSet-&gt;PrivilegeCount;
00602 
00603 }
}
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a73" doxytag="sep.h::SepCopyProxyData" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS SepCopyProxyData           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">OUT PSECURITY_TOKEN_PROXY_DATA *&nbsp;</td>
          <td class="mdname" nowrap> <em>DestProxyData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSECURITY_TOKEN_PROXY_DATA&nbsp;</td>
          <td class="mdname" nowrap> <em>SourceProxyData</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/se_2capture_8c-source.html#l00681">681</a> of file <a class="el" href="../../d3/d4/se_2capture_8c-source.html">se/capture.c</a>.
<p>
References <a class="el" href="../../d6/d7/ex_8h-source.html#l00253">ExAllocatePoolWithTag</a>, <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, and <a class="el" href="../../d7/d5/nls_8c-source.html#l01763">RtlCopyUnicodeString()</a>.
<p>
Referenced by <a class="el" href="../../d5/d2/token_8c-source.html#l02213">SepCreateToken()</a>, <a class="el" href="../../d7/d2/tokendup_8c-source.html#l00362">SepDuplicateToken()</a>, <a class="el" href="../../d7/d2/tokendup_8c-source.html#l01939">SepFilterToken()</a>, and <a class="el" href="../../d3/d4/se_2capture_8c-source.html#l00773">SepProbeAndCaptureQosData()</a>.
<p>
<pre class="fragment"><div>00688                    :
00689 
00690     This routine copies a token proxy data structure from one token to another.
00691 
00692 Arguments:
00693 
00694     DestProxyData - Receives a pointer to a <span class="keyword">new</span> proxy data structure.
00695 
00696     SourceProxyData - Supplies a pointer to an already existing proxy data structure.
00697 
00698 Return Value:
00699 
00700     STATUS_INSUFFICIENT_RESOURCES on <a class="code" href="../../d8/d0/rtbatcr_8c.html#a1">failure</a>.
00701 
00702 --*/
00703 
00704 {
00705 
00706     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00707 
00708     *DestProxyData = <a class="code" href="../../d5/d8/ex_8h.html#a4">ExAllocatePoolWithTag</a>( PagedPool, <span class="keyword">sizeof</span>( SECURITY_TOKEN_PROXY_DATA ), 'dPoT' );
00709 
00710     <span class="keywordflow">if</span> (*DestProxyData == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00711         <span class="keywordflow">return</span>( STATUS_INSUFFICIENT_RESOURCES );
00712     }
00713 
00714 
00715 
00716     (*DestProxyData)-&gt;PathInfo.Buffer = <a class="code" href="../../d5/d8/ex_8h.html#a4">ExAllocatePoolWithTag</a>( PagedPool, SourceProxyData-&gt;PathInfo.Length, 'dPoT' );
00717 
00718     <span class="keywordflow">if</span> ((*DestProxyData)-&gt;PathInfo.Buffer == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00719         <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( *DestProxyData );
00720         *DestProxyData = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00721         <span class="keywordflow">return</span>( STATUS_INSUFFICIENT_RESOURCES );
00722     }
00723 
00724     (*DestProxyData)-&gt;Length = SourceProxyData-&gt;Length;
00725     (*DestProxyData)-&gt;ProxyClass = SourceProxyData-&gt;ProxyClass;
00726     (*DestProxyData)-&gt;PathInfo.MaximumLength =
00727         (*DestProxyData)-&gt;PathInfo.Length = SourceProxyData-&gt;PathInfo.Length;
00728     (*DestProxyData)-&gt;ContainerMask = SourceProxyData-&gt;ContainerMask;
00729     (*DestProxyData)-&gt;ObjectMask = SourceProxyData-&gt;ObjectMask;
00730 
00731     <a class="code" href="../../d6/d6/nls_8c.html#a44">RtlCopyUnicodeString</a>( &amp;(*DestProxyData)-&gt;PathInfo, &amp;SourceProxyData-&gt;PathInfo );
00732 
00733     <span class="keywordflow">return</span>( STATUS_SUCCESS );
00734 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a63" doxytag="sep.h::SepCopyString" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SepCopyString           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap> <em>SourceString</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PUNICODE_STRING *&nbsp;</td>
          <td class="mdname" nowrap> <em>DestString</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a39" doxytag="sep.h::SepCreateToken" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS SepCreateToken           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">OUT PHANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>TokenHandle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>RequestorMode</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ACCESS_MASK&nbsp;</td>
          <td class="mdname" nowrap> <em>DesiredAccess</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN POBJECT_ATTRIBUTES <a class="el" href="../../d8/d0/ctlpcqos_8c.html#a1">ObjectAttributes</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN TOKEN_TYPE&nbsp;</td>
          <td class="mdname" nowrap> <em>TokenType</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN SECURITY_IMPERSONATION_LEVEL ImpersonationLevel&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PLUID&nbsp;</td>
          <td class="mdname" nowrap> <em>AuthenticationId</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PLARGE_INTEGER&nbsp;</td>
          <td class="mdname" nowrap> <em>ExpirationTime</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSID_AND_ATTRIBUTES&nbsp;</td>
          <td class="mdname" nowrap> <em>User</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>GroupCount</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSID_AND_ATTRIBUTES&nbsp;</td>
          <td class="mdname" nowrap> <em>Groups</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>GroupsLength</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>PrivilegeCount</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PLUID_AND_ATTRIBUTES&nbsp;</td>
          <td class="mdname" nowrap> <em>Privileges</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>PrivilegesLength</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSID <a class="el" href="../../d2/d1/cttoken_8c.html#a53">Owner</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSID&nbsp;</td>
          <td class="mdname" nowrap> <em>PrimaryGroup</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PACL DefaultDacl&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PTOKEN_SOURCE&nbsp;</td>
          <td class="mdname" nowrap> <em>TokenSource</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>SystemToken</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSECURITY_TOKEN_PROXY_DATA ProxyData&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSECURITY_TOKEN_AUDIT_DATA AuditData&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d2/token_8c-source.html#l02213">2213</a> of file <a class="el" href="../../d5/d2/token_8c-source.html">token.c</a>.
<p>
References <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00126">ALIGN_UP</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l03024">ExAllocateLocallyUniqueId</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00126">ExAllocatePool</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l00253">ExAllocatePoolWithTag</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00168">_OBJECT_TYPE_INITIALIZER::GenericMapping</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d9/obcreate_8c-source.html#l00055">ObCreateObject()</a>, <a class="el" href="../../d7/d9/obcreate_8c-source.html#l00713">ObDeleteCapturedInsertInfo()</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00494">ObDereferenceObject</a>, <a class="el" href="../../d2/d0/obinsert_8c-source.html#l00029">ObInsertObject()</a>, <a class="el" href="../../d8/d9/ctlnpqos_8c-source.html#l00027">ObjectAttributes</a>, <a class="el" href="../../d7/d9/ctaccess_8c-source.html#l00159">Owner</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, <a class="el" href="../../d6/d2/parseini_8c-source.html#l00038">PTOKEN</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l01380">RtlCopySid()</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l01436">RtlCopySidAndAttributesArray()</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l01824">RtlEqualLuid()</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l00871">RtlEqualSid()</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l01030">RtlLengthRequiredSid()</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01630">SeAliasAdminsSid</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01691">SeChangeNotifyPrivilege</a>, <a class="el" href="../../d3/d4/seastate_8c-source.html#l00180">SeCreateAccessState()</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01670">SeCreateTokenPrivilege</a>, <a class="el" href="../../d3/d4/seastate_8c-source.html#l00348">SeDeleteAccessState()</a>, <a class="el" href="../../d9/d2/tokenp_8h-source.html#l00479">SepArrayGroupAttributes</a>, <a class="el" href="../../d3/d4/se_2capture_8c-source.html#l00681">SepCopyProxyData()</a>, <a class="el" href="../../d0/d9/rmlogon_8c-source.html#l00384">SepDeReferenceLogonSession()</a>, <a class="el" href="../../d0/d9/rmlogon_8c-source.html#l00278">SepReferenceLogonSession()</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01212">SepTokenObjectType</a>, <a class="el" href="../../d9/d3/privileg_8c-source.html#l00436">SeSinglePrivilegeCheck()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d7/d9/ctaccess_8c-source.html#l00123">Token</a>, <a class="el" href="../../d9/d2/tokenp_8h-source.html#l00124">TOKEN_DEFAULT_DYNAMIC_CHARGE</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l00075">TOKEN_HAS_ADMIN_GROUP</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l00072">TOKEN_HAS_TRAVERSE_PRIVILEGE</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00196">_OBJECT_TYPE::TypeInfo</a>, and <a class="el" href="../../d0/d9/ntosdef_8h.html#a76a70">UserMode</a>.
<p>
Referenced by <a class="el" href="../../d5/d2/token_8c-source.html#l01690">NtCreateToken()</a>, <a class="el" href="../../d5/d2/token_8c-source.html#l01010">SeMakeAnonymousLogonToken()</a>, and <a class="el" href="../../d5/d2/token_8c-source.html#l00536">SeMakeSystemToken()</a>.
<p>
<pre class="fragment"><div>02240                    :
02241 
02242     <a class="code" href="../../d4/d5/conimep_8h.html#a111">Create</a> a token object and <span class="keywordflow">return</span> a handle opened <span class="keywordflow">for</span> access to
02243     that token.  This API implements <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> bulk of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> work needed
02244     <span class="keywordflow">for</span> <a class="code" href="../../d4/d3/token_8c.html#a15">NtCreateToken</a>.
02245 
02246     All parameters except DesiredAccess and <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a> are assumed
02247     to have been probed and captured.
02248 
02249     The output parameter (TokenHandle) is expected to be returned to a
02250     safe address, rather than to a user mode address that may cause an
02251     exception.
02252 
02253     !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
02254     NOTE: This routine is also used to create the initial system token.
02255           In that case, the SystemToken parameter is TRUE and no handle
02256           is established to the token.  Instead, a pointer to the token
02257           is returned via the TokenHandle parameter.
02258     !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
02259 
02260 
02261 Arguments:
02262 
02263     TokenHandle - Receives the handle of the newly created token.  If the
02264         SystemToken parameter is specified is true, then this parameter
02265         receives a pointer to the token instead of a handle to the token.
02266 
02267     RequestorMode - The mode of the caller on whose behalf the token
02268         is being created.
02269 
02270     DesiredAccess - Is an access mask indicating which access types
02271         the handle is to provide to the new object.
02272 
02273     ObjectAttributes - Points to the standard object attributes data
02274         structure.  Refer to the NT Object Management
02275         Specification for a description of this data structure.
02276 
02277     TokenType - Type of token to be created.  Privilege is required
02278         to create any type of token.
02279 
02280     ImpersonationLevel - If the token type is TokenImpersonation, then
02281         this parameter is used to specify the impersonation level of
02282         the token.
02283 
02284     AuthenticationId - Points to a LUID (or LUID) providing a unique
02285         identifier associated with the authentication.  This is used
02286         within security only, for audit purposes.
02287 
02288     ExpirationTime - Time at which the token becomes invalid.  If this
02289         value is specified as zero, then the token has no expiration
02290         time.
02291 
02292     User - Is the user SID to place in the token.
02293 
02294     GroupCount - Indicates the number of groups in the 'Groups' parameter.
02295         This value may be zero, in which case the 'Groups' parameter is
02296         ignored.
02297 
02298     Groups - Are the group SIDs, and their corresponding attributes,
02299         to place in the token.
02300 
02301     GroupsLength - Indicates the length, in bytes, of the array of groups
02302         to place in the token.
02303 
02304     PrivilegeCount - Indicates the number of privileges in the 'Privileges'
02305         parameter.  This value may be zero, in which case the 'Privileges'
02306         parameter is ignored.
02307 
02308     Privileges - Are the privilege LUIDs, and their corresponding attributes,
02309         to place in the token.
02310 
02311     PrivilegesLength - Indicates the length, in bytes, of the array of
02312         privileges to place in the token.
02313 
02314     Owner - (Optionally) identifies an identifier that is to be used
02315         as the default owner for the token.  If not provided, the
02316         user ID is made the default owner.
02317 
02318     PrimaryGroup - Identifies which of the group IDs is to be the
02319         primary group of the token.
02320 
02321     DefaultDacl - (optionally) establishes an ACL to be used as the
02322         default discretionary access protection for the token.
02323 
02324     TokenSource - Identifies the token source name string and
02325         identifier to be assigned to the token.
02326 
02327 Return Value:
02328 
02329     STATUS_SUCCESS - Indicates the operation was successful.
02330 
02331     STATUS_INVALID_OWNER - Indicates the ID provided to be assigned
02332         as the default owner of the token does not have an attribute
02333         indicating it may be assigned as an owner.
02334 
02335     STATUS_INVALID_PRIMARY_GROUP - Indicates the group ID provided
02336         via the PrimaryGroup parameter was not among those assigned
02337         to the token in the Groups parameter.
02338 
02339     STATUS_INVALID_PARAMETER - Indicates that a required parameter,
02340         such as User or PrimaryGroup, was not provided with a legitimate
02341         value.
02342 
02343 --*/
02344 
02345 {
02346 
02347     <a class="code" href="../../d5/d3/parseini_8c.html#a4">PTOKEN</a> <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>;
02348     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
02349 
02350     ULONG PagedPoolSize;
02351 
02352     ULONG PrimaryGroupLength;
02353 
02354     ULONG TokenBodyLength;
02355     ULONG VariableLength;
02356 
02357     ULONG DefaultOwnerIndex;
02358     PUCHAR Where ;
02359     ULONG ComputedPrivLength ;
02360 
02361     <span class="comment">//ULONG_PTR NextFree;</span>
02362     PSID NextSidFree;
02363 
02364     ULONG DynamicLength = <a class="code" href="../../d8/d3/tokenp_8h.html#a3">TOKEN_DEFAULT_DYNAMIC_CHARGE</a>;
02365     ULONG DynamicLengthUsed;
02366 
02367     ULONG SubAuthorityCount;
02368     ULONG GroupIndex;
02369     ULONG PrivilegeIndex;
02370     BOOLEAN OwnerFound;
02371 
02372     UCHAR TokenFlags = 0;
02373 
02374     <a class="code" href="../../d2/d5/struct__ACCESS__STATE.html">ACCESS_STATE</a> AccessState;
02375     <a class="code" href="../../d5/d2/struct__AUX__ACCESS__DATA.html">AUX_ACCESS_DATA</a> AuxData;
02376     LUID NewModifiedId;
02377 
02378     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
02379 
02380     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( <span class="keyword">sizeof</span>(SECURITY_IMPERSONATION_LEVEL) &lt;= <span class="keyword">sizeof</span>(ULONG) );
02381 
02382     <span class="comment">//</span>
02383     <span class="comment">// Make sure the Enabled and Enabled-by-default bits are set on every</span>
02384     <span class="comment">// mandatory group.</span>
02385     <span class="comment">//</span>
02386     <span class="comment">// Also, check to see if the local administrators alias is present.</span>
02387     <span class="comment">// if so, turn on the flag so that we can do restrictions later</span>
02388     <span class="comment">//</span>
02389 
02390     <span class="keywordflow">for</span> (GroupIndex=0; GroupIndex &lt; GroupCount; GroupIndex++) {
02391         <span class="keywordflow">if</span> (Groups[GroupIndex].Attributes &amp; SE_GROUP_MANDATORY) {
02392             Groups[GroupIndex].Attributes |= (SE_GROUP_ENABLED | SE_GROUP_ENABLED_BY_DEFAULT);
02393         }
02394         <span class="keywordflow">if</span> ( <a class="code" href="../../d8/d6/sertl_8c.html#a36">RtlEqualSid</a>( SeAliasAdminsSid, Groups[GroupIndex].Sid ) )
02395         {
02396             TokenFlags |= <a class="code" href="../../d0/d5/se_8h.html#a4">TOKEN_HAS_ADMIN_GROUP</a> ;
02397         }
02398     }
02399 
02400     <span class="comment">//</span>
02401     <span class="comment">// Check to see if the token being created is going to be granted</span>
02402     <span class="comment">// SeChangeNotifyPrivilege.  If so, set a flag in the TokenFlags field</span>
02403     <span class="comment">// so we can find this out quickly.</span>
02404     <span class="comment">//</span>
02405 
02406     <span class="keywordflow">for</span> (PrivilegeIndex = 0; PrivilegeIndex &lt; PrivilegeCount; PrivilegeIndex++) {
02407 
02408         <span class="keywordflow">if</span> (((<a class="code" href="../../d8/d6/sertl_8c.html#a50">RtlEqualLuid</a>(&amp;Privileges[PrivilegeIndex].Luid,&amp;SeChangeNotifyPrivilege))
02409                 &amp;&amp;
02410             (Privileges[PrivilegeIndex].Attributes &amp; SE_PRIVILEGE_ENABLED))) {
02411 
02412             TokenFlags |= <a class="code" href="../../d0/d5/se_8h.html#a1">TOKEN_HAS_TRAVERSE_PRIVILEGE</a>;
02413             <span class="keywordflow">break</span>;
02414         }
02415     }
02416 
02417 
02418     <span class="comment">//</span>
02419     <span class="comment">// Get a ModifiedId to use</span>
02420     <span class="comment">//</span>
02421 
02422     <a class="code" href="../../d5/d8/ex_8h.html#a79">ExAllocateLocallyUniqueId</a>( &amp;NewModifiedId );
02423 
02424     <span class="comment">//</span>
02425     <span class="comment">// Validate the owner ID, if provided and establish the default</span>
02426     <span class="comment">// owner index.</span>
02427     <span class="comment">//</span>
02428 
02429     <span class="keywordflow">if</span> (!ARGUMENT_PRESENT(Owner)) {
02430 
02431         DefaultOwnerIndex = 0;
02432 
02433     } <span class="keywordflow">else</span> {
02434 
02435 
02436         <span class="keywordflow">if</span> ( <a class="code" href="../../d8/d6/sertl_8c.html#a36">RtlEqualSid</a>( Owner, User-&gt;Sid )  ) {
02437 
02438             DefaultOwnerIndex = 0;
02439 
02440         } <span class="keywordflow">else</span> {
02441 
02442             GroupIndex = 0;
02443             OwnerFound = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02444 
02445             <span class="keywordflow">while</span> ((GroupIndex &lt; GroupCount) &amp;&amp; (!OwnerFound)) {
02446 
02447                 <span class="keywordflow">if</span> ( <a class="code" href="../../d8/d6/sertl_8c.html#a36">RtlEqualSid</a>( Owner, (Groups[GroupIndex].Sid) )  ) {
02448 
02449                     <span class="comment">//</span>
02450                     <span class="comment">// Found a match - make sure it is assignable as owner.</span>
02451                     <span class="comment">//</span>
02452 
02453                     <span class="keywordflow">if</span> ( <a class="code" href="../../d8/d3/tokenp_8h.html#a12">SepArrayGroupAttributes</a>( Groups, GroupIndex ) &amp;
02454                          SE_GROUP_OWNER ) {
02455 
02456                         DefaultOwnerIndex = GroupIndex + 1;
02457                         OwnerFound = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02458 
02459                     } <span class="keywordflow">else</span> {
02460 
02461                         <span class="keywordflow">return</span> STATUS_INVALID_OWNER;
02462 
02463                     } <span class="comment">// endif Owner attribute set</span>
02464 
02465                 } <span class="comment">// endif owner = group</span>
02466 
02467                 GroupIndex += 1;
02468 
02469             }  <span class="comment">// endwhile</span>
02470 
02471             <span class="keywordflow">if</span> (!OwnerFound) {
02472 
02473                 <span class="keywordflow">return</span> STATUS_INVALID_OWNER;
02474 
02475             } <span class="comment">// endif !OwnerFound</span>
02476         } <span class="comment">// endif owner = user</span>
02477     } <span class="comment">// endif owner specified</span>
02478 
02479 
02480 
02481     <span class="comment">//</span>
02482     <span class="comment">// Increment the reference count for this logon session</span>
02483     <span class="comment">// (fail if there is no corresponding logon session.)</span>
02484     <span class="comment">//</span>
02485 
02486     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d6/sep_8h.html#a40">SepReferenceLogonSession</a>( AuthenticationId );
02487     <span class="keywordflow">if</span> ( !<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status) ) {
02488         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
02489     }
02490 
02491 
02492 
02493 
02494     <span class="comment">//</span>
02495     <span class="comment">//  Calculate the length needed for the variable portion of the token</span>
02496     <span class="comment">//  This includes the User ID, Group IDs, and Privileges</span>
02497     <span class="comment">//</span>
02498     <span class="comment">//</span>
02499     <span class="comment">// Align the privilege chunk by pointer alignment so that the SIDs will</span>
02500     <span class="comment">// be correctly aligned.  Align the Groups Length so that the SID_AND_ATTR</span>
02501     <span class="comment">// array (which is</span>
02502     <span class="comment">//</span>
02503 
02504     ComputedPrivLength = PrivilegeCount * <span class="keyword">sizeof</span>( LUID_AND_ATTRIBUTES ) ;
02505 
02506     ComputedPrivLength = <a class="code" href="../../d0/d9/ntosdef_8h.html#a4">ALIGN_UP</a>( ComputedPrivLength, PVOID );
02507 
02508     GroupsLength = <a class="code" href="../../d0/d9/ntosdef_8h.html#a4">ALIGN_UP</a>( GroupsLength, PVOID );
02509 
02510 
02511     VariableLength  = GroupsLength + ComputedPrivLength +
02512                        <a class="code" href="../../d0/d9/ntosdef_8h.html#a4">ALIGN_UP</a>( (GroupCount * <span class="keyword">sizeof</span>( SID_AND_ATTRIBUTES )), PVOID ) ;
02513 
02514     SubAuthorityCount = ((SID *)(User-&gt;Sid))-&gt;SubAuthorityCount;
02515     VariableLength += <span class="keyword">sizeof</span>(SID_AND_ATTRIBUTES) +
02516                       (ULONG)LongAlignSize(<a class="code" href="../../d8/d6/sertl_8c.html#a38">RtlLengthRequiredSid</a>( SubAuthorityCount ));
02517 
02518 
02519 
02520     <span class="comment">//</span>
02521     <span class="comment">//  Calculate the length needed for the dynamic portion of the token</span>
02522     <span class="comment">//  This includes the default Dacl and the primary group.</span>
02523     <span class="comment">//</span>
02524 
02525     SubAuthorityCount = ((SID *)PrimaryGroup)-&gt;SubAuthorityCount;
02526     DynamicLengthUsed = (ULONG)LongAlignSize(<a class="code" href="../../d8/d6/sertl_8c.html#a38">RtlLengthRequiredSid</a>( SubAuthorityCount ));
02527 
02528     <span class="keywordflow">if</span> (ARGUMENT_PRESENT(DefaultDacl)) {
02529         DynamicLengthUsed += (ULONG)LongAlignSize(DefaultDacl-&gt;AclSize);
02530     }
02531 
02532     <span class="keywordflow">if</span> (DynamicLengthUsed &gt; DynamicLength) {
02533         DynamicLength = DynamicLengthUsed;
02534     }
02535 
02536     <span class="comment">//</span>
02537     <span class="comment">// Now create the token body</span>
02538     <span class="comment">//</span>
02539 
02540     TokenBodyLength = <span class="keyword">sizeof</span>(<a class="code" href="../../d8/d1/struct__TOKEN.html">TOKEN</a>) + VariableLength;
02541     PagedPoolSize = TokenBodyLength + DynamicLength;
02542 
02543 
02544     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d0/obcreate_8c.html#a5">ObCreateObject</a>(
02545                  RequestorMode,      <span class="comment">// ProbeMode</span>
02546                  SepTokenObjectType, <span class="comment">// ObjectType</span>
02547                  ObjectAttributes,   <span class="comment">// ObjectAttributes</span>
02548                  UserMode,           <span class="comment">// OwnershipMode</span>
02549                  NULL,               <span class="comment">// ParseContext</span>
02550                  TokenBodyLength,    <span class="comment">// ObjectBodySize</span>
02551                  PagedPoolSize,      <span class="comment">// PagedPoolCharge</span>
02552                  0,                  <span class="comment">// NonPagedPoolCharge</span>
02553                  (PVOID *)&amp;Token     <span class="comment">// Return pointer to object</span>
02554                  );
02555 
02556     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
02557         <a class="code" href="../../d6/d6/sep_8h.html#a41">SepDeReferenceLogonSession</a>( AuthenticationId );
02558         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
02559     }
02560 
02561     <span class="comment">//</span>
02562     <span class="comment">// After this point, we rely on token deletion to clean up the referenced</span>
02563     <span class="comment">// logon session if the creation fails.</span>
02564     <span class="comment">//</span>
02565 
02566 
02567     <span class="comment">//</span>
02568     <span class="comment">// Main Body initialization</span>
02569     <span class="comment">//</span>
02570 
02571 
02572     <a class="code" href="../../d5/d8/ex_8h.html#a79">ExAllocateLocallyUniqueId</a>( &amp;(<a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;TokenId) );
02573     <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;ParentTokenId = RtlConvertLongToLuid(0);
02574     <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;AuthenticationId = (*AuthenticationId);
02575     <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;TokenInUse = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02576     <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;ModifiedId = NewModifiedId;
02577     <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;ExpirationTime = (*ExpirationTime);
02578     <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;TokenType = TokenType;
02579     <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;ImpersonationLevel = ImpersonationLevel;
02580     <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;TokenSource = (*TokenSource);
02581 
02582     <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;TokenFlags = TokenFlags;
02583     <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;SessionId = 0;
02584 
02585     <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;DynamicCharged  = DynamicLength;
02586     <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;DynamicAvailable = DynamicLength - DynamicLengthUsed;
02587 
02588     <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;DefaultOwnerIndex = DefaultOwnerIndex;
02589     <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;DefaultDacl = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02590 
02591     <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;VariableLength = VariableLength;
02592 
02593     <span class="comment">// Ensure SepTokenDeleteMethod knows the buffers aren't allocated yet.</span>
02594     <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;ProxyData = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02595     <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;AuditData = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02596     <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;DynamicPart = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02597 
02598     <span class="keywordflow">if</span> (ARGUMENT_PRESENT( ProxyData )) {
02599 
02600         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d6/sep_8h.html#a73">SepCopyProxyData</a>(
02601                     &amp;<a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;ProxyData,
02602                     ProxyData
02603                     );
02604 
02605         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
02606             <a class="code" href="../../d4/d0/ob_8h.html#a14">ObDereferenceObject</a>( Token );
02607             <span class="keywordflow">return</span>( STATUS_NO_MEMORY );
02608         }
02609 
02610     } <span class="keywordflow">else</span> {
02611 
02612         <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;ProxyData = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02613     }
02614 
02615     <span class="keywordflow">if</span> (ARGUMENT_PRESENT( AuditData )) {
02616 
02617         <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;AuditData = <a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>( PagedPool, <span class="keyword">sizeof</span>( SECURITY_TOKEN_AUDIT_DATA ));
02618 
02619         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;AuditData == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02620             <a class="code" href="../../d4/d0/ob_8h.html#a14">ObDereferenceObject</a>( Token );
02621             <span class="keywordflow">return</span>( STATUS_NO_MEMORY );
02622         }
02623 
02624         *(<a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;AuditData) = *AuditData;
02625 
02626     } <span class="keywordflow">else</span> {
02627 
02628         <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;AuditData = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02629     }
02630 
02631 
02632     <span class="comment">//</span>
02633     <span class="comment">//  Variable part initialization</span>
02634     <span class="comment">//  Data is in the following order:</span>
02635     <span class="comment">//</span>
02636     <span class="comment">//               Privileges array</span>
02637     <span class="comment">//               User (SID_AND_ATTRIBUTES)</span>
02638     <span class="comment">//               Groups (SID_AND_ATTRIBUTES)</span>
02639     <span class="comment">//               Restricted Sids (SID_AND_ATTRIBUTES)</span>
02640     <span class="comment">//               SIDs</span>
02641     <span class="comment">//</span>
02642 
02643     Where = (PUCHAR) &amp; <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;VariablePart ;
02644 
02645     <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;Privileges = (PLUID_AND_ATTRIBUTES) Where ;
02646     <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;PrivilegeCount = PrivilegeCount ;
02647 
02648     RtlCopyMemory(
02649         Where,
02650         Privileges,
02651         PrivilegeCount * <span class="keyword">sizeof</span>(LUID_AND_ATTRIBUTES) );
02652 
02653     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( ComputedPrivLength &gt;= PrivilegeCount * <span class="keyword">sizeof</span>( LUID_AND_ATTRIBUTES ) );
02654 
02655     Where += ComputedPrivLength ;
02656     VariableLength -= ComputedPrivLength ;
02657 
02658     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( (((ULONG_PTR) Where ) &amp; (<span class="keyword">sizeof</span>(PVOID) - 1)) == 0 );
02659 
02660     <span class="comment">//</span>
02661     <span class="comment">// Now, copy the sid and attributes arrays.</span>
02662     <span class="comment">//</span>
02663 
02664     NextSidFree = (PSID) (Where + (<span class="keyword">sizeof</span>( SID_AND_ATTRIBUTES ) *
02665                                    (GroupCount + 1) ) );
02666 
02667     <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;UserAndGroups = (PSID_AND_ATTRIBUTES) Where ;
02668     <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;UserAndGroupCount = GroupCount + 1 ;
02669 
02670 
02671     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(VariableLength &gt;= ((GroupCount + 1) * (ULONG)<span class="keyword">sizeof</span>(SID_AND_ATTRIBUTES)));
02672 
02673     VariableLength -= ((GroupCount + 1) * (ULONG)<span class="keyword">sizeof</span>(SID_AND_ATTRIBUTES));
02674     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d8/d6/sertl_8c.html#a47">RtlCopySidAndAttributesArray</a>(
02675                  1,
02676                  User,
02677                  VariableLength,
02678                  (PSID_AND_ATTRIBUTES)Where,
02679                  NextSidFree,
02680                  &amp;NextSidFree,
02681                  &amp;VariableLength
02682                  );
02683 
02684     Where += <span class="keyword">sizeof</span>( SID_AND_ATTRIBUTES );
02685 
02686     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( (((ULONG_PTR) Where ) &amp; (<span class="keyword">sizeof</span>(PVOID) - 1)) == 0 );
02687 
02688     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d8/d6/sertl_8c.html#a47">RtlCopySidAndAttributesArray</a>(
02689                  GroupCount,
02690                  Groups,
02691                  VariableLength,
02692                  (PSID_AND_ATTRIBUTES)Where,
02693                  NextSidFree,
02694                  &amp;NextSidFree,
02695                  &amp;VariableLength
02696                  );
02697 
02698 
02699     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status));
02700 
02701 
02702     <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;RestrictedSids = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02703     <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;RestrictedSidCount = 0;
02704 
02705 
02706     <span class="comment">//</span>
02707     <span class="comment">//  Dynamic part initialization</span>
02708     <span class="comment">//  Data is in the following order:</span>
02709     <span class="comment">//</span>
02710     <span class="comment">//                  PrimaryGroup (SID)</span>
02711     <span class="comment">//                  Default Discreationary Acl (ACL)</span>
02712     <span class="comment">//</span>
02713 
02714     <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;DynamicPart = (PULONG)<a class="code" href="../../d5/d8/ex_8h.html#a4">ExAllocatePoolWithTag</a>( PagedPool, DynamicLength, 'dTeS' );
02715 
02716     <span class="comment">//</span>
02717     <span class="comment">// The attempt to allocate the DynamicPart of the token may have</span>
02718     <span class="comment">// failed.  Dereference the created object and exit with an error.</span>
02719     <span class="comment">//</span>
02720 
02721     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;DynamicPart == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02722         <a class="code" href="../../d4/d0/ob_8h.html#a14">ObDereferenceObject</a>( Token );
02723         <span class="keywordflow">return</span>( STATUS_NO_MEMORY );
02724     }
02725 
02726 
02727     Where = (PUCHAR) <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;DynamicPart;
02728 
02729     <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;PrimaryGroup = (PSID) Where;
02730     PrimaryGroupLength = <a class="code" href="../../d8/d6/sertl_8c.html#a38">RtlLengthRequiredSid</a>( ((SID *)PrimaryGroup)-&gt;SubAuthorityCount );
02731     <a class="code" href="../../d8/d6/sertl_8c.html#a46">RtlCopySid</a>( PrimaryGroupLength, (PSID)Where, PrimaryGroup );
02732     Where += (ULONG)LongAlignSize(PrimaryGroupLength);
02733 
02734     <span class="keywordflow">if</span> (ARGUMENT_PRESENT(DefaultDacl)) {
02735         <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;DefaultDacl = (PACL)Where;
02736 
02737         RtlCopyMemory( (PVOID)Where,
02738                       (PVOID)DefaultDacl,
02739                       DefaultDacl-&gt;AclSize
02740                       );
02741     }
02742 
02743 <span class="preprocessor">#ifdef TOKEN_DEBUG</span>
02744 <span class="preprocessor"></span>
02745 <span class="comment">//</span>
02746 <span class="comment">// Debug</span>
02747     SepDumpToken( Token );
02748 <span class="comment">// Debug</span>
02749 <span class="comment">//</span>
02751 <span class="comment"></span><span class="preprocessor">#endif //TOKEN_DEBUG</span>
02752 <span class="preprocessor"></span>
02753 
02754     <span class="comment">//</span>
02755     <span class="comment">//  Insert the token unless it is a system token.</span>
02756     <span class="comment">//</span>
02757 
02758     <span class="keywordflow">if</span> (!SystemToken) {
02759 
02760         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d5/seastate_8c.html#a2">SeCreateAccessState</a>(
02761                      &amp;AccessState,
02762                      &amp;AuxData,
02763                      DesiredAccess,
02764                      &amp;<a class="code" href="../../d0/d5/se_8h.html#a36">SepTokenObjectType</a>-&gt;<a class="code" href="../../d3/d6/struct__OBJECT__TYPE.html#o9">TypeInfo</a>.<a class="code" href="../../d5/d6/struct__OBJECT__TYPE__INITIALIZER.html#o4">GenericMapping</a>
02765                      );
02766 
02767         <span class="keywordflow">if</span> ( <a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status) ) {
02768             BOOLEAN PrivilegeHeld;
02769 
02770             PrivilegeHeld = <a class="code" href="../../d8/d4/privileg_8c.html#a3">SeSinglePrivilegeCheck</a>(
02771                             SeCreateTokenPrivilege,
02772                             KeGetPreviousMode()
02773                             );
02774 
02775             <span class="keywordflow">if</span> (PrivilegeHeld) {
02776 
02777                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d1/d1/obinsert_8c.html#a0">ObInsertObject</a>( Token,
02778                                          &amp;AccessState,
02779                                          0,
02780                                          0,
02781                                          (PVOID *)NULL,
02782                                          TokenHandle
02783                                          );
02784 
02785             } <span class="keywordflow">else</span> {
02786 
02787                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_PRIVILEGE_NOT_HELD;
02788                 <a class="code" href="../../d4/d0/ob_8h.html#a14">ObDereferenceObject</a>( Token );
02789             }
02790 
02791             <a class="code" href="../../d2/d5/seastate_8c.html#a3">SeDeleteAccessState</a>( &amp;AccessState );
02792 
02793         } <span class="keywordflow">else</span> {
02794 
02795             <a class="code" href="../../d4/d0/ob_8h.html#a14">ObDereferenceObject</a>( Token );
02796         }
02797     } <span class="keywordflow">else</span> {
02798 
02799         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( <a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status ) );
02800         <a class="code" href="../../d6/d0/obcreate_8c.html#a10">ObDeleteCapturedInsertInfo</a>(Token);
02801         <span class="comment">//</span>
02802         <span class="comment">// Return pointer instead of handle.</span>
02803         <span class="comment">//</span>
02804 
02805         (*TokenHandle) = (HANDLE)<a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>;
02806     }
02807 
02808     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
02809 
02810 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a41" doxytag="sep.h::SepDeReferenceLogonSession" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SepDeReferenceLogonSession           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PLUID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>LogonId</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d9/rmlogon_8c-source.html#l00384">384</a> of file <a class="el" href="../../d0/d9/rmlogon_8c-source.html">rmlogon.c</a>.
<p>
References <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d2/d9/rmp_8h-source.html#l00131">_SEP_LOGON_SESSION_REFERENCES::Flags</a>, <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00070">KeBugCheck()</a>, <a class="el" href="../../d2/d9/rmp_8h-source.html#l00129">_SEP_LOGON_SESSION_REFERENCES::LogonId</a>, <a class="el" href="../../d2/d9/rmp_8h-source.html#l00128">_SEP_LOGON_SESSION_REFERENCES::Next</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00645">PsGetCurrentThread</a>, <a class="el" href="../../d2/d9/rmp_8h-source.html#l00130">_SEP_LOGON_SESSION_REFERENCES::ReferenceCount</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l01824">RtlEqualLuid()</a>, <a class="el" href="../../d2/d9/rmp_8h-source.html#l00134">SEP_TERMINATION_NOTIFY</a>, <a class="el" href="../../d0/d9/rmlogon_8c-source.html#l01049">SepInformFileSystemsOfDeletedLogon()</a>, <a class="el" href="../../d0/d9/rmlogon_8c-source.html#l00777">SepInformLsaOfDeletedLogon()</a>, <a class="el" href="../../d0/d9/rmlogon_8c-source.html#l00109">SepLogonSessionIndex</a>, <a class="el" href="../../d2/d9/rmp_8h-source.html#l00229">SepLogonSessions</a>, <a class="el" href="../../d2/d9/rmp_8h-source.html#l00060">SepRmAcquireDbWriteLock</a>, and <a class="el" href="../../d2/d9/rmp_8h-source.html#l00066">SepRmReleaseDbWriteLock</a>.
<p>
Referenced by <a class="el" href="../../d5/d2/token_8c-source.html#l02213">SepCreateToken()</a>, <a class="el" href="../../d7/d2/tokendup_8c-source.html#l00362">SepDuplicateToken()</a>, <a class="el" href="../../d7/d2/tokendup_8c-source.html#l01939">SepFilterToken()</a>, and <a class="el" href="../../d5/d2/token_8c-source.html#l02156">SepTokenDeleteMethod()</a>.
<p>
<pre class="fragment"><div>00390                    :
00391 
00392     This routine decrements <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> reference count of a logon session
00393     tracking record.
00394 
00395     If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> reference count <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> decremented to zero, then there <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> no
00396     possibility <span class="keywordflow">for</span> any more tokens to exist <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> logon session.
00397     In <span class="keyword">this</span> <span class="keywordflow">case</span>, <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> LSA <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> notified that a logon session has
00398     terminated.
00399 
00400 
00401 
00402 Arguments:
00403 
00404     LogonId - Pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> logon session <a class="code" href="../../d4/d9/smbtrsup_8c.html#a7">ID</a> whose logon track <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
00405         to be decremented.
00406 
00407 Return Value:
00408 
00409     None.
00410 
00411 --*/
00412 
00413 {
00414 
00415     ULONG SessionArrayIndex;
00416     <a class="code" href="../../d6/d1/struct__SEP__LOGON__SESSION__REFERENCES.html">PSEP_LOGON_SESSION_REFERENCES</a> Previous, Current;
00417 
00418 <span class="preprocessor">#ifdef SEP_TRACK_LOGON_SESSION_REFS</span>
00419 <span class="preprocessor"></span>    ULONG Refs;
00420 <span class="preprocessor">#endif //SEP_TRACK_LOGON_SESSION_REFS</span>
00421 <span class="preprocessor"></span>
00422     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00423 
00424     SessionArrayIndex = <a class="code" href="../../d9/d9/rmlogon_8c.html#a0">SepLogonSessionIndex</a>( LogonId );
00425 
00426     <span class="comment">//</span>
00427     <span class="comment">// Protect modification of reference monitor database</span>
00428     <span class="comment">//</span>
00429 
00430     <a class="code" href="../../d1/d0/rmp_8h.html#a3">SepRmAcquireDbWriteLock</a>();
00431 
00432 
00433     <span class="comment">//</span>
00434     <span class="comment">// Now walk the list for our logon session array hash index.</span>
00435     <span class="comment">//</span>
00436 
00437     Previous = (<a class="code" href="../../d6/d1/struct__SEP__LOGON__SESSION__REFERENCES.html">PSEP_LOGON_SESSION_REFERENCES</a>)
00438                ((PVOID)&amp;<a class="code" href="../../d1/d0/rmp_8h.html#a22">SepLogonSessions</a>[ SessionArrayIndex ]);
00439     Current = Previous-&gt;<a class="code" href="../../d6/d1/struct__SEP__LOGON__SESSION__REFERENCES.html#o0">Next</a>;
00440 
00441     <span class="keywordflow">while</span> (Current != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00442 
00443         <span class="comment">//</span>
00444         <span class="comment">// If we found it, decrement the reference count and return</span>
00445         <span class="comment">//</span>
00446 
00447         <span class="keywordflow">if</span> (<a class="code" href="../../d8/d6/sertl_8c.html#a50">RtlEqualLuid</a>( LogonId, &amp;Current-&gt;<a class="code" href="../../d6/d1/struct__SEP__LOGON__SESSION__REFERENCES.html#o1">LogonId</a>) ) {
00448             Current-&gt;<a class="code" href="../../d6/d1/struct__SEP__LOGON__SESSION__REFERENCES.html#o2">ReferenceCount</a> -= 1;
00449             <span class="keywordflow">if</span> (Current-&gt;<a class="code" href="../../d6/d1/struct__SEP__LOGON__SESSION__REFERENCES.html#o2">ReferenceCount</a> == 0) {
00450 
00451                 <span class="comment">//</span>
00452                 <span class="comment">// Pull it from the list</span>
00453                 <span class="comment">//</span>
00454 
00455                 Previous-&gt;<a class="code" href="../../d6/d1/struct__SEP__LOGON__SESSION__REFERENCES.html#o0">Next</a> = Current-&gt;<a class="code" href="../../d6/d1/struct__SEP__LOGON__SESSION__REFERENCES.html#o0">Next</a>;
00456 
00457 
00458                 <span class="comment">//</span>
00459                 <span class="comment">// No longer need to protect our pointer to this</span>
00460                 <span class="comment">// record.</span>
00461                 <span class="comment">//</span>
00462 
00463                 <a class="code" href="../../d1/d0/rmp_8h.html#a5">SepRmReleaseDbWriteLock</a>();
00464 
00465                 <span class="comment">//</span>
00466                 <span class="comment">// Asynchronoously inform file systems that this logon session</span>
00467                 <span class="comment">// is going away, if atleast one FS expressed interest in this</span>
00468                 <span class="comment">// logon session.</span>
00469                 <span class="comment">//</span>
00470 
00471                 <span class="keywordflow">if</span> (Current-&gt;<a class="code" href="../../d6/d1/struct__SEP__LOGON__SESSION__REFERENCES.html#o3">Flags</a> &amp; <a class="code" href="../../d1/d0/rmp_8h.html#a8">SEP_TERMINATION_NOTIFY</a>) {
00472                     <a class="code" href="../../d9/d9/rmlogon_8c.html#a6">SepInformFileSystemsOfDeletedLogon</a>( LogonId );
00473                 }
00474 
00475                 <span class="comment">//</span>
00476                 <span class="comment">// Deallocate the logon session track record.</span>
00477                 <span class="comment">//</span>
00478 
00479                 <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( (PVOID)Current );
00480 
00481 
00482 <span class="preprocessor">#ifdef SEP_TRACK_LOGON_SESSION_REFS</span>
00483 <span class="preprocessor"></span>            <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"SE (rm): -- ** logon session: (%d, %d) to ZERO by (%d, %d)\n"</span>,
00484                       LogonId-&gt;HighPart, LogonId-&gt;LowPart,
00485                       <a class="code" href="../../d1/d9/ps_8h.html#a20">PsGetCurrentThread</a>()-&gt;Cid.UniqueProcess,
00486                       <a class="code" href="../../d1/d9/ps_8h.html#a20">PsGetCurrentThread</a>()-&gt;Cid.UniqueThread);
00487 
00488 <span class="preprocessor">#endif //SEP_TRACK_LOGON_SESSION_REFS</span>
00489 <span class="preprocessor"></span>
00490                 <span class="comment">//</span>
00491                 <span class="comment">// Inform the LSA about the deletion of this logon session.</span>
00492                 <span class="comment">//</span>
00493 
00494                 <a class="code" href="../../d9/d9/rmlogon_8c.html#a5">SepInformLsaOfDeletedLogon</a>( LogonId );
00495 
00496 
00497 
00498                 <span class="keywordflow">return</span>;
00499 
00500             }
00501 
00502             <span class="comment">//</span>
00503             <span class="comment">// reference count was incremented, but not to zero.</span>
00504             <span class="comment">//</span>
00505 
00506 <span class="preprocessor">#ifdef SEP_TRACK_LOGON_SESSION_REFS</span>
00507 <span class="preprocessor"></span>            Refs = Current-&gt;<a class="code" href="../../d6/d1/struct__SEP__LOGON__SESSION__REFERENCES.html#o2">ReferenceCount</a>;
00508 <span class="preprocessor">#endif //SEP_TRACK_LOGON_SESSION_REFS</span>
00509 <span class="preprocessor"></span>
00510             <a class="code" href="../../d1/d0/rmp_8h.html#a5">SepRmReleaseDbWriteLock</a>();
00511 
00512 <span class="preprocessor">#ifdef SEP_TRACK_LOGON_SESSION_REFS</span>
00513 <span class="preprocessor"></span>            <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"SE (rm): -- logon session: (%d, %d) to %d by (%d, %d)\n"</span>,
00514                       LogonId-&gt;HighPart, LogonId-&gt;LowPart, Refs,
00515                       <a class="code" href="../../d1/d9/ps_8h.html#a20">PsGetCurrentThread</a>()-&gt;Cid.UniqueProcess,
00516                       <a class="code" href="../../d1/d9/ps_8h.html#a20">PsGetCurrentThread</a>()-&gt;Cid.UniqueThread);
00517 <span class="preprocessor">#endif //SEP_TRACK_LOGON_SESSION_REFS</span>
00518 <span class="preprocessor"></span>
00519             <span class="keywordflow">return</span>;
00520         }
00521 
00522         Previous = Current;
00523         Current = Current-&gt;<a class="code" href="../../d6/d1/struct__SEP__LOGON__SESSION__REFERENCES.html#o0">Next</a>;
00524     }
00525 
00526     <a class="code" href="../../d1/d0/rmp_8h.html#a5">SepRmReleaseDbWriteLock</a>();
00527 
00528     <span class="comment">//</span>
00529     <span class="comment">// Bad news, someone asked us to decrement the reference count of</span>
00530     <span class="comment">// a logon session we didn't know existed.</span>
00531     <span class="comment">//</span>
00532 
00533     <a class="code" href="../../d9/d1/bugcheck_8c.html#a13">KeBugCheck</a>( DEREF_UNKNOWN_LOGON_SESSION );
00534 
00535     <span class="keywordflow">return</span>;
00536 
00537 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a35" doxytag="sep.h::SepDevelopmentTest" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN SepDevelopmentTest           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d0/d5/seinit_8c-source.html#l00184">SepInitializationPhase1()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a57" doxytag="sep.h::SepDumpSecurityDescriptor" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SepDumpSecurityDescriptor           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PSECURITY_DESCRIPTOR&nbsp;</td>
          <td class="mdname" nowrap> <em>SecurityDescriptor</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSZ&nbsp;</td>
          <td class="mdname" nowrap> <em>TitleString</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d4/seassign_8c-source.html#l00650">650</a> of file <a class="el" href="../../d2/d4/seassign_8c-source.html">seassign.c</a>.
<p>
References <a class="el" href="../../d7/d9/ctaccess_8c-source.html#l00161">Dacl</a>, <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d7/d9/ctaccess_8c-source.html#l00160">Group</a>, <a class="el" href="../../d7/d9/ctaccess_8c-source.html#l00159">Owner</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d2/d4/seassign_8c-source.html#l00762">SepPrintAcl()</a>, and <a class="el" href="../../d2/d4/seassign_8c-source.html#l00916">SepPrintSid()</a>.
<p>
Referenced by <a class="el" href="../../d1/d3/accessck_8c-source.html#l03323">SeAccessCheck()</a>, <a class="el" href="../../d2/d4/seassign_8c-source.html#l00089">SeAssignSecurity()</a>, <a class="el" href="../../d2/d4/seassign_8c-source.html#l00228">SeAssignSecurityEx()</a>, and <a class="el" href="../../d1/d3/accessck_8c-source.html#l01564">SepAccessCheck()</a>.
<p>
<pre class="fragment"><div>00657                    :
00658 
00659     Private routine to dump a security descriptor to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> debug
00660     screen.
00661 
00662 Arguments:
00663 
00664     SecurityDescriptor - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> security descriptor to be dumped.
00665 
00666     TitleString - <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> null terminated string to <a class="code" href="../../d0/d1/rtdeltre_8c.html#a5">print</a> before dumping
00667         <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> security descriptor.
00668 
00669 
00670 Return Value:
00671 
00672     None.
00673 
00674 
00675 --*/
00676 {
00677 <span class="preprocessor">#if DBG</span>
00678 <span class="preprocessor"></span>    PISECURITY_DESCRIPTOR ISecurityDescriptor;
00679     UCHAR Revision;
00680     SECURITY_DESCRIPTOR_CONTROL Control;
00681     PSID <a class="code" href="../../d6/d0/ctaccess_8c.html#a53">Owner</a>;
00682     PSID <a class="code" href="../../d6/d0/ctaccess_8c.html#a54">Group</a>;
00683     PACL Sacl;
00684     PACL <a class="code" href="../../d6/d0/ctaccess_8c.html#a55">Dacl</a>;
00685 
00686     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00687 
00688 
00689     <span class="keywordflow">if</span> (!SepDumpSD) {
00690         <span class="keywordflow">return</span>;
00691     }
00692 
00693     <span class="keywordflow">if</span> (!ARGUMENT_PRESENT( SecurityDescriptor )) {
00694         <span class="keywordflow">return</span>;
00695     }
00696 
00697     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(TitleString);
00698 
00699     ISecurityDescriptor = ( PISECURITY_DESCRIPTOR )SecurityDescriptor;
00700 
00701     Revision = ISecurityDescriptor-&gt;Revision;
00702     Control  = ISecurityDescriptor-&gt;Control;
00703 
00704     <a class="code" href="../../d6/d0/ctaccess_8c.html#a53">Owner</a>    = RtlpOwnerAddrSecurityDescriptor( ISecurityDescriptor );
00705     <a class="code" href="../../d6/d0/ctaccess_8c.html#a54">Group</a>    = RtlpGroupAddrSecurityDescriptor( ISecurityDescriptor );
00706     Sacl     = RtlpSaclAddrSecurityDescriptor( ISecurityDescriptor );
00707     <a class="code" href="../../d6/d0/ctaccess_8c.html#a55">Dacl</a>     = RtlpDaclAddrSecurityDescriptor( ISecurityDescriptor );
00708 
00709     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"\nSECURITY DESCRIPTOR\n"</span>);
00710 
00711     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Revision = %d\n"</span>,Revision);
00712 
00713     <span class="comment">//</span>
00714     <span class="comment">// Print control info</span>
00715     <span class="comment">//</span>
00716 
00717     <span class="keywordflow">if</span> (Control &amp; SE_OWNER_DEFAULTED) {
00718         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Owner defaulted\n"</span>);
00719     }
00720     <span class="keywordflow">if</span> (Control &amp; SE_GROUP_DEFAULTED) {
00721         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Group defaulted\n"</span>);
00722     }
00723     <span class="keywordflow">if</span> (Control &amp; SE_DACL_PRESENT) {
00724         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Dacl present\n"</span>);
00725     }
00726     <span class="keywordflow">if</span> (Control &amp; SE_DACL_DEFAULTED) {
00727         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Dacl defaulted\n"</span>);
00728     }
00729     <span class="keywordflow">if</span> (Control &amp; SE_SACL_PRESENT) {
00730         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Sacl present\n"</span>);
00731     }
00732     <span class="keywordflow">if</span> (Control &amp; SE_SACL_DEFAULTED) {
00733         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Sacl defaulted\n"</span>);
00734     }
00735     <span class="keywordflow">if</span> (Control &amp; SE_SELF_RELATIVE) {
00736         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Self relative\n"</span>);
00737     }
00738     <span class="keywordflow">if</span> (Control &amp; SE_DACL_UNTRUSTED) {
00739         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Dacl untrusted\n"</span>);
00740     }
00741     <span class="keywordflow">if</span> (Control &amp; SE_SERVER_SECURITY) {
00742         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Server security\n"</span>);
00743     }
00744 
00745     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Owner "</span>);
00746     <a class="code" href="../../d6/d6/sep_8h.html#a56">SepPrintSid</a>( Owner );
00747 
00748     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Group "</span>);
00749     <a class="code" href="../../d6/d6/sep_8h.html#a56">SepPrintSid</a>( Group );
00750 
00751     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Sacl"</span>);
00752     <a class="code" href="../../d6/d6/sep_8h.html#a55">SepPrintAcl</a>( Sacl );
00753 
00754     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Dacl"</span>);
00755     <a class="code" href="../../d6/d6/sep_8h.html#a55">SepPrintAcl</a>( Dacl );
00756 <span class="preprocessor">#endif</span>
00757 <span class="preprocessor"></span>}

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a60" doxytag="sep.h::SepDumpString" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SepDumpString           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PUNICODE_STRING&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>String</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/adtutil_8c-source.html#l00036">36</a> of file <a class="el" href="../../d3/d4/adtutil_8c-source.html">adtutil.c</a>.
<p>
References <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, and <a class="el" href="../../d5/d8/talloc_8c-source.html#l00027">String</a>.
<p>
<pre class="fragment"><div>00040 {
00041     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00042 
00043     <span class="keywordflow">if</span> ( <a class="code" href="../../d4/d9/talloc_8c.html#a0">String</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00044         KdPrint((<span class="stringliteral">"&lt;NULL&gt;"</span>));
00045         <span class="keywordflow">return</span>;
00046     }
00047 
00048     KdPrint((<span class="stringliteral">"%Z"</span>,<a class="code" href="../../d4/d9/talloc_8c.html#a0">String</a>-&gt;Buffer));
00049 
00050 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a59" doxytag="sep.h::SepDumpTokenInfo" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SepDumpTokenInfo           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PACCESS_TOKEN&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Token</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d4/seassign_8c-source.html#l00995">995</a> of file <a class="el" href="../../d2/d4/seassign_8c-source.html">seassign.c</a>.
<p>
References <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d6/d2/parseini_8c-source.html#l00038">PTOKEN</a>, <a class="el" href="../../d2/d4/seassign_8c-source.html#l00916">SepPrintSid()</a>, and <a class="el" href="../../d7/d9/ctaccess_8c-source.html#l00123">Token</a>.
<p>
Referenced by <a class="el" href="../../d1/d3/accessck_8c-source.html#l03323">SeAccessCheck()</a>, <a class="el" href="../../d1/d3/accessck_8c-source.html#l01564">SepAccessCheck()</a>, <a class="el" href="../../d1/d3/accessck_8c-source.html#l00733">SepSidInToken()</a>, and <a class="el" href="../../d1/d3/accessck_8c-source.html#l00856">SepSidInTokenEx()</a>.
<p>
<pre class="fragment"><div>01001                    :
01002 
01003     Prints interesting information in a token.
01004 
01005 Arguments:
01006 
01007     <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a> - Provides <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> token to be examined.
01008 
01009 
01010 Return Value:
01011 
01012     None.
01013 
01014 --*/
01015 
01016 {
01017 <span class="preprocessor">#if DBG</span>
01018 <span class="preprocessor"></span>    ULONG UserAndGroupCount;
01019     PSID_AND_ATTRIBUTES TokenSid;
01020     ULONG i;
01021     <a class="code" href="../../d5/d3/parseini_8c.html#a4">PTOKEN</a> IToken;
01022 
01023     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
01024 
01025     <span class="keywordflow">if</span> (!SepDumpToken) {
01026         <span class="keywordflow">return</span>;
01027     }
01028 
01029     IToken = (<a class="code" href="../../d8/d1/struct__TOKEN.html">TOKEN</a> *)<a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>;
01030 
01031     UserAndGroupCount = IToken-&gt;UserAndGroupCount;
01032 
01033     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"\n\nToken Address=%lx\n"</span>,IToken);
01034     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Token User and Groups Array:\n\n"</span>);
01035 
01036     <span class="keywordflow">for</span> ( i = 0 , TokenSid = IToken-&gt;UserAndGroups;
01037           i &lt; UserAndGroupCount ;
01038           i++, TokenSid++
01039         ) {
01040 
01041         <a class="code" href="../../d6/d6/sep_8h.html#a56">SepPrintSid</a>( TokenSid-&gt;Sid );
01042 
01043         }
01044 
01045     <span class="keywordflow">if</span> ( IToken-&gt;RestrictedSids ) {
01046         UserAndGroupCount = IToken-&gt;RestrictedSidCount;
01047 
01048         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Restricted Sids Array:\n\n"</span>);
01049 
01050         <span class="keywordflow">for</span> ( i = 0 , TokenSid = IToken-&gt;RestrictedSids;
01051               i &lt; UserAndGroupCount ;
01052               i++, TokenSid++
01053             ) {
01054 
01055             <a class="code" href="../../d6/d6/sep_8h.html#a56">SepPrintSid</a>( TokenSid-&gt;Sid );
01056 
01057             }
01058     }
01059 <span class="preprocessor">#endif</span>
01060 <span class="preprocessor"></span>}

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a62" doxytag="sep.h::SepExamineSacl" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SepExamineSacl           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PACL&nbsp;</td>
          <td class="mdname" nowrap> <em>Sacl</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PACCESS_TOKEN&nbsp;</td>
          <td class="mdname" nowrap> <em>Token</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ACCESS_MASK&nbsp;</td>
          <td class="mdname" nowrap> <em>DesiredAccess</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>AccessGranted</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PBOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>GenerateAudit</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PBOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>GenerateAlarm</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d4/seaudit_8c-source.html#l03952">3952</a> of file <a class="el" href="../../d4/d4/seaudit_8c-source.html">seaudit.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d0/rtdmpsec_8c-source.html#l00053">FirstAce</a>, <a class="el" href="../../d5/d0/rtdmpsec_8c-source.html#l00059">NextAce</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d1/d3/accessck_8c-source.html#l00733">SepSidInToken()</a>, <a class="el" href="../../d7/d9/ctaccess_8c-source.html#l00123">Token</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d4/d4/seaudit_8c-source.html#l02072">NtOpenObjectAuditAlarm()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l03538">SeCreateObjectAuditAlarm()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l03660">SeObjectReferenceAuditAlarm()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l02765">SeOpenObjectAuditAlarm()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l03085">SeOpenObjectForDeleteAuditAlarm()</a>, and <a class="el" href="../../d4/d4/seaudit_8c-source.html#l03429">SeTraverseAuditAlarm()</a>.
<p>
<pre class="fragment"><div>03963                    :
03964 
03965     This routine will examine <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> passed Sacl and determine what
03966     <span class="keywordflow">if</span> any action <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> required based its contents.
03967 
03968     Note that <span class="keyword">this</span> routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not aware of any system state, ie,
03969     whether or not auditing <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> currently enabled <span class="keywordflow">for</span> either <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
03970     system or <span class="keyword">this</span> particular object <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a>.
03971 
03972 Arguments:
03973 
03974     Sacl - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Sacl to be examined.
03975 
03976     <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a> - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> effective token of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller
03977 
03978     AccessGranted - Supplies whether or not <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> access attempt
03979         was successful.
03980 
03981     GenerateAudit - Returns a <span class="keywordtype">boolean</span> indicating whether or not
03982         we should generate an audit.
03983 
03984     GenerateAlarm - Returns a <span class="keywordtype">boolean</span> indiciating whether or not
03985         we should generate an alarm.
03986 
03987 Return Value:
03988 
03989     STATUS_SUCCESS - The operation completed successfully.
03990 
03991 --*/
03992 
03993 {
03994 
03995     ULONG i;
03996     PVOID Ace;
03997     ULONG AceCount;
03998     ACCESS_MASK AccessMask;
03999     UCHAR AceFlags;
04000     BOOLEAN FailedMaximumAllowed;
04001 
04002     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
04003 
04004     *GenerateAudit = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
04005     *GenerateAlarm = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
04006 
04007     <span class="comment">//</span>
04008     <span class="comment">// If we failed an attempt to open an object for ONLY maximumum allowed,</span>
04009     <span class="comment">// then we generate an audit if ANY ACCESS_DENIED audit matching this</span>
04010     <span class="comment">// user's list of sids is found</span>
04011     <span class="comment">//</span>
04012 
04013     FailedMaximumAllowed = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
04014     <span class="keywordflow">if</span> (!AccessGranted &amp;&amp; (DesiredAccess &amp; MAXIMUM_ALLOWED)) {
04015         FailedMaximumAllowed = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
04016     }
04017 
04018     <span class="comment">//</span>
04019     <span class="comment">// If the Sacl is null, do nothing and return</span>
04020     <span class="comment">//</span>
04021 
04022     <span class="keywordflow">if</span> (Sacl == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
04023 
04024         <span class="keywordflow">return</span>;
04025     }
04026 
04027     AceCount = Sacl-&gt;AceCount;
04028 
04029     <span class="keywordflow">if</span> (AceCount == 0) {
04030         <span class="keywordflow">return</span>;
04031     }
04032 
04033     <span class="comment">//</span>
04034     <span class="comment">// Iterate through the ACEs on the Sacl until either we reach</span>
04035     <span class="comment">// the end or discover that we have to take all possible actions,</span>
04036     <span class="comment">// in which case it doesn't pay to look any further</span>
04037     <span class="comment">//</span>
04038 
04039     <span class="keywordflow">for</span> ( i = 0, Ace = <a class="code" href="../../d4/d1/rtdmpsec_8c.html#a1">FirstAce</a>( Sacl ) ;
04040           (i &lt; AceCount) &amp;&amp; !(*GenerateAudit &amp;&amp; *GenerateAlarm);
04041           i++, Ace = <a class="code" href="../../d4/d1/rtdmpsec_8c.html#a2">NextAce</a>( Ace ) ) {
04042 
04043         <span class="keywordflow">if</span> ( !(((PACE_HEADER)Ace)-&gt;AceFlags &amp; INHERIT_ONLY_ACE)) {
04044 
04045              <span class="keywordflow">if</span> ( (((PACE_HEADER)Ace)-&gt;AceType == SYSTEM_AUDIT_ACE_TYPE) ) {
04046 
04047                 <span class="keywordflow">if</span> ( <a class="code" href="../../d6/d6/sep_8h.html#a61">SepSidInToken</a>( (PACCESS_TOKEN)Token, NULL, &amp;((PSYSTEM_AUDIT_ACE)Ace)-&gt;SidStart, FALSE ) ) {
04048 
04049                     AccessMask = ((PSYSTEM_AUDIT_ACE)Ace)-&gt;Mask;
04050                     AceFlags   = ((PACE_HEADER)Ace)-&gt;AceFlags;
04051 
04052                     <span class="keywordflow">if</span> ( AccessMask &amp; DesiredAccess ) {
04053 
04054                         <span class="keywordflow">if</span> (((AceFlags &amp; SUCCESSFUL_ACCESS_ACE_FLAG) &amp;&amp; AccessGranted) ||
04055                               ((AceFlags &amp; FAILED_ACCESS_ACE_FLAG) &amp;&amp; !AccessGranted)) {
04056 
04057                             *GenerateAudit = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
04058                         }
04059                     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( FailedMaximumAllowed &amp;&amp; (AceFlags &amp; FAILED_ACCESS_ACE_FLAG) ) {
04060                             *GenerateAudit = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
04061                     }
04062                 }
04063 
04064                  <span class="keywordflow">continue</span>;
04065              }
04066 
04067              <span class="keywordflow">if</span> ( (((PACE_HEADER)Ace)-&gt;AceType == SYSTEM_ALARM_ACE_TYPE) ) {
04068 
04069                 <span class="keywordflow">if</span> ( <a class="code" href="../../d6/d6/sep_8h.html#a61">SepSidInToken</a>( (PACCESS_TOKEN)Token, NULL, &amp;((PSYSTEM_ALARM_ACE)Ace)-&gt;SidStart, FALSE ) ) {
04070 
04071                     AccessMask = ((PSYSTEM_ALARM_ACE)Ace)-&gt;Mask;
04072 
04073                     <span class="keywordflow">if</span> ( AccessMask &amp; DesiredAccess ) {
04074 
04075                         AceFlags   = ((PACE_HEADER)Ace)-&gt;AceFlags;
04076 
04077                         <span class="keywordflow">if</span> (((AceFlags &amp; SUCCESSFUL_ACCESS_ACE_FLAG) &amp;&amp; AccessGranted) ||
04078                               ((AceFlags &amp; FAILED_ACCESS_ACE_FLAG) &amp;&amp; !AccessGranted)) {
04079 
04080                             *GenerateAlarm = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
04081                         }
04082                     }
04083                 }
04084             }
04085         }
04086     }
04087 
04088     <span class="keywordflow">return</span>;
04089 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a67" doxytag="sep.h::SepFilterPrivilegeAudits" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN SepFilterPrivilegeAudits           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PPRIVILEGE_SET&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>PrivilegeSet</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d4/seaudit_8c-source.html#l04587">4587</a> of file <a class="el" href="../../d4/d4/seaudit_8c-source.html">seaudit.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l01824">RtlEqualLuid()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l04520">SepFilterPrivileges</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d4/d4/seaudit_8c-source.html#l02765">SeOpenObjectAuditAlarm()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l03085">SeOpenObjectForDeleteAuditAlarm()</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l00125">SepAdtPrivilegeObjectAuditAlarm()</a>, and <a class="el" href="../../d4/d4/seaudit_8c-source.html#l00989">SePrivilegedServiceAuditAlarm()</a>.
<p>
<pre class="fragment"><div>04593                    :
04594 
04595     This routine will filter <a class="code" href="../../d6/d0/wsprintf_8c.html#a0">out</a> a list of privileges as listed in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
04596     <a class="code" href="../../d3/d5/seaudit_8c.html#a2">SepFilterPrivileges</a> array.
04597 
04598 Arguments:
04599 
04600     Privileges - The privilege set to be audited
04601 
04602 Return Value:
04603 
04604     <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> means that <span class="keyword">this</span> use of privilege <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not to be audited.
04605     <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> means that <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> audit should <span class="keywordflow">continue</span> normally.
04606 
04607 --*/
04608 
04609 {
04610     PLUID *Privilege;
04611     ULONG Match = 0;
04612     ULONG i;
04613 
04614     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
04615 
04616     <span class="keywordflow">if</span> ( !ARGUMENT_PRESENT(PrivilegeSet) ||
04617         (PrivilegeSet-&gt;PrivilegeCount == 0) ) {
04618         <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> );
04619     }
04620 
04621     <span class="keywordflow">for</span> (i=0; i&lt;PrivilegeSet-&gt;PrivilegeCount; i++) {
04622 
04623         Privilege = <a class="code" href="../../d3/d5/seaudit_8c.html#a2">SepFilterPrivileges</a>;
04624 
04625         <span class="keywordflow">do</span> {
04626 
04627             <span class="keywordflow">if</span> ( <a class="code" href="../../d8/d6/sertl_8c.html#a50">RtlEqualLuid</a>( &amp;PrivilegeSet-&gt;Privilege[i].Luid, *Privilege )) {
04628 
04629                 Match++;
04630                 <span class="keywordflow">break</span>;
04631             }
04632 
04633         } <span class="keywordflow">while</span> ( *++Privilege != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>  );
04634     }
04635 
04636     <span class="keywordflow">if</span> ( Match == PrivilegeSet-&gt;PrivilegeCount ) {
04637 
04638         <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> );
04639 
04640     } <span class="keywordflow">else</span> {
04641 
04642         <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> );
04643     }
04644 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a74" doxytag="sep.h::SepFreeProxyData" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SepFreeProxyData           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PSECURITY_TOKEN_PROXY_DATA&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>ProxyData</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/se_2capture_8c-source.html#l00737">737</a> of file <a class="el" href="../../d3/d4/se_2capture_8c-source.html">se/capture.c</a>.
<p>
References <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>.
<p>
Referenced by <a class="el" href="../../d3/d4/se_2capture_8c-source.html#l00953">SeCaptureSecurityQos()</a>, <a class="el" href="../../d3/d4/se_2capture_8c-source.html#l00910">SeFreeCapturedSecurityQos()</a>, <a class="el" href="../../d7/d2/tokendup_8c-source.html#l00362">SepDuplicateToken()</a>, <a class="el" href="../../d7/d2/tokendup_8c-source.html#l01939">SepFilterToken()</a>, <a class="el" href="../../d3/d4/se_2capture_8c-source.html#l00773">SepProbeAndCaptureQosData()</a>, and <a class="el" href="../../d5/d2/token_8c-source.html#l02156">SepTokenDeleteMethod()</a>.
<p>
<pre class="fragment"><div>00743                    :
00744 
00745     This routine frees a SECURITY_TOKEN_PROXY_DATA structure and all sub structures.
00746 
00747 Arguments:
00748 
00749     ProxyData - Supplies a pointer to an existing proxy data structure.
00750 
00751 Return Value:
00752 
00753     None.
00754 
00755 --*/
00756 {
00757     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00758 
00759     <span class="keywordflow">if</span> (ProxyData != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00760 
00761         <span class="keywordflow">if</span> (ProxyData-&gt;PathInfo.Buffer != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00762             <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( ProxyData-&gt;PathInfo.Buffer );
00763         }
00764 
00765         <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( ProxyData );
00766     }
00767 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a43" doxytag="sep.h::SepFreeSubjectContext" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SepFreeSubjectContext           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">PSECURITY_SUBJECT_CONTEXT</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>SubjectContext</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a44" doxytag="sep.h::SepGetDefaultsSubjectContext" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SepGetDefaultsSubjectContext           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">PSECURITY_SUBJECT_CONTEXT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>SubjectContext</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PSID *&nbsp;</td>
          <td class="mdname" nowrap> <em>Owner</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PSID *&nbsp;</td>
          <td class="mdname" nowrap> <em>Group</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PSID *&nbsp;</td>
          <td class="mdname" nowrap> <em>ServerOwner</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PSID *&nbsp;</td>
          <td class="mdname" nowrap> <em>ServerGroup</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PACL *&nbsp;</td>
          <td class="mdname" nowrap> <em>Dacl</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d7/subject_8c-source.html#l00234">234</a> of file <a class="el" href="../../d1/d7/subject_8c-source.html">subject.c</a>.
<p>
References <a class="el" href="../../d7/d5/sep_8h-source.html#l00165">EffectiveToken</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d7/d9/ctaccess_8c-source.html#l00126">PrimaryToken</a>, and <a class="el" href="../../d6/d2/parseini_8c-source.html#l00038">PTOKEN</a>.
<p>
Referenced by <a class="el" href="../../d9/d5/sertl_8c-source.html#l09057">RtlpNewSecurityObject()</a>, and <a class="el" href="../../d9/d5/sertl_8c-source.html#l10195">RtlpSetSecurityObject()</a>.
<p>
<pre class="fragment"><div>00244                    :
00245 
00246     This routine retrieves pointers to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keywordflow">default</span> owner, primary group,
00247     and, <span class="keywordflow">if</span> present, discretionary ACL of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> provided subject security
00248     context.
00249 
00250 Arguments:
00251 
00252     SubjectContext - Points to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> subject security context whose <span class="keywordflow">default</span>
00253         values are to be retrieved.
00254 
00255     <a class="code" href="../../d6/d0/ctaccess_8c.html#a53">Owner</a> - Receives a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> subject's <span class="keywordflow">default</span> owner SID.  This
00256         value will always be returned as a non-zero pointer.  That <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>,
00257         a subject's security context must contain a owner SID.
00258 
00259     <a class="code" href="../../d6/d0/ctaccess_8c.html#a54">Group</a> - Receives a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> subject's <span class="keywordflow">default</span> primary group SID.
00260         This value will always be returned as a non-zero pointer.  That <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>,
00261         a subject's security context must contain a primary group.
00262 
00263     <a class="code" href="../../d6/d0/ctaccess_8c.html#a55">Dacl</a> - Receives a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> subject's <span class="keywordflow">default</span> discretionary ACL,
00264         <span class="keywordflow">if</span> one <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> define <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> subject.  Note that a subject security context
00265         does not have to include a <span class="keywordflow">default</span> discretionary ACL.  In <span class="keyword">this</span> <span class="keywordflow">case</span>,
00266         <span class="keyword">this</span> value will be returned as <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>.
00267 
00268 
00269 
00270 
00271 Return Value:
00272 
00273     none.
00274 
00275 --*/
00276 
00277 {
00278     <a class="code" href="../../d5/d3/parseini_8c.html#a4">PTOKEN</a> <a class="code" href="../../d6/d6/sep_8h.html#a7">EffectiveToken</a>;
00279     <a class="code" href="../../d5/d3/parseini_8c.html#a4">PTOKEN</a> <a class="code" href="../../d6/d0/ctaccess_8c.html#a31">PrimaryToken</a>;
00280 
00281     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00282 
00283     <span class="keywordflow">if</span> (ARGUMENT_PRESENT(SubjectContext-&gt;ClientToken)) {
00284         <a class="code" href="../../d6/d6/sep_8h.html#a7">EffectiveToken</a> = (<a class="code" href="../../d5/d3/parseini_8c.html#a4">PTOKEN</a>)SubjectContext-&gt;ClientToken;
00285     } <span class="keywordflow">else</span> {
00286         <a class="code" href="../../d6/d6/sep_8h.html#a7">EffectiveToken</a> = (<a class="code" href="../../d5/d3/parseini_8c.html#a4">PTOKEN</a>)SubjectContext-&gt;PrimaryToken;
00287     }
00288 
00289     (*Owner) = <a class="code" href="../../d6/d6/sep_8h.html#a7">EffectiveToken</a>-&gt;UserAndGroups[<a class="code" href="../../d6/d6/sep_8h.html#a7">EffectiveToken</a>-&gt;DefaultOwnerIndex].Sid;
00290 
00291     (*Group) = <a class="code" href="../../d6/d6/sep_8h.html#a7">EffectiveToken</a>-&gt;PrimaryGroup;
00292 
00293     (*Dacl)  = <a class="code" href="../../d6/d6/sep_8h.html#a7">EffectiveToken</a>-&gt;DefaultDacl;
00294 
00295     <a class="code" href="../../d6/d0/ctaccess_8c.html#a31">PrimaryToken</a> = (<a class="code" href="../../d5/d3/parseini_8c.html#a4">PTOKEN</a>)SubjectContext-&gt;PrimaryToken;
00296 
00297     *ServerOwner = <a class="code" href="../../d6/d0/ctaccess_8c.html#a31">PrimaryToken</a>-&gt;UserAndGroups[<a class="code" href="../../d6/d0/ctaccess_8c.html#a31">PrimaryToken</a>-&gt;DefaultOwnerIndex].Sid;
00298 
00299     *ServerGroup = <a class="code" href="../../d6/d0/ctaccess_8c.html#a31">PrimaryToken</a>-&gt;PrimaryGroup;
00300 
00301     <span class="keywordflow">return</span>;
00302 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a46" doxytag="sep.h::SepIdAssignableAsGroup" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN SepIdAssignableAsGroup           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PACCESS_TOKEN&nbsp;</td>
          <td class="mdname" nowrap> <em>Token</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSID&nbsp;</td>
          <td class="mdname" nowrap> <em>Group</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d7/subject_8c-source.html#l00306">306</a> of file <a class="el" href="../../d1/d7/subject_8c-source.html">subject.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d9/ctaccess_8c-source.html#l00160">Group</a>, <a class="el" href="../../d2/d9/cmchek_8c-source.html#l00095">Index</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d6/d2/parseini_8c-source.html#l00038">PTOKEN</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l00871">RtlEqualSid()</a>, <a class="el" href="../../d9/d2/tokenp_8h-source.html#l00413">SepAcquireTokenReadLock</a>, <a class="el" href="../../d9/d2/tokenp_8h-source.html#l00419">SepReleaseTokenReadLock</a>, and <a class="el" href="../../d7/d9/ctaccess_8c-source.html#l00123">Token</a>.
<p>
Referenced by <a class="el" href="../../d1/d3/tokenset_8c-source.html#l00037">NtSetInformationToken()</a>.
<p>
<pre class="fragment"><div>00312                    :
00313 
00314     This routine checks to see whether <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> provided SID <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> one that
00315     may be assigned to be <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keywordflow">default</span> primary group in a token.
00316 
00317     The current criteria <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> that <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> passed SID be a group in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00318     token, with no other restrictions.
00319 
00320 Arguments:
00321 
00322     <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a> - Points to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> token to be examined.
00323 
00324     <a class="code" href="../../d6/d0/ctaccess_8c.html#a54">Group</a> - Points to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> SID to be checked.
00325 
00326 Return Value:
00327 
00328     <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> - SID passed by be assigned as <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keywordflow">default</span> primary group in a token.
00329 
00330     <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> - Passed SID may not be so assigned.
00331 
00332 --*/
00333 
00334 {
00335     ULONG <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>;
00336     BOOLEAN Found = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00337     <a class="code" href="../../d5/d3/parseini_8c.html#a4">PTOKEN</a> <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>;
00338 
00339     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00340 
00341     <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a> = (<a class="code" href="../../d5/d3/parseini_8c.html#a4">PTOKEN</a>)AToken;
00342 
00343     <span class="comment">//</span>
00344     <span class="comment">// Let's make it invalid to assign a NULL primary group,</span>
00345     <span class="comment">// but we may need to revisit this.</span>
00346     <span class="comment">//</span>
00347 
00348     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d0/ctaccess_8c.html#a54">Group</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00349         <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> );
00350     }
00351 
00352     <a class="code" href="../../d8/d3/tokenp_8h.html#a6">SepAcquireTokenReadLock</a>( Token );
00353 
00354     <span class="comment">//</span>
00355     <span class="comment">//  Walk through the list of user and group IDs looking</span>
00356     <span class="comment">//  for a match to the specified SID.</span>
00357     <span class="comment">//</span>
00358 
00359     <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = 0;
00360     <span class="keywordflow">while</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> &lt; <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;UserAndGroupCount) {
00361 
00362         Found = <a class="code" href="../../d8/d6/sertl_8c.html#a36">RtlEqualSid</a>(
00363                     Group,
00364                     <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;UserAndGroups[Index].Sid
00365                     );
00366 
00367         <span class="keywordflow">if</span> ( Found ) {
00368             <span class="keywordflow">break</span>;
00369         }
00370 
00371         <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> += 1;
00372     }
00373 
00374     <a class="code" href="../../d8/d3/tokenp_8h.html#a8">SepReleaseTokenReadLock</a>( Token );
00375 
00376     <span class="keywordflow">return</span> Found;
00377 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a36" doxytag="sep.h::SepInitializationPhase0" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN SepInitializationPhase0           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/seinit_8c-source.html#l00078">78</a> of file <a class="el" href="../../d0/d5/seinit_8c-source.html">seinit.c</a>.
<p>
References <a class="el" href="../../d1/d7/luid_8c-source.html#l00037">ExLuidInitialization()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00643">PsGetCurrentProcess</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00645">PsGetCurrentThread</a>, <a class="el" href="../../d5/d2/token_8c-source.html#l00536">SeMakeSystemToken()</a>, <a class="el" href="../../d9/d4/seglobal_8c-source.html#l01152">SepInitializeWorkList()</a>, <a class="el" href="../../d1/d9/rmmain_8c-source.html#l01275">SepRmInitPhase0()</a>, <a class="el" href="../../d5/d2/token_8c-source.html#l01460">SepTokenInitialization()</a>, and <a class="el" href="../../d9/d4/seglobal_8c-source.html#l00307">SepVariableInitialization()</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/seinit_8c-source.html#l00041">SeInitSystem()</a>.
<p>
<pre class="fragment"><div>00082                    :
00083 
00084     Perform phase 0 security initialization.
00085 
00086     This includes:
00087 
00088         - Initialize LUID allocation
00089         - Initialize security global variables
00090         - initialize <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> token object.
00091         - Initialize <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> necessary security components of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> boot thread/process
00092 
00093 
00094 Arguments:
00095 
00096     None.
00097 
00098 Return Value:
00099 
00100     <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> - Initialization was successful.
00101 
00102     <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> - Initialization Failed.
00103 
00104 --*/
00105 
00106 {
00107 
00108     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00109 
00110     <span class="comment">//</span>
00111     <span class="comment">//  LUID allocation services are needed by security prior to phase 0</span>
00112     <span class="comment">//  Executive initialization.  So, LUID initialization is performed</span>
00113     <span class="comment">//  here</span>
00114     <span class="comment">//</span>
00115 
00116     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d8/ex_8h.html#a300">ExLuidInitialization</a>() == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00117         KdPrint((<span class="stringliteral">"Security: Locally Unique ID initialization failed.\n"</span>));
00118         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00119     }
00120 
00121     <span class="comment">//</span>
00122     <span class="comment">// Initialize security global variables</span>
00123     <span class="comment">//</span>
00124 
00125     <span class="keywordflow">if</span> (!<a class="code" href="../../d8/d5/seglobal_8c.html#a100">SepVariableInitialization</a>()) {
00126         KdPrint((<span class="stringliteral">"Security: Global variable initialization failed.\n"</span>));
00127         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00128     }
00129 
00130     <span class="comment">//</span>
00131     <span class="comment">// Perform Phase 0 Reference Monitor Initialization.</span>
00132     <span class="comment">//</span>
00133 
00134     <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/rmmain_8c.html#a7">SepRmInitPhase0</a>()) {
00135         KdPrint((<span class="stringliteral">"Security: Ref Mon state initialization failed.\n"</span>));
00136         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00137     }
00138 
00139     <span class="comment">//</span>
00140     <span class="comment">// Initialize the token object type.</span>
00141     <span class="comment">//</span>
00142 
00143     <span class="keywordflow">if</span> (!<a class="code" href="../../d8/d3/tokenp_8h.html#a35">SepTokenInitialization</a>()) {
00144         KdPrint((<span class="stringliteral">"Security: Token object initialization failed.\n"</span>));
00145         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00146     }
00147 
00148 <span class="comment">//    //</span>
00149 <span class="comment">//    // Initialize auditing structures</span>
00150 <span class="comment">//    //</span>
00151 <span class="comment">//</span>
00152 <span class="comment">//    if (!SepAdtInitializePhase0()) {</span>
00153 <span class="comment">//        KdPrint(("Security: Auditing initialization failed.\n"));</span>
00154 <span class="comment">//        return FALSE;</span>
00155 <span class="comment">//    }</span>
00156 <span class="comment">//</span>
00157     <span class="comment">//</span>
00158     <span class="comment">// Initialize SpinLock and list for the LSA worker thread</span>
00159     <span class="comment">//</span>
00160 
00161     <span class="comment">//</span>
00162     <span class="comment">// Initialize the work queue spinlock, list head, and semaphore</span>
00163     <span class="comment">// for each of the work queues.</span>
00164     <span class="comment">//</span>
00165 
00166     <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d6/sep_8h.html#a51">SepInitializeWorkList</a>()) {
00167         KdPrint((<span class="stringliteral">"Security: Unable to initialize work queue\n"</span>));
00168         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00169     }
00170 
00171     <span class="comment">//</span>
00172     <span class="comment">// Initialize the security fields of the boot thread.</span>
00173     <span class="comment">//</span>
00174 
00175     <a class="code" href="../../d1/d9/ps_8h.html#a19">PsGetCurrentProcess</a>()-&gt;Token = <a class="code" href="../../d0/d5/se_8h.html#a153">SeMakeSystemToken</a>();
00176     <a class="code" href="../../d1/d9/ps_8h.html#a20">PsGetCurrentThread</a>()-&gt;ImpersonationInfo = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00177     <a class="code" href="../../d1/d9/ps_8h.html#a20">PsGetCurrentThread</a>()-&gt;ActiveImpersonationInfo = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00178 
00179     <span class="keywordflow">return</span> ( <a class="code" href="../../d1/d9/ps_8h.html#a19">PsGetCurrentProcess</a>()-&gt;Token != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> );
00180 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a37" doxytag="sep.h::SepInitializationPhase1" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN SepInitializationPhase1           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/seinit_8c-source.html#l00184">184</a> of file <a class="el" href="../../d0/d5/seinit_8c-source.html">seinit.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00147">ASSERTMSG</a>, <a class="el" href="../../d7/d9/ctaccess_8c-source.html#l00161">Dacl</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00126">ExAllocatePool</a>, <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d9/d9/geninst_8c-source.html#l00154">Name</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d6/d9/obclose_8c-source.html#l00037">NtClose()</a>, <a class="el" href="../../d9/d9/obdir_8c-source.html#l00032">NtCreateDirectoryObject()</a>, <a class="el" href="../../d1/d7/ex_2event_8c-source.html#l00180">NtCreateEvent()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d8/d9/ctlnpqos_8c-source.html#l00027">ObjectAttributes</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d3/d3/acledit_8c-source.html#l01607">RtlAddAccessAllowedAce()</a>, <a class="el" href="../../d7/d5/nls_8c-source.html#l00082">RtlAnsiStringToUnicodeString()</a>, <a class="el" href="../../d3/d3/acledit_8c-source.html#l00099">RtlCreateAcl()</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l01945">RtlCreateSecurityDescriptor()</a>, <a class="el" href="../../d7/d5/nls_8c-source.html#l01215">RtlFreeUnicodeString()</a>, <a class="el" href="../../d3/d6/string_8c-source.html#l00056">RtlInitString()</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l02543">RtlSetDaclSecurityDescriptor()</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01630">SeAliasAdminsSid</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01645">SeAnonymousLogonToken</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01628">SeLocalSystemSid</a>, <a class="el" href="../../d0/d5/se_8h.html#a154">SeMakeAnonymousLogonToken()</a>, <a class="el" href="../../d0/d4/adtinit_8c-source.html#l00085">SepAdtInitializePhase1()</a>, <a class="el" href="../../d6/d6/sep_8h.html#a35">SepDevelopmentTest()</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01651">SePublicDefaultSd</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01609">SeWorldSid</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/seinit_8c-source.html#l00041">SeInitSystem()</a>.
<p>
<pre class="fragment"><div>00188                    :
00189 
00190     Perform phase 1 security initialization.
00191 
00192     This includes:
00193 
00194         - <a class="code" href="../../d4/d5/conimep_8h.html#a111">Create</a> an object directory <span class="keywordflow">for</span> security related objects.
00195           (\Security).
00196 
00197         - <a class="code" href="../../d4/d5/conimep_8h.html#a111">Create</a> an event to be signalled after <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> LSA has initialized.
00198           (\Security\LSA_Initialized)
00199 
00200 
00201 
00202 
00203 Arguments:
00204 
00205     None.
00206 
00207 Return Value:
00208 
00209     <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> - Initialization was successful.
00210 
00211     <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> - Initialization Failed.
00212 
00213 --*/
00214 
00215 {
00216 
00217     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00218     STRING <a class="code" href="../../d8/d0/geninst_8c.html#a20">Name</a>;
00219     UNICODE_STRING UnicodeName;
00220     OBJECT_ATTRIBUTES <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>;
00221     HANDLE SecurityRoot, TemporaryHandle;
00222     PSECURITY_DESCRIPTOR SD ;
00223     UCHAR SDBuffer[ SECURITY_DESCRIPTOR_MIN_LENGTH ];
00224     PACL <a class="code" href="../../d6/d0/ctaccess_8c.html#a55">Dacl</a> ;
00225 
00226     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00227 
00228     <a class="code" href="../../d0/d5/se_8h.html#a66">SeAnonymousLogonToken</a> = <a class="code" href="../../d0/d5/se_8h.html#a154">SeMakeAnonymousLogonToken</a>();
00229     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(SeAnonymousLogonToken != NULL);
00230 
00231     <span class="comment">//</span>
00232     <span class="comment">// Create the security object directory.</span>
00233     <span class="comment">//</span>
00234 
00235     <a class="code" href="../../d2/d7/string_8c.html#a5">RtlInitString</a>( &amp;Name, <span class="stringliteral">"\\Security"</span> );
00236     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d6/nls_8c.html#a21">RtlAnsiStringToUnicodeString</a>(
00237                  &amp;UnicodeName,
00238                  &amp;Name,
00239                  TRUE );  <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( <a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status) );
00240 
00241     <span class="comment">//</span>
00242     <span class="comment">// Build up the security descriptor</span>
00243     <span class="comment">//</span>
00244 
00245     SD = (PSECURITY_DESCRIPTOR) SDBuffer ;
00246 
00247     <a class="code" href="../../d8/d6/sertl_8c.html#a53">RtlCreateSecurityDescriptor</a>( SD,
00248                                  SECURITY_DESCRIPTOR_REVISION );
00249 
00250     <a class="code" href="../../d6/d0/ctaccess_8c.html#a55">Dacl</a> = <a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>(
00251                 NonPagedPool,
00252                 256 );
00253 
00254     <span class="keywordflow">if</span> ( !<a class="code" href="../../d6/d0/ctaccess_8c.html#a55">Dacl</a> )
00255     {
00256         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> ;
00257     }
00258 
00259     <a class="code" href="../../d2/d4/acledit_8c.html#a6">RtlCreateAcl</a>( Dacl, 256, ACL_REVISION );
00260 
00261     <a class="code" href="../../d2/d4/acledit_8c.html#a16">RtlAddAccessAllowedAce</a>( Dacl,
00262                             ACL_REVISION,
00263                             DIRECTORY_ALL_ACCESS,
00264                             SeLocalSystemSid );
00265 
00266     <a class="code" href="../../d2/d4/acledit_8c.html#a16">RtlAddAccessAllowedAce</a>( Dacl,
00267                             ACL_REVISION,
00268                             DIRECTORY_QUERY | DIRECTORY_TRAVERSE |
00269                                 READ_CONTROL,
00270                             SeAliasAdminsSid );
00271 
00272     <a class="code" href="../../d2/d4/acledit_8c.html#a16">RtlAddAccessAllowedAce</a>( Dacl,
00273                             ACL_REVISION,
00274                             DIRECTORY_TRAVERSE,
00275                             SeWorldSid );
00276 
00277     <a class="code" href="../../d8/d6/sertl_8c.html#a60">RtlSetDaclSecurityDescriptor</a>(
00278                             SD,
00279                             TRUE,
00280                             Dacl,
00281                             FALSE );
00282 
00283     InitializeObjectAttributes(
00284         &amp;ObjectAttributes,
00285         &amp;UnicodeName,
00286         (OBJ_PERMANENT | OBJ_CASE_INSENSITIVE),
00287         NULL,
00288         SD
00289         );
00290 
00291     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d8/d0/obdir_8c.html#a0">NtCreateDirectoryObject</a>(
00292                  &amp;SecurityRoot,
00293                  DIRECTORY_ALL_ACCESS,
00294                  &amp;ObjectAttributes
00295                  );
00296     <a class="code" href="../../d6/d6/nls_8c.html#a34">RtlFreeUnicodeString</a>( &amp;UnicodeName );
00297     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a8">ASSERTMSG</a>(<span class="stringliteral">"Security root object directory creation failed."</span>,<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status));
00298 
00299     <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( Dacl );
00300 
00301     <span class="comment">//</span>
00302     <span class="comment">// Create an event in the security directory</span>
00303     <span class="comment">//</span>
00304 
00305     <a class="code" href="../../d2/d7/string_8c.html#a5">RtlInitString</a>( &amp;Name, <span class="stringliteral">"LSA_AUTHENTICATION_INITIALIZED"</span> );
00306     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d6/nls_8c.html#a21">RtlAnsiStringToUnicodeString</a>(
00307                  &amp;UnicodeName,
00308                  &amp;Name,
00309                  TRUE );  <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( <a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status) );
00310     InitializeObjectAttributes(
00311         &amp;ObjectAttributes,
00312         &amp;UnicodeName,
00313         (OBJ_PERMANENT | OBJ_CASE_INSENSITIVE),
00314         SecurityRoot,
00315         SePublicDefaultSd
00316         );
00317 
00318     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d0/d8/ex_2event_8c.html#a5">NtCreateEvent</a>(
00319                  &amp;TemporaryHandle,
00320                  GENERIC_WRITE,
00321                  &amp;ObjectAttributes,
00322                  NotificationEvent,
00323                  FALSE
00324                  );
00325     <a class="code" href="../../d6/d6/nls_8c.html#a34">RtlFreeUnicodeString</a>( &amp;UnicodeName );
00326     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a8">ASSERTMSG</a>(<span class="stringliteral">"LSA Initialization Event Creation Failed."</span>,<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status));
00327 
00328     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>( SecurityRoot );
00329     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a8">ASSERTMSG</a>(<span class="stringliteral">"Security object directory handle closure Failed."</span>,<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status));
00330     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>( TemporaryHandle );
00331     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a8">ASSERTMSG</a>(<span class="stringliteral">"LSA Initialization Event handle closure Failed."</span>,<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status));
00332 
00333     <span class="comment">//</span>
00334     <span class="comment">// Initialize auditing structures</span>
00335     <span class="comment">//</span>
00336 
00337     <span class="keywordflow">if</span> (!<a class="code" href="../../d7/d4/adt_8h.html#a7">SepAdtInitializePhase1</a>()) {
00338         KdPrint((<span class="stringliteral">"Security: Auditing initialization failed.\n"</span>));
00339         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00340     }
00341 
00342 
00343 <span class="preprocessor">#ifndef SETEST</span>
00344 <span class="preprocessor"></span>
00345     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00346 
00347 <span class="preprocessor">#else</span>
00348 <span class="preprocessor"></span>
00349     <span class="keywordflow">return</span> <a class="code" href="../../d6/d6/sep_8h.html#a35">SepDevelopmentTest</a>();
00350 
00351 <span class="preprocessor">#endif  //SETEST</span>
00352 <span class="preprocessor"></span>
00353 }
}
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a51" doxytag="sep.h::SepInitializeWorkList" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN SepInitializeWorkList           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d4/seglobal_8c-source.html#l01152">1152</a> of file <a class="el" href="../../d9/d4/seglobal_8c-source.html">seglobal.c</a>.
<p>
References <a class="el" href="../../d6/d7/ex_8h-source.html#l02473">ExInitializeResource</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d9/d4/seglobal_8c-source.html#l00288">SepLsaQueue</a>, <a class="el" href="../../d9/d4/seglobal_8c-source.html#l00282">SepLsaQueueLock</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/seinit_8c-source.html#l00078">SepInitializationPhase0()</a>.
<p>
<pre class="fragment"><div>01158                    :
01159 
01160     Initializes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> mutex and list head used to queue work from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
01161     <a class="code" href="../../d6/d7/halmips_8h.html#a455">Executive</a> to LSA.  This mechanism operates on top of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> normal ExWorkerThread
01162     mechanism by capturing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> first thread to perform LSA work and keeping <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a>
01163     until all <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current work <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> done.
01164 
01165     The reduces <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> number of worker threads that are blocked on I/O to LSA.
01166 
01167 Arguments:
01168 
01169     None.
01170 
01171 
01172 Return Value:
01173 
01174     <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <span class="keywordflow">if</span> successful, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> otherwise.
01175 
01176 --*/
01177 
01178 {
01179     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
01180 
01181     <a class="code" href="../../d5/d8/ex_8h.html#a68">ExInitializeResource</a>(&amp;SepLsaQueueLock);
01182     InitializeListHead(&amp;SepLsaQueue);
01183     <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> );
01184 }
}
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a42" doxytag="sep.h::SepLockSubjectContext" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SepLockSubjectContext           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">PSECURITY_SUBJECT_CONTEXT</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>SubjectContext</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a55" doxytag="sep.h::SepPrintAcl" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SepPrintAcl           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PACL&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Acl</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d4/seassign_8c-source.html#l00762">762</a> of file <a class="el" href="../../d2/d4/seassign_8c-source.html">seassign.c</a>.
<p>
References <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d0/rtdmpsec_8c-source.html#l00053">FirstAce</a>, <a class="el" href="../../d5/d0/rtdmpsec_8c-source.html#l00059">NextAce</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d2/d4/seassign_8c-source.html#l00916">SepPrintSid()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d2/d4/seassign_8c-source.html#l00650">SepDumpSecurityDescriptor()</a>.
<p>
<pre class="fragment"><div>00768                    :
00769 
00770     This routine dumps via (DbgPrint) an Acl for debug purposes.  It is
00771     specialized to dump standard aces.
00772 
00773 Arguments:
00774 
00775     Acl - Supplies the Acl to dump
00776 
00777 Return Value:
00778 
00779     None
00780 
00781 --*/
00782 
00783 
00784 {
00785 <span class="preprocessor">#if DBG</span>
00786 <span class="preprocessor"></span>    ULONG i;
00787     <a class="code" href="../../d4/d7/struct__KNOWN__ACE.html">PKNOWN_ACE</a> Ace;
00788     BOOLEAN KnownType;
00789 
00790     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00791 
00792     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"@ %8lx\n"</span>, Acl);
00793 
00794     <span class="comment">//</span>
00795     <span class="comment">//  Check if the Acl is null</span>
00796     <span class="comment">//</span>
00797 
00798     <span class="keywordflow">if</span> (Acl == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00799 
00800         <span class="keywordflow">return</span>;
00801 
00802     }
00803 
00804     <span class="comment">//</span>
00805     <span class="comment">//  Dump the Acl header</span>
00806     <span class="comment">//</span>
00807 
00808     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Revision: %02x"</span>, Acl-&gt;AclRevision);
00809     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Size: %04x"</span>, Acl-&gt;AclSize);
00810     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" AceCount: %04x\n"</span>, Acl-&gt;AceCount);
00811 
00812     <span class="comment">//</span>
00813     <span class="comment">//  Now for each Ace we want do dump it</span>
00814     <span class="comment">//</span>
00815 
00816     <span class="keywordflow">for</span> (i = 0, Ace = <a class="code" href="../../d4/d1/rtdmpsec_8c.html#a1">FirstAce</a>(Acl);
00817          i &lt; Acl-&gt;AceCount;
00818          i++, Ace = <a class="code" href="../../d4/d1/rtdmpsec_8c.html#a2">NextAce</a>(Ace) ) {
00819 
00820         <span class="comment">//</span>
00821         <span class="comment">//  print out the ace header</span>
00822         <span class="comment">//</span>
00823 
00824         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"\n AceHeader: %08lx "</span>, *(PULONG)Ace);
00825 
00826         <span class="comment">//</span>
00827         <span class="comment">//  special case on the standard ace types</span>
00828         <span class="comment">//</span>
00829 
00830         <span class="keywordflow">if</span> ((Ace-&gt;Header.AceType == ACCESS_ALLOWED_ACE_TYPE) ||
00831             (Ace-&gt;Header.AceType == ACCESS_DENIED_ACE_TYPE) ||
00832             (Ace-&gt;Header.AceType == SYSTEM_AUDIT_ACE_TYPE) ||
00833             (Ace-&gt;Header.AceType == SYSTEM_ALARM_ACE_TYPE) ||
00834             (Ace-&gt;Header.AceType == ACCESS_ALLOWED_COMPOUND_ACE_TYPE)) {
00835 
00836             <span class="comment">//</span>
00837             <span class="comment">//  The following array is indexed by ace types and must</span>
00838             <span class="comment">//  follow the allowed, denied, audit, alarm seqeuence</span>
00839             <span class="comment">//</span>
00840 
00841             PCHAR AceTypes[] = { <span class="stringliteral">"Access Allowed"</span>,
00842                                  <span class="stringliteral">"Access Denied "</span>,
00843                                  <span class="stringliteral">"System Audit  "</span>,
00844                                  <span class="stringliteral">"System Alarm  "</span>,
00845                                  <span class="stringliteral">"Compound Grant"</span>,
00846                                };
00847 
00848             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(AceTypes[Ace-&gt;Header.AceType]);
00849             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"\n Access Mask: %08lx "</span>, Ace-&gt;Mask);
00850             KnownType = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00851 
00852         } <span class="keywordflow">else</span> {
00853 
00854             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Unknown Ace Type\n"</span>);
00855             KnownType = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00856         }
00857 
00858         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"\n"</span>);
00859 
00860         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" AceSize = %d\n"</span>,Ace-&gt;Header.AceSize);
00861 
00862         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Ace Flags = "</span>);
00863         <span class="keywordflow">if</span> (Ace-&gt;Header.AceFlags &amp; OBJECT_INHERIT_ACE) {
00864             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"OBJECT_INHERIT_ACE\n"</span>);
00865             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"                   "</span>);
00866         }
00867 
00868         <span class="keywordflow">if</span> (Ace-&gt;Header.AceFlags &amp; CONTAINER_INHERIT_ACE) {
00869             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"CONTAINER_INHERIT_ACE\n"</span>);
00870             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"                   "</span>);
00871         }
00872 
00873         <span class="keywordflow">if</span> (Ace-&gt;Header.AceFlags &amp; NO_PROPAGATE_INHERIT_ACE) {
00874             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"NO_PROPAGATE_INHERIT_ACE\n"</span>);
00875             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"                   "</span>);
00876         }
00877 
00878         <span class="keywordflow">if</span> (Ace-&gt;Header.AceFlags &amp; INHERIT_ONLY_ACE) {
00879             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"INHERIT_ONLY_ACE\n"</span>);
00880             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"                   "</span>);
00881         }
00882 
00883 
00884         <span class="keywordflow">if</span> (Ace-&gt;Header.AceFlags &amp; SUCCESSFUL_ACCESS_ACE_FLAG) {
00885             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"SUCCESSFUL_ACCESS_ACE_FLAG\n"</span>);
00886             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"            "</span>);
00887         }
00888 
00889         <span class="keywordflow">if</span> (Ace-&gt;Header.AceFlags &amp; FAILED_ACCESS_ACE_FLAG) {
00890             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"FAILED_ACCESS_ACE_FLAG\n"</span>);
00891             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"            "</span>);
00892         }
00893 
00894         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"\n"</span>);
00895 
00896         <span class="keywordflow">if</span> (KnownType != <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
00897             <span class="keywordflow">continue</span>;
00898         }
00899 
00900         <span class="keywordflow">if</span> (Ace-&gt;Header.AceType != ACCESS_ALLOWED_COMPOUND_ACE_TYPE) {
00901             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Sid = "</span>);
00902             <a class="code" href="../../d6/d6/sep_8h.html#a56">SepPrintSid</a>(&amp;Ace-&gt;SidStart);
00903         } <span class="keywordflow">else</span> {
00904             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Server Sid = "</span>);
00905             <a class="code" href="../../d6/d6/sep_8h.html#a56">SepPrintSid</a>(RtlCompoundAceServerSid(Ace));
00906             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"\n Client Sid = "</span>);
00907             <a class="code" href="../../d6/d6/sep_8h.html#a56">SepPrintSid</a>(RtlCompoundAceClientSid( Ace ));
00908         }
00909     }
00910 <span class="preprocessor">#endif</span>
00911 <span class="preprocessor"></span>}

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a56" doxytag="sep.h::SepPrintSid" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SepPrintSid           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PSID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Sid</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d4/seassign_8c-source.html#l00916">916</a> of file <a class="el" href="../../d2/d4/seassign_8c-source.html">seassign.c</a>.
<p>
References <a class="el" href="../../d7/d1/rtqkey_8c-source.html#l00042">Buffer</a>, <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d2/d4/seassign_8c-source.html#l01065">SepSidTranslation()</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
Referenced by <a class="el" href="../../d2/d4/seassign_8c-source.html#l00650">SepDumpSecurityDescriptor()</a>, <a class="el" href="../../d2/d4/seassign_8c-source.html#l00995">SepDumpTokenInfo()</a>, and <a class="el" href="../../d2/d4/seassign_8c-source.html#l00762">SepPrintAcl()</a>.
<p>
<pre class="fragment"><div>00922                    :
00923 
00924     Prints a formatted Sid
00925 
00926 Arguments:
00927 
00928     Sid - Provides a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> sid to be printed.
00929 
00930 
00931 Return Value:
00932 
00933     None.
00934 
00935 --*/
00936 
00937 {
00938 <span class="preprocessor">#if DBG</span>
00939 <span class="preprocessor"></span>    UCHAR i;
00940     ULONG Tmp;
00941     PISID ISid;
00942     STRING AccountName;
00943     UCHAR <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>[128];
00944 
00945     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00946 
00947     <span class="keywordflow">if</span> (Sid == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00948         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Sid is NULL\n"</span>);
00949         <span class="keywordflow">return</span>;
00950     }
00951 
00952     <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>[0] = 0;
00953 
00954     AccountName.MaximumLength = 127;
00955     AccountName.Length = 0;
00956     AccountName.Buffer = (PVOID)&amp;<a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>[0];
00957 
00958     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d6/sep_8h.html#a58">SepSidTranslation</a>( Sid, &amp;AccountName )) {
00959 
00960         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"%s   "</span>, AccountName.Buffer );
00961     }
00962 
00963     ISid = (PISID)Sid;
00964 
00965     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"S-%lu-"</span>, (USHORT)ISid-&gt;Revision );
00966     <span class="keywordflow">if</span> (  (ISid-&gt;IdentifierAuthority.Value[0] != 0)  ||
00967           (ISid-&gt;IdentifierAuthority.Value[1] != 0)     ){
00968         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"0x%02hx%02hx%02hx%02hx%02hx%02hx"</span>,
00969                     (USHORT)ISid-&gt;IdentifierAuthority.Value[0],
00970                     (USHORT)ISid-&gt;IdentifierAuthority.Value[1],
00971                     (USHORT)ISid-&gt;IdentifierAuthority.Value[2],
00972                     (USHORT)ISid-&gt;IdentifierAuthority.Value[3],
00973                     (USHORT)ISid-&gt;IdentifierAuthority.Value[4],
00974                     (USHORT)ISid-&gt;IdentifierAuthority.Value[5] );
00975     } <span class="keywordflow">else</span> {
00976         Tmp = (ULONG)ISid-&gt;IdentifierAuthority.Value[5]          +
00977               (ULONG)(ISid-&gt;IdentifierAuthority.Value[4] &lt;&lt;  8)  +
00978               (ULONG)(ISid-&gt;IdentifierAuthority.Value[3] &lt;&lt; 16)  +
00979               (ULONG)(ISid-&gt;IdentifierAuthority.Value[2] &lt;&lt; 24);
00980         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"%lu"</span>, Tmp);
00981     }
00982 
00983 
00984     <span class="keywordflow">for</span> (i=0;i&lt;ISid-&gt;SubAuthorityCount ;i++ ) {
00985         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"-%lu"</span>, ISid-&gt;SubAuthority[i]);
00986     }
00987     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"\n"</span>);
00988 <span class="preprocessor">#endif</span>
00989 <span class="preprocessor"></span>}

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a75" doxytag="sep.h::SepProbeAndCaptureQosData" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS SepProbeAndCaptureQosData           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PSECURITY_ADVANCED_QUALITY_OF_SERVICE&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>CapturedSecurityQos</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/se_2capture_8c-source.html#l00773">773</a> of file <a class="el" href="../../d3/d4/se_2capture_8c-source.html">se/capture.c</a>.
<p>
References <a class="el" href="../../d6/d4/cc_8h-source.html#l00126">ExAllocatePool</a>, <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l01209">ProbeForRead</a>, <a class="el" href="../../d3/d4/se_2capture_8c-source.html#l00681">SepCopyProxyData()</a>, <a class="el" href="../../d3/d4/se_2capture_8c-source.html#l00737">SepFreeProxyData()</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
Referenced by <a class="el" href="../../d3/d4/se_2capture_8c-source.html#l00953">SeCaptureSecurityQos()</a>.
<p>
<pre class="fragment"><div>00779                    :
00780 
00781     This routine probes and captures <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> imbedded structures in a
00782     Security Quality of Service structure.
00783 
00784     This routine assumes that <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> being called under an existing
00785     <span class="keywordflow">try</span>-except clause.
00786 
00787 Arguments:
00788 
00789     CapturedSecurityQos - Points to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> captured body of a QOS
00790         structure.  The pointers in <span class="keyword">this</span> structure are presumed
00791         not to be probed or captured at <span class="keyword">this</span> point.
00792 
00793 Return Value:
00794 
00795     STATUS_SUCCESS indicates no exceptions were encountered.
00796 
00797     Any access violations encountered will be returned.
00798 
00799 --*/
00800 {
00801     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00802     PSECURITY_TOKEN_PROXY_DATA CapturedProxyData;
00803     PSECURITY_TOKEN_AUDIT_DATA CapturedAuditData;
00804     SECURITY_TOKEN_PROXY_DATA StackProxyData;
00805     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00806 
00807     CapturedProxyData = CapturedSecurityQos-&gt;ProxyData;
00808     CapturedSecurityQos-&gt;ProxyData = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00809     CapturedAuditData = CapturedSecurityQos-&gt;AuditData;
00810     CapturedSecurityQos-&gt;AuditData = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00811 
00812     <span class="keywordflow">if</span> (ARGUMENT_PRESENT( CapturedProxyData )) {
00813 
00814         <span class="comment">//</span>
00815         <span class="comment">// Make sure the body of the proxy data is ok to read.</span>
00816         <span class="comment">//</span>
00817 
00818         <a class="code" href="../../d5/d8/ex_8h.html#a11">ProbeForRead</a>(
00819             CapturedProxyData,
00820             <span class="keyword">sizeof</span>(SECURITY_TOKEN_PROXY_DATA),
00821             <span class="keyword">sizeof</span>(ULONG)
00822             );
00823 
00824         StackProxyData = *CapturedProxyData;
00825 
00826         <span class="keywordflow">if</span> (StackProxyData.Length != <span class="keyword">sizeof</span>( SECURITY_TOKEN_PROXY_DATA )) {
00827             <span class="keywordflow">return</span>( STATUS_INVALID_PARAMETER );
00828         }
00829 
00830 
00831         <span class="comment">//</span>
00832         <span class="comment">// Probe the passed pathinfo buffer</span>
00833         <span class="comment">//</span>
00834 
00835         <a class="code" href="../../d5/d8/ex_8h.html#a11">ProbeForRead</a>(
00836             StackProxyData.PathInfo.Buffer,
00837             StackProxyData.PathInfo.Length,
00838             <span class="keyword">sizeof</span>( UCHAR )
00839             );
00840 
00841         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d6/sep_8h.html#a73">SepCopyProxyData</a>( &amp;CapturedSecurityQos-&gt;ProxyData, &amp;StackProxyData );
00842 
00843         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00844 
00845             <span class="keywordflow">if</span> (CapturedSecurityQos-&gt;ProxyData != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00846                 <a class="code" href="../../d6/d6/sep_8h.html#a74">SepFreeProxyData</a>( CapturedSecurityQos-&gt;ProxyData );
00847                 CapturedSecurityQos-&gt;ProxyData = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00848             }
00849 
00850             <span class="keywordflow">return</span>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00851         }
00852 
00853     }
00854 
00855     <span class="keywordflow">if</span> (ARGUMENT_PRESENT( CapturedAuditData )) {
00856 
00857         PSECURITY_TOKEN_AUDIT_DATA LocalAuditData;
00858 
00859         <span class="comment">//</span>
00860         <span class="comment">// Probe the audit data structure and make sure it looks ok</span>
00861         <span class="comment">//</span>
00862 
00863         <a class="code" href="../../d5/d8/ex_8h.html#a11">ProbeForRead</a>(
00864             CapturedAuditData,
00865             <span class="keyword">sizeof</span>( SECURITY_TOKEN_AUDIT_DATA ),
00866             <span class="keyword">sizeof</span>( ULONG )
00867             );
00868 
00869 
00870         LocalAuditData = <a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>( PagedPool, <span class="keyword">sizeof</span>( SECURITY_TOKEN_AUDIT_DATA ));
00871 
00872         <span class="keywordflow">if</span> (LocalAuditData == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00873 
00874             <span class="comment">//</span>
00875             <span class="comment">// Cleanup any proxy data we may have allocated.</span>
00876             <span class="comment">//</span>
00877 
00878             <a class="code" href="../../d6/d6/sep_8h.html#a74">SepFreeProxyData</a>( CapturedSecurityQos-&gt;ProxyData );
00879             CapturedSecurityQos-&gt;ProxyData = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00880 
00881             <span class="keywordflow">return</span>( STATUS_INSUFFICIENT_RESOURCES );
00882 
00883         }
00884 
00885         <span class="comment">//</span>
00886         <span class="comment">// Copy the data to the local buffer. Note: we do this in this</span>
00887         <span class="comment">// order so that if the final assignment fails the caller will</span>
00888         <span class="comment">// still be able to free the allocated pool.</span>
00889         <span class="comment">//</span>
00890 
00891         CapturedSecurityQos-&gt;AuditData = LocalAuditData;
00892 
00893         *CapturedSecurityQos-&gt;AuditData = *CapturedAuditData;
00894 
00895         <span class="keywordflow">if</span> ( LocalAuditData-&gt;Length != <span class="keyword">sizeof</span>( SECURITY_TOKEN_AUDIT_DATA ) ) {
00896             <a class="code" href="../../d6/d6/sep_8h.html#a74">SepFreeProxyData</a>( CapturedSecurityQos-&gt;ProxyData );
00897             CapturedSecurityQos-&gt;ProxyData = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00898             <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>(CapturedSecurityQos-&gt;AuditData);
00899             CapturedSecurityQos-&gt;AuditData = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00900             <span class="keywordflow">return</span>( STATUS_INVALID_PARAMETER );
00901         }
00902     }
00903 
00904     <span class="keywordflow">return</span>( STATUS_SUCCESS );
00905 
00906 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a66" doxytag="sep.h::SepQueryNameString" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> POBJECT_NAME_INFORMATION SepQueryNameString           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Object</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
*++ 
<p>

<p>
Definition at line <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l02324">2324</a> of file <a class="el" href="../../d8/d5/sepaudit_8c-source.html">sepaudit.c</a>.
<p>
References <a class="el" href="../../d6/d7/ex_8h-source.html#l00253">ExAllocatePoolWithTag</a>, <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d0/obquery_8c-source.html#l00713">ObQueryNameString()</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
Referenced by <a class="el" href="../../d4/d4/seaudit_8c-source.html#l03538">SeCreateObjectAuditAlarm()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l02765">SeOpenObjectAuditAlarm()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l03085">SeOpenObjectForDeleteAuditAlarm()</a>, and <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l01907">SepAdtObjectReferenceAuditAlarm()</a>.
<p>
<pre class="fragment"><div>02330                    :
02331 
02332     Takes a pointer to an object and returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> name of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object.
02333 
02334 Arguments:
02335 
02336     Object - a pointer to an object.
02337 
02338 
02339 Return Value:
02340 
02341     <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> pointer to a buffer containing a POBJECT_NAME_INFORMATION
02342     structure containing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> name of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object.  The string <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
02343     allocated <a class="code" href="../../d6/d0/wsprintf_8c.html#a0">out</a> of paged <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> and should be freed by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller.
02344 
02345     <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> may also be returned.
02346 
02347 
02348 --*/
02349 
02350 {
02351     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
02352     ULONG ReturnLength = 0;
02353     POBJECT_NAME_INFORMATION ObjectNameInfo = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02354     PUNICODE_STRING ObjectName = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02355 
02356     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
02357 
02358     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d1/obquery_8c.html#a7">ObQueryNameString</a>(
02359                  Object,
02360                  ObjectNameInfo,
02361                  0,
02362                  &amp;ReturnLength
02363                  );
02364 
02365     <span class="keywordflow">if</span> ( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> == STATUS_INFO_LENGTH_MISMATCH ) {
02366 
02367         ObjectNameInfo = <a class="code" href="../../d5/d8/ex_8h.html#a4">ExAllocatePoolWithTag</a>( PagedPool, ReturnLength, 'nOeS' );
02368 
02369         <span class="keywordflow">if</span> ( ObjectNameInfo != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
02370 
02371             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d1/obquery_8c.html#a7">ObQueryNameString</a>(
02372                         Object,
02373                         ObjectNameInfo,
02374                         ReturnLength,
02375                         &amp;ReturnLength
02376                         );
02377 
02378             <span class="keywordflow">if</span> ( <a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
02379 
02380                 <span class="keywordflow">if</span> (ObjectNameInfo-&gt;Name.Length != 0) {
02381 
02382                     <span class="keywordflow">return</span>( ObjectNameInfo );
02383 
02384                 } <span class="keywordflow">else</span> {
02385 
02386                     <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( ObjectNameInfo );
02387                     <span class="keywordflow">return</span>( <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> );
02388                 }
02389             }
02390         }
02391     }
02392 
02393     <span class="keywordflow">return</span>( <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> );
02394 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a65" doxytag="sep.h::SepQueryTypeString" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PUNICODE_STRING SepQueryTypeString           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Object</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l02400">2400</a> of file <a class="el" href="../../d8/d5/sepaudit_8c-source.html">sepaudit.c</a>.
<p>
References <a class="el" href="../../d6/d7/ex_8h-source.html#l00253">ExAllocatePoolWithTag</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d0/obquery_8c-source.html#l01082">ObQueryTypeName()</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
Referenced by <a class="el" href="../../d4/d4/seaudit_8c-source.html#l02765">SeOpenObjectAuditAlarm()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l03085">SeOpenObjectForDeleteAuditAlarm()</a>, and <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l01907">SepAdtObjectReferenceAuditAlarm()</a>.
<p>
<pre class="fragment"><div>02405                    :
02406 
02407     Takes a pointer to an object and returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object.
02408 
02409 Arguments:
02410 
02411     Object - a pointer to an object.
02412 
02413 
02414 Return Value:
02415 
02416     <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> pointer to a UNICODE_STRING that contains <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> name of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object
02417     <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a>.  The string <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> allocated <a class="code" href="../../d6/d0/wsprintf_8c.html#a0">out</a> of paged <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> and should be freed
02418     by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller.
02419 
02420     <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> may also be returned.
02421 
02422 
02423 --*/
02424 
02425 {
02426 
02427     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
02428     PUNICODE_STRING TypeName = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02429     ULONG ReturnLength;
02430 
02431     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
02432 
02433     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d1/obquery_8c.html#a8">ObQueryTypeName</a>(
02434                  Object,
02435                  TypeName,
02436                  0,
02437                  &amp;ReturnLength
02438                  );
02439 
02440     <span class="keywordflow">if</span> ( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> == STATUS_INFO_LENGTH_MISMATCH ) {
02441 
02442         TypeName = <a class="code" href="../../d5/d8/ex_8h.html#a4">ExAllocatePoolWithTag</a>( PagedPool, ReturnLength, 'nTeS' );
02443 
02444         <span class="keywordflow">if</span> ( TypeName != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
02445 
02446             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d1/obquery_8c.html#a8">ObQueryTypeName</a>(
02447                         Object,
02448                         TypeName,
02449                         ReturnLength,
02450                         &amp;ReturnLength
02451                         );
02452 
02453             <span class="keywordflow">if</span> ( <a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
02454 
02455                 <span class="keywordflow">return</span>( TypeName );
02456             }
02457         }
02458     }
02459 
02460     <span class="keywordflow">return</span>( <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> );
02461 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a68" doxytag="sep.h::SepQueueWorkItem" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN SepQueueWorkItem           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d8/d1/struct__SEP__LSA__WORK__ITEM.html">PSEP_LSA_WORK_ITEM</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>LsaWorkItem</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>ForceQueue</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/adtlog_8c-source.html#l00600">600</a> of file <a class="el" href="../../d1/d4/adtlog_8c-source.html">adtlog.c</a>.
<p>
References <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d5/d8/ex_8h.html#a332a206">DelayedWorkQueue</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l01961">ExInitializeWorkItem</a>, <a class="el" href="../../d2/d8/worker_8c-source.html#l00375">ExQueueWorkItem()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l01950">PWORKER_THREAD_ROUTINE</a>, <a class="el" href="../../d2/d4/adtp_8h-source.html#l00056">SepAdtCountEventsDiscarded</a>, <a class="el" href="../../d2/d4/adtp_8h-source.html#l00063">SepAdtCurrentListLength</a>, <a class="el" href="../../d2/d4/adtp_8h-source.html#l00070">SepAdtDiscardingAudits</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l02717">SepAdtGenerateDiscardAudit()</a>, <a class="el" href="../../d2/d4/adtp_8h-source.html#l00037">SepAdtMaxListLength</a>, <a class="el" href="../../d2/d4/adtp_8h-source.html#l00038">SepAdtMinListLength</a>, <a class="el" href="../../d9/d4/seglobal_8c-source.html#l00296">SepExWorkItem</a>, <a class="el" href="../../d7/d5/sep_8h-source.html#l00287">SepLockLsaQueue</a>, <a class="el" href="../../d9/d4/seglobal_8c-source.html#l00288">SepLsaQueue</a>, <a class="el" href="../../d1/d9/rmmain_8c-source.html#l00907">SepRmCallLsa()</a>, <a class="el" href="../../d7/d5/sep_8h-source.html#l00290">SepUnlockLsaQueue</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d7/d5/sep_8h-source.html#l00372">_SEP_WORK_ITEM::WorkItem</a>.
<p>
Referenced by <a class="el" href="../../d1/d4/adtlog_8c-source.html#l00052">SepAdtLogAuditRecord()</a>, and <a class="el" href="../../d0/d9/rmlogon_8c-source.html#l00777">SepInformLsaOfDeletedLogon()</a>.
<p>
<pre class="fragment"><div>00607                    :
00608 
00609     Puts <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> passed work item on <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> queue to be passed to LSA,
00610     and returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> state of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> queue upon arrival.
00611 
00612 Arguments:
00613 
00614     LsaWorkItem - Pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> work item to be queued.
00615 
00616     ForceQueue - Indicate that <span class="keyword">this</span> item <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not to be discarded
00617         due because of a full queue.
00618 
00619 Return Value:
00620 
00621     <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> - The item was successfully queued.
00622 
00623     <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> - The item was not queued and must be discarded.
00624 
00625 --*/
00626 
00627 {
00628     BOOLEAN rc = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00629     BOOLEAN StartExThread = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> ;
00630 
00631     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00632 
00633 <span class="preprocessor">#if 0</span>
00634 <span class="preprocessor"></span>
00635   <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Queueing an audit\n"</span>);
00636 
00637 <span class="preprocessor">#endif</span>
00638 <span class="preprocessor"></span>
00639     <a class="code" href="../../d6/d6/sep_8h.html#a14">SepLockLsaQueue</a>();
00640 
00641     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d5/adtp_8h.html#a11">SepAdtDiscardingAudits</a> &amp;&amp; !ForceQueue) {
00642 
00643         <span class="keywordflow">if</span> (<a class="code" href="../../d1/d5/adtp_8h.html#a10">SepAdtCurrentListLength</a> &lt; <a class="code" href="../../d1/d5/adtp_8h.html#a6">SepAdtMinListLength</a>) {
00644 
00645             <span class="comment">//</span>
00646             <span class="comment">// We need to generate an audit saying how many audits we've</span>
00647             <span class="comment">// discarded.</span>
00648             <span class="comment">//</span>
00649             <span class="comment">// Since we have the mutex protecting the Audit queue, we don't</span>
00650             <span class="comment">// have to worry about anyone coming along and logging an</span>
00651             <span class="comment">// audit.  But *we* can, since a mutex may be acquired recursively.</span>
00652             <span class="comment">//</span>
00653             <span class="comment">// Since we are so protected, turn off the SepAdtDiscardingAudits</span>
00654             <span class="comment">// flag here so that we don't come through this path again.</span>
00655             <span class="comment">//</span>
00656 
00657             <a class="code" href="../../d1/d5/adtp_8h.html#a11">SepAdtDiscardingAudits</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00658 
00659             <a class="code" href="../../d7/d6/sepaudit_8c.html#a22">SepAdtGenerateDiscardAudit</a>();
00660 <span class="preprocessor">#if 0</span>
00661 <span class="preprocessor"></span>            <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Auditing resumed\n"</span>);
00662 <span class="preprocessor">#endif</span>
00663 <span class="preprocessor"></span>
00664             <span class="comment">//</span>
00665             <span class="comment">// We must assume that that worked, so clear the discard count.</span>
00666             <span class="comment">//</span>
00667 
00668             <a class="code" href="../../d1/d5/adtp_8h.html#a9">SepAdtCountEventsDiscarded</a> = 0;
00669 
00670             <span class="comment">//</span>
00671             <span class="comment">// Our 'audits discarded' audit is now on the queue,</span>
00672             <span class="comment">// continue logging the one we started with.</span>
00673             <span class="comment">//</span>
00674 
00675         } <span class="keywordflow">else</span> {
00676 
00677             <span class="comment">//</span>
00678             <span class="comment">// We are not yet below our low water mark.  Toss</span>
00679             <span class="comment">// this audit and increment the discard count.</span>
00680             <span class="comment">//</span>
00681 
00682             <a class="code" href="../../d1/d5/adtp_8h.html#a9">SepAdtCountEventsDiscarded</a>++;
00683             rc = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00684             <span class="keywordflow">goto</span> Exit;
00685         }
00686     }
00687 
00688     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d5/adtp_8h.html#a10">SepAdtCurrentListLength</a> &lt; <a class="code" href="../../d1/d5/adtp_8h.html#a5">SepAdtMaxListLength</a> || ForceQueue) {
00689 
00690         InsertTailList(&amp;SepLsaQueue, &amp;LsaWorkItem-&gt;List);
00691 
00692         <span class="keywordflow">if</span> (++<a class="code" href="../../d1/d5/adtp_8h.html#a10">SepAdtCurrentListLength</a> == 1) {
00693 
00694 <span class="preprocessor">#if 0</span>
00695 <span class="preprocessor"></span>            <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Queueing a work item\n"</span>);
00696 <span class="preprocessor">#endif</span>
00697 <span class="preprocessor"></span>
00698             StartExThread = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> ;
00699         }
00700 
00701     } <span class="keywordflow">else</span> {
00702 
00703         <span class="comment">//</span>
00704         <span class="comment">// There is no room for this audit on the queue,</span>
00705         <span class="comment">// so change our state to 'discarding' and tell</span>
00706         <span class="comment">// the caller to toss this audit.</span>
00707         <span class="comment">//</span>
00708 
00709         <a class="code" href="../../d1/d5/adtp_8h.html#a11">SepAdtDiscardingAudits</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00710 
00711 <span class="preprocessor">#if 0</span>
00712 <span class="preprocessor"></span>        <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Starting to discard audits\n"</span>);
00713 <span class="preprocessor">#endif</span>
00714 <span class="preprocessor"></span>
00715         rc = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00716     }
00717 
00718 Exit:
00719 
00720     <a class="code" href="../../d6/d6/sep_8h.html#a15">SepUnlockLsaQueue</a>();
00721 
00722     <span class="keywordflow">if</span> ( StartExThread )
00723     {
00724         <a class="code" href="../../d5/d8/ex_8h.html#a55">ExInitializeWorkItem</a>( &amp;<a class="code" href="../../d8/d5/seglobal_8c.html#a97">SepExWorkItem</a>.<a class="code" href="../../d2/d2/struct__SEP__WORK__ITEM.html#o0">WorkItem</a>,
00725                               (PWORKER_THREAD_ROUTINE) SepRmCallLsa,
00726                               &amp;SepExWorkItem
00727                               );
00728 
00729         <a class="code" href="../../d5/d8/ex_8h.html#a261">ExQueueWorkItem</a>( &amp;<a class="code" href="../../d8/d5/seglobal_8c.html#a97">SepExWorkItem</a>.<a class="code" href="../../d2/d2/struct__SEP__WORK__ITEM.html#o0">WorkItem</a>, DelayedWorkQueue );
00730     }
00731 
00732     <span class="keywordflow">return</span>( rc );
00733 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a40" doxytag="sep.h::SepReferenceLogonSession" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS SepReferenceLogonSession           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PLUID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>LogonId</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d9/rmlogon_8c-source.html#l00278">278</a> of file <a class="el" href="../../d0/d9/rmlogon_8c-source.html">rmlogon.c</a>.
<p>
References <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d2/d9/rmp_8h-source.html#l00129">_SEP_LOGON_SESSION_REFERENCES::LogonId</a>, <a class="el" href="../../d2/d9/rmp_8h-source.html#l00128">_SEP_LOGON_SESSION_REFERENCES::Next</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d1/d0/rmp_8h.html#a15">PSEP_LOGON_SESSION_REFERENCES</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00645">PsGetCurrentThread</a>, <a class="el" href="../../d2/d9/rmp_8h-source.html#l00130">_SEP_LOGON_SESSION_REFERENCES::ReferenceCount</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l01824">RtlEqualLuid()</a>, <a class="el" href="../../d0/d9/rmlogon_8c-source.html#l00109">SepLogonSessionIndex</a>, <a class="el" href="../../d2/d9/rmp_8h-source.html#l00229">SepLogonSessions</a>, <a class="el" href="../../d2/d9/rmp_8h-source.html#l00060">SepRmAcquireDbWriteLock</a>, and <a class="el" href="../../d2/d9/rmp_8h-source.html#l00066">SepRmReleaseDbWriteLock</a>.
<p>
Referenced by <a class="el" href="../../d5/d2/token_8c-source.html#l02213">SepCreateToken()</a>, <a class="el" href="../../d7/d2/tokendup_8c-source.html#l00362">SepDuplicateToken()</a>, and <a class="el" href="../../d7/d2/tokendup_8c-source.html#l01939">SepFilterToken()</a>.
<p>
<pre class="fragment"><div>00284                    :
00285 
00286     This routine increments <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> reference count of a logon session
00287     tracking record.
00288 
00289 
00290 
00291 Arguments:
00292 
00293     LogonId - Pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> logon session <a class="code" href="../../d4/d9/smbtrsup_8c.html#a7">ID</a> whose logon track <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
00294         to be incremented.
00295 
00296 Return Value:
00297 
00298     STATUS_SUCCESS - The reference count was successfully incremented.
00299 
00300     STATUS_NO_SUCH_LOGON_SESSION - The specified logon session doesn'<a class="code" href="../../d4/d1/genmips_8c.html#a17">t</a>
00301         exist in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> reference monitor's database.
00302 
00303 --*/
00304 
00305 {
00306 
00307     ULONG SessionArrayIndex;
00308     <a class="code" href="../../d6/d1/struct__SEP__LOGON__SESSION__REFERENCES.html">PSEP_LOGON_SESSION_REFERENCES</a> Previous, Current;
00309 
00310 <span class="preprocessor">#ifdef SEP_TRACK_LOGON_SESSION_REFS</span>
00311 <span class="preprocessor"></span>    ULONG Refs;
00312 <span class="preprocessor">#endif //SEP_TRACK_LOGON_SESSION_REFS</span>
00313 <span class="preprocessor"></span>
00314     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00315 
00316     SessionArrayIndex = <a class="code" href="../../d9/d9/rmlogon_8c.html#a0">SepLogonSessionIndex</a>( LogonId );
00317 
00318     <span class="comment">//</span>
00319     <span class="comment">// Protect modification of reference monitor database</span>
00320     <span class="comment">//</span>
00321 
00322     <a class="code" href="../../d1/d0/rmp_8h.html#a3">SepRmAcquireDbWriteLock</a>();
00323 
00324 
00325     <span class="comment">//</span>
00326     <span class="comment">// Now walk the list for our logon session array hash index.</span>
00327     <span class="comment">//</span>
00328 
00329     Previous = (<a class="code" href="../../d6/d1/struct__SEP__LOGON__SESSION__REFERENCES.html">PSEP_LOGON_SESSION_REFERENCES</a>)
00330                ((PVOID)&amp;<a class="code" href="../../d1/d0/rmp_8h.html#a22">SepLogonSessions</a>[ SessionArrayIndex ]);
00331     Current = Previous-&gt;<a class="code" href="../../d6/d1/struct__SEP__LOGON__SESSION__REFERENCES.html#o0">Next</a>;
00332 
00333     <span class="keywordflow">while</span> (Current != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00334 
00335         <span class="comment">//</span>
00336         <span class="comment">// If we found it, increment the reference count and return</span>
00337         <span class="comment">//</span>
00338 
00339         <span class="keywordflow">if</span> (<a class="code" href="../../d8/d6/sertl_8c.html#a50">RtlEqualLuid</a>( LogonId, &amp;Current-&gt;<a class="code" href="../../d6/d1/struct__SEP__LOGON__SESSION__REFERENCES.html#o1">LogonId</a>) ) {
00340 <span class="preprocessor">#ifdef SEP_TRACK_LOGON_SESSION_REFS</span>
00341 <span class="preprocessor"></span>             ULONG Refs;
00342 <span class="preprocessor">#endif //SEP_TRACK_LOGON_SESSION_REFS</span>
00343 <span class="preprocessor"></span>
00344              Current-&gt;<a class="code" href="../../d6/d1/struct__SEP__LOGON__SESSION__REFERENCES.html#o2">ReferenceCount</a> += 1;
00345 
00346 <span class="preprocessor">#ifdef SEP_TRACK_LOGON_SESSION_REFS</span>
00347 <span class="preprocessor"></span>             Refs = Current-&gt;<a class="code" href="../../d6/d1/struct__SEP__LOGON__SESSION__REFERENCES.html#o2">ReferenceCount</a>;
00348 <span class="preprocessor">#endif //SEP_TRACK_LOGON_SESSION_REFS</span>
00349 <span class="preprocessor"></span>
00350              <a class="code" href="../../d1/d0/rmp_8h.html#a5">SepRmReleaseDbWriteLock</a>();
00351 
00352 <span class="preprocessor">#ifdef SEP_TRACK_LOGON_SESSION_REFS</span>
00353 <span class="preprocessor"></span>             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"SE (rm): ++ logon session: (%d, %d) to %d by (%d, %d)\n"</span>,
00354                       LogonId-&gt;HighPart, LogonId-&gt;LowPart, Refs,
00355                       <a class="code" href="../../d1/d9/ps_8h.html#a20">PsGetCurrentThread</a>()-&gt;Cid.UniqueProcess,
00356                       <a class="code" href="../../d1/d9/ps_8h.html#a20">PsGetCurrentThread</a>()-&gt;Cid.UniqueThread);
00357 
00358 <span class="preprocessor">#endif //SEP_TRACK_LOGON_SESSION_REFS</span>
00359 <span class="preprocessor"></span>             <span class="keywordflow">return</span> STATUS_SUCCESS;
00360         }
00361 
00362         Previous = Current;
00363         Current = Current-&gt;<a class="code" href="../../d6/d1/struct__SEP__LOGON__SESSION__REFERENCES.html#o0">Next</a>;
00364     }
00365 
00366     <a class="code" href="../../d1/d0/rmp_8h.html#a5">SepRmReleaseDbWriteLock</a>();
00367 
00368     <span class="comment">//</span>
00369     <span class="comment">// Bad news, someone asked us to increment the reference count of</span>
00370     <span class="comment">// a logon session we didn't know existed.  This might be a new</span>
00371     <span class="comment">// token being created, so return an error status and let the caller</span>
00372     <span class="comment">// decide if it warrants a bug check or not.</span>
00373     <span class="comment">//</span>
00374 
00375 
00376     <span class="keywordflow">return</span> STATUS_NO_SUCH_LOGON_SESSION;
00377 
00378 
00379 
00380 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a50" doxytag="sep.h::SepRmCallLsa" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS SepRmCallLsa           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d2/d2/struct__SEP__WORK__ITEM.html">PSEP_WORK_ITEM</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>SepWorkItem</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d9/rmmain_8c-source.html#l00907">907</a> of file <a class="el" href="../../d1/d9/rmmain_8c-source.html">rmmain.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d7/d5/sep_8h-source.html#l00364">_SEP_LSA_WORK_ITEM::CleanupFunction</a>, <a class="el" href="../../d7/d5/sep_8h-source.html#l00365">_SEP_LSA_WORK_ITEM::CleanupParameter</a>, <a class="el" href="../../d7/d5/sep_8h-source.html#l00354">_SEP_LSA_WORK_ITEM::CommandNumber</a>, <a class="el" href="../../d8/d1/struct__SEP__LSA__WORK__ITEM.html#o5">_SEP_LSA_WORK_ITEM::CommandParams</a>, <a class="el" href="../../d7/d5/sep_8h-source.html#l00355">_SEP_LSA_WORK_ITEM::CommandParamsLength</a>, <a class="el" href="../../d7/d5/sep_8h-source.html#l00330">_SEP_LSA_WORK_ITEM::CommandParamsMemoryType</a>, <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d4/d4/procobj_8c-source.html#l00166">KeAttachProcess()</a>, <a class="el" href="../../d4/d4/procobj_8c-source.html#l00405">KeDetachProcess()</a>, <a class="el" href="../../d2/d9/rmp_8h-source.html#l00085">_SEP_RM_STATE::LsaCommandPortHandle</a>, <a class="el" href="../../d2/d9/rmp_8h-source.html#l00092">_SEP_RM_STATE::LsaViewPortMemory</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00166">_EPROCESS::Pcb</a>, <a class="el" href="../../d6/d6/sep_8h.html#a30">PSEP_WORK_ITEM</a>, <a class="el" href="../../d7/d5/sep_8h-source.html#l00356">_SEP_LSA_WORK_ITEM::ReplyBuffer</a>, <a class="el" href="../../d7/d5/sep_8h-source.html#l00357">_SEP_LSA_WORK_ITEM::ReplyBufferLength</a>, <a class="el" href="../../d4/d7/client_8c-source.html#l03425">ReplyMessage()</a>, <a class="el" href="../../d2/d9/rmp_8h-source.html#l00093">_SEP_RM_STATE::RmViewPortMemory</a>, <a class="el" href="../../d2/d9/rmp_8h-source.html#l00076">SEP_RM_LSA_SHARED_MEMORY_SIZE</a>, <a class="el" href="../../d1/d4/adtlog_8c-source.html#l00504">SepAdtCopyToLsaSharedMemory()</a>, <a class="el" href="../../d1/d4/adtlog_8c-source.html#l00738">SepDequeueWorkItem()</a>, <a class="el" href="../../d9/d4/seglobal_8c-source.html#l00266">SepLsaHandle</a>, <a class="el" href="../../d9/d4/seglobal_8c-source.html#l00294">SepLsaQueueLength</a>, <a class="el" href="../../d2/d9/rmp_8h-source.html#l00226">SepRmLsaCallProcess</a>, <a class="el" href="../../d2/d9/rmp_8h-source.html#l00227">SepRmState</a>, <a class="el" href="../../d7/d5/sep_8h-source.html#l00293">SepWorkListHead</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
Referenced by <a class="el" href="../../d1/d4/adtlog_8c-source.html#l00600">SepQueueWorkItem()</a>.
<p>
<pre class="fragment"><div>00912                    :
00913 
00914     This function sends a command to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> LSA via <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> LSA Reference Monitor
00915     <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a22">Server</a> Command LPC Port.  If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> command has parameters, they will be
00916     copied directly into a message structure and sent via LPC, therefore,
00917     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> supplied parameters may not contain any absolute pointers.  <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> caller
00918     must remove pointers by <span class="stringliteral">"marshalling"</span> them into <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> buffer CommandParams.
00919 
00920     This function will create a queue of requests.  This <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> in order to allow
00921     greater throughput <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> majority <span class="keywordflow">if</span> its callers.  If a thread enters
00922     <span class="keyword">this</span> routine and finds <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> queue empty, <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> responsibility of that
00923     thread to service all requests that come in <span class="keywordflow">while</span> <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> working until <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00924     queue <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> empty again.  Other threads that enter will simply hook their work
00925     item onto <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> queue and <a class="code" href="../../d9/d1/fedefs_8h.html#a16">exit</a>.
00926 
00927 
00928     To implement a <span class="keyword">new</span> LSA command, <span class="keywordflow">do</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> following:
00929     ================================================
00930 
00931     (1)  If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> command takes no parameters, just call <span class="keyword">this</span> routine directly
00932          and provide an LSA worker routine called Lsap&lt;command&gt;Wrkr.  See
00933          <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a> lsa\server\lsarm.c <span class="keywordflow">for</span> examples
00934 
00935     (2)  If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> command takes parameters, provide a routine called
00936          SepRmSend&lt;command&gt;Command that takes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> parameters in unmarshalled
00937          form and calls <a class="code" href="../../d6/d6/sep_8h.html#a50">SepRmCallLsa</a>() with the command <span class="keywordtype">id</span>, marshalled
00938          parameters, length  of marshalled parameters and pointer to
00939          optional reply message.  The marshalled parameters are free format:
00940          the only restriction is that there must be no absolute address
00941          pointers.  These parameters are all placed in the passed LsaWorkItem
00942          structure.
00943 
00944     (3)  In file private\inc\ntrmlsa.h, append a command name  to the
00945          enumerated type LSA_COMMAND_NUMBER defined in file
00946          private\inc\ntrmlsa.h.  Change the #define for LsapMaximumCommand
00947          to reference the new command.
00948 
00949     (4)  Add the Lsap&lt;command&gt;Wrkr to the command dispatch table structure
00950          LsapCommandDispatch[] in file lsarm.c.
00951 
00952     (5)  Add function prototypes to lsap.h and sep.h.
00953 
00954 
00955 Arguments:
00956 
00957     LsaWorkItem - Supplies a pointer to an SE_LSA_WORK_ITEM containing the
00958         information to be passed to LSA.  This structure will be freed
00959         asynchronously by some invocation of this routine, not necessarily
00960         in the current context.
00961 
00962         !THIS PARAMETER MUST BE ALLOCATED OUT OF NONPAGED POOL!
00963 
00964 Return Value:
00965 
00966     NTSTATUS - Result Code.  This is either a result code returned from
00967         trying to send the command/receive the reply, or a status code
00968         from the command itself.
00969 
00970 --*/
00971 
00972 {
00973     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
00974     LSA_COMMAND_MESSAGE CommandMessage;
00975     LSA_REPLY_MESSAGE <a class="code" href="../../d3/d8/client_8c.html#a125">ReplyMessage</a>;
00976     <a class="code" href="../../d8/d1/struct__SEP__LSA__WORK__ITEM.html">PSEP_LSA_WORK_ITEM</a> WorkQueueItem;
00977     ULONG LocalListLength = 0;
00978     SIZE_T RegionSize;
00979     PVOID CopiedCommandParams = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00980     PVOID LsaViewCopiedCommandParams = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00981 
00982     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00983 
00984 <span class="preprocessor">#if 0</span>
00985 <span class="preprocessor"></span>  <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Entering SepRmCallLsa\n"</span>);
00986 <span class="preprocessor">#endif</span>
00987 <span class="preprocessor"></span>
00988     WorkQueueItem = <a class="code" href="../../d6/d6/sep_8h.html#a16">SepWorkListHead</a>();
00989 
00990     <a class="code" href="../../d3/d5/procobj_8c.html#a4">KeAttachProcess</a>( &amp;<a class="code" href="../../d1/d0/rmp_8h.html#a19">SepRmLsaCallProcess</a>-&gt;<a class="code" href="../../d0/d4/struct__EPROCESS.html#o0">Pcb</a> );
00991 
00992     <span class="keywordflow">while</span> ( WorkQueueItem ) {
00993 
00994 <span class="preprocessor">#if 0</span>
00995 <span class="preprocessor"></span>      <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Got a work item from head of queue, processing\n"</span>);
00996 <span class="preprocessor">#endif</span>
00997 <span class="preprocessor"></span>
00998         <span class="comment">//</span>
00999         <span class="comment">// Construct a message for LPC.  First, fill in the message header</span>
01000         <span class="comment">// fields for LPC, specifying the message type and data sizes for</span>
01001         <span class="comment">// the outgoing CommandMessage and the incoming ReplyMessage.</span>
01002         <span class="comment">//</span>
01003 
01004         CommandMessage.MessageHeader.u2.ZeroInit = 0;
01005         CommandMessage.MessageHeader.u1.s1.TotalLength =
01006             ((CSHORT) RM_COMMAND_MESSAGE_HEADER_SIZE +
01007             (CSHORT) WorkQueueItem-&gt;<a class="code" href="../../d8/d1/struct__SEP__LSA__WORK__ITEM.html#o7">CommandParamsLength</a>);
01008         CommandMessage.MessageHeader.u1.s1.DataLength =
01009             CommandMessage.MessageHeader.u1.s1.TotalLength -
01010             (CSHORT) <span class="keyword">sizeof</span>(PORT_MESSAGE);
01011 
01012         <a class="code" href="../../d3/d8/client_8c.html#a125">ReplyMessage</a>.MessageHeader.u2.ZeroInit = 0;
01013         <a class="code" href="../../d3/d8/client_8c.html#a125">ReplyMessage</a>.MessageHeader.u1.s1.DataLength = (CSHORT) WorkQueueItem-&gt;<a class="code" href="../../d8/d1/struct__SEP__LSA__WORK__ITEM.html#o9">ReplyBufferLength</a>;
01014         <a class="code" href="../../d3/d8/client_8c.html#a125">ReplyMessage</a>.MessageHeader.u1.s1.TotalLength =
01015             <a class="code" href="../../d3/d8/client_8c.html#a125">ReplyMessage</a>.MessageHeader.u1.s1.DataLength +
01016             (CSHORT) <span class="keyword">sizeof</span>(PORT_MESSAGE);
01017 
01018         <span class="comment">//</span>
01019         <span class="comment">// Next, fill in the header info needed by the LSA.</span>
01020         <span class="comment">//</span>
01021 
01022         CommandMessage.CommandNumber = WorkQueueItem-&gt;<a class="code" href="../../d8/d1/struct__SEP__LSA__WORK__ITEM.html#o6">CommandNumber</a>;
01023         <a class="code" href="../../d3/d8/client_8c.html#a125">ReplyMessage</a>.ReturnedStatus = STATUS_SUCCESS;
01024 
01025         <span class="comment">//</span>
01026         <span class="comment">// Set up the Command Parameters either in the LPC Command Message</span>
01027         <span class="comment">// itself, in the preallocated Lsa shared memory block, or in a</span>
01028         <span class="comment">// specially allocated block.  The parameters are either</span>
01029         <span class="comment">// immediate (i.e. in the WorkQueueItem itself, or are in a buffer</span>
01030         <span class="comment">// pointed to by the address in the WorkQueueItem.</span>
01031         <span class="comment">//</span>
01032 
01033         <span class="keywordflow">switch</span> (WorkQueueItem-&gt;<a class="code" href="../../d8/d1/struct__SEP__LSA__WORK__ITEM.html#o1">CommandParamsMemoryType</a>) {
01034 
01035         <span class="keywordflow">case</span> SepRmImmediateMemory:
01036 
01037             <span class="comment">//</span>
01038             <span class="comment">// The Command Parameters are in the CommandParams buffer</span>
01039             <span class="comment">// in the Work Queue Item.  Just copy them to the corresponding</span>
01040             <span class="comment">// buffer in the CommandMessage buffer.</span>
01041             <span class="comment">//</span>
01042 
01043             CommandMessage.CommandParamsMemoryType = SepRmImmediateMemory;
01044 
01045             RtlCopyMemory(
01046                 CommandMessage.CommandParams,
01047                 &amp;WorkQueueItem-&gt;<a class="code" href="../../d8/d1/struct__SEP__LSA__WORK__ITEM.html#o5">CommandParams</a>,
01048                 WorkQueueItem-&gt;<a class="code" href="../../d8/d1/struct__SEP__LSA__WORK__ITEM.html#o7">CommandParamsLength</a>
01049                 );
01050 
01051             <span class="keywordflow">break</span>;
01052 
01053         <span class="keywordflow">case</span> SepRmPagedPoolMemory:
01054         <span class="keywordflow">case</span> SepRmUnspecifiedMemory:
01055 
01056             <span class="comment">//</span>
01057             <span class="comment">// The Command Parameters are contained in paged pool memory.</span>
01058             <span class="comment">// Since this memory is is not accessible by the LSA, we must</span>
01059             <span class="comment">// copy of them either to the LPC Command Message Block, or</span>
01060             <span class="comment">// into LSA shared memory.</span>
01061             <span class="comment">//</span>
01062 
01063             <span class="keywordflow">if</span> (WorkQueueItem-&gt;<a class="code" href="../../d8/d1/struct__SEP__LSA__WORK__ITEM.html#o7">CommandParamsLength</a> &lt;= LSA_MAXIMUM_COMMAND_PARAM_SIZE) {
01064 
01065                 <span class="comment">//</span>
01066                 <span class="comment">// Parameters will fit into the LPC Command Message block.</span>
01067                 <span class="comment">//</span>
01068 
01069                 CopiedCommandParams = CommandMessage.CommandParams;
01070 
01071                 RtlCopyMemory(
01072                     CopiedCommandParams,
01073                     WorkQueueItem-&gt;<a class="code" href="../../d8/d1/struct__SEP__LSA__WORK__ITEM.html#o5">CommandParams</a>.BaseAddress,
01074                     WorkQueueItem-&gt;<a class="code" href="../../d8/d1/struct__SEP__LSA__WORK__ITEM.html#o7">CommandParamsLength</a>
01075                     );
01076 
01077                 CommandMessage.CommandParamsMemoryType = SepRmImmediateMemory;
01078 
01079             } <span class="keywordflow">else</span> {
01080 
01081                 <span class="comment">//</span>
01082                 <span class="comment">// Parameters too large for LPC Command Message block.</span>
01083                 <span class="comment">// If possible, copy them to the preallocated Lsa Shared</span>
01084                 <span class="comment">// Memory block.  If they are too large to fit, copy them</span>
01085                 <span class="comment">// to an individually allocated chunk of Shared Virtual</span>
01086                 <span class="comment">// Memory.</span>
01087                 <span class="comment">//</span>
01088 
01089                 <span class="keywordflow">if</span> (WorkQueueItem-&gt;<a class="code" href="../../d8/d1/struct__SEP__LSA__WORK__ITEM.html#o7">CommandParamsLength</a> &lt;= <a class="code" href="../../d1/d0/rmp_8h.html#a6">SEP_RM_LSA_SHARED_MEMORY_SIZE</a>) {
01090 
01091                     RtlCopyMemory(
01092                         <a class="code" href="../../d1/d0/rmp_8h.html#a20">SepRmState</a>.<a class="code" href="../../d1/d2/struct__SEP__RM__STATE.html#o9">RmViewPortMemory</a>,
01093                         WorkQueueItem-&gt;<a class="code" href="../../d8/d1/struct__SEP__LSA__WORK__ITEM.html#o5">CommandParams</a>.BaseAddress,
01094                         WorkQueueItem-&gt;<a class="code" href="../../d8/d1/struct__SEP__LSA__WORK__ITEM.html#o7">CommandParamsLength</a>
01095                         );
01096 
01097                     LsaViewCopiedCommandParams = <a class="code" href="../../d1/d0/rmp_8h.html#a20">SepRmState</a>.<a class="code" href="../../d1/d2/struct__SEP__RM__STATE.html#o8">LsaViewPortMemory</a>;
01098                     CommandMessage.CommandParamsMemoryType = SepRmLsaCommandPortSharedMemory;
01099 
01100                 } <span class="keywordflow">else</span> {
01101 
01102                     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d0/d5/adtlog_8c.html#a4">SepAdtCopyToLsaSharedMemory</a>(
01103                                  SepLsaHandle,
01104                                  WorkQueueItem-&gt;<a class="code" href="../../d8/d1/struct__SEP__LSA__WORK__ITEM.html#o5">CommandParams</a>.BaseAddress,
01105                                  WorkQueueItem-&gt;<a class="code" href="../../d8/d1/struct__SEP__LSA__WORK__ITEM.html#o7">CommandParamsLength</a>,
01106                                  &amp;LsaViewCopiedCommandParams
01107                                  );
01108 
01109                     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01110 
01111                         <span class="comment">//</span>
01112                         <span class="comment">// An error occurred, most likely in allocating</span>
01113                         <span class="comment">// shared virtual memory.  For now, just ignore</span>
01114                         <span class="comment">// the error and discard the Audit Record.  Later,</span>
01115                         <span class="comment">// we may consider generating a warning record</span>
01116                         <span class="comment">// indicating some records lost.</span>
01117                         <span class="comment">//</span>
01118 
01119                         <span class="keywordflow">break</span>;
01120 
01121                     }
01122 
01123                     CommandMessage.CommandParamsMemoryType = SepRmLsaCustomSharedMemory;
01124                 }
01125 
01126                 <span class="comment">//</span>
01127                 <span class="comment">// Buffer has been successfully copied to a shared Lsa</span>
01128                 <span class="comment">// memory buffer.  Place the address of the buffer valid in</span>
01129                 <span class="comment">// the LSA's process context in the Command Message.</span>
01130                 <span class="comment">//</span>
01131 
01132                 *((PVOID *) CommandMessage.CommandParams) =
01133                     LsaViewCopiedCommandParams;
01134 
01135                 CommandMessage.MessageHeader.u1.s1.TotalLength =
01136                     ((CSHORT) RM_COMMAND_MESSAGE_HEADER_SIZE +
01137                     (CSHORT) <span class="keyword">sizeof</span>( LsaViewCopiedCommandParams ));
01138                 CommandMessage.MessageHeader.u1.s1.DataLength =
01139                     CommandMessage.MessageHeader.u1.s1.TotalLength -
01140                     (CSHORT) <span class="keyword">sizeof</span>(PORT_MESSAGE);
01141             }
01142 
01143             <span class="comment">//</span>
01144             <span class="comment">// Free input command params buffer if Paged Pool.</span>
01145             <span class="comment">//</span>
01146 
01147             <span class="keywordflow">if</span> (WorkQueueItem-&gt;<a class="code" href="../../d8/d1/struct__SEP__LSA__WORK__ITEM.html#o1">CommandParamsMemoryType</a> == SepRmPagedPoolMemory) {
01148 
01149                 <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( WorkQueueItem-&gt;<a class="code" href="../../d8/d1/struct__SEP__LSA__WORK__ITEM.html#o5">CommandParams</a>.BaseAddress );
01150             }
01151 
01152             <span class="keywordflow">break</span>;
01153 
01154         <span class="keywordflow">default</span>:
01155 
01156             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_INVALID_PARAMETER;
01157             <span class="keywordflow">break</span>;
01158         }
01159 
01160         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01161 
01162             <span class="comment">//</span>
01163             <span class="comment">// Send Message to the LSA via the LSA Server Command LPC Port.</span>
01164             <span class="comment">// This must be done in the process in which the handle was created.</span>
01165             <span class="comment">//</span>
01166 
01167             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwRequestWaitReplyPort(
01168                          <a class="code" href="../../d1/d0/rmp_8h.html#a20">SepRmState</a>.<a class="code" href="../../d1/d2/struct__SEP__RM__STATE.html#o1">LsaCommandPortHandle</a>,
01169                          (PPORT_MESSAGE) &amp;CommandMessage,
01170                          (PPORT_MESSAGE) &amp;ReplyMessage
01171                          );
01172 
01173             <span class="comment">//</span>
01174             <span class="comment">// If the command was successful, copy the data back to the output</span>
01175             <span class="comment">// buffer.</span>
01176             <span class="comment">//</span>
01177 
01178             <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01179 
01180                 <span class="comment">//</span>
01181                 <span class="comment">// Move output from command (if any) to buffer.  Note that this</span>
01182                 <span class="comment">// is done even if the command returns status, because some status</span>
01183                 <span class="comment">// values are not errors.</span>
01184                 <span class="comment">//</span>
01185 
01186                 <span class="keywordflow">if</span> (ARGUMENT_PRESENT(WorkQueueItem-&gt;<a class="code" href="../../d8/d1/struct__SEP__LSA__WORK__ITEM.html#o8">ReplyBuffer</a>)) {
01187 
01188                     RtlCopyMemory(
01189                         WorkQueueItem-&gt;<a class="code" href="../../d8/d1/struct__SEP__LSA__WORK__ITEM.html#o8">ReplyBuffer</a>,
01190                         <a class="code" href="../../d3/d8/client_8c.html#a125">ReplyMessage</a>.ReplyBuffer,
01191                         WorkQueueItem-&gt;<a class="code" href="../../d8/d1/struct__SEP__LSA__WORK__ITEM.html#o9">ReplyBufferLength</a>
01192                         );
01193                 }
01194 
01195                 <span class="comment">//</span>
01196                 <span class="comment">// Return status from command.</span>
01197                 <span class="comment">//</span>
01198 
01199                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d3/d8/client_8c.html#a125">ReplyMessage</a>.ReturnedStatus;
01200 
01201                 <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01202                     KdPrint((<span class="stringliteral">"Security: Command sent from RM to LSA returned 0x%lx\n"</span>,
01203                         Status));
01204                 }
01205 
01206             } <span class="keywordflow">else</span> {
01207 
01208                 KdPrint((<span class="stringliteral">"Security: Sending Command RM to LSA failed 0x%lx\n"</span>, Status));
01209             }
01210 
01211             <span class="comment">//</span>
01212             <span class="comment">// On return from the LPC call to the LSA, we expect the called</span>
01213             <span class="comment">// LSA worker routine to have copied the Command Parameters</span>
01214             <span class="comment">// buffer (if any).  If a custom shared memory boffer was allocated,</span>
01215             <span class="comment">// free it now.</span>
01216             <span class="comment">//</span>
01217 
01218             <span class="keywordflow">if</span> (CommandMessage.CommandParamsMemoryType == SepRmLsaCustomSharedMemory) {
01219 
01220                 RegionSize = 0;
01221 
01222                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwFreeVirtualMemory(
01223                              SepLsaHandle,
01224                              (PVOID *) &amp;CommandMessage.CommandParams,
01225                              &amp;RegionSize,
01226                              MEM_RELEASE
01227                              );
01228 
01229                 <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status));
01230             }
01231 
01232         }
01233 
01234 
01235         <span class="comment">//</span>
01236         <span class="comment">// Clean up.  We must call the cleanup functions on its parameter</span>
01237         <span class="comment">// and then free the used WorkQueueItem itself.</span>
01238         <span class="comment">//</span>
01239 
01240         <span class="keywordflow">if</span> ( ARGUMENT_PRESENT( WorkQueueItem-&gt;<a class="code" href="../../d8/d1/struct__SEP__LSA__WORK__ITEM.html#o10">CleanupFunction</a>)) {
01241 
01242             (WorkQueueItem-&gt;<a class="code" href="../../d8/d1/struct__SEP__LSA__WORK__ITEM.html#o10">CleanupFunction</a>)(WorkQueueItem-&gt;<a class="code" href="../../d8/d1/struct__SEP__LSA__WORK__ITEM.html#o11">CleanupParameter</a>);
01243         }
01244 
01245         <span class="comment">//</span>
01246         <span class="comment">// Determine if there is more work to do on this list</span>
01247         <span class="comment">//</span>
01248 
01249         WorkQueueItem = <a class="code" href="../../d0/d5/adtlog_8c.html#a6">SepDequeueWorkItem</a>();
01250 <span class="preprocessor">#if 0</span>
01251 <span class="preprocessor"></span>      <span class="keywordflow">if</span> ( WorkQueueItem ) {
01252             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Got another item from list, going back\n"</span>);
01253       } <span class="keywordflow">else</span> {
01254           <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"List is empty, leaving\n"</span>);
01255       }
01256 <span class="preprocessor">#endif</span>
01257 <span class="preprocessor"></span>
01258 
01259     }
01260 
01261     <a class="code" href="../../d3/d5/procobj_8c.html#a7">KeDetachProcess</a>();
01262 
01263     <span class="keywordflow">if</span> ( LocalListLength &gt; <a class="code" href="../../d8/d5/seglobal_8c.html#a96">SepLsaQueueLength</a> ) {
01264         <a class="code" href="../../d8/d5/seglobal_8c.html#a96">SepLsaQueueLength</a> = LocalListLength;
01265     }
01266 
01267     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01268 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a52" doxytag="sep.h::SepRmInitPhase0" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN SepRmInitPhase0           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d9/rmmain_8c-source.html#l01275">1275</a> of file <a class="el" href="../../d1/d9/rmmain_8c-source.html">rmmain.c</a>.
<p>
References <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, and <a class="el" href="../../d3/d9/rmvars_8c-source.html#l00095">SepRmDbInitialization()</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/seinit_8c-source.html#l00078">SepInitializationPhase0()</a>.
<p>
<pre class="fragment"><div>01280                    :
01281 
01282     This function performs Reference Monitor Phase 0 initialization.
01283     This includes initializing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> reference monitor database to a state
01284     which allows access validation <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a24">routines</a> to operate (always granting
01285     access) prior to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d3/d9/arcinst_8c.html#a19">main</a> init of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Reference Monitor in Phase 1
01286     initialization, without having to check <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> RM <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> initialized.
01287 
01288 
01289 Arguments:
01290 
01291     None.
01292 
01293 Return Value:
01294 
01295    BOOLEAN - <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <span class="keywordflow">if</span> successful, <span class="keywordflow">else</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>
01296 
01297 --*/
01298 
01299 {
01300 
01301     BOOLEAN CompletionStatus;
01302 
01303     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
01304 
01305     CompletionStatus = <a class="code" href="../../d2/d0/rmvars_8c.html#a4">SepRmDbInitialization</a>();
01306 
01307     <span class="keywordflow">return</span> CompletionStatus;
01308 }
}
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a61" doxytag="sep.h::SepSidInToken" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN SepSidInToken           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PACCESS_TOKEN&nbsp;</td>
          <td class="mdname" nowrap> <em>Token</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSID&nbsp;</td>
          <td class="mdname" nowrap> <em>PrincipalSelfSid</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSID&nbsp;</td>
          <td class="mdname" nowrap> <em>Sid</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>DenyAce</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d3/accessck_8c-source.html#l00733">733</a> of file <a class="el" href="../../d1/d3/accessck_8c-source.html">accessck.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d6/d2/parseini_8c-source.html#l00038">PTOKEN</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l00871">RtlEqualSid()</a>, <a class="el" href="../../d2/d4/seassign_8c-source.html#l00995">SepDumpTokenInfo()</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01615">SePrincipalSelfSid</a>, <a class="el" href="../../d7/d9/ctaccess_8c-source.html#l00123">Token</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d1/d3/accessck_8c-source.html#l01564">SepAccessCheck()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l03952">SepExamineSacl()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l04257">SepExamineSaclEx()</a>, and <a class="el" href="../../d1/d3/accessck_8c-source.html#l03796">SepTokenIsOwner()</a>.
<p>
<pre class="fragment"><div>00742                    :
00743 
00744     Checks to see <span class="keywordflow">if</span> a given SID <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> given token.
00745 
00746     N.B. The code to compute <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> length of a SID and test <span class="keywordflow">for</span> equality
00747          <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> duplicated from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> security runtime since <span class="keyword">this</span> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> such a
00748          frequently used routine.
00749 
00750 Arguments:
00751 
00752     <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a> - Pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> token to be examined
00753 
00754     PrincipalSelfSid - If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object being access checked <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> an object which
00755         represents a principal (e.g., a user object), <span class="keyword">this</span> parameter should
00756         be <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> SID of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object.  Any ACE containing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> constant
00757         PRINCIPAL_SELF_SID <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> replaced by <span class="keyword">this</span> SID.
00758 
00759         The parameter should be <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object does not represent a principal.
00760 
00761 
00762     Sid - Pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> SID of interest
00763 
00764 Return Value:
00765 
00766     <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> value of <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> indicates that <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> SID <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> token, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>
00767     otherwise.
00768 
00769 --*/
00770 
00771 {
00772 
00773     ULONG i;
00774     PISID MatchSid;
00775     ULONG SidLength;
00776     <a class="code" href="../../d5/d3/parseini_8c.html#a4">PTOKEN</a> <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>;
00777     PSID_AND_ATTRIBUTES TokenSid;
00778     ULONG UserAndGroupCount;
00779 
00780     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00781 
00782 <span class="preprocessor">#if DBG</span>
00783 <span class="preprocessor"></span>
00784     <a class="code" href="../../d6/d6/sep_8h.html#a59">SepDumpTokenInfo</a>(AToken);
00785 
00786 <span class="preprocessor">#endif</span>
00787 <span class="preprocessor"></span>
00788     <span class="comment">//</span>
00789     <span class="comment">// If Sid is the constant PrincipalSelfSid,</span>
00790     <span class="comment">//  replace it with the passed in PrincipalSelfSid.</span>
00791     <span class="comment">//</span>
00792 
00793     <span class="keywordflow">if</span> ( PrincipalSelfSid != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> &amp;&amp;
00794          <a class="code" href="../../d8/d6/sertl_8c.html#a36">RtlEqualSid</a>( SePrincipalSelfSid, Sid ) ) {
00795         Sid = PrincipalSelfSid;
00796     }
00797 
00798     <span class="comment">//</span>
00799     <span class="comment">// Get the length of the source SID since this only needs to be computed</span>
00800     <span class="comment">// once.</span>
00801     <span class="comment">//</span>
00802 
00803     SidLength = 8 + (4 * ((PISID)Sid)-&gt;SubAuthorityCount);
00804 
00805     <span class="comment">//</span>
00806     <span class="comment">// Get address of user/group array and number of user/groups.</span>
00807     <span class="comment">//</span>
00808 
00809     <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a> = (<a class="code" href="../../d5/d3/parseini_8c.html#a4">PTOKEN</a>)AToken;
00810     TokenSid = <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;UserAndGroups;
00811     UserAndGroupCount = <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;UserAndGroupCount;
00812 
00813     <span class="comment">//</span>
00814     <span class="comment">// Scan through the user/groups and attempt to find a match with the</span>
00815     <span class="comment">// specified SID.</span>
00816     <span class="comment">//</span>
00817 
00818     <span class="keywordflow">for</span> (i = 0 ; i &lt; UserAndGroupCount ; i += 1) {
00819         MatchSid = (PISID)TokenSid-&gt;Sid;
00820 
00821         <span class="comment">//</span>
00822         <span class="comment">// If the SID revision and length matches, then compare the SIDs</span>
00823         <span class="comment">// for equality.</span>
00824         <span class="comment">//</span>
00825 
00826         <span class="keywordflow">if</span> ((((PISID)Sid)-&gt;Revision == MatchSid-&gt;Revision) &amp;&amp;
00827             (SidLength == (8 + (4 * (ULONG)MatchSid-&gt;SubAuthorityCount)))) {
00828             <span class="keywordflow">if</span> (RtlEqualMemory(Sid, MatchSid, SidLength)) {
00829 
00830                 <span class="comment">//</span>
00831                 <span class="comment">// If this is the first one in the list, then it is the User,</span>
00832                 <span class="comment">// and return success immediately.</span>
00833                 <span class="comment">//</span>
00834                 <span class="comment">// If this is not the first one, then it represents a group,</span>
00835                 <span class="comment">// and we must make sure the group is currently enabled before</span>
00836                 <span class="comment">// we can say that the group is "in" the token.</span>
00837                 <span class="comment">//</span>
00838 
00839                 <span class="keywordflow">if</span> ((i == 0) || (TokenSid-&gt;Attributes &amp; SE_GROUP_ENABLED) ||
00840                     (DenyAce &amp;&amp; (TokenSid-&gt;Attributes &amp; SE_GROUP_USE_FOR_DENY_ONLY))) {
00841                     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00842 
00843                 } <span class="keywordflow">else</span> {
00844                     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00845                 }
00846             }
00847         }
00848 
00849         TokenSid += 1;
00850     }
00851 
00852     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00853 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a58" doxytag="sep.h::SepSidTranslation" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN SepSidTranslation           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PSID&nbsp;</td>
          <td class="mdname" nowrap> <em>Sid</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PSTRING&nbsp;</td>
          <td class="mdname" nowrap> <em>AccountName</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d4/seassign_8c-source.html#l01065">1065</a> of file <a class="el" href="../../d2/d4/seassign_8c-source.html">seassign.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l00871">RtlEqualSid()</a>, <a class="el" href="../../d3/d6/string_8c-source.html#l00056">RtlInitString()</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01626">SeBatchSid</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01614">SeCreatorGroupServerSid</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01612">SeCreatorGroupSid</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01613">SeCreatorOwnerServerSid</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01611">SeCreatorOwnerSid</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01627">SeInteractiveSid</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01610">SeLocalSid</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01628">SeLocalSystemSid</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01625">SeNetworkSid</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01609">SeWorldSid</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d2/d4/seassign_8c-source.html#l00916">SepPrintSid()</a>.
<p>
<pre class="fragment"><div>01072                    :
01073 
01074     This routine translates well-known SIDs into English names.
01075 
01076 Arguments:
01077 
01078     Sid - Provides <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> sid to be examined.
01079 
01080     AccountName - Provides a string buffer in which to place <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
01081         translated name.
01082 
01083 Return Value:
01084 
01085     None
01086 
01087 --*/
01088 
01089 <span class="comment">// AccountName is expected to have a large maximum length</span>
01090 
01091 {
01092     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
01093 
01094     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d6/sertl_8c.html#a36">RtlEqualSid</a>(Sid, SeWorldSid)) {
01095         <a class="code" href="../../d2/d7/string_8c.html#a5">RtlInitString</a>( AccountName, <span class="stringliteral">"WORLD         "</span>);
01096         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
01097     }
01098 
01099     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d6/sertl_8c.html#a36">RtlEqualSid</a>(Sid, SeLocalSid)) {
01100         <a class="code" href="../../d2/d7/string_8c.html#a5">RtlInitString</a>( AccountName, <span class="stringliteral">"LOCAL         "</span>);
01101         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
01102     }
01103 
01104     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d6/sertl_8c.html#a36">RtlEqualSid</a>(Sid, SeNetworkSid)) {
01105         <a class="code" href="../../d2/d7/string_8c.html#a5">RtlInitString</a>( AccountName, <span class="stringliteral">"NETWORK       "</span>);
01106         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
01107     }
01108 
01109     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d6/sertl_8c.html#a36">RtlEqualSid</a>(Sid, SeBatchSid)) {
01110         <a class="code" href="../../d2/d7/string_8c.html#a5">RtlInitString</a>( AccountName, <span class="stringliteral">"BATCH         "</span>);
01111         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
01112     }
01113 
01114     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d6/sertl_8c.html#a36">RtlEqualSid</a>(Sid, SeInteractiveSid)) {
01115         <a class="code" href="../../d2/d7/string_8c.html#a5">RtlInitString</a>( AccountName, <span class="stringliteral">"INTERACTIVE   "</span>);
01116         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
01117     }
01118 
01119     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d6/sertl_8c.html#a36">RtlEqualSid</a>(Sid, SeLocalSystemSid)) {
01120         <a class="code" href="../../d2/d7/string_8c.html#a5">RtlInitString</a>( AccountName, <span class="stringliteral">"SYSTEM        "</span>);
01121         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
01122     }
01123 
01124     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d6/sertl_8c.html#a36">RtlEqualSid</a>(Sid, SeCreatorOwnerSid)) {
01125         <a class="code" href="../../d2/d7/string_8c.html#a5">RtlInitString</a>( AccountName, <span class="stringliteral">"CREATOR_OWNER "</span>);
01126         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
01127     }
01128 
01129     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d6/sertl_8c.html#a36">RtlEqualSid</a>(Sid, SeCreatorGroupSid)) {
01130         <a class="code" href="../../d2/d7/string_8c.html#a5">RtlInitString</a>( AccountName, <span class="stringliteral">"CREATOR_GROUP "</span>);
01131         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
01132     }
01133 
01134     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d6/sertl_8c.html#a36">RtlEqualSid</a>(Sid, SeCreatorOwnerServerSid)) {
01135         <a class="code" href="../../d2/d7/string_8c.html#a5">RtlInitString</a>( AccountName, <span class="stringliteral">"CREATOR_OWNER_SERVER "</span>);
01136         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
01137     }
01138 
01139     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d6/sertl_8c.html#a36">RtlEqualSid</a>(Sid, SeCreatorGroupServerSid)) {
01140         <a class="code" href="../../d2/d7/string_8c.html#a5">RtlInitString</a>( AccountName, <span class="stringliteral">"CREATOR_GROUP_SERVER "</span>);
01141         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
01142     }
01143 
01144     <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
01145 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a49" doxytag="sep.h::SepSinglePrivilegeCheck" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN SepSinglePrivilegeCheck           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">LUID&nbsp;</td>
          <td class="mdname" nowrap> <em>DesiredPrivilege</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PACCESS_TOKEN&nbsp;</td>
          <td class="mdname" nowrap> <em>EffectiveToken</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>PreviousMode</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d4/seaudit_8c-source.html#l00143">143</a> of file <a class="el" href="../../d4/d4/seaudit_8c-source.html">seaudit.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d9/d3/privileg_8c-source.html#l00038">SepPrivilegeCheck()</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01675">SeTcbPrivilege</a>, and <a class="el" href="../../d7/d9/ctaccess_8c-source.html#l00123">Token</a>.
<p>
Referenced by <a class="el" href="../../d1/d3/accessck_8c-source.html#l01564">SepAccessCheck()</a>, and <a class="el" href="../../d1/d3/accessck_8c-source.html#l03652">SePrivilegePolicyCheck()</a>.
<p>
<pre class="fragment"><div>00151                    :
00152 
00153     Determines <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> passed token has <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> passed privilege.
00154 
00155 Arguments:
00156 
00157     DesiredPrivilege - The privilege to be tested <span class="keywordflow">for</span>.
00158 
00159     <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a> - The token being examined.
00160 
00161     PreviousMode - The previous processor mode.
00162 
00163 Return Value:
00164 
00165     Returns <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> subject has <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> passed privilege, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> otherwise.
00166 
00167 --*/
00168 
00169 {
00170 
00171    LUID_AND_ATTRIBUTES Privilege;
00172    BOOLEAN Result;
00173 
00174    <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00175 
00176    <span class="comment">//</span>
00177    <span class="comment">// Don't let anyone call this to test for SeTcbPrivilege</span>
00178    <span class="comment">//</span>
00179 
00180    <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(!((DesiredPrivilege.LowPart == <a class="code" href="../../d0/d5/se_8h.html#a84">SeTcbPrivilege</a>.LowPart) &amp;&amp;
00181             (DesiredPrivilege.HighPart == <a class="code" href="../../d0/d5/se_8h.html#a84">SeTcbPrivilege</a>.HighPart)));
00182 
00183    Privilege.Luid = DesiredPrivilege;
00184    Privilege.Attributes = 0;
00185 
00186    Result = <a class="code" href="../../d8/d3/tokenp_8h.html#a37">SepPrivilegeCheck</a>(
00187                Token,
00188                &amp;Privilege,
00189                1,
00190                PRIVILEGE_SET_ALL_NECESSARY,
00191                PreviousMode
00192                );
00193 
00194    <span class="keywordflow">return</span>(Result);
00195 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a54" doxytag="sep.h::SepTokenIsOwner" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN SepTokenIsOwner           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PACCESS_TOKEN&nbsp;</td>
          <td class="mdname" nowrap> <em>Token</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSECURITY_DESCRIPTOR&nbsp;</td>
          <td class="mdname" nowrap> <em>SecurityDescriptor</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>TokenLocked</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d3/accessck_8c-source.html#l03796">3796</a> of file <a class="el" href="../../d1/d3/accessck_8c-source.html">accessck.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d7/d5/sep_8h-source.html#l00165">EffectiveToken</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d9/ctaccess_8c-source.html#l00159">Owner</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d6/d2/parseini_8c-source.html#l00038">PTOKEN</a>, <a class="el" href="../../d9/d2/tokenp_8h-source.html#l00413">SepAcquireTokenReadLock</a>, <a class="el" href="../../d9/d2/tokenp_8h-source.html#l00419">SepReleaseTokenReadLock</a>, <a class="el" href="../../d1/d3/accessck_8c-source.html#l00733">SepSidInToken()</a>, <a class="el" href="../../d1/d3/accessck_8c-source.html#l00856">SepSidInTokenEx()</a>, <a class="el" href="../../d7/d9/ctaccess_8c-source.html#l00123">Token</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l00076">TOKEN_IS_RESTRICTED</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d1/d3/accessck_8c-source.html#l03323">SeAccessCheck()</a>, <a class="el" href="../../d1/d3/accessck_8c-source.html#l02704">SeAccessCheckByType()</a>, and <a class="el" href="../../d4/d4/seaudit_8c-source.html#l01050">SepAccessCheckAndAuditAlarm()</a>.
<p>
<pre class="fragment"><div>03804                    :
03805 
03806     This routine will determine of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d6/d0/ctaccess_8c.html#a53">Owner</a> of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> passed security descriptor
03807     <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> passed token. If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> token <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> restricted <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> cannot be <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
03808     owner.
03809 
03810 
03811 Arguments:
03812 
03813     <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a> - The token representing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current user.
03814 
03815     SecurityDescriptor - The security descriptor <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object being
03816         accessed.
03817 
03818     TokenLocked - <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> <span class="keywordtype">boolean</span> describing whether <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller has taken
03819         a read lock <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> token.
03820 
03821 
03822 Return Value:
03823 
03824     <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> - The user of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> token <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> owner of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object.
03825 
03826     <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> - The user of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> token <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> owner of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object.
03827 
03828 --*/
03829 
03830 {
03831     PSID <a class="code" href="../../d6/d0/ctaccess_8c.html#a53">Owner</a>;
03832     BOOLEAN rc;
03833 
03834     PISECURITY_DESCRIPTOR ISecurityDescriptor;
03835     <a class="code" href="../../d5/d3/parseini_8c.html#a4">PTOKEN</a> <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>;
03836 
03837     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
03838 
03839     ISecurityDescriptor = (PISECURITY_DESCRIPTOR)SecurityDescriptor;
03840     <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a> = (<a class="code" href="../../d5/d3/parseini_8c.html#a4">PTOKEN</a>)<a class="code" href="../../d6/d6/sep_8h.html#a7">EffectiveToken</a>;
03841 
03842     <span class="keywordflow">if</span> (!TokenLocked) {
03843         <a class="code" href="../../d8/d3/tokenp_8h.html#a6">SepAcquireTokenReadLock</a>( Token );
03844     }
03845 
03846     <a class="code" href="../../d6/d0/ctaccess_8c.html#a53">Owner</a> = RtlpOwnerAddrSecurityDescriptor( ISecurityDescriptor );
03847     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( Owner != NULL );
03848 
03849     rc = <a class="code" href="../../d6/d6/sep_8h.html#a61">SepSidInToken</a>( Token, NULL, Owner, FALSE );
03850 
03851     <span class="comment">//</span>
03852     <span class="comment">// For restricted tokens, check the restricted sids too.</span>
03853     <span class="comment">//</span>
03854 
03855     <span class="keywordflow">if</span> (rc &amp;&amp; (<a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;TokenFlags &amp; <a class="code" href="../../d0/d5/se_8h.html#a5">TOKEN_IS_RESTRICTED</a>) != 0) {
03856         rc = <a class="code" href="../../d0/d4/accessck_8c.html#a8">SepSidInTokenEx</a>( Token, NULL, Owner, FALSE, TRUE );
03857 
03858     }
03859 
03860     <span class="keywordflow">if</span> (!TokenLocked) {
03861         <a class="code" href="../../d8/d3/tokenp_8h.html#a8">SepReleaseTokenReadLock</a>( Token );
03862     }
03863 
03864     <span class="keywordflow">return</span>( rc );
03865 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a45" doxytag="sep.h::SepValidOwnerSubjectContext" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN SepValidOwnerSubjectContext           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">PSECURITY_SUBJECT_CONTEXT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>SubjectContext</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSID&nbsp;</td>
          <td class="mdname" nowrap> <em>Owner</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>ServerObject</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d7/subject_8c-source.html#l00381">381</a> of file <a class="el" href="../../d1/d7/subject_8c-source.html">subject.c</a>.
<p>
References <a class="el" href="../../d7/d5/sep_8h-source.html#l00165">EffectiveToken</a>, <a class="el" href="../../d0/d1/fedefs_8h-source.html#l00051">exit</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d9/cmchek_8c-source.html#l00095">Index</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d9/ctaccess_8c-source.html#l00159">Owner</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d6/d2/parseini_8c-source.html#l00038">PTOKEN</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l00871">RtlEqualSid()</a>, <a class="el" href="../../d9/d2/tokenp_8h-source.html#l00413">SepAcquireTokenReadLock</a>, <a class="el" href="../../d5/d2/token_8c-source.html#l02813">SepIdAssignableAsOwner()</a>, <a class="el" href="../../d9/d2/tokenp_8h-source.html#l00419">SepReleaseTokenReadLock</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01686">SeRestorePrivilege</a>, <a class="el" href="../../d9/d3/privileg_8c-source.html#l00436">SeSinglePrivilegeCheck()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d0/d9/ntosdef_8h.html#a76a70">UserMode</a>.
<p>
Referenced by <a class="el" href="../../d9/d5/sertl_8c-source.html#l09057">RtlpNewSecurityObject()</a>, and <a class="el" href="../../d9/d5/sertl_8c-source.html#l10195">RtlpSetSecurityObject()</a>.
<p>
<pre class="fragment"><div>00388                    :
00389 
00390     This routine checks to see whether <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> provided SID <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> one <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> subject
00391     <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> authorized to assign as <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> owner of objects.  It will also check to
00392     see <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller has <a class="code" href="../../d0/d5/se_8h.html#a95">SeRestorePrivilege</a>, <span class="keywordflow">if</span> so, <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> request <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> granted.
00393 
00394 Arguments:
00395 
00396     SubjectContext - Points to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> subject's security context.
00397 
00398     <a class="code" href="../../d6/d0/ctaccess_8c.html#a53">Owner</a> - Points to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> SID to be checked.
00399 
00400 
00401 
00402 Return Value:
00403 
00404     none.
00405 
00406 --*/
00407 
00408 {
00409 
00410     ULONG <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>;
00411     BOOLEAN Found;
00412     <a class="code" href="../../d5/d3/parseini_8c.html#a4">PTOKEN</a> <a class="code" href="../../d6/d6/sep_8h.html#a7">EffectiveToken</a>;
00413     BOOLEAN Rc = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00414 
00415     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00416 
00417     <span class="comment">//</span>
00418     <span class="comment">// It is invalid to assign a NULL owner, regardless of</span>
00419     <span class="comment">// whether you have SeRestorePrivilege or not.</span>
00420     <span class="comment">//</span>
00421 
00422     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d0/ctaccess_8c.html#a53">Owner</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00423         <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> );
00424     }
00425 
00426     <span class="comment">//</span>
00427     <span class="comment">// Allowable owners come from the primary if it's a server object.</span>
00428     <span class="comment">//</span>
00429 
00430     <span class="keywordflow">if</span> (!ServerObject &amp;&amp; ARGUMENT_PRESENT(SubjectContext-&gt;ClientToken)) {
00431         <a class="code" href="../../d6/d6/sep_8h.html#a7">EffectiveToken</a> = (<a class="code" href="../../d5/d3/parseini_8c.html#a4">PTOKEN</a>)SubjectContext-&gt;ClientToken;
00432     } <span class="keywordflow">else</span> {
00433         <a class="code" href="../../d6/d6/sep_8h.html#a7">EffectiveToken</a> = (<a class="code" href="../../d5/d3/parseini_8c.html#a4">PTOKEN</a>)SubjectContext-&gt;PrimaryToken;
00434     }
00435 
00436 
00437     <span class="comment">//</span>
00438     <span class="comment">// If we're impersonating, make sure we're at TokenImpersonation</span>
00439     <span class="comment">// or above.  This prevents someone from setting the owner of an</span>
00440     <span class="comment">// object when impersonating at less Identify or Anonymous.</span>
00441     <span class="comment">//</span>
00442 
00443     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d6/sep_8h.html#a7">EffectiveToken</a>-&gt;TokenType == TokenImpersonation) {
00444 
00445         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d6/sep_8h.html#a7">EffectiveToken</a>-&gt;ImpersonationLevel &lt; SecurityImpersonation) {
00446 
00447             <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> );
00448 
00449         }
00450     }
00451 
00452     <a class="code" href="../../d8/d3/tokenp_8h.html#a6">SepAcquireTokenReadLock</a>( EffectiveToken );
00453 
00454     <span class="comment">//</span>
00455     <span class="comment">//  Walk through the list of user and group IDs looking</span>
00456     <span class="comment">//  for a match to the specified SID.  If one is found,</span>
00457     <span class="comment">//  make sure it may be assigned as an owner.</span>
00458     <span class="comment">//</span>
00459     <span class="comment">//  This code is similar to that performed to set the default</span>
00460     <span class="comment">//  owner of a token (NtSetInformationToken).</span>
00461     <span class="comment">//</span>
00462 
00463     <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = 0;
00464     <span class="keywordflow">while</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> &lt; <a class="code" href="../../d6/d6/sep_8h.html#a7">EffectiveToken</a>-&gt;UserAndGroupCount) {
00465 
00466 
00467         Found = <a class="code" href="../../d8/d6/sertl_8c.html#a36">RtlEqualSid</a>(
00468                     Owner,
00469                     <a class="code" href="../../d6/d6/sep_8h.html#a7">EffectiveToken</a>-&gt;UserAndGroups[Index].Sid
00470                     );
00471 
00472         <span class="keywordflow">if</span> ( Found ) {
00473 
00474             <span class="comment">//</span>
00475             <span class="comment">// We may return success if the Sid is one that may be assigned</span>
00476             <span class="comment">// as an owner, or if the caller has SeRestorePrivilege</span>
00477             <span class="comment">//</span>
00478 
00479             <span class="keywordflow">if</span> ( <a class="code" href="../../d8/d3/tokenp_8h.html#a33">SepIdAssignableAsOwner</a>(EffectiveToken,Index) ) {
00480 
00481                 <a class="code" href="../../d8/d3/tokenp_8h.html#a8">SepReleaseTokenReadLock</a>( EffectiveToken );
00482                 Rc = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00483                 <span class="keywordflow">goto</span> <a class="code" href="../../d9/d1/fedefs_8h.html#a16">exit</a>;
00484 
00485             } <span class="keywordflow">else</span> {
00486 
00487                 <span class="comment">//</span>
00488                 <span class="comment">// Rc is already set to FALSE, just exit.</span>
00489                 <span class="comment">//</span>
00490 
00491                 <a class="code" href="../../d8/d3/tokenp_8h.html#a8">SepReleaseTokenReadLock</a>( EffectiveToken );
00492                 <span class="keywordflow">goto</span> <a class="code" href="../../d9/d1/fedefs_8h.html#a16">exit</a>;
00493 
00494             } <span class="comment">//endif assignable</span>
00495 
00496 
00497         }  <span class="comment">//endif Found</span>
00498 
00499 
00500         <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> += 1;
00501 
00502     } <span class="comment">//endwhile</span>
00503 
00504 
00505     <a class="code" href="../../d8/d3/tokenp_8h.html#a8">SepReleaseTokenReadLock</a>( EffectiveToken );
00506 
00507 <a class="code" href="../../d9/d1/fedefs_8h.html#a16">exit</a>:
00508 
00509     <span class="comment">//</span>
00510     <span class="comment">// If we are going to fail this call, check for Restore privilege,</span>
00511     <span class="comment">// and succeed if he has it.</span>
00512     <span class="comment">//</span>
00513 
00514     <span class="comment">//</span>
00515     <span class="comment">// We should really have gotten PreviousMode from the caller, but we</span>
00516     <span class="comment">// didn't, so hard wire it to be user-mode here.</span>
00517     <span class="comment">//</span>
00518 
00519     <span class="keywordflow">if</span> ( Rc == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> ) {
00520         Rc = <a class="code" href="../../d8/d4/privileg_8c.html#a3">SeSinglePrivilegeCheck</a>( SeRestorePrivilege, UserMode );
00521     }
00522 
00523     <span class="keywordflow">return</span> Rc;
00524 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a38" doxytag="sep.h::SepVariableInitialization" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN SepVariableInitialization           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="a20" doxytag="sep.h::SepAuditShutdownEvents" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN <a class="el" href="../../d6/d6/sep_8h.html#a20">SepAuditShutdownEvents</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d5/sep_8h-source.html#l00267">267</a> of file <a class="el" href="../../d7/d5/sep_8h-source.html">sep.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a32" doxytag="sep.h::SepDequeueWorkItem" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d8/d1/struct__SEP__LSA__WORK__ITEM.html">PSEP_LSA_WORK_ITEM</a> SepDequeueWorkItem(VOID)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a31" doxytag="sep.h::SepExWorkItem" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d2/d2/struct__SEP__WORK__ITEM.html">SEP_WORK_ITEM</a> <a class="el" href="../../d6/d6/sep_8h.html#a31">SepExWorkItem</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d5/sep_8h-source.html#l00376">376</a> of file <a class="el" href="../../d7/d5/sep_8h-source.html">sep.h</a>.
<p>
Referenced by <a class="el" href="../../d1/d4/adtlog_8c-source.html#l00600">SepQueueWorkItem()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a19" doxytag="sep.h::SepLsaHandle" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HANDLE <a class="el" href="../../d6/d6/sep_8h.html#a19">SepLsaHandle</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d5/sep_8h-source.html#l00265">265</a> of file <a class="el" href="../../d7/d5/sep_8h-source.html">sep.h</a>.
<p>
Referenced by <a class="el" href="../../d1/d9/rmmain_8c-source.html#l00907">SepRmCallLsa()</a>, and <a class="el" href="../../d1/d9/rmmain_8c-source.html#l00466">SepRmCommandServerThreadInit()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a23" doxytag="sep.h::SepLsaQueue" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LIST_ENTRY <a class="el" href="../../d6/d6/sep_8h.html#a23">SepLsaQueue</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d5/sep_8h-source.html#l00281">281</a> of file <a class="el" href="../../d7/d5/sep_8h-source.html">sep.h</a>.
<p>
Referenced by <a class="el" href="../../d1/d4/adtlog_8c-source.html#l00738">SepDequeueWorkItem()</a>, <a class="el" href="../../d9/d4/seglobal_8c-source.html#l01152">SepInitializeWorkList()</a>, and <a class="el" href="../../d1/d4/adtlog_8c-source.html#l00600">SepQueueWorkItem()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a22" doxytag="sep.h::SepLsaQueueLength" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d6/d6/sep_8h.html#a22">SepLsaQueueLength</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d5/sep_8h-source.html#l00275">275</a> of file <a class="el" href="../../d7/d5/sep_8h-source.html">sep.h</a>.
<p>
Referenced by <a class="el" href="../../d1/d9/rmmain_8c-source.html#l00907">SepRmCallLsa()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a21" doxytag="sep.h::SepLsaQueueLock" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d6/d4/struct__ERESOURCE.html">ERESOURCE</a> <a class="el" href="../../d6/d6/sep_8h.html#a21">SepLsaQueueLock</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d5/sep_8h-source.html#l00273">273</a> of file <a class="el" href="../../d7/d5/sep_8h-source.html">sep.h</a>.
<p>
Referenced by <a class="el" href="../../d9/d4/seglobal_8c-source.html#l01152">SepInitializeWorkList()</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:45:35 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
