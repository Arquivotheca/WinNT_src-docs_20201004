<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: classc.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>classc.c</h1><a href="../../d5/d7/classc_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/****************************** Module Header ******************************\</span>
00002 <span class="comment">* Module Name: classc.c</span>
00003 <span class="comment">*</span>
00004 <span class="comment">* Copyright (c) 1985 - 1999, Microsoft Corporation</span>
00005 <span class="comment">*</span>
00006 <span class="comment">* This module contains</span>
00007 <span class="comment">*</span>
00008 <span class="comment">* History:</span>
00009 <span class="comment">* 15-Dec-1993 JohnC      Pulled functions from user\server.</span>
00010 <span class="comment">\***************************************************************************/</span>
00011 
00012 <span class="preprocessor">#include "<a class="code" href="../../d7/d3/w32_2ntuser_2client_2precomp_8h.html">precomp.h</a>"</span>
00013 <span class="preprocessor">#pragma hdrstop</span>
00014 <span class="preprocessor"></span>
00015 <span class="comment">/*</span>
00016 <span class="comment"> * These arrays are used by GetClassWord/Long.</span>
00017 <span class="comment"> */</span>
00018 
00019 <span class="comment">// !!! can't we get rid of this and just special case GCW_ATOM</span>
00020 
<a name="l00021"></a><a class="code" href="../../d5/d7/classc_8c.html#a1">00021</a> CONST <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> <a class="code" href="../../d5/d7/classc_8c.html#a1">afClassDWord</a>[] = {
00022      <a class="code" href="../../d9/d0/pnpiop_8h.html#a100">FIELD_SIZE</a>(<a class="code" href="../../d7/d0/structtagCLS.html">CLS</a>, spicnSm),          <span class="comment">// GCL_HICONSM       (-34)</span>
00023      0,
00024      <a class="code" href="../../d9/d0/pnpiop_8h.html#a100">FIELD_SIZE</a>(<a class="code" href="../../d7/d0/structtagCLS.html">CLS</a>, atomClassName),    <span class="comment">// GCW_ATOM          (-32)</span>
00025      0,
00026      0,
00027      0,
00028      0,
00029      0,
00030      <a class="code" href="../../d9/d0/pnpiop_8h.html#a100">FIELD_SIZE</a>(<a class="code" href="../../d7/d0/structtagCLS.html">CLS</a>, style),            <span class="comment">// GCL_STYLE         (-26)</span>
00031      0,
00032      <a class="code" href="../../d9/d0/pnpiop_8h.html#a100">FIELD_SIZE</a>(<a class="code" href="../../d7/d0/structtagCLS.html">CLS</a>, lpfnWndProc),      <span class="comment">// GCL_WNDPROC       (-24)</span>
00033      0,
00034      0,
00035      0,
00036      <a class="code" href="../../d9/d0/pnpiop_8h.html#a100">FIELD_SIZE</a>(<a class="code" href="../../d7/d0/structtagCLS.html">CLS</a>, cbclsExtra),       <span class="comment">// GCL_CBCLSEXTRA    (-20)</span>
00037      0,
00038      <a class="code" href="../../d9/d0/pnpiop_8h.html#a100">FIELD_SIZE</a>(<a class="code" href="../../d7/d0/structtagCLS.html">CLS</a>, cbwndExtra),       <span class="comment">// GCL_CBWNDEXTRA    (-18)</span>
00039      0,
00040      <a class="code" href="../../d9/d0/pnpiop_8h.html#a100">FIELD_SIZE</a>(<a class="code" href="../../d7/d0/structtagCLS.html">CLS</a>, hModule),          <span class="comment">// GCL_HMODULE       (-16)</span>
00041      0,
00042      <a class="code" href="../../d9/d0/pnpiop_8h.html#a100">FIELD_SIZE</a>(<a class="code" href="../../d7/d0/structtagCLS.html">CLS</a>, spicn),            <span class="comment">// GCL_HICON         (-14)</span>
00043      0,
00044      <a class="code" href="../../d9/d0/pnpiop_8h.html#a100">FIELD_SIZE</a>(<a class="code" href="../../d7/d0/structtagCLS.html">CLS</a>, spcur),            <span class="comment">// GCL_HCURSOR       (-12)</span>
00045      0,
00046      <a class="code" href="../../d9/d0/pnpiop_8h.html#a100">FIELD_SIZE</a>(<a class="code" href="../../d7/d0/structtagCLS.html">CLS</a>, hbrBackground),    <span class="comment">// GCL_HBRBACKGROUND (-10)</span>
00047      0,
00048      <a class="code" href="../../d9/d0/pnpiop_8h.html#a100">FIELD_SIZE</a>(<a class="code" href="../../d7/d0/structtagCLS.html">CLS</a>, lpszMenuName)      <span class="comment">// GCL_HMENUNAME      (-8)</span>
00049 };
00050 
<a name="l00051"></a><a class="code" href="../../d5/d7/classc_8c.html#a2">00051</a> CONST <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> <a class="code" href="../../d5/d7/classc_8c.html#a2">aiClassOffset</a>[] = {
00052     FIELD_OFFSET(<a class="code" href="../../d7/d0/structtagCLS.html">CLS</a>, spicnSm),         <span class="comment">// GCL_HICONSM</span>
00053     0,
00054     FIELD_OFFSET(<a class="code" href="../../d7/d0/structtagCLS.html">CLS</a>, atomClassName),   <span class="comment">// GCW_ATOM</span>
00055     0,
00056     0,
00057     0,
00058     0,
00059     0,
00060     FIELD_OFFSET(<a class="code" href="../../d7/d0/structtagCLS.html">CLS</a>, style),           <span class="comment">// GCL_STYLE</span>
00061     0,
00062     FIELD_OFFSET(<a class="code" href="../../d7/d0/structtagCLS.html">CLS</a>, lpfnWndProc),     <span class="comment">// GCL_WNDPROC</span>
00063     0,
00064     0,
00065     0,
00066     FIELD_OFFSET(<a class="code" href="../../d7/d0/structtagCLS.html">CLS</a>, cbclsExtra),      <span class="comment">// GCL_CBCLSEXTRA</span>
00067     0,
00068     FIELD_OFFSET(<a class="code" href="../../d7/d0/structtagCLS.html">CLS</a>, cbwndExtra),      <span class="comment">// GCL_CBWNDEXTRA</span>
00069     0,
00070     FIELD_OFFSET(<a class="code" href="../../d7/d0/structtagCLS.html">CLS</a>, hModule),         <span class="comment">// GCL_HMODULE</span>
00071     0,
00072     FIELD_OFFSET(<a class="code" href="../../d7/d0/structtagCLS.html">CLS</a>, spicn),           <span class="comment">// GCL_HICON</span>
00073     0,
00074     FIELD_OFFSET(<a class="code" href="../../d7/d0/structtagCLS.html">CLS</a>, spcur),           <span class="comment">// GCL_HCURSOR</span>
00075     0,
00076     FIELD_OFFSET(<a class="code" href="../../d7/d0/structtagCLS.html">CLS</a>, hbrBackground),   <span class="comment">// GCL_HBRBACKGROUND</span>
00077     0,
00078     FIELD_OFFSET(<a class="code" href="../../d7/d0/structtagCLS.html">CLS</a>, lpszMenuName)     <span class="comment">// GCL_MENUNAME</span>
00079 };
00080 
00081 <span class="comment">/*</span>
00082 <span class="comment"> * INDEX_OFFSET must refer to the first entry of afClassDWord[]</span>
00083 <span class="comment"> */</span>
<a name="l00084"></a><a class="code" href="../../d5/d7/classc_8c.html#a0">00084</a> <span class="preprocessor">#define INDEX_OFFSET GCLP_HICONSM</span>
00085 <span class="preprocessor"></span>
00086 
00087 <span class="comment">/***************************************************************************\</span>
00088 <span class="comment">* GetClassData</span>
00089 <span class="comment">*</span>
00090 <span class="comment">* GetClassWord and GetClassLong are now identical routines because they both</span>
00091 <span class="comment">* can return DWORDs.  This single routine performs the work for them both</span>
00092 <span class="comment">* by using two arrays; afClassDWord to determine whether the result should be</span>
00093 <span class="comment">* a UINT or a DWORD, and aiClassOffset to find the correct offset into the</span>
00094 <span class="comment">* CLS structure for a given GCL_ or GCL_ index.</span>
00095 <span class="comment">*</span>
00096 <span class="comment">* History:</span>
00097 <span class="comment">* 11-19-90 darrinm      Wrote.</span>
00098 <span class="comment">\***************************************************************************/</span>
00099 
<a name="l00100"></a><a class="code" href="../../d6/d0/usercli_8h.html#a631">00100</a> ULONG_PTR <a class="code" href="../../d6/d0/usercli_8h.html#a631">_GetClassData</a>(
00101     <a class="code" href="../../d7/d0/structtagCLS.html">PCLS</a> pcls,
00102     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd,   <span class="comment">// used for transition to kernel-mode for GCL_WNDPROC</span>
00103     <span class="keywordtype">int</span> index,
00104     BOOL bAnsi)
00105 {
00106     KERNEL_ULONG_PTR dwData;
00107     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwCPDType = 0;
00108 
00109     index -= <a class="code" href="../../d5/d7/classc_8c.html#a0">INDEX_OFFSET</a>;
00110 
00111     <span class="keywordflow">if</span> (index &lt; 0) {
00112         RIPERR0(ERROR_INVALID_INDEX, RIP_VERBOSE, <span class="stringliteral">""</span>);
00113         <span class="keywordflow">return</span> 0;
00114     }
00115 
00116     UserAssert(index &gt;= 0);
00117     UserAssert(index &lt; <span class="keyword">sizeof</span>(<a class="code" href="../../d5/d7/classc_8c.html#a1">afClassDWord</a>));
00118     UserAssert(<span class="keyword">sizeof</span>(<a class="code" href="../../d5/d7/classc_8c.html#a1">afClassDWord</a>) == <span class="keyword">sizeof</span>(<a class="code" href="../../d5/d7/classc_8c.html#a2">aiClassOffset</a>));
00119     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d7/classc_8c.html#a1">afClassDWord</a>[index] == <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)) {
00120         dwData = *(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> *)(((<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> *)pcls) + <a class="code" href="../../d5/d7/classc_8c.html#a2">aiClassOffset</a>[index]);
00121     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d5/d7/classc_8c.html#a1">afClassDWord</a>[index] == <span class="keyword">sizeof</span>(KERNEL_ULONG_PTR)) {
00122         dwData = *(KERNEL_ULONG_PTR *)(((<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> *)pcls) + <a class="code" href="../../d5/d7/classc_8c.html#a2">aiClassOffset</a>[index]);
00123     } <span class="keywordflow">else</span> {
00124         dwData = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)*(WORD *)(((<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> *)pcls) + <a class="code" href="../../d5/d7/classc_8c.html#a2">aiClassOffset</a>[index]);
00125     }
00126 
00127     index += <a class="code" href="../../d5/d7/classc_8c.html#a0">INDEX_OFFSET</a>;
00128 
00129     <span class="comment">/*</span>
00130 <span class="comment">     * If we're returning an icon or cursor handle, do the reverse</span>
00131 <span class="comment">     * mapping here.</span>
00132 <span class="comment">     */</span>
00133     <span class="keywordflow">switch</span>(index) {
00134     <span class="keywordflow">case</span> GCLP_MENUNAME:
00135         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a98">IS_PTR</a>(pcls-&gt;lpszMenuName)) {
00136             <span class="comment">/*</span>
00137 <span class="comment">             * The Menu Name is a real string: return the client-side address.</span>
00138 <span class="comment">             * (If the class was registered by another app this returns an</span>
00139 <span class="comment">             * address in that app's addr. space, but it's the best we can do)</span>
00140 <span class="comment">             */</span>
00141             dwData = bAnsi ?
00142                     (ULONG_PTR)pcls-&gt;<a class="code" href="../../d7/d0/structtagCLS.html#o8">lpszClientAnsiMenuName</a> :
00143                     (ULONG_PTR)pcls-&gt;<a class="code" href="../../d7/d0/structtagCLS.html#o9">lpszClientUnicodeMenuName</a>;
00144         }
00145         <span class="keywordflow">break</span>;
00146 
00147     <span class="keywordflow">case</span> GCLP_HICON:
00148     <span class="keywordflow">case</span> GCLP_HCURSOR:
00149     <span class="keywordflow">case</span> GCLP_HICONSM:
00150         <span class="comment">/*</span>
00151 <span class="comment">         * We have to go to the kernel to convert the pcursor to a handle because</span>
00152 <span class="comment">         * cursors are allocated out of POOL, which is not accessable from the client.</span>
00153 <span class="comment">         */</span>
00154         <span class="keywordflow">if</span> (dwData) {
00155             dwData = <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a178">NtUserCallHwndParam</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a448">PtoH</a>(pwnd), index, SFI_GETCLASSICOCUR);
00156         }
00157         <span class="keywordflow">break</span>;
00158 
00159     <span class="keywordflow">case</span> GCLP_WNDPROC:
00160         {
00161 
00162         <span class="comment">/*</span>
00163 <span class="comment">         * Always return the client wndproc in case this is a server</span>
00164 <span class="comment">         * window class.</span>
00165 <span class="comment">         */</span>
00166 
00167         <span class="keywordflow">if</span> (pcls-&gt;<a class="code" href="../../d7/d0/structtagCLS.html#o7">CSF_flags</a> &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a492">CSF_SERVERSIDEPROC</a>) {
00168             dwData = <a class="code" href="../../d2/d5/ntuser_2rtl_2getset_8c.html#a0">MapServerToClientPfn</a>(dwData, bAnsi);
00169         } <span class="keywordflow">else</span> {
00170             KERNEL_ULONG_PTR dwT = dwData;
00171 
00172             dwData = <a class="code" href="../../d2/d5/ntuser_2rtl_2getset_8c.html#a1">MapClientNeuterToClientPfn</a>(pcls, dwT, bAnsi);
00173 
00174             <span class="comment">/*</span>
00175 <span class="comment">             * If the client mapping didn't change the window proc then see if</span>
00176 <span class="comment">             * we need a callproc handle.</span>
00177 <span class="comment">             */</span>
00178             <span class="keywordflow">if</span> (dwData == dwT) {
00179                 <span class="comment">/*</span>
00180 <span class="comment">                 * Need to return a CallProc handle if there is an Ansi/Unicode mismatch</span>
00181 <span class="comment">                 */</span>
00182                 <span class="keywordflow">if</span> (bAnsi != !!(pcls-&gt;<a class="code" href="../../d7/d0/structtagCLS.html#o7">CSF_flags</a> &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a493">CSF_ANSIPROC</a>)) {
00183                     dwCPDType |= bAnsi ? <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a459">CPD_ANSI_TO_UNICODE</a> : <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a460">CPD_UNICODE_TO_ANSI</a>;
00184                 }
00185             }
00186         }
00187 
00188         <span class="keywordflow">if</span> (dwCPDType) {
00189             ULONG_PTR dwCPD;
00190 
00191             dwCPD = <a class="code" href="../../d0/d5/ntuser_2kernel_2getset_8c.html#a7">GetCPD</a>(pwnd, dwCPDType | <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a465">CPD_WNDTOCLS</a>, KERNEL_ULONG_PTR_TO_ULONG_PTR(dwData));
00192 
00193             <span class="keywordflow">if</span> (dwCPD) {
00194                 dwData = dwCPD;
00195             } <span class="keywordflow">else</span> {
00196                 RIPMSG0(RIP_WARNING, <span class="stringliteral">"GetClassLong unable to alloc CPD returning handle\n"</span>);
00197             }
00198         }
00199         }
00200         <span class="keywordflow">break</span>;
00201 
00202     <span class="keywordflow">case</span> GCL_CBCLSEXTRA:
00203         <span class="keywordflow">if</span> ((pcls-&gt;<a class="code" href="../../d7/d0/structtagCLS.html#o7">CSF_flags</a> &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a496">CSF_WOWCLASS</a>) &amp;&amp; (pcls-&gt;<a class="code" href="../../d7/d0/structtagCLS.html#o7">CSF_flags</a> &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a497">CSF_WOWEXTRA</a>)) {
00204             <span class="comment">/*</span>
00205 <span class="comment">             * The 16-bit app changed its Extra bytes value.  Return the changed</span>
00206 <span class="comment">             * value.  FritzS</span>
00207 <span class="comment">             */</span>
00208 
00209             <span class="keywordflow">return</span> <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a491">PWCFromPCLS</a>(pcls)-&gt;iClsExtra;
00210         }
00211         <span class="keywordflow">else</span>
00212             <span class="keywordflow">return</span> pcls-&gt;cbclsExtra;
00213 
00214         <span class="keywordflow">break</span>;
00215 
00216     <span class="comment">/*</span>
00217 <span class="comment">     * WOW uses a pointer straight into the class structure.</span>
00218 <span class="comment">     */</span>
00219     <span class="keywordflow">case</span> GCLP_WOWWORDS:
00220         <span class="keywordflow">if</span> (pcls-&gt;<a class="code" href="../../d7/d0/structtagCLS.html#o7">CSF_flags</a> &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a496">CSF_WOWCLASS</a>) {
00221             <span class="keywordflow">return</span> ((ULONG_PTR)<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a491">PWCFromPCLS</a>(pcls));
00222         } <span class="keywordflow">else</span>
00223             <span class="keywordflow">return</span> 0;
00224 
00225     <span class="keywordflow">case</span> GCL_STYLE:
00226         dwData &amp;= CS_VALID;
00227         <span class="keywordflow">break</span>;
00228     }
00229 
00230     <span class="keywordflow">return</span> KERNEL_ULONG_PTR_TO_ULONG_PTR(dwData);
00231 }
00232 
00233 
00234 
00235 <span class="comment">/***************************************************************************\</span>
00236 <span class="comment">* _GetClassLong (API)</span>
00237 <span class="comment">*</span>
00238 <span class="comment">* Return a class long.  Positive index values return application class longs</span>
00239 <span class="comment">* while negative index values return system class longs.  The negative</span>
00240 <span class="comment">* indices are published in WINDOWS.H.</span>
00241 <span class="comment">*</span>
00242 <span class="comment">* History:</span>
00243 <span class="comment">* 10-16-90 darrinm      Wrote.</span>
00244 <span class="comment">\***************************************************************************/</span>
00245 
<a name="l00246"></a><a class="code" href="../../d5/d7/classc_8c.html#a4">00246</a> ULONG_PTR <a class="code" href="../../d6/d0/usercli_8h.html#a210">_GetClassLongPtr</a>(
00247     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd,
00248     <span class="keywordtype">int</span> index,
00249     BOOL bAnsi)
00250 {
00251     <a class="code" href="../../d7/d0/structtagCLS.html">PCLS</a> pcls = <a class="code" href="../../d6/d0/usercli_8h.html#a24">REBASEALWAYS</a>(pwnd, pcls);
00252 
00253     <span class="keywordflow">if</span> (index &lt; 0) {
00254         <span class="keywordflow">return</span> <a class="code" href="../../d6/d0/usercli_8h.html#a631">_GetClassData</a>(pcls, pwnd, index, bAnsi);
00255     } <span class="keywordflow">else</span> {
00256         <span class="keywordflow">if</span> (index + (<span class="keywordtype">int</span>)<span class="keyword">sizeof</span>(ULONG_PTR) &gt; pcls-&gt;cbclsExtra) {
00257             RIPERR0(ERROR_INVALID_INDEX, RIP_VERBOSE, <span class="stringliteral">""</span>);
00258             <span class="keywordflow">return</span> 0;
00259         } <span class="keywordflow">else</span> {
00260             ULONG_PTR UNALIGNED *pudw;
00261             pudw = (ULONG_PTR UNALIGNED *)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> *)(pcls + 1) + index);
00262             <span class="keywordflow">return</span> *pudw;
00263         }
00264     }
00265 }
00266 
00267 <span class="preprocessor">#ifdef _WIN64</span>
00268 <span class="preprocessor"></span><a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d6/d0/usercli_8h.html#a632">_GetClassLong</a>(
00269     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd,
00270     <span class="keywordtype">int</span> index,
00271     BOOL bAnsi)
00272 {
00273     <a class="code" href="../../d7/d0/structtagCLS.html">PCLS</a> pcls = <a class="code" href="../../d6/d0/usercli_8h.html#a24">REBASEALWAYS</a>(pwnd, pcls);
00274 
00275     <span class="keywordflow">if</span> (index &lt; 0) {
00276         <span class="keywordflow">if</span> (index &lt; <a class="code" href="../../d5/d7/classc_8c.html#a0">INDEX_OFFSET</a> || <a class="code" href="../../d5/d7/classc_8c.html#a1">afClassDWord</a>[index - <a class="code" href="../../d5/d7/classc_8c.html#a0">INDEX_OFFSET</a>] &gt; <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)) {
00277             RIPERR1(ERROR_INVALID_INDEX, RIP_WARNING, <span class="stringliteral">"GetClassLong: invalid index %d"</span>, index);
00278             <span class="keywordflow">return</span> 0;
00279         }
00280         <span class="keywordflow">return</span> (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)<a class="code" href="../../d6/d0/usercli_8h.html#a631">_GetClassData</a>(pcls, pwnd, index, bAnsi);
00281     } <span class="keywordflow">else</span> {
00282         <span class="keywordflow">if</span> (index + (<span class="keywordtype">int</span>)<span class="keyword">sizeof</span>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>) &gt; pcls-&gt;cbclsExtra) {
00283             RIPERR0(ERROR_INVALID_INDEX, RIP_VERBOSE, <span class="stringliteral">""</span>);
00284             <span class="keywordflow">return</span> 0;
00285         } <span class="keywordflow">else</span> {
00286             <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> UNALIGNED *pudw;
00287             pudw = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> UNALIGNED *)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> *)(pcls + 1) + index);
00288             <span class="keywordflow">return</span> *pudw;
00289         }
00290     }
00291 }
00292 <span class="preprocessor">#endif</span>
00293 <span class="preprocessor"></span>
00294 <span class="comment">/***************************************************************************\</span>
00295 <span class="comment">* GetClassWord (API)</span>
00296 <span class="comment">*</span>
00297 <span class="comment">* Return a class word.  Positive index values return application class words</span>
00298 <span class="comment">* while negative index values return system class words.  The negative</span>
00299 <span class="comment">* indices are published in WINDOWS.H.</span>
00300 <span class="comment">*</span>
00301 <span class="comment">* History:</span>
00302 <span class="comment">* 10-16-90 darrinm      Wrote.</span>
00303 <span class="comment">\***************************************************************************/</span>
00304 
<a name="l00305"></a><a class="code" href="../../d5/d7/classc_8c.html#a5">00305</a> WORD <a class="code" href="../../d5/d7/classc_8c.html#a5">GetClassWord</a>(
00306     HWND hwnd,
00307     <span class="keywordtype">int</span> index)
00308 {
00309     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd;
00310     <a class="code" href="../../d7/d0/structtagCLS.html">PCLS</a> pclsClient;
00311 
00312     pwnd = <a class="code" href="../../d4/d0/immcli_8h.html#a4">ValidateHwnd</a>(hwnd);
00313 
00314     <span class="keywordflow">if</span> (pwnd == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00315         <span class="keywordflow">return</span> 0;
00316 
00317     pclsClient = (<a class="code" href="../../d7/d0/structtagCLS.html">PCLS</a>)<a class="code" href="../../d6/d0/usercli_8h.html#a24">REBASEALWAYS</a>(pwnd, pcls);
00318 
00319     <span class="keywordflow">if</span> (index == GCW_ATOM) {
00320         <span class="keywordflow">return</span> (WORD)<a class="code" href="../../d6/d0/usercli_8h.html#a631">_GetClassData</a>(pclsClient, pwnd, index, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00321     } <span class="keywordflow">else</span> {
00322         <span class="keywordflow">if</span> ((index &lt; 0) || (index + (int)sizeof(WORD) &gt; pclsClient-&gt;cbclsExtra)) {
00323             RIPERR0(ERROR_INVALID_INDEX, RIP_VERBOSE, <span class="stringliteral">""</span>);
00324             <span class="keywordflow">return</span> 0;
00325         } <span class="keywordflow">else</span> {
00326             WORD UNALIGNED *puw;
00327             puw = (WORD UNALIGNED *)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> *)(pclsClient + 1) + index);
00328             <span class="keywordflow">return</span> *puw;
00329         }
00330     }
00331 }
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:39:24 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
