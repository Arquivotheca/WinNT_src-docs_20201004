<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: resizedlg.cpp Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>resizedlg.cpp</h1><a href="../../d5/d8/resizedlg_8cpp.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">// ResizeDlg.cpp: implementation of the CResizeDlg class.</span>
00002 <span class="comment">//</span>
00004 <span class="comment"></span>
00005 <span class="preprocessor">#include "<a class="code" href="../../d3/d4/w32_2ntuser_2client_2nt6_2pch_8h.html">pch.h</a>"</span>
00006 <span class="preprocessor">#include "ResizeDlg.h"</span>
00007 <span class="preprocessor">#include "<a class="code" href="../../d7/d5/ntuser_2client_2nt6_2debug_8h.html">debug.h</a>"</span>
00008 <span class="preprocessor">#include "<a class="code" href="../../d5/d5/persctl_8h.html">persctl.h</a>"</span>
00009 <span class="comment">// #include "w32err.h" // #include "E:\nt\private\NTOS\w32\w32inc\w32err.h"</span>
00010 <span class="comment">// #include "usercli.h" // #include "e:\nt\private\ntos\w32\ntuser\client\usercli.h"</span>
00011 <span class="comment">// #include "resource.h"</span>
00012 <span class="comment">// #include "E:\nt\private\NTOS\w32\w32inc\w32err.h"</span>
00013 
00014 
<a name="l00015"></a><a class="code" href="../../d5/d8/resizedlg_8cpp.html#a0">00015</a> <span class="preprocessor">#define MIN_COL_SPACE 4</span>
<a name="l00016"></a><a class="code" href="../../d5/d8/resizedlg_8cpp.html#a1">00016</a> <span class="preprocessor"></span><span class="preprocessor">#define MIN_ROW_SPACE 4</span>
00017 <span class="preprocessor"></span>
<a name="l00018"></a><a class="code" href="../../d5/d8/resizedlg_8cpp.html#a4">00018</a> <span class="keywordtype">void</span>* __cdecl <a class="code" href="../../d5/d8/resizedlg_8cpp.html#a4">operator new</a>(size_t n)
00019 {
00020     <span class="comment">// return malloc(n);</span>
00021         <span class="keywordflow">return</span> GlobalAlloc( GPTR, <a class="code" href="../../d7/d0/exts_8h.html#a0">n</a>);
00022 }
00023 
<a name="l00024"></a><a class="code" href="../../d5/d8/resizedlg_8cpp.html#a5">00024</a> <span class="keywordtype">void</span> __cdecl <a class="code" href="../../d5/d8/resizedlg_8cpp.html#a5">operator delete</a>(<span class="keywordtype">void</span>* p)
00025 {
00026     <span class="comment">// free(p);</span>
00027         GlobalFree(p);
00028 }
00029 
00030 <span class="keyword">extern</span> <span class="stringliteral">"C"</span> {
00031 
<a name="l00032"></a><a class="code" href="../../d5/d8/resizedlg_8cpp.html#a6">00032</a> <a class="code" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a> __cdecl <a class="code" href="../../d5/d8/resizedlg_8cpp.html#a6">MakeAResizeDlg</a>(<span class="keywordtype">int</span> <span class="keywordtype">id</span>,HANDLE h)
00033 {
00034         <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="../../d5/d6/classCResizeDlg.html">CResizeDlg</a>(<span class="keywordtype">id</span>, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, (HINSTANCE)h);
00035 }
00036 
<a name="l00037"></a><a class="code" href="../../d5/d8/resizedlg_8cpp.html#a7">00037</a> LRESULT <a class="code" href="../../d5/d8/resizedlg_8cpp.html#a7">ResizeDlgMessage</a>( LPVOID pObject, 
00038     HWND hwnd,
00039     UINT message,
00040     WPARAM wParam,
00041     LPARAM lParam )
00042 {
00043         <span class="keywordflow">return</span> ((<a class="code" href="../../d5/d6/classCResizeDlg.html">CResizeDlg</a>*)pObject)-&gt;DlgProc( hwnd, message, wParam, lParam );
00044 }
00045 
00046 
00047 };
00048 
00049 
00050 
00051 
00053 <span class="comment">// Construction/Destruction</span>
00055 <span class="comment"></span>
<a name="l00056"></a><a class="code" href="../../d5/d6/classCResizeDlg.html#a0">00056</a> <a class="code" href="../../d5/d6/classCResizeDlg.html#a0">CResizeDlg::CResizeDlg</a>(<span class="keywordtype">int</span> DlgID, HWND hWndParent, HINSTANCE hInst)
00057 : <a class="code" href="../../d4/d2/classCDlg.html">BASECLASS</a>(DlgID, hWndParent, <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a0">hInst</a>)
00058 {
00059         SetAnnotate(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00060         SetRowWeight(0);
00061         SetColWeight(0);
00062         <a class="code" href="../../d5/d6/classCResizeDlg.html#p4">m_hwndGripper</a>=<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00063 }
00064 
<a name="l00065"></a><a class="code" href="../../d5/d6/classCResizeDlg.html#a1">00065</a> <a class="code" href="../../d5/d6/classCResizeDlg.html#a1">CResizeDlg::~CResizeDlg</a>()
00066 {
00067 
00068 }
00069 
00071 <span class="comment">//</span>
00072 <span class="comment">//</span>
00073 <span class="comment">//</span>
<a name="l00075"></a><a class="code" href="../../d5/d6/classCResizeDlg.html#a2">00075</a> <span class="comment"></span><a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> CALLBACK <a class="code" href="../../d5/d6/classCResizeDlg.html#a2">CResizeDlg::DlgProc</a>(HWND hDlg, <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> uMessage, WPARAM wParam, LPARAM lParam)
00076 {
00077         <span class="keywordflow">switch</span>( uMessage )
00078         {
00079         <span class="keywordflow">case</span> WM_NCHITTEST:
00080                 {
00081                         <span class="comment">// Because we always turn on the resize frame, we must always hit test.</span>
00082                         <span class="comment">// if( (GetRowWeight() !=0 ) || (GetColWeight() != 0 ) )</span>
00083                         {
00084                                 <span class="comment">// call def window proc to see what he wants to do</span>
00085                                 LONG lRes= <a class="code" href="../../d5/d6/classCResizeDlg.html#b8">HitTest</a>( <a class="code" href="../../d5/d9/cltxt_8h.html#a15">DefWindowProc</a>( hDlg, uMessage, wParam, lParam ) );
00086                                 <span class="keywordflow">if</span>( lRes != (HTERROR-1) )
00087                                 {
00088                                         SetWindowLong( hDlg, DWL_MSGRESULT,  lRes );
00089                                         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00090                                 }
00091                         }
00092                 }
00093                 <span class="keywordflow">break</span>;
00094 
00095         <span class="keywordflow">case</span> WM_WINDOWPOSCHANGING:
00096                 <span class="keywordflow">if</span>( (GetRowWeight() !=0 ) || (GetColWeight() != 0 ) )
00097                         <a class="code" href="../../d5/d6/classCResizeDlg.html#b2">DoChangePos</a>( (WINDOWPOS*)lParam);
00098                 <span class="keywordflow">break</span>;
00099 
00100         <span class="keywordflow">case</span> WM_ERASEBKGND:
00101                 <span class="comment">/*</span>
00102 <span class="comment">                if( (GetRowWeight() !=0 ) || (GetColWeight() != 0 ) )</span>
00103 <span class="comment">            {</span>
00104 <span class="comment">                        HDC hdc=(HDC)wParam;</span>
00105 <span class="comment">                        RECT rcWindow;</span>
00106 <span class="comment">                        GetClientRect(hDlg, &amp;rcWindow);</span>
00107 <span class="comment">                        int g_cxGrip = GetSystemMetrics( SM_CXVSCROLL );</span>
00108 <span class="comment">                        int g_cyGrip = GetSystemMetrics( SM_CYHSCROLL );</span>
00109 <span class="comment">                        rcWindow.left = rcWindow.right - g_cxGrip; // pWState-&gt;x_VSBArrow;</span>
00110 <span class="comment">                        rcWindow.top = rcWindow.bottom - g_cyGrip; // pWState-&gt;y_HSBArrow;</span>
00111 <span class="comment">                        DrawFrameControl(hdc, &amp;rcWindow, DFC_SCROLL, DFCS_SCROLLSIZEGRIP);</span>
00112 <span class="comment">                }</span>
00113 <span class="comment">                */</span>
00114                 <span class="keywordflow">break</span>;
00115 
00116         <span class="keywordflow">case</span> WM_INITDIALOG:
00117                         SetWindow(hDlg);
00118                         <a class="code" href="../../d5/d6/classCResizeDlg.html#b6">DoInitDialog</a>();
00119                         <span class="comment">// Re-adjusts the dialogs to what we think they should be</span>
00120                         <span class="comment">// breaks some apps who are completely owner draw.</span>
00121                         <span class="keywordflow">if</span>( (GetRowWeight() !=0 ) || (GetColWeight() != 0 ) )
00122                         {
00123                                 <a class="code" href="../../d5/d6/classCResizeDlg.html#b20">AddGripper</a>(); <span class="comment">// need to sit on the size meesage too.</span>
00124                                 RECT r;
00125                                 <a class="code" href="../../d3/d9/client_2wow_8c.html#a26">GetWindowRect</a>( hDlg, &amp;r);
00126                                 <a class="code" href="../../d3/d4/w32_2ntuser_2client_2nt6_2pch_8h.html#a0">SetWindowPos</a>(
00127                                         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, 0,0, r.right - r.left, r.bottom - r.top, 
00128                                         SWP_NOACTIVATE | SWP_NOCOPYBITS | SWP_NOMOVE | SWP_NOOWNERZORDER |
00129                                         SWP_NOREDRAW | SWP_NOZORDER );
00130                         }
00131                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00132                 <span class="keywordflow">break</span>;
00133 
00134         <span class="keywordflow">case</span> WM_SIZE:
00135                 <span class="keywordflow">if</span>( (GetRowWeight() !=0 ) || (GetColWeight() != 0 ) )
00136                 {
00137                         <span class="comment">// Don't try to re-adjust to the size when initially shown.</span>
00138                         <span class="keywordflow">if</span>( wParam == SIZE_RESTORED )
00139                         {
00140                                 WINDOWPOS pos={<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, 0,0, LOWORD(lParam), HIWORD(lParam), 
00141                                         SWP_NOACTIVATE | SWP_NOCOPYBITS | SWP_NOMOVE | SWP_NOOWNERZORDER |
00142                                         SWP_NOREDRAW | SWP_NOSENDCHANGING | SWP_NOZORDER };
00143                                 <a class="code" href="../../d5/d6/classCResizeDlg.html#b2">DoChangePos</a>( &amp;pos );
00144                                 <a class="code" href="../../d5/d6/classCResizeDlg.html#b13">ResizeControls</a>(LOWORD( lParam ) , HIWORD (lParam) );
00145                         }
00146                 }
00147                 <span class="keywordflow">break</span>;
00148 
00149         <span class="keywordflow">case</span> WM_PAINT:
00150                 <a class="code" href="../../d5/d6/classCResizeDlg.html#b10">Annotate</a>();
00151                 <span class="keywordflow">break</span>;
00152         }
00153         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00154 }
00155 
00157 <span class="comment">//</span>
00158 <span class="comment">// Walks all the controls, finds their edges,</span>
00159 <span class="comment">// attatches them to their edges/guides.</span>
00160 <span class="comment">//</span>
<a name="l00162"></a><a class="code" href="../../d5/d6/classCResizeDlg.html#b12">00162</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="../../d5/d6/classCResizeDlg.html#b12">CResizeDlg::WalkControls</a>()
00163 {
00164         <a class="code" href="../../d5/d6/classCResizeDlg.html#p1">m_ParentInfo</a>.<a class="code" href="../../d4/d5/classCParentInfo.html#a7">Init</a>( <a class="code" href="../../d4/d2/classCDlg.html#a5">GetWindow</a>() );
00165         <a class="code" href="../../d5/d6/classCResizeDlg.html#b14">FindControls</a>();
00166         <a class="code" href="../../d5/d6/classCResizeDlg.html#p1">m_ParentInfo</a>.<a class="code" href="../../d4/d5/classCParentInfo.html#a0">DeterminBorders</a>( &amp;<a class="code" href="../../d5/d6/classCResizeDlg.html#p0">m_ControlList</a> );
00167         <a class="code" href="../../d5/d6/classCResizeDlg.html#b15">MakeAttatchments</a>();
00168         <a class="code" href="../../d5/d6/classCResizeDlg.html#b17">FindCommonGuides</a>();
00169         <a class="code" href="../../d5/d6/classCResizeDlg.html#b0">SpecialRowCol</a>();
00170 }
00171 
00173 <span class="comment">//</span>
00174 <span class="comment">// Walk the dialog</span>
00175 <span class="comment">// build structures of what we think the relationships of the controls is.</span>
00176 <span class="comment">//</span>
<a name="l00178"></a><a class="code" href="../../d5/d6/classCResizeDlg.html#b14">00178</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="../../d5/d6/classCResizeDlg.html#b14">CResizeDlg::FindControls</a>()
00179 {
00180         HWND hCurrent;
00181         HWND hFirst;
00182         hCurrent=hFirst=::GetWindow(<a class="code" href="../../d4/d2/classCDlg.html#a5">GetWindow</a>(),GW_CHILD);
00183         <a class="code" href="../../d7/d5/ntuser_2client_2nt6_2debug_8h.html#a0">TRACE</a>(<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"FindControls on 0x%0x\n"</span>, <a class="code" href="../../d4/d2/classCDlg.html#a5">GetWindow</a>() );
00184         <a class="code" href="../../d7/d5/ntuser_2client_2nt6_2debug_8h.html#a0">TRACE</a>(<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"Parent size is %d,%d by %d,%d\n"</span>,
00185                 <a class="code" href="../../d5/d6/classCResizeDlg.html#p1">m_ParentInfo</a>.<a class="code" href="../../d4/d5/classCParentInfo.html#a10">GetLeft</a>(),
00186                 <a class="code" href="../../d5/d6/classCResizeDlg.html#p1">m_ParentInfo</a>.<a class="code" href="../../d4/d5/classCParentInfo.html#a11">GetTop</a>(),
00187                 <a class="code" href="../../d5/d6/classCResizeDlg.html#p1">m_ParentInfo</a>.<a class="code" href="../../d4/d5/classCParentInfo.html#a12">GetRight</a>(),
00188                 <a class="code" href="../../d5/d6/classCResizeDlg.html#p1">m_ParentInfo</a>.<a class="code" href="../../d4/d5/classCParentInfo.html#a13">GetBottom</a>() );
00189 
00190         <span class="keywordflow">if</span>( hFirst )
00191         {
00192                 <span class="keywordflow">do</span> {
00193                         <a class="code" href="../../d3/d6/classCResizeControl.html">CResizeControl</a> * pC = <span class="keyword">new</span> <a class="code" href="../../d3/d6/classCResizeControl.html">CResizeControl</a>(hCurrent, <a class="code" href="../../d5/d6/classCResizeDlg.html#p1">m_ParentInfo</a>);
00194                         <span class="keywordflow">if</span>( pC-&gt;<a class="code" href="../../d3/d6/classCResizeControl.html#a2">Valid</a>() )
00195                         {
00196                                 <span class="comment">//</span>
00197                                 <span class="comment">// Make sure the control is wihin the bounds of our parent.</span>
00198                                 <span class="comment">//</span>
00199                                 RECT r=pC-&gt;<a class="code" href="../../d3/d6/classCResizeControl.html#a26">GetLocation</a>();
00200                                 <a class="code" href="../../d7/d5/ntuser_2client_2nt6_2debug_8h.html#a0">TRACE</a>(<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"Control size is %d,%d by %d,%d\n"</span>,
00201                                         r.left,
00202                                         r.top,
00203                                         r.right,
00204                                         r.bottom);
00205                                 <span class="keywordflow">if</span>( (r.right &gt; <a class="code" href="../../d5/d6/classCResizeDlg.html#p1">m_ParentInfo</a>.<a class="code" href="../../d4/d5/classCParentInfo.html#a12">GetRight</a>()) ||
00206                                         (r.bottom &gt; <a class="code" href="../../d5/d6/classCResizeDlg.html#p1">m_ParentInfo</a>.<a class="code" href="../../d4/d5/classCParentInfo.html#a13">GetBottom</a>()) ||
00207                                         (r.top &lt; <a class="code" href="../../d5/d6/classCResizeDlg.html#p1">m_ParentInfo</a>.<a class="code" href="../../d4/d5/classCParentInfo.html#a11">GetTop</a>()) ||
00208                                         (r.left &lt; <a class="code" href="../../d5/d6/classCResizeDlg.html#p1">m_ParentInfo</a>.<a class="code" href="../../d4/d5/classCParentInfo.html#a10">GetLeft</a>()) )
00209                                 {
00210                                         <a class="code" href="../../d7/d5/ntuser_2client_2nt6_2debug_8h.html#a0">TRACE</a>(<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"Punting this control %s\n"</span>, pC-&gt;GetClassName() );
00211                                         <span class="keyword">delete</span> pC;              <span class="comment">// we don't play with these.</span>
00212                                 }
00213                                 <span class="keywordflow">else</span>
00214                                         <a class="code" href="../../d5/d6/classCResizeDlg.html#p0">m_ControlList</a>.<a class="code" href="../../d5/d2/classCDPA.html#a3">Append</a>(pC);
00215                         }
00216                         <span class="keywordflow">else</span>
00217                                 <span class="keyword">delete</span> pC;
00218                 } <span class="keywordflow">while</span> (hCurrent=::GetWindow(hCurrent,GW_HWNDNEXT));
00219         }
00220 }
00221 
00223 <span class="comment">//</span>
00224 <span class="comment">// We have data backing each control now.</span>
00225 <span class="comment">// walk it and have it initialize itself.</span>
00226 <span class="comment">//</span>
<a name="l00228"></a><a class="code" href="../../d5/d6/classCResizeDlg.html#b16">00228</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="../../d5/d6/classCResizeDlg.html#b16">CResizeDlg::FindBorders</a>()
00229 {
00230 }
00231  
00233 <span class="comment">//</span>
00234 <span class="comment">// Now we have determined the borders on the dialog, see</span>
00235 <span class="comment">// if any controls can make assumptions about their individual</span>
00236 <span class="comment">// attatchments.</span>
00237 <span class="comment">//</span>
<a name="l00239"></a><a class="code" href="../../d5/d6/classCResizeDlg.html#b15">00239</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="../../d5/d6/classCResizeDlg.html#b15">CResizeDlg::MakeAttatchments</a>()
00240 {
00241         <a class="code" href="../../d3/d6/classCResizeControl.html">CResizeControl</a> * pC;
00242         <span class="keywordtype">int</span> i=0;
00243         <span class="keywordflow">while</span>( pC=<a class="code" href="../../d5/d6/classCResizeDlg.html#p0">m_ControlList</a>.<a class="code" href="../../d0/d2/classCControlList.html#a2">GetControl</a>(i++) )
00244                 pC-&gt;DeterminLeftAttatchments();
00245 
00246         i=0;
00247         <span class="keywordflow">while</span>( pC=<a class="code" href="../../d5/d6/classCResizeDlg.html#p0">m_ControlList</a>.<a class="code" href="../../d0/d2/classCControlList.html#a2">GetControl</a>(i++) )
00248                 pC-&gt;DeterminTopAttatchments();
00249 
00250         i=0;
00251         <span class="keywordflow">while</span>( pC=<a class="code" href="../../d5/d6/classCResizeDlg.html#p0">m_ControlList</a>.<a class="code" href="../../d0/d2/classCControlList.html#a2">GetControl</a>(i++) )
00252                 pC-&gt;DeterminRightAttatchments();
00253 
00254         i=0;
00255         <span class="keywordflow">while</span>( pC=<a class="code" href="../../d5/d6/classCResizeDlg.html#p0">m_ControlList</a>.<a class="code" href="../../d0/d2/classCControlList.html#a2">GetControl</a>(i++) )
00256                 pC-&gt;DeterminBottomAttatchments();
00257 
00258         i=0;
00259         <span class="keywordflow">while</span>( pC=<a class="code" href="../../d5/d6/classCResizeDlg.html#p0">m_ControlList</a>.<a class="code" href="../../d0/d2/classCControlList.html#a2">GetControl</a>(i++) )
00260                 pC-&gt;SetControlAssociations();
00261 }
00262 
00264 <span class="comment">//</span>
00265 <span class="comment">//</span>
00266 <span class="comment">//</span>
<a name="l00268"></a><a class="code" href="../../d5/d6/classCResizeDlg.html#b13">00268</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="../../d5/d6/classCResizeDlg.html#b13">CResizeDlg::ResizeControls</a>(WORD width, WORD height)
00269 {
00270         <span class="keywordtype">int</span> iSpecialRow = GetNumRows()-1;
00271         <span class="keywordtype">int</span> iSpecialCol = GetNumCols()-1;
00272 
00273         <span class="comment">//</span>
00274         <span class="comment">// Add free space</span>
00275         <span class="comment">//</span>
00276         <span class="keywordflow">if</span>( GetColWeight()&gt;0 )
00277         {
00278                 <span class="keywordtype">int</span> FreeW = width - <a class="code" href="../../d5/d6/classCResizeDlg.html#p3">m_Cols</a>[ GetNumCols() ].<a class="code" href="../../d9/d9/structtagCHANNEL.html#o0">Pos</a> - <a class="code" href="../../d5/d6/classCResizeDlg.html#p1">m_ParentInfo</a>.GetRightBorder();
00279                 <span class="keywordflow">if</span>( FreeW != 0 )
00280                 {
00281                         <span class="keywordtype">int</span> iPadding=0;
00282                         <span class="keywordtype">int</span> iPad=FreeW/GetColWeight();
00283                         <span class="keywordflow">for</span>( <span class="keywordtype">int</span> fi=0;fi&lt;= GetNumCols(); fi++)
00284                         {
00285                                 m_Cols[ fi ].Pos += iPadding;
00286                                 <span class="keywordflow">if</span>( m_Cols[fi].iFixed&gt;=0)
00287                                         iPadding+=iPad * m_Cols[fi].iWeight;
00288                         }
00289                 }
00290         }
00291 
00292         <span class="comment">//</span>
00293         <span class="comment">// Add free row.</span>
00294         <span class="comment">//</span>
00295         <span class="keywordflow">if</span>( GetRowWeight()&gt;0 )
00296         {
00297                 <span class="keywordtype">int</span> Free = height - <a class="code" href="../../d5/d6/classCResizeDlg.html#p2">m_Rows</a>[ GetNumRows() ].<a class="code" href="../../d9/d9/structtagCHANNEL.html#o0">Pos</a> - <a class="code" href="../../d5/d6/classCResizeDlg.html#p1">m_ParentInfo</a>.GetBottomBorder();
00298                 <span class="keywordflow">if</span>( Free != 0 )
00299                 {
00300                         <span class="keywordtype">int</span> iPadding=0;
00301                         <span class="keywordtype">int</span> iPad=Free/GetRowWeight();
00302                         <span class="keywordflow">for</span>( <span class="keywordtype">int</span> fi=0;fi&lt;= GetNumRows(); fi++)
00303                         {
00304                                 m_Rows[ fi ].Pos += iPadding;
00305                                 <span class="keywordflow">if</span>( m_Rows[fi].iFixed&gt;=0)
00306                                         iPadding+=iPad * m_Rows[fi].iWeight;
00307                         }
00308                 }
00309         }
00310 
00311         <span class="comment">//</span>
00312         <span class="comment">// Now setup the information for all of the controls, as to which cell they are in.</span>
00313         <span class="comment">//</span>
00314         HDWP hdwp = <a class="code" href="../../d3/d8/client_8c.html#a89">BeginDeferWindowPos</a>( <a class="code" href="../../d5/d6/classCResizeDlg.html#p0">m_ControlList</a>.<a class="code" href="../../d0/d2/classCControlList.html#a3">GetControlCount</a>() );
00315         <span class="keywordtype">int</span> i=0;
00316         <a class="code" href="../../d3/d6/classCResizeControl.html">CResizeControl</a> * pC;
00317         CConstraint     * pCons;
00318         <span class="keywordflow">while</span>( pC=(<a class="code" href="../../d3/d6/classCResizeControl.html">CResizeControl</a> *) <a class="code" href="../../d5/d6/classCResizeDlg.html#p0">m_ControlList</a>.<a class="code" href="../../d5/d2/classCDPA.html#a4">GetPointer</a>(i++) )
00319         {
00320                 pCons=&amp;(pC-&gt;<a class="code" href="../../d3/d6/classCResizeControl.html#o1">m_Cons</a>);
00321                 <span class="keywordtype">int</span> x=<a class="code" href="../../d5/d6/classCResizeDlg.html#p3">m_Cols</a>[pCons-&gt;GetCol()].<a class="code" href="../../d9/d9/structtagCHANNEL.html#o0">Pos</a> + pCons-&gt;GetPadLeft();
00322                 <span class="keywordtype">int</span> y=<a class="code" href="../../d5/d6/classCResizeDlg.html#p2">m_Rows</a>[pCons-&gt;GetRow()].<a class="code" href="../../d9/d9/structtagCHANNEL.html#o0">Pos</a> + pCons-&gt;GetPadTop();
00323                 <span class="keywordtype">int</span> w,h;
00324 
00325                 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> bMove=<span class="keyword">true</span>; <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> bSize=<span class="keyword">false</span>;
00326                 <span class="keywordflow">if</span>( pC-&gt;IsGrowsWide() )
00327                 {
00328                         w=m_Cols[pCons-&gt;GetCol()+pCons-&gt;GetColW()].Pos + pCons-&gt;GetPadRight() -x;
00329                         bSize=<span class="keyword">true</span>;
00330                 }
00331                 <span class="keywordflow">else</span>
00332                         w=pC-&gt;GetWidth();
00333 
00334                 <span class="keywordflow">if</span>( pC-&gt;IsGrowsHigh() )
00335                 {
00336                         h=m_Rows[pCons-&gt;GetRow()+pCons-&gt;GetRowH()].Pos + pCons-&gt;GetPadBottom() -y;
00337                         bSize=<span class="keyword">true</span>;
00338                 }
00339                 <span class="keywordflow">else</span>
00340                         h=pC-&gt;GetHeight();
00341 
00342                 <span class="comment">//</span>
00343                 <span class="comment">// Here we special case the ComboBox - yuck.</span>
00344                 <span class="comment">//</span>
00345                 <span class="keywordflow">if</span>( lstrcmp( pC-&gt;GetClassName(), <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"Button"</span>) ==0)
00346                 {
00347                         <span class="comment">//</span>
00348                         <span class="comment">// Check box button is OK though.</span>
00349                         <span class="comment">//</span>
00350                         <span class="keywordtype">int</span> ibs=GetWindowStyle( pC-&gt;GetControl() );
00351                         <span class="keywordflow">if</span>( (ibs &amp; 0xf) == BS_GROUPBOX )
00352                         {
00353                                 <span class="comment">//</span>
00354                                 <span class="comment">// Force the width / height.</span>
00355                                 <span class="comment">//</span>
00356                                 w=m_Cols[pCons-&gt;GetCol()+pCons-&gt;GetColW()].Pos + pCons-&gt;GetPadRight() -x;
00357                                 h=m_Rows[pCons-&gt;GetRow()+pCons-&gt;GetRowH()].Pos + pCons-&gt;GetPadBottom() -y;
00358                                 bSize=<span class="keyword">true</span>;
00359                         }
00360                 }
00361 
00362                 <span class="comment">//</span>
00363                 <span class="comment">// If they are in special row / columns we do something special to them.</span>
00364                 <span class="comment">//</span>
00365                 <span class="keywordflow">if</span>( <a class="code" href="../../d5/d6/classCResizeDlg.html#p6">m_SpecialCol</a>.<a class="code" href="../../d7/d9/struct__tagSPECIAL.html#o0">bSpecial</a> &amp;&amp; ( pCons-&gt;GetCol() == iSpecialCol ) )
00366                 {
00367                         <span class="comment">// alignment issues</span>
00368                         <span class="keywordflow">if</span>(<a class="code" href="../../d5/d6/classCResizeDlg.html#p6">m_SpecialCol</a>.<a class="code" href="../../d7/d9/struct__tagSPECIAL.html#o3">iAlignment</a> == -1 )
00369                         {
00370                                 y=pC-&gt;GetTopGap();
00371                         }
00372                         <span class="keywordflow">else</span>
00373                         <span class="keywordflow">if</span>(<a class="code" href="../../d5/d6/classCResizeDlg.html#p6">m_SpecialCol</a>.<a class="code" href="../../d7/d9/struct__tagSPECIAL.html#o3">iAlignment</a> == 1 )
00374                         {
00375                                 <span class="comment">//</span>
00376                                 <span class="comment">// Right aligned.</span>
00377                                 <span class="comment">//</span>
00378                                 y=pC-&gt;GetTopGap() + height - <a class="code" href="../../d5/d6/classCResizeDlg.html#p6">m_SpecialCol</a>.<a class="code" href="../../d7/d9/struct__tagSPECIAL.html#o2">iMax</a> - <a class="code" href="../../d5/d6/classCResizeDlg.html#p1">m_ParentInfo</a>.GetTopBorder();
00379                         }
00380                         <span class="keywordflow">else</span>
00381                         {
00382                                 <span class="comment">//</span>
00383                                 <span class="comment">// Center aligned</span>
00384                                 <span class="comment">//</span>
00385                                 y=pC-&gt;GetTopGap() + ((height - <a class="code" href="../../d5/d6/classCResizeDlg.html#p6">m_SpecialCol</a>.<a class="code" href="../../d7/d9/struct__tagSPECIAL.html#o2">iMax</a> - <a class="code" href="../../d5/d6/classCResizeDlg.html#p1">m_ParentInfo</a>.GetTopBorder())/2);
00386                         }
00387                 }
00388 
00389                 <span class="keywordflow">if</span>( <a class="code" href="../../d5/d6/classCResizeDlg.html#p5">m_SpecialRow</a>.<a class="code" href="../../d7/d9/struct__tagSPECIAL.html#o0">bSpecial</a> &amp;&amp; ( pCons-&gt;GetRow() == iSpecialRow ) )
00390                 {
00391                         <span class="comment">// alignment issues</span>
00392                         <span class="keywordflow">if</span>(<a class="code" href="../../d5/d6/classCResizeDlg.html#p5">m_SpecialRow</a>.<a class="code" href="../../d7/d9/struct__tagSPECIAL.html#o3">iAlignment</a> == -1 )
00393                         {
00394                                 x=pC-&gt;GetLeftGap();
00395                         }
00396                         <span class="keywordflow">else</span>
00397                         <span class="keywordflow">if</span>(<a class="code" href="../../d5/d6/classCResizeDlg.html#p5">m_SpecialRow</a>.<a class="code" href="../../d7/d9/struct__tagSPECIAL.html#o3">iAlignment</a> == 1 )       <span class="comment">// right aligned.</span>
00398                         {
00399                                 x=pC-&gt;GetLeftGap() + width - <a class="code" href="../../d5/d6/classCResizeDlg.html#p5">m_SpecialRow</a>.<a class="code" href="../../d7/d9/struct__tagSPECIAL.html#o2">iMax</a> - <a class="code" href="../../d5/d6/classCResizeDlg.html#p1">m_ParentInfo</a>.GetRightBorder();
00400                         }
00401                         <span class="keywordflow">else</span>
00402                         {
00403                                 x=pC-&gt;GetLeftGap() + ((width - <a class="code" href="../../d5/d6/classCResizeDlg.html#p5">m_SpecialRow</a>.<a class="code" href="../../d7/d9/struct__tagSPECIAL.html#o2">iMax</a> - <a class="code" href="../../d5/d6/classCResizeDlg.html#p1">m_ParentInfo</a>.GetRightBorder()) / 2);
00404                         }
00405                 }
00406 
00407                 hdwp = <a class="code" href="../../d3/d4/w32_2ntuser_2client_2nt6_2pch_8h.html#a2">DeferWindowPos</a>( hdwp, pC-&gt;GetControl(), <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, 
00408                         x, y, w , h,
00409                         (bMove ? 0: SWP_NOMOVE) |       (bSize ? 0: SWP_NOSIZE) | SWP_NOZORDER );
00410 
00411         }
00412 
00413         <span class="comment">//</span>
00414         <span class="comment">// Move the gripper</span>
00415         <span class="comment">//</span>
00416         <a class="code" href="../../d5/d6/classCResizeDlg.html#b21">SetGripperPos</a>(hdwp);
00417 
00418         <a class="code" href="../../d3/d8/client_8c.html#a90">EndDeferWindowPos</a>( hdwp );
00419 }
00420 
00422 <span class="comment">//</span>
00423 <span class="comment">// Tries to combine guides to be offsets from other guides.</span>
00424 <span class="comment">//</span>
<a name="l00426"></a><a class="code" href="../../d5/d6/classCResizeDlg.html#b17">00426</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="../../d5/d6/classCResizeDlg.html#b17">CResizeDlg::FindCommonGuides</a>()
00427 {
00428         <a class="code" href="../../d6/d2/classCEdge.html">CEdge</a> ** ppVert = <a class="code" href="../../d5/d6/classCResizeDlg.html#p1">m_ParentInfo</a>.<a class="code" href="../../d4/d5/classCParentInfo.html#a3">GetVerticalEdges</a>();
00429         <a class="code" href="../../d6/d2/classCEdge.html">CEdge</a> ** ppHoriz = <a class="code" href="../../d5/d6/classCResizeDlg.html#p1">m_ParentInfo</a>.<a class="code" href="../../d4/d5/classCParentInfo.html#a2">GetHorizontalEdges</a>();
00430 
00431         <span class="comment">//</span>
00432         <span class="comment">// Work out which guides are used in columns.</span>
00433         <span class="comment">//</span>
00434         <span class="keywordtype">int</span> iCount,i;
00435         iCount=<a class="code" href="../../d5/d6/classCResizeDlg.html#p1">m_ParentInfo</a>.<a class="code" href="../../d4/d5/classCParentInfo.html#a29">GetNumVert</a>();
00436         <a class="code" href="../../d5/d6/classCResizeDlg.html#b11">Sort</a>(ppVert, iCount );
00437 <span class="preprocessor">#ifdef _DEBUG</span>
00438 <span class="preprocessor"></span>        <a class="code" href="../../d7/d5/ntuser_2client_2nt6_2debug_8h.html#a0">TRACE</a>(<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"Vertical edge information %d edges\n"</span>, iCount );
00439         <span class="keywordflow">for</span>(i=0;i&lt;iCount;i++)
00440         {
00441                 <a class="code" href="../../d6/d2/classCEdge.html">CEdge</a> * pEdge=ppVert[i];
00442                 <a class="code" href="../../d7/d5/ntuser_2client_2nt6_2debug_8h.html#a0">TRACE</a>(<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"Edge %02d: Edge@%02d times as 0x%02x, position %08d, Guide@%03d\n"</span>,
00443                         i, pEdge-&gt;<a class="code" href="../../d6/d2/classCEdge.html#a16">GetControlCount</a>(), 
00444                         pEdge-&gt;<a class="code" href="../../d6/d2/classCEdge.html#a11">GetGuide</a>()-&gt;<a class="code" href="../../d1/d3/classCGuide.html#a0">Attatchment</a>(),
00445                         pEdge-&gt;<a class="code" href="../../d6/d2/classCEdge.html#a8">GetPosition</a>(),
00446                         pEdge-&gt;<a class="code" href="../../d6/d2/classCEdge.html#a11">GetGuide</a>()-&gt;<a class="code" href="../../d1/d3/classCGuide.html#a1">NumAttatchments</a>()
00447                         );
00448         }
00449 <span class="preprocessor">#endif</span>
00450 <span class="preprocessor"></span>
00451         iCount=<a class="code" href="../../d5/d6/classCResizeDlg.html#p1">m_ParentInfo</a>.<a class="code" href="../../d4/d5/classCParentInfo.html#a28">GetNumHoriz</a>();
00452         <a class="code" href="../../d5/d6/classCResizeDlg.html#b11">Sort</a>(ppHoriz, iCount );
00453 <span class="preprocessor">#ifdef _DEBUG</span>
00454 <span class="preprocessor"></span>        <a class="code" href="../../d7/d5/ntuser_2client_2nt6_2debug_8h.html#a0">TRACE</a>(<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"Horiz edge information %d edges\n"</span>, iCount );
00455         <span class="keywordflow">for</span>(i=0;i&lt;iCount;i++)
00456         {
00457                 <a class="code" href="../../d6/d2/classCEdge.html">CEdge</a> * pEdge=ppHoriz[i];
00458                 <a class="code" href="../../d1/d3/classCGuide.html">CGuide</a> * pGuide=pEdge-&gt;<a class="code" href="../../d6/d2/classCEdge.html#a11">GetGuide</a>();
00459                 <a class="code" href="../../d7/d5/ntuser_2client_2nt6_2debug_8h.html#a0">TRACE</a>(<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"Edge %02d: Edge@%02d times as 0x%02x, position %08d, Guide@%03d\n"</span>,i,
00460                         pEdge-&gt;<a class="code" href="../../d6/d2/classCEdge.html#a16">GetControlCount</a>(), 
00461                         pEdge-&gt;<a class="code" href="../../d6/d2/classCEdge.html#a0">Attatchment</a>(),
00462                         pGuide-&gt;GetPosition(),
00463                         pEdge-&gt;<a class="code" href="../../d6/d2/classCEdge.html#a11">GetGuide</a>()-&gt;<a class="code" href="../../d1/d3/classCGuide.html#a1">NumAttatchments</a>()
00464                         );
00465         }
00466 <span class="preprocessor">#endif</span>
00467 <span class="preprocessor"></span>
00468         <span class="comment">//</span>
00469         <span class="comment">// Determin rows and columns</span>
00470         <span class="comment">//</span>
00471         <a class="code" href="../../d5/d6/classCResizeDlg.html#b18">DeterminCols</a>( ppVert, <a class="code" href="../../d5/d6/classCResizeDlg.html#p1">m_ParentInfo</a>.<a class="code" href="../../d4/d5/classCParentInfo.html#a29">GetNumVert</a>() );
00472         <a class="code" href="../../d5/d6/classCResizeDlg.html#b19">DeterminRows</a>( ppHoriz, <a class="code" href="../../d5/d6/classCResizeDlg.html#p1">m_ParentInfo</a>.<a class="code" href="../../d4/d5/classCParentInfo.html#a28">GetNumHoriz</a>() );
00473         <a class="code" href="../../d5/d6/classCResizeDlg.html#b7">PlaceControls</a>();
00474 
00475         <span class="keyword">delete</span> [] ppVert;
00476         <span class="keyword">delete</span> [] ppHoriz;
00477 
00478         <a class="code" href="../../d5/d6/classCResizeDlg.html#b9">DeterminWeights</a>();
00479 }
00480 
00482 <span class="comment">//</span>
00483 <span class="comment">// Sorts an array of edges.</span>
00484 <span class="comment">//</span>
<a name="l00486"></a><a class="code" href="../../d5/d6/classCResizeDlg.html#b11">00486</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="../../d5/d6/classCResizeDlg.html#b11">CResizeDlg::Sort</a>(<a class="code" href="../../d6/d2/classCEdge.html">CEdge</a> * *ppEdges, <span class="keywordtype">int</span> iCount)
00487 {
00488         <span class="comment">//</span>
00489         <span class="comment">// Lame sort BB fix later.</span>
00490         <span class="comment">//</span>
00491         <span class="keywordtype">int</span> iInsert=0;
00492         <span class="keywordflow">while</span> ( iInsert &lt; iCount )
00493         {
00494                 <span class="keywordtype">int</span> iSmallest=iInsert;
00495                 <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iMatch=iInsert; iMatch&lt;iCount; iMatch++)
00496                 {
00497                         <span class="keywordflow">if</span>( ppEdges[iMatch]-&gt;<a class="code" href="../../d6/d2/classCEdge.html#a8">GetPosition</a>() &lt; ppEdges[iSmallest]-&gt;<a class="code" href="../../d6/d2/classCEdge.html#a8">GetPosition</a>() )
00498                                 iSmallest=iMatch;
00499                 }
00500                 <span class="keywordflow">if</span>( iSmallest &gt; iInsert )
00501                 {
00502                         <a class="code" href="../../d6/d2/classCEdge.html">CEdge</a> * pTemp=ppEdges[iInsert];
00503                         ppEdges[iInsert]=ppEdges[iSmallest];
00504                         ppEdges[iSmallest]=pTemp;
00505                 }
00506                 <span class="comment">// TRACE(L"%02d is %08d\n", iInsert, ppEdges[iInsert]-&gt;GetPosition() );</span>
00507                 iInsert++;
00508         }
00509 }
00510 
00511 
00513 <span class="comment">//</span>
00514 <span class="comment">// State table kinda used to determin when a new col. is needed</span>
00515 <span class="comment">// Prev This    New Col?</span>
00516 <span class="comment">// L    L               Yes, on this edge</span>
00517 <span class="comment">// L    R               Yes, on this edge</span>
00518 <span class="comment">// R    L               Yes, between these two edges</span>
00519 <span class="comment">// R    R               Yes if last (no if on same guide)?</span>
00520 <span class="comment">//</span>
<a name="l00522"></a><a class="code" href="../../d5/d6/classCResizeDlg.html#b18">00522</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="../../d5/d6/classCResizeDlg.html#b18">CResizeDlg::DeterminCols</a>(<a class="code" href="../../d6/d2/classCEdge.html">CEdge</a> * * ppEdges, <span class="keywordtype">int</span> iCount)
00523 {
00524         <span class="comment">//</span>
00525         <span class="comment">// First pass is just to work out positions of edges,</span>
00526         <span class="comment">// and if those edges constitute Columns.</span>
00527         <span class="comment">//</span>
00528         <span class="keywordtype">int</span> i;
00529         <span class="keywordtype">int</span> iCols=0;
00530         <span class="keywordtype">int</span> iLastGuide;
00531         <span class="keywordtype">int</span> iThisGuide;
00532         <span class="keywordtype">int</span> * iPos = <span class="keyword">new</span> <span class="keywordtype">int</span>[iCount];                   <span class="comment">// where the edges are</span>
00533         iPos[0]=ppEdges[0]-&gt;<a class="code" href="../../d6/d2/classCEdge.html#a8">GetPosition</a>();              <span class="comment">// we always use the first edge.</span>
00534         <span class="keywordtype">int</span> iLastPos=0;
00535         <span class="keywordflow">for</span>(i=1; i&lt;iCount;i++)
00536         {
00537                 iThisGuide=ppEdges[i]-&gt;Attatchment() ;
00538                 iLastGuide=ppEdges[i-1]-&gt;Attatchment();
00539                 <a class="code" href="../../d7/d5/ntuser_2client_2nt6_2debug_8h.html#a0">TRACE</a>(<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"Edge:%02d - Attatched as %02d\n"</span>, i, iThisGuide);
00540 
00541                 <span class="comment">//</span>
00542                 <span class="comment">// Column between these two controls </span>
00543                 <span class="comment">//</span>
00544                 <span class="keywordflow">if</span>( (iLastGuide &amp; <a class="code" href="../../d7/d4/edge_8h.html#a4">RIGHT_AT</a> ) &amp;&amp; ( iThisGuide &amp; <a class="code" href="../../d7/d4/edge_8h.html#a3">LEFT_AT</a> ) )
00545                 {
00546                         iCols++;
00547                         iPos[iCols] = ppEdges[i-1]-&gt;GetPosition() + ((ppEdges[i]-&gt;GetPosition() - ppEdges[i-1]-&gt;GetPosition())/2);
00548                         <span class="keywordflow">continue</span>;
00549                 }
00550 
00551                 <span class="comment">//</span>
00552                 <span class="comment">// If we're starting another left edge of a control, needs a new guide</span>
00553                 <span class="comment">//</span>
00554                 <span class="keywordflow">if</span>( (iThisGuide &amp; <a class="code" href="../../d7/d4/edge_8h.html#a3">LEFT_AT</a> ) )
00555                 {
00556                         iCols++;
00557                         iPos[iCols]= ppEdges[i]-&gt;GetPosition();
00558                         <span class="keywordflow">continue</span>;
00559                 }
00560 
00561                 <span class="comment">//</span>
00562                 <span class="comment">// If this is the last right edge</span>
00563                 <span class="comment">//</span>
00564                 <span class="keywordflow">if</span>( (iThisGuide &amp; <a class="code" href="../../d7/d4/edge_8h.html#a4">RIGHT_AT</a> ) &amp;&amp; ((i+1)==iCount) )
00565                 {
00566                         iCols++;
00567                         iPos[iCols] = ppEdges[i]-&gt;GetPosition() ;
00568                         <span class="keywordflow">continue</span>;       <span class="comment">// just incase you add anytyhing below</span>
00569                 }
00570         }
00571 
00572 
00573         <span class="comment">//</span>
00574         <span class="comment">// Second pass is to make up the column information</span>
00575         <span class="comment">// we don't allow narrow colums, that is columns who are &lt;2 appart.</span>
00576         <span class="comment">//</span>
00577         <a class="code" href="../../d7/d5/ntuser_2client_2nt6_2debug_8h.html#a0">TRACE</a>(<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"Column Widths are ...\n"</span>);
00578         SetNumCols( iCols );                    <span class="comment">// 0 through n are USED. Not n-1</span>
00579         <a class="code" href="../../d5/d6/classCResizeDlg.html#p3">m_Cols</a> = <span class="keyword">new</span> <a class="code" href="../../d9/d9/structtagCHANNEL.html">CHANNEL</a>[iCols+1];
00580         <a class="code" href="../../d5/d6/classCResizeDlg.html#p3">m_Cols</a>[0].<a class="code" href="../../d9/d9/structtagCHANNEL.html#o0">Pos</a>=iPos[0];
00581         iLastPos=0;
00582         <span class="keywordtype">int</span> iThisCol=1;
00583         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iThisPos=1;iThisPos&lt;=iCols;iThisPos++)
00584         {
00585                 <span class="keywordtype">int</span> iWidth=iPos[iThisPos]-iPos[iLastPos];
00586                 <span class="keywordflow">if</span>( iWidth &gt;= <a class="code" href="../../d5/d8/resizedlg_8cpp.html#a0">MIN_COL_SPACE</a> )
00587                 {
00588                         <a class="code" href="../../d5/d6/classCResizeDlg.html#p3">m_Cols</a>[iThisCol].<a class="code" href="../../d9/d9/structtagCHANNEL.html#o0">Pos</a> = iPos[iThisPos];
00589                         <a class="code" href="../../d5/d6/classCResizeDlg.html#p3">m_Cols</a>[iThisCol-1].<a class="code" href="../../d9/d9/structtagCHANNEL.html#o1">Size</a> = iWidth;
00590                         <a class="code" href="../../d5/d6/classCResizeDlg.html#p3">m_Cols</a>[iThisCol-1].<a class="code" href="../../d9/d9/structtagCHANNEL.html#o3">iWeight</a>=0;
00591                         <a class="code" href="../../d5/d6/classCResizeDlg.html#p3">m_Cols</a>[iThisCol-1].<a class="code" href="../../d9/d9/structtagCHANNEL.html#o2">iFixed</a>=<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00592                         <span class="comment">/*</span>
00593 <span class="comment">                        TRACE(L"Col:%02d Width:%03d Pos:%03d\n",        </span>
00594 <span class="comment">                                iThisCol-1, </span>
00595 <span class="comment">                                m_Cols[iThisCol-1].Size, </span>
00596 <span class="comment">                                m_Cols[iThisCol-1].Pos);</span>
00597 <span class="comment">                        */</span>
00598                         iLastPos=iThisPos;
00599                         iThisCol++;
00600                 }
00601                 <span class="keywordflow">else</span>
00602                 {
00603                         <span class="comment">// TRACE(L"Skipping col #%d as it's only %d wide\n",iThisPos,iWidth);</span>
00604                 }
00605         }
00606 <span class="preprocessor">#ifdef _DEBUG</span>
00607 <span class="preprocessor"></span>        <span class="keywordflow">if</span>( (iThisCol-1) != iCols )
00608                 <a class="code" href="../../d7/d5/ntuser_2client_2nt6_2debug_8h.html#a0">TRACE</a>(<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"Skipped %d rows\n"</span>,iThisCol-1-iCols);
00609 <span class="preprocessor">#endif</span>
00610 <span class="preprocessor"></span>        SetNumCols( iThisCol-1 );
00611 
00612         <span class="keyword">delete</span> [] iPos;
00613 }
00614 
00616 <span class="comment">//</span>
00617 <span class="comment">// State table kinda used to determin when a new col. is needed</span>
00618 <span class="comment">// Prev This    New Col?</span>
00619 <span class="comment">// L    L               Yes, on this edge</span>
00620 <span class="comment">// L    R               Yes, on this edge</span>
00621 <span class="comment">// R    L               Yes, between these two edges</span>
00622 <span class="comment">// R    R               Yes if last (no if on same guide)?</span>
00623 <span class="comment">//</span>
<a name="l00625"></a><a class="code" href="../../d5/d6/classCResizeDlg.html#b19">00625</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="../../d5/d6/classCResizeDlg.html#b19">CResizeDlg::DeterminRows</a>(<a class="code" href="../../d6/d2/classCEdge.html">CEdge</a> * * ppEdges, <span class="keywordtype">int</span> iCount)
00626 {
00627         <span class="keywordtype">int</span> i;
00628         <span class="keywordtype">int</span> iRows=0;
00629         <span class="keywordtype">int</span> iLastGuide;
00630         <span class="keywordtype">int</span> iThisGuide;
00631         <span class="keywordtype">int</span> * iPos = <span class="keyword">new</span> <span class="keywordtype">int</span>[iCount];
00632 
00633         <span class="comment">//</span>
00634         <span class="comment">// brute force, each edge is a row.</span>
00635         <span class="comment">//</span>
00636         iRows=0;
00637         iPos[0]=ppEdges[0]-&gt;<a class="code" href="../../d6/d2/classCEdge.html#a8">GetPosition</a>();
00638         <span class="keywordtype">int</span> iLastPos=0;
00639         <span class="keywordflow">for</span>(i=1; i&lt;iCount;i++)
00640         {
00641                 iThisGuide=ppEdges[i]-&gt;Attatchment() ;
00642                 iLastGuide=ppEdges[i-1]-&gt;Attatchment();
00643                 <a class="code" href="../../d7/d5/ntuser_2client_2nt6_2debug_8h.html#a0">TRACE</a>(<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"Edge:%02d - Attatched as %02d pos:%03d\n"</span>, i, iThisGuide, ppEdges[i]-&gt;GetPosition() );
00644 
00645                 <span class="comment">//</span>
00646                 <span class="comment">// row between these two controls </span>
00647                 <span class="comment">//</span>
00648                 <span class="keywordflow">if</span>( (iLastGuide &amp; <a class="code" href="../../d7/d4/edge_8h.html#a6">BOTTOM_AT</a> ) &amp;&amp; ( iThisGuide &amp; <a class="code" href="../../d7/d4/edge_8h.html#a5">TOP_AT</a> ) )
00649                 {
00650                         iRows++;
00651                         iPos[iRows] = ppEdges[i-1]-&gt;GetPosition() + ((ppEdges[i]-&gt;GetPosition() - ppEdges[i-1]-&gt;GetPosition())/2);
00652                         <span class="keywordflow">continue</span>;
00653                 }
00654 
00655                 <span class="comment">//</span>
00656                 <span class="comment">// If we're starting another left edge of a control, needs a new guide</span>
00657                 <span class="comment">//</span>
00658                 <span class="keywordflow">if</span>( (iThisGuide &amp; <a class="code" href="../../d7/d4/edge_8h.html#a5">TOP_AT</a> ) )
00659                 {
00660                         iRows++;
00661                         iPos[iRows]= ppEdges[i]-&gt;GetPosition();
00662                         <span class="keywordflow">continue</span>;
00663                 }
00664 
00665                 <span class="comment">//</span>
00666                 <span class="comment">// If this is the last right edge</span>
00667                 <span class="comment">//</span>
00668                 <span class="keywordflow">if</span>( (iThisGuide &amp; <a class="code" href="../../d7/d4/edge_8h.html#a6">BOTTOM_AT</a> ) &amp;&amp; ((i+1)==iCount) )
00669                 {
00670                         iRows++;
00671                         iPos[iRows] = ppEdges[i]-&gt;GetPosition() ;
00672                         <span class="keywordflow">continue</span>;       <span class="comment">// just incase you add anytyhing below</span>
00673                 }
00674         }
00675 
00676         <span class="comment">//</span>
00677         <span class="comment">// Second pass is to make up the column information</span>
00678         <span class="comment">// we don't allow narrow colums, that is columns who are &lt;2 appart.</span>
00679         <span class="comment">//</span>
00680         <a class="code" href="../../d7/d5/ntuser_2client_2nt6_2debug_8h.html#a0">TRACE</a>(<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"Rowumn Widths are ...\n"</span>);
00681         SetNumRows( iRows );                    <span class="comment">// 0 through n are USED. Not n-1</span>
00682         <a class="code" href="../../d5/d6/classCResizeDlg.html#p2">m_Rows</a> = <span class="keyword">new</span> <a class="code" href="../../d9/d9/structtagCHANNEL.html">CHANNEL</a>[iRows+1];
00683         <a class="code" href="../../d5/d6/classCResizeDlg.html#p2">m_Rows</a>[0].<a class="code" href="../../d9/d9/structtagCHANNEL.html#o0">Pos</a>=iPos[0];
00684         iLastPos=0;
00685         <span class="keywordtype">int</span> iThisRow=1;
00686         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iThisPos=1;iThisPos&lt;=iRows;iThisPos++)
00687         {
00688                 <span class="keywordtype">int</span> iWidth=iPos[iThisPos]-iPos[iLastPos];
00689                 <span class="keywordflow">if</span>( iWidth &gt;= <a class="code" href="../../d5/d8/resizedlg_8cpp.html#a1">MIN_ROW_SPACE</a> )
00690                 {
00691                         <a class="code" href="../../d5/d6/classCResizeDlg.html#p2">m_Rows</a>[iThisRow].<a class="code" href="../../d9/d9/structtagCHANNEL.html#o0">Pos</a> = iPos[iThisPos];
00692                         <a class="code" href="../../d5/d6/classCResizeDlg.html#p2">m_Rows</a>[iThisRow-1].<a class="code" href="../../d9/d9/structtagCHANNEL.html#o1">Size</a> = iWidth;
00693                         <a class="code" href="../../d5/d6/classCResizeDlg.html#p2">m_Rows</a>[iThisRow-1].<a class="code" href="../../d9/d9/structtagCHANNEL.html#o3">iWeight</a>=0;
00694                         <a class="code" href="../../d5/d6/classCResizeDlg.html#p2">m_Rows</a>[iThisRow-1].<a class="code" href="../../d9/d9/structtagCHANNEL.html#o2">iFixed</a>=<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00695                         <span class="comment">/*</span>
00696 <span class="comment">                        TRACE(L"Row:%02d Width:%03d Pos:%03d\n",        </span>
00697 <span class="comment">                                iThisRow-1, </span>
00698 <span class="comment">                                m_Rows[iThisRow-1].Size, </span>
00699 <span class="comment">                                m_Rows[iThisRow-1].Pos);</span>
00700 <span class="comment">                        */</span>
00701                         iLastPos=iThisPos;
00702                         iThisRow++;
00703                 }
00704                 <span class="keywordflow">else</span>
00705                 {
00706                         <span class="comment">// TRACE(L"Skipping Row #%d as it's only %d wide\n",iThisPos,iWidth);</span>
00707                 }
00708         }
00709 <span class="preprocessor">#ifdef _DEBUG</span>
00710 <span class="preprocessor"></span>        <span class="keywordflow">if</span>( (iThisRow-1) != iRows )
00711                 <a class="code" href="../../d7/d5/ntuser_2client_2nt6_2debug_8h.html#a0">TRACE</a>(<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"Skipped %d rows\n"</span>,iThisRow-1-iRows);
00712 <span class="preprocessor">#endif</span>
00713 <span class="preprocessor"></span>        SetNumRows( iThisRow-1 );
00714 
00715         <span class="keyword">delete</span> [] iPos;
00716 }
00717 
00719 <span class="comment">//</span>
00720 <span class="comment">// Draws the annotations on the dialog of where the column/rows are</span>
00721 <span class="comment">//</span>
<a name="l00723"></a><a class="code" href="../../d5/d6/classCResizeDlg.html#b10">00723</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="../../d5/d6/classCResizeDlg.html#b10">CResizeDlg::Annotate</a>()
00724 {
00725         <span class="keywordflow">if</span>(GetAnnotate()==<span class="keyword">false</span>)
00726                 <span class="keywordflow">return</span>;
00727 
00728         HDC hdc=<a class="code" href="../../d3/d4/w32_2ntuser_2client_2nt6_2pch_8h.html#a1">GetDC</a>( <a class="code" href="../../d4/d2/classCDlg.html#a5">GetWindow</a>() );
00729         <span class="comment">//</span>
00730         <span class="comment">// Draw all the control edges on the screen.</span>
00731         <span class="comment">//</span>
00732         <span class="comment">// m_ParentInfo.Annotate( hdc );</span>
00733 
00734         <span class="comment">//</span>
00735         <span class="comment">// Now show the cols/rows</span>
00736         <span class="comment">//</span>
00737         <span class="keywordtype">int</span> iCount=GetNumRows();
00738         <span class="keywordtype">int</span> i;
00739         RECT r;
00740         <a class="code" href="../../d3/d9/client_2wow_8c.html#a26">GetWindowRect</a>( <a class="code" href="../../d4/d2/classCDlg.html#a5">GetWindow</a>(), &amp;r);
00741         <span class="keywordtype">int</span> iWidth=r.right - r.left;
00742         <span class="keywordtype">int</span> iHeight=r.bottom - r.top;
00743 
00744         HPEN hFixedPen = CreatePen( PS_SOLID, 2, RGB( 0x00,0x00,0xff) );
00745         HPEN hSizePen = CreatePen( PS_SOLID, 2, RGB( 0x00,0xff,0x00) );
00746         HGDIOBJ holdPen= SelectObject( hdc, hFixedPen);
00747 
00748         <span class="comment">//</span>
00749         <span class="comment">// Horizontal lines</span>
00750         <span class="comment">//</span>
00751         <span class="keywordflow">for</span>(i=0;i&lt;=iCount;i++)
00752         {
00753                 <span class="keywordflow">if</span>(<a class="code" href="../../d5/d6/classCResizeDlg.html#p2">m_Rows</a>[i].<a class="code" href="../../d9/d9/structtagCHANNEL.html#o2">iFixed</a> &gt;= 0 )
00754                         SelectObject( hdc, hSizePen );
00755                 <span class="keywordflow">else</span>
00756                         SelectObject( hdc, hFixedPen );
00757                 MoveToEx( hdc, 0, <a class="code" href="../../d5/d6/classCResizeDlg.html#p2">m_Rows</a>[i].Pos, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> );
00758                 LineTo( hdc, iWidth , <a class="code" href="../../d5/d6/classCResizeDlg.html#p2">m_Rows</a>[i].Pos );
00759         }
00760 
00761         <span class="comment">//</span>
00762         <span class="comment">// Vertical lines</span>
00763         <span class="comment">//</span>
00764         iCount = GetNumCols();
00765         <span class="keywordflow">for</span>(i=0;i&lt;=iCount;i++)
00766         {
00767                 <span class="keywordflow">if</span>(<a class="code" href="../../d5/d6/classCResizeDlg.html#p3">m_Cols</a>[i].<a class="code" href="../../d9/d9/structtagCHANNEL.html#o2">iFixed</a> &gt;= 0 )
00768                         SelectObject( hdc, hSizePen );
00769                 <span class="keywordflow">else</span>
00770                         SelectObject( hdc, hFixedPen );
00771                 MoveToEx( hdc, <a class="code" href="../../d5/d6/classCResizeDlg.html#p3">m_Cols</a>[i].Pos, 0, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> );
00772                 LineTo( hdc, <a class="code" href="../../d5/d6/classCResizeDlg.html#p3">m_Cols</a>[i].Pos, iHeight );
00773         }
00774 
00775         SelectObject(hdc, holdPen);
00776         DeleteObject(hFixedPen);
00777         DeleteObject(hSizePen);
00778 
00779         <a class="code" href="../../d3/d8/client_8c.html#a45">ReleaseDC</a>( <a class="code" href="../../d4/d2/classCDlg.html#a5">GetWindow</a>(), hdc );
00780 }
00781 
00783 <span class="comment">//</span>
00784 <span class="comment">// </span>
00785 <span class="comment">//</span>
<a name="l00787"></a><a class="code" href="../../d5/d6/classCResizeDlg.html#b4">00787</a> <span class="comment"></span><span class="keywordtype">int</span> <a class="code" href="../../d5/d6/classCResizeDlg.html#b4">CResizeDlg::FindRow</a>(<span class="keywordtype">int</span> pos)
00788 {
00789         <span class="keywordtype">int</span> i=0;
00790         <span class="keywordflow">while</span>( i&lt;=GetNumRows() )
00791         {
00792                 <span class="keywordflow">if</span>( <a class="code" href="../../d5/d6/classCResizeDlg.html#p2">m_Rows</a>[i].<a class="code" href="../../d9/d9/structtagCHANNEL.html#o0">Pos</a> &gt; pos )
00793                         <span class="keywordflow">return</span> i-1;
00794                 i++;
00795         }
00796         <span class="keywordflow">return</span> GetNumRows();
00797 }
00798 
00800 <span class="comment">//</span>
00801 <span class="comment">// </span>
00802 <span class="comment">//</span>
<a name="l00804"></a><a class="code" href="../../d5/d6/classCResizeDlg.html#b3">00804</a> <span class="comment"></span><span class="keywordtype">int</span> <a class="code" href="../../d5/d6/classCResizeDlg.html#b3">CResizeDlg::FindCol</a>(<span class="keywordtype">int</span> pos)
00805 {
00806         <span class="keywordtype">int</span> i=0;
00807         <span class="keywordflow">while</span>( i&lt;=GetNumCols() )
00808         {
00809                 <span class="keywordflow">if</span>( <a class="code" href="../../d5/d6/classCResizeDlg.html#p3">m_Cols</a>[i].<a class="code" href="../../d9/d9/structtagCHANNEL.html#o0">Pos</a> &gt; pos )
00810                         <span class="keywordflow">return</span> i-1;
00811                 i++;
00812         }
00813         <span class="keywordflow">return</span> GetNumCols();
00814 }
00815 
00817 <span class="comment">//</span>
00818 <span class="comment">// Walks the rows/columns and determins if they are resizable.</span>
00819 <span class="comment">//</span>
<a name="l00821"></a><a class="code" href="../../d5/d6/classCResizeDlg.html#b9">00821</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="../../d5/d6/classCResizeDlg.html#b9">CResizeDlg::DeterminWeights</a>()
00822 {
00823         <span class="keywordtype">int</span> iColWeight=0;
00824         {
00825                 <span class="keywordflow">for</span>( <span class="keywordtype">int</span> fi=0;fi&lt;= GetNumCols(); fi++)
00826                         <a class="code" href="../../d5/d6/classCResizeDlg.html#p3">m_Cols</a>[ fi ].<a class="code" href="../../d9/d9/structtagCHANNEL.html#o2">iFixed</a>&lt;0 ? 0: iColWeight+=<a class="code" href="../../d5/d6/classCResizeDlg.html#p3">m_Cols</a>[fi].<a class="code" href="../../d9/d9/structtagCHANNEL.html#o3">iWeight</a>;
00827         }
00828         <span class="keywordtype">int</span> iRowWeight=0;
00829         {
00830                 <span class="keywordflow">for</span>( <span class="keywordtype">int</span> fi=0;fi&lt;= GetNumRows(); fi++)
00831                         <a class="code" href="../../d5/d6/classCResizeDlg.html#p2">m_Rows</a>[ fi ].<a class="code" href="../../d9/d9/structtagCHANNEL.html#o2">iFixed</a>&lt;0 ? 0: iRowWeight+=<a class="code" href="../../d5/d6/classCResizeDlg.html#p2">m_Rows</a>[fi].<a class="code" href="../../d9/d9/structtagCHANNEL.html#o3">iWeight</a>;
00832         }
00833         SetColWeight(iColWeight);
00834         SetRowWeight(iRowWeight);
00835 }
00836 
00838 <span class="comment">//</span>
00839 <span class="comment">// Passed in the current hit test, allows you to override it.</span>
00840 <span class="comment">// return HTERROR -1 if we didn't deal with it.</span>
00841 <span class="comment">//</span>
<a name="l00843"></a><a class="code" href="../../d5/d6/classCResizeDlg.html#b8">00843</a> <span class="comment"></span>LONG <a class="code" href="../../d5/d6/classCResizeDlg.html#b8">CResizeDlg::HitTest</a>(LONG lCurrent)
00844 {
00845 <span class="preprocessor">#define WIDE 1</span>
00846 <span class="preprocessor"></span><span class="preprocessor">#define HIGH 2</span>
00847 <span class="preprocessor"></span>        <span class="keywordtype">int</span> iThisDlg = (GetRowWeight() ? <a class="code" href="../../d5/d8/resizedlg_8cpp.html#a3">HIGH</a> : 0 ) | ( GetColWeight() ? <a class="code" href="../../d5/d8/resizedlg_8cpp.html#a2">WIDE</a> : 0 );
00848 
00849         <span class="comment">// TRACE(L"NC Hit Test %d - dlg is %d\n",lCurrent, iThisDlg);</span>
00850         <span class="keywordflow">switch</span>( lCurrent )
00851         {
00852                 <span class="keywordflow">case</span> HTLEFT: <span class="comment">// In the left border of a window </span>
00853                 <span class="keywordflow">case</span> HTRIGHT: <span class="comment">// In the rigcase HT border of a window </span>
00854                         <span class="keywordflow">if</span>( iThisDlg==0)
00855                                 <span class="keywordflow">return</span> HTNOWHERE;
00856                         <span class="keywordflow">if</span>( iThisDlg &amp; <a class="code" href="../../d5/d8/resizedlg_8cpp.html#a2">WIDE</a> )
00857                                 <span class="keywordflow">return</span> lCurrent;        <span class="comment">// OK</span>
00858                         <span class="keywordflow">return</span> HTNOWHERE;
00859 
00860                 <span class="keywordflow">case</span> HTTOP: <span class="comment">// In the upper horizontal border of a window </span>
00861                 <span class="keywordflow">case</span> HTBOTTOM: <span class="comment">// In the lower horizontal border of a window </span>
00862                         <span class="keywordflow">if</span>( iThisDlg==0)
00863                                 <span class="keywordflow">return</span> HTNOWHERE;
00864                         <span class="keywordflow">if</span>( iThisDlg &amp; <a class="code" href="../../d5/d8/resizedlg_8cpp.html#a3">HIGH</a> ) 
00865                                 <span class="keywordflow">return</span> lCurrent;        <span class="comment">// OK</span>
00866                         <span class="keywordflow">return</span> HTNOWHERE;               <span class="comment">// Can't make taller</span>
00867 
00868                 <span class="keywordflow">case</span> HTTOPLEFT: <span class="comment">// In the upper-left corner of a window border </span>
00869                 <span class="keywordflow">case</span> HTTOPRIGHT: <span class="comment">// In the upper rigcase HT corner of a window border </span>
00870                         <span class="keywordflow">if</span>( iThisDlg==0)
00871                                 <span class="keywordflow">return</span> HTNOWHERE;
00872 
00873                         <span class="keywordflow">if</span>( (iThisDlg &amp; (<a class="code" href="../../d5/d8/resizedlg_8cpp.html#a3">HIGH</a> | <a class="code" href="../../d5/d8/resizedlg_8cpp.html#a2">WIDE</a>)) == (<a class="code" href="../../d5/d8/resizedlg_8cpp.html#a3">HIGH</a> | <a class="code" href="../../d5/d8/resizedlg_8cpp.html#a2">WIDE</a> ))
00874                                 <span class="keywordflow">return</span> lCurrent;
00875                         <span class="keywordflow">if</span>( iThisDlg &amp; <a class="code" href="../../d5/d8/resizedlg_8cpp.html#a3">HIGH</a> )
00876                                 <span class="keywordflow">return</span> HTTOP;
00877                         <span class="keywordflow">if</span>( lCurrent == HTTOPLEFT )
00878                                 <span class="keywordflow">return</span> HTLEFT;
00879                         <span class="keywordflow">return</span> HTRIGHT;
00880 
00881                 <span class="keywordflow">case</span> HTGROWBOX: <span class="comment">// In a size box (same as case HTSIZE) </span>
00882                         <span class="keywordflow">if</span>( iThisDlg==0)
00883                                 <span class="keywordflow">return</span> HTNOWHERE;
00884                         <span class="keywordflow">if</span>( (iThisDlg &amp; (<a class="code" href="../../d5/d8/resizedlg_8cpp.html#a3">HIGH</a> | <a class="code" href="../../d5/d8/resizedlg_8cpp.html#a2">WIDE</a>)) == (<a class="code" href="../../d5/d8/resizedlg_8cpp.html#a3">HIGH</a> | <a class="code" href="../../d5/d8/resizedlg_8cpp.html#a2">WIDE</a> ))
00885                                 <span class="keywordflow">return</span> lCurrent;
00886                         <span class="keywordflow">if</span>( iThisDlg &amp; <a class="code" href="../../d5/d8/resizedlg_8cpp.html#a3">HIGH</a> )
00887                                 <span class="keywordflow">return</span> HTBOTTOM;
00888                         <span class="keywordflow">return</span> HTRIGHT;
00889 
00890                 <span class="keywordflow">case</span> HTBOTTOMLEFT: <span class="comment">// In the lower-left corner of a window border </span>
00891                 <span class="keywordflow">case</span> HTBOTTOMRIGHT: <span class="comment">// In the lower-rigcase HT corner of a window border </span>
00892                         <span class="keywordflow">if</span>( iThisDlg==0)
00893                                 <span class="keywordflow">return</span> HTNOWHERE;
00894                         <span class="keywordflow">if</span>( (iThisDlg &amp; (<a class="code" href="../../d5/d8/resizedlg_8cpp.html#a3">HIGH</a> | <a class="code" href="../../d5/d8/resizedlg_8cpp.html#a2">WIDE</a>)) == (<a class="code" href="../../d5/d8/resizedlg_8cpp.html#a3">HIGH</a> | <a class="code" href="../../d5/d8/resizedlg_8cpp.html#a2">WIDE</a> ))
00895                                 <span class="keywordflow">return</span> lCurrent;
00896                         <span class="keywordflow">if</span>( iThisDlg &amp; <a class="code" href="../../d5/d8/resizedlg_8cpp.html#a3">HIGH</a> )
00897                                 <span class="keywordflow">return</span> HTBOTTOM;
00898                         <span class="keywordflow">if</span>(lCurrent == HTBOTTOMRIGHT)
00899                                 <span class="keywordflow">return</span> HTRIGHT;
00900                         <span class="keywordflow">return</span> HTLEFT;
00901         }
00902         <span class="keywordflow">return</span> HTERROR-1;
00903 }
00904 
00906 <span class="comment">//</span>
00907 <span class="comment">// Determins the location of the controls in the row/col space.</span>
00908 <span class="comment">//</span>
<a name="l00910"></a><a class="code" href="../../d5/d6/classCResizeDlg.html#b7">00910</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="../../d5/d6/classCResizeDlg.html#b7">CResizeDlg::PlaceControls</a>()
00911 {
00912         <span class="comment">//</span>
00913         <span class="comment">// Now setup the information for all of the controls, as to which cell they are in.</span>
00914         <span class="comment">//</span>
00915         <span class="keywordtype">int</span> i=0;
00916         <a class="code" href="../../d3/d6/classCResizeControl.html">CResizeControl</a> * pC;
00917         CConstraint     * pCons;
00918         <span class="keywordflow">while</span>( pC=(<a class="code" href="../../d3/d6/classCResizeControl.html">CResizeControl</a> *) <a class="code" href="../../d5/d6/classCResizeDlg.html#p0">m_ControlList</a>.<a class="code" href="../../d5/d2/classCDPA.html#a4">GetPointer</a>(i++) )
00919         {
00920                 <span class="keywordtype">int</span> Row, Col, RowH, ColW;
00921 
00922                 RECT r=pC-&gt;<a class="code" href="../../d3/d6/classCResizeControl.html#a26">GetLocation</a>();
00923                 pCons=&amp;(pC-&gt;<a class="code" href="../../d3/d6/classCResizeControl.html#o1">m_Cons</a>);
00924 
00925                 Row  = <a class="code" href="../../d5/d6/classCResizeDlg.html#b4">FindRow</a>( r.top);
00926                 RowH = FindRow( r.bottom ) - Row +1 ;
00927                 <span class="keywordflow">if</span>( RowH + Row &gt; GetNumRows() )
00928                         RowH = GetNumRows() - Row;
00929 
00930                 Col  = <a class="code" href="../../d5/d6/classCResizeDlg.html#b3">FindCol</a>( r.left);
00931                 ColW = FindCol( r.right ) - Col + 1;
00932                 <span class="keywordflow">if</span>( ColW + Col &gt; GetNumCols() )
00933                         ColW = GetNumCols() - Col;
00934 
00935                 pCons-&gt;SetCol( Col );
00936                 pCons-&gt;SetRow( Row );
00937                 pCons-&gt;SetColW( ColW );
00938                 pCons-&gt;SetRowH( RowH );
00939 
00940                 <span class="comment">//</span>
00941                 <span class="comment">// Now adjust the padding from the edges of the cell.</span>
00942                 <span class="comment">//</span>
00943                 pCons-&gt;SetPadTop   ( r.top    - <a class="code" href="../../d5/d6/classCResizeDlg.html#p2">m_Rows</a>[ Row ].<a class="code" href="../../d9/d9/structtagCHANNEL.html#o0">Pos</a> );
00944                 pCons-&gt;SetPadBottom( r.bottom - <a class="code" href="../../d5/d6/classCResizeDlg.html#p2">m_Rows</a>[ Row + RowH ].<a class="code" href="../../d9/d9/structtagCHANNEL.html#o0">Pos</a> );
00945                 pCons-&gt;SetPadLeft  ( r.left   - <a class="code" href="../../d5/d6/classCResizeDlg.html#p3">m_Cols</a>[ Col ].<a class="code" href="../../d9/d9/structtagCHANNEL.html#o0">Pos</a> );
00946                 pCons-&gt;SetPadRight ( r.right  - <a class="code" href="../../d5/d6/classCResizeDlg.html#p3">m_Cols</a>[ Col + ColW ].<a class="code" href="../../d9/d9/structtagCHANNEL.html#o0">Pos</a>  );
00947 
00948                 <span class="comment">/*</span>
00949 <span class="comment">                IF you're worried that you got the dimentions wrong</span>
00950 <span class="comment">                TRACE(L"Component %03d [%06d] %s\n pos: l:%03d, r:%03d, t:%03d, b:%03d\nCell: l:%03d, r:%03d, t:%03d, b:%03d\n",</span>
00951 <span class="comment">                        i, GetDlgCtrlID( pC-&gt;GetControl()),  pC-&gt;GetClassName(), r.left, r.right, r.top, r.bottom,</span>
00952 <span class="comment">                        m_Cols[pCons-&gt;GetCol()].Pos + pCons-&gt;GetPadLeft(),</span>
00953 <span class="comment">                        m_Cols[pCons-&gt;GetCol()+pCons-&gt;GetColW()].Pos + pCons-&gt;GetPadRight(),</span>
00954 <span class="comment">                        m_Rows[pCons-&gt;GetRow()].Pos + pCons-&gt;GetPadTop(),</span>
00955 <span class="comment">                        m_Rows[pCons-&gt;GetRow()+pCons-&gt;GetRowH()].Pos + pCons-&gt;GetPadBottom() );</span>
00956 <span class="comment">                */</span>
00957 
00958                 <a class="code" href="../../d7/d5/ntuser_2client_2nt6_2debug_8h.html#a0">TRACE</a>(<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"Component %03d [%06d] %s\n pos: Cell: %03d,%03d by %03d x %03d\n Padding:l:%03d, r:%03d, t:%03d, b:%03d\n"</span>,
00959                         i, <a class="code" href="../../d4/d9/nt6_2dlgmgr_8c.html#a11">GetDlgCtrlID</a>( pC-&gt;GetControl()),  pC-&gt;GetClassName(), 
00960                         pCons-&gt;GetCol(), pCons-&gt;GetRow(), pCons-&gt;GetColW(), pCons-&gt;GetRowH(),
00961                         pCons-&gt;GetPadLeft(), pCons-&gt;GetPadRight(), pCons-&gt;GetPadTop(), pCons-&gt;GetPadBottom() );
00962 
00963                 <span class="comment">//</span>
00964                 <span class="comment">// Mark each column this control spans as gets wider.</span>
00965                 <span class="comment">//</span>
00966                 <span class="keywordtype">int</span> iCol=pCons-&gt;GetCol();
00967                 <span class="keywordtype">int</span> ic=pCons-&gt;GetColW();
00968                 <span class="keywordflow">while</span>( ic-- )
00969                 {
00970                         <span class="keywordflow">if</span>( pC-&gt; IsGrowsWide() == <span class="keyword">false</span> )
00971                                 <a class="code" href="../../d5/d6/classCResizeDlg.html#p3">m_Cols</a>[ iCol+ic ].<a class="code" href="../../d9/d9/structtagCHANNEL.html#o2">iFixed</a>-=1;    <span class="comment">// can't make wider</span>
00972                         <span class="keywordflow">else</span>
00973                         {
00974                                 <a class="code" href="../../d5/d6/classCResizeDlg.html#p3">m_Cols</a>[ iCol+ic ].<a class="code" href="../../d9/d9/structtagCHANNEL.html#o3">iWeight</a>++;
00975                                 <a class="code" href="../../d5/d6/classCResizeDlg.html#p3">m_Cols</a>[ iCol+ic ].<a class="code" href="../../d9/d9/structtagCHANNEL.html#o2">iFixed</a>+=2;    <span class="comment">// can make wider</span>
00976                         }
00977                 }
00978 
00979                 ic=pCons-&gt;GetRowH();
00980                 <span class="keywordtype">int</span> iRow=pCons-&gt;GetRow();
00981                 <span class="keywordflow">while</span>( ic-- )
00982                 {
00983                         <span class="keywordflow">if</span>( pC-&gt; IsGrowsHigh() == <span class="keyword">false</span> )
00984                                 <a class="code" href="../../d5/d6/classCResizeDlg.html#p2">m_Rows</a>[ iRow+ic ].<a class="code" href="../../d9/d9/structtagCHANNEL.html#o2">iFixed</a>-=1;    <span class="comment">// can't make wider</span>
00985                         <span class="keywordflow">else</span>
00986                         {
00987                                 <a class="code" href="../../d5/d6/classCResizeDlg.html#p2">m_Rows</a>[ iRow+ic ].<a class="code" href="../../d9/d9/structtagCHANNEL.html#o3">iWeight</a>++;
00988                                 <a class="code" href="../../d5/d6/classCResizeDlg.html#p2">m_Rows</a>[ iRow+ic ].<a class="code" href="../../d9/d9/structtagCHANNEL.html#o2">iFixed</a>+=2;    <span class="comment">// can make wider</span>
00989                         }
00990                 }
00991         }
00992 }
00993 
00995 <span class="comment">//</span>
00996 <span class="comment">// Determins if we can actually change size to that asked for.</span>
00997 <span class="comment">//</span>
<a name="l00999"></a><a class="code" href="../../d5/d6/classCResizeDlg.html#b2">00999</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="../../d5/d6/classCResizeDlg.html#b2">CResizeDlg::DoChangePos</a>(WINDOWPOS * lpwp)
01000 {
01001         <span class="keywordflow">if</span>((lpwp-&gt;flags &amp; SWP_NOSIZE) == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>)
01002         {
01003                 <span class="comment">//</span>
01004                 <span class="comment">// We're being sized - size in screen area (ie. included title bar)</span>
01005                 <span class="comment">// m_ParentInfo EXCLUDES title bar.</span>
01006                 <span class="comment">//</span>
01007                 RECT r;
01008                 <a class="code" href="../../d3/d9/client_2wow_8c.html#a26">GetWindowRect</a>( <a class="code" href="../../d4/d2/classCDlg.html#a5">GetWindow</a>(), &amp;r );
01009                 <span class="keywordflow">if</span>( GetRowWeight() &lt;= 0 )
01010                         lpwp-&gt;cy=r.bottom- r.top;
01011                 <span class="keywordflow">if</span>( GetColWeight() &lt;= 0 )
01012                         lpwp-&gt;cx=r.right - r.left;
01013                 <a class="code" href="../../d8/d3/structtagDIMENSION.html">DIMENSION</a> dMin= <a class="code" href="../../d5/d6/classCResizeDlg.html#p1">m_ParentInfo</a>.GetMinimumSize();
01014                 <span class="keywordflow">if</span>( lpwp-&gt;cx &lt; dMin.<a class="code" href="../../d8/d3/structtagDIMENSION.html#o0">Width</a> )
01015                         lpwp-&gt;cx=dMin.<a class="code" href="../../d8/d3/structtagDIMENSION.html#o0">Width</a>;
01016                 <span class="keywordflow">if</span>( lpwp-&gt;cy &lt; dMin.<a class="code" href="../../d8/d3/structtagDIMENSION.html#o1">Height</a> )
01017                         lpwp-&gt;cy=dMin.<a class="code" href="../../d8/d3/structtagDIMENSION.html#o1">Height</a>;   
01018         }
01019 }
01020 
01022 <span class="comment">//</span>
01023 <span class="comment">// </span>
01024 <span class="comment">//</span>
<a name="l01026"></a><a class="code" href="../../d5/d6/classCResizeDlg.html#b6">01026</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="../../d5/d6/classCResizeDlg.html#b6">CResizeDlg::DoInitDialog</a>()
01027 {
01028         <a class="code" href="../../d5/d6/classCResizeDlg.html#b5">AddToSystemMenu</a>();
01029         <a class="code" href="../../d5/d6/classCResizeDlg.html#b12">WalkControls</a>();
01030         <a class="code" href="../../d5/d6/classCResizeDlg.html#b13">ResizeControls</a>( (WORD)<a class="code" href="../../d5/d6/classCResizeDlg.html#p1">m_ParentInfo</a>.<a class="code" href="../../d4/d5/classCParentInfo.html#a8">GetWidth</a>() , (WORD)<a class="code" href="../../d5/d6/classCResizeDlg.html#p1">m_ParentInfo</a>.<a class="code" href="../../d4/d5/classCParentInfo.html#a9">GetHeight</a>() );
01031 }
01032 
01034 <span class="comment">//</span>
01035 <span class="comment">// Adds an annotate option to the system menu.</span>
01036 <span class="comment">//</span>
<a name="l01038"></a><a class="code" href="../../d5/d6/classCResizeDlg.html#b5">01038</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="../../d5/d6/classCResizeDlg.html#b5">CResizeDlg::AddToSystemMenu</a>()
01039 {
01040         <span class="comment">/*</span>
01041 <span class="comment">        //</span>
01042 <span class="comment">        // Get the system menu - add an annotate option to it?</span>
01043 <span class="comment">        //</span>
01044 <span class="comment">        HMENU hm=GetSystemMenu(GetWindow(), false);</span>
01045 <span class="comment">        TCHAR   szAnnotate[128];</span>
01046 <span class="comment">        LoadString( GetInstance(), IDS_ANNOTATE, szAnnotate,  128);</span>
01047 <span class="comment">        MENUITEMINFO minfo={</span>
01048 <span class="comment">                sizeof(MENUITEMINFO),</span>
01049 <span class="comment">                MIIM_ID | MIIM_TYPE,</span>
01050 <span class="comment">                MFT_STRING,</span>
01051 <span class="comment">                0,</span>
01052 <span class="comment">                IDS_ANNOTATE,           // ID</span>
01053 <span class="comment">                NULL,                           // SubMenu</span>
01054 <span class="comment">                NULL,                           // Checked</span>
01055 <span class="comment">                NULL,                           // Unchecked</span>
01056 <span class="comment">                0,                                      // Item data - app specific</span>
01057 <span class="comment">                szAnnotate,                     // Content of the menu item</span>
01058 <span class="comment">                lstrlen(szAnnotate)+1// Length of menu item data</span>
01059 <span class="comment">        };</span>
01060 <span class="comment"></span>
01061 <span class="comment">        InsertMenuItem( hm, -1, TRUE, &amp;minfo);</span>
01062 <span class="comment">        */</span>
01063 }
01064 
<a name="l01065"></a><a class="code" href="../../d5/d6/classCResizeDlg.html#b20">01065</a> <span class="keywordtype">void</span> <a class="code" href="../../d5/d6/classCResizeDlg.html#b20">CResizeDlg::AddGripper</a>()
01066 {
01067         <span class="keywordtype">int</span> g_cxGrip = <a class="code" href="../../d3/d9/client_2wow_8c.html#a16">GetSystemMetrics</a>( SM_CXVSCROLL );
01068         <span class="keywordtype">int</span> g_cyGrip = <a class="code" href="../../d3/d9/client_2wow_8c.html#a16">GetSystemMetrics</a>( SM_CYHSCROLL );
01069         RECT rc;
01070         <a class="code" href="../../d3/d9/client_2wow_8c.html#a24">GetClientRect</a>( <a class="code" href="../../d4/d2/classCDlg.html#a5">GetWindow</a>(), &amp;rc);
01071         <a class="code" href="../../d5/d6/classCResizeDlg.html#p4">m_hwndGripper</a> = CreateWindow( TEXT(<span class="stringliteral">"Scrollbar"</span>),
01072                      <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
01073                      WS_VISIBLE | WS_CHILD | WS_CLIPSIBLINGS |
01074                        WS_CLIPCHILDREN | SBS_BOTTOMALIGN | SBS_SIZEGRIP |
01075                        SBS_SIZEBOXBOTTOMRIGHTALIGN,
01076                      rc.right - g_cxGrip,
01077                      rc.bottom - g_cyGrip,
01078                      g_cxGrip,
01079                      g_cyGrip,
01080                      GetWindow(),
01081                      (HMENU)-1,
01082                      (HINSTANCE)GetWindowLong( <a class="code" href="../../d4/d2/classCDlg.html#a5">GetWindow</a>(), GWL_HINSTANCE ) , <span class="comment">// g_hinst,</span>
01083                      <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> );
01084 }
01085 
<a name="l01086"></a><a class="code" href="../../d5/d6/classCResizeDlg.html#b21">01086</a> HDWP <a class="code" href="../../d5/d6/classCResizeDlg.html#b21">CResizeDlg::SetGripperPos</a>(HDWP hdwp)
01087 {
01088         <span class="keywordflow">if</span>( <a class="code" href="../../d5/d6/classCResizeDlg.html#p4">m_hwndGripper</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> )
01089         {
01090                 <span class="keywordtype">int</span> g_cxGrip = <a class="code" href="../../d3/d9/client_2wow_8c.html#a16">GetSystemMetrics</a>( SM_CXVSCROLL );
01091                 <span class="keywordtype">int</span> g_cyGrip = <a class="code" href="../../d3/d9/client_2wow_8c.html#a16">GetSystemMetrics</a>( SM_CYHSCROLL );
01092                 RECT rc;
01093                 <a class="code" href="../../d3/d9/client_2wow_8c.html#a24">GetClientRect</a>( <a class="code" href="../../d4/d2/classCDlg.html#a5">GetWindow</a>(), &amp;rc);
01094                 <span class="keywordflow">return</span> <a class="code" href="../../d3/d4/w32_2ntuser_2client_2nt6_2pch_8h.html#a2">DeferWindowPos</a>( hdwp, <a class="code" href="../../d5/d6/classCResizeDlg.html#p4">m_hwndGripper</a>, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
01095                                  rc.right - g_cxGrip,
01096                                  rc.bottom - g_cyGrip,
01097                                  g_cxGrip,
01098                                  g_cyGrip,
01099                                         SWP_NOZORDER | SWP_NOSIZE );
01100         }
01101         <span class="keywordflow">else</span>
01102                 <span class="keywordflow">return</span> hdwp;
01103 }
01104 
01106 <span class="comment">//</span>
01107 <span class="comment">//</span>
01108 <span class="comment">//</span>
01111 <span class="comment"></span><span class="comment">// Construction/Destruction</span>
01113 <span class="comment"></span>
<a name="l01114"></a><a class="code" href="../../d6/d6/classCScaleDlg.html#a0">01114</a> <a class="code" href="../../d6/d6/classCScaleDlg.html#a0">CScaleDlg::CScaleDlg</a>(<span class="keywordtype">int</span> DlgID, HWND hWndParent, HINSTANCE hInst)
01115 : <a class="code" href="../../d5/d6/classCResizeDlg.html">BASECLASS</a>(DlgID, hWndParent, <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a0">hInst</a>)
01116 {
01117 }
01118 
<a name="l01119"></a><a class="code" href="../../d6/d6/classCScaleDlg.html#a1">01119</a> <a class="code" href="../../d6/d6/classCScaleDlg.html#a1">CScaleDlg::~CScaleDlg</a>()
01120 {
01121 
01122 }
01123 
01124 <span class="comment">//</span>
01125 <span class="comment">// Multiply the positions as a result of what they are now.</span>
01126 <span class="comment">//</span>
<a name="l01127"></a><a class="code" href="../../d6/d6/classCScaleDlg.html#b2">01127</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/d6/classCScaleDlg.html#b2">CScaleDlg::ResizeControls</a>(WORD width, WORD height)
01128 {
01129         <span class="comment">//</span>
01130         <span class="comment">// Perhaps we just scale the fontsize information too?</span>
01131         <span class="comment">//</span>
01132         <span class="keywordtype">int</span> OrigW = m_ParentInfo.GetRightBorder();
01133         OrigW = m_ParentInfo.<a class="code" href="../../d4/d5/classCParentInfo.html#a8">GetWidth</a>();
01134         <span class="keywordtype">int</span> OrigH = m_ParentInfo.GetBottomBorder();
01135         OrigH = m_ParentInfo.<a class="code" href="../../d4/d5/classCParentInfo.html#a9">GetHeight</a>();
01136 
01137         <span class="comment">//</span>
01138         <span class="comment">// SetDialogFont</span>
01139         <span class="comment">//</span>
01140         HFONT hFont=(HFONT)<a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>( <a class="code" href="../../d4/d2/classCDlg.html#a5">GetWindow</a>(), WM_GETFONT, 0,0 );
01141         LOGFONT <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a18">lf</a>;
01142         GetObject( (HGDIOBJ)hFont, <span class="keyword">sizeof</span>(<a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a18">lf</a>), &amp;<a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a18">lf</a>);
01143         <span class="keywordtype">int</span> scalew= width * 100 / OrigW;
01144         <span class="keywordtype">int</span> scaleh=height * 100 / OrigH;
01145         <span class="keywordtype">int</span> scale=scalew;
01146 
01147         <span class="keywordflow">if</span>( scalew &lt; scaleh )
01148                 scale=scaleh;
01149 
01150         <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a18">lf</a>.lfHeight = <a class="code" href="../../d6/d6/classCScaleDlg.html#p0">m_dwInitFontSize</a> * scale / 100;
01151         HFONT hNewFont=CreateFontIndirect( &amp;<a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a18">lf</a> );
01152 
01153         HWND hCurrent;
01154         HWND hFirst;
01155         hCurrent=hFirst=::GetWindow(<a class="code" href="../../d4/d2/classCDlg.html#a5">GetWindow</a>(),GW_CHILD);
01156         <span class="keywordflow">if</span>( hFirst )
01157         {
01158                 <span class="keywordflow">do</span> {
01159                         <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>( hCurrent, WM_SETFONT, (WPARAM)hNewFont, 1 );
01160                 } <span class="keywordflow">while</span> (hCurrent=::GetWindow(hCurrent,GW_HWNDNEXT));
01161         }
01162 
01163         <span class="comment">// newX=origX * width / origParentWidth</span>
01164         <span class="comment">//</span>
01165         <span class="comment">// Now setup the information for all of the controls, as to which cell they are in.</span>
01166         <span class="comment">//</span>
01167         HDWP hdwp = <a class="code" href="../../d3/d8/client_8c.html#a89">BeginDeferWindowPos</a>( m_ControlList.<a class="code" href="../../d0/d2/classCControlList.html#a3">GetControlCount</a>() +1 ); <span class="comment">// 1 for the gripper</span>
01168         <span class="keywordtype">int</span> i=0;
01169         <a class="code" href="../../d3/d6/classCResizeControl.html">CResizeControl</a> * pC;
01170         <span class="keywordflow">while</span>( pC=(<a class="code" href="../../d3/d6/classCResizeControl.html">CResizeControl</a> *) m_ControlList.<a class="code" href="../../d5/d2/classCDPA.html#a4">GetPointer</a>(i++) )
01171         {
01172                 <span class="keywordtype">int</span> x=pC-&gt;GetLeftGap(); <span class="comment">// GetLeftEdge()-&gt;GetPosition();</span>
01173                 <span class="keywordtype">int</span> y=pC-&gt;GetTopGap(); <span class="comment">// GetTopEdge()-&gt;GetPosition();</span>
01174                 <span class="keywordtype">int</span> w=OrigW - pC-&gt;GetRightGap() - x; <span class="comment">// GetRightEdge()-GetPosition() - x;</span>
01175                 <span class="keywordtype">int</span> h=OrigH - pC-&gt;GetBottomGap() - y; <span class="comment">// BottomEdge()-GetPosition() -y;</span>
01176 
01177                 <span class="keywordtype">int</span> newx=x * width / OrigW;
01178                 <span class="keywordtype">int</span> newy=y * height / OrigH;
01179 
01180                 <span class="keywordtype">int</span> neww=w * width / OrigW;
01181                 <span class="keywordtype">int</span> newh=h * height / OrigH;
01182 
01183 
01184                 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> bMove=<span class="keyword">false</span>;
01185                 <span class="keywordflow">if</span>( (newx != x) || (newy != y))
01186                         bMove=<span class="keyword">true</span>;
01187                 
01188                 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> bSize=<span class="keyword">false</span>;
01189                 <span class="keywordflow">if</span>( (newh != h) || (neww != w))
01190                         bSize=<span class="keyword">true</span>;
01191 
01192                 hdwp = <a class="code" href="../../d3/d4/w32_2ntuser_2client_2nt6_2pch_8h.html#a2">DeferWindowPos</a>( hdwp, pC-&gt;GetControl(), <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, 
01193                         newx, newy, neww , newh,
01194                         (bMove ? 0: SWP_NOMOVE) |       (bSize ? 0: SWP_NOSIZE) | SWP_NOZORDER );
01195 
01196         }
01197 
01198         <span class="comment">//</span>
01199         <span class="comment">// Move the gripper</span>
01200         <span class="comment">//</span>
01201         SetGripperPos(hdwp);
01202 
01203         <a class="code" href="../../d3/d8/client_8c.html#a90">EndDeferWindowPos</a>( hdwp );
01204 
01205 }
01206 
<a name="l01207"></a><a class="code" href="../../d6/d6/classCScaleDlg.html#b1">01207</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/d6/classCScaleDlg.html#b1">CScaleDlg::DeterminWeights</a>()
01208 {
01209         SetRowWeight(1);
01210         SetColWeight(1);
01211         HFONT hFont=(HFONT)<a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>( <a class="code" href="../../d4/d2/classCDlg.html#a5">GetWindow</a>(), WM_GETFONT, 0,0 );
01212         LOGFONT <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a18">lf</a>;
01213         GetObject( hFont, <span class="keyword">sizeof</span>(<a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a18">lf</a>), &amp;<a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a18">lf</a>);
01214         <a class="code" href="../../d6/d6/classCScaleDlg.html#p0">m_dwInitFontSize</a> = <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a18">lf</a>.lfHeight;
01215 }
01216 
<a name="l01217"></a><a class="code" href="../../d6/d6/classCScaleDlg.html#b0">01217</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/d6/classCScaleDlg.html#b0">CScaleDlg::DoChangePos</a>(WINDOWPOS * lpwp)
01218 {
01219         <span class="comment">// Lock the apsect ratio.</span>
01220         <span class="keywordflow">if</span>((lpwp-&gt;flags &amp; SWP_NOSIZE) == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>)
01221         {
01222                 <span class="keywordflow">if</span>( <a class="code" href="../../d6/d6/classCScaleDlg.html#r0">dwLastCX</a> != lpwp-&gt;cx )
01223                         <a class="code" href="../../d6/d6/classCScaleDlg.html#r1">dwLastCY</a> = lpwp-&gt;cy = (lpwp-&gt;cx * m_ParentInfo.<a class="code" href="../../d4/d5/classCParentInfo.html#a9">GetHeight</a>()) / m_ParentInfo.<a class="code" href="../../d4/d5/classCParentInfo.html#a8">GetWidth</a>();
01224 
01225                 <span class="keywordflow">if</span>( <a class="code" href="../../d6/d6/classCScaleDlg.html#r1">dwLastCY</a> != lpwp-&gt;cy )
01226                         <a class="code" href="../../d6/d6/classCScaleDlg.html#r0">dwLastCX</a> = lpwp-&gt;cx = (lpwp-&gt;cy * m_ParentInfo.<a class="code" href="../../d4/d5/classCParentInfo.html#a8">GetWidth</a>()) / m_ParentInfo.<a class="code" href="../../d4/d5/classCParentInfo.html#a9">GetHeight</a>();
01227         }
01228 }
01229 
<a name="l01230"></a><a class="code" href="../../d5/d6/classCResizeDlg.html#b1">01230</a> <span class="keywordtype">void</span> <a class="code" href="../../d5/d6/classCResizeDlg.html#b1">CResizeDlg::DeterminNumberOfControls</a>()
01231 {
01232         <span class="keywordtype">int</span> iControlCount=0;
01233         HWND hCurrent;
01234         HWND hFirst;
01235         hCurrent=hFirst=::GetWindow(<a class="code" href="../../d4/d2/classCDlg.html#a5">GetWindow</a>(),GW_CHILD);
01236         <span class="keywordflow">if</span>( hFirst )
01237         {
01238                 <span class="keywordflow">do</span> {
01239                         iControlCount++;
01240                 } <span class="keywordflow">while</span> (hCurrent=::GetWindow(hCurrent,GW_HWNDNEXT));
01241         }
01242         m_ControlCount=iControlCount;
01243 }
01244 
01246 <span class="comment">//</span>
01247 <span class="comment">// Looks for the last row/col being full of buttons.</span>
01248 <span class="comment">//</span>
<a name="l01250"></a><a class="code" href="../../d5/d6/classCResizeDlg.html#b0">01250</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="../../d5/d6/classCResizeDlg.html#b0">CResizeDlg::SpecialRowCol</a>()
01251 {
01252         <a class="code" href="../../d7/d5/ntuser_2client_2nt6_2debug_8h.html#a0">TRACE</a>(<span class="stringliteral">"There are %d rows, and %d columns\n"</span>, GetNumRows(), GetNumCols() );
01253 
01254         <span class="comment">//</span>
01255         <span class="comment">// Walk the controls, find the row/col they are in.</span>
01256         <span class="comment">//</span>
01257         <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> bSpecialRow=<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01258         <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> bSpecialCol=<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01259         <span class="keywordtype">int</span> iNumRows=GetNumRows()-1;
01260         <span class="keywordtype">int</span> iNumCols=GetNumCols()-1;
01261 
01262         <span class="comment">//</span>
01263         <span class="comment">// It is a special row if all the heights are the same</span>
01264         <span class="comment">// it is a special col if all the widths are the same</span>
01265         <span class="comment">//</span>
01266         <span class="keywordtype">int</span> iRowHeight=0;
01267         <span class="keywordtype">int</span> iColWidth=0;
01268 
01269         <span class="comment">//</span>
01270         <span class="comment">// It's a row/col if there is more than one control there</span>
01271         <span class="comment">//</span>
01272         <span class="keywordtype">int</span> iRowCount=0;
01273         <span class="keywordtype">int</span> iColCount=0;
01274 
01275         <span class="comment">//</span>
01276         <span class="comment">// We remember the bounds of the rows/cols</span>
01277         <span class="comment">// left/right is the left of the left button, and the right of the right</span>
01278         <span class="comment">// top/bottom is the top of the topmost, and the bottom of the bottom most.</span>
01279         <span class="comment">//</span>
01280         RECT    bounds;         <span class="comment">// this is the </span>
01281         bounds.left=<a class="code" href="../../d5/d6/classCResizeDlg.html#p1">m_ParentInfo</a>.<a class="code" href="../../d4/d5/classCParentInfo.html#a8">GetWidth</a>();
01282         bounds.right=0;
01283         bounds.top=<a class="code" href="../../d5/d6/classCResizeDlg.html#p1">m_ParentInfo</a>.<a class="code" href="../../d4/d5/classCParentInfo.html#a9">GetHeight</a>();
01284         bounds.bottom=0;
01285 
01286         <span class="keywordtype">int</span> i=0;
01287         <a class="code" href="../../d3/d6/classCResizeControl.html">CResizeControl</a> * pC;
01288         CConstraint     * pCons;
01289         <span class="keywordflow">while</span>( pC=(<a class="code" href="../../d3/d6/classCResizeControl.html">CResizeControl</a> *) <a class="code" href="../../d5/d6/classCResizeDlg.html#p0">m_ControlList</a>.<a class="code" href="../../d5/d2/classCDPA.html#a4">GetPointer</a>(i++) )
01290         {
01291                 pCons=&amp;(pC-&gt;<a class="code" href="../../d3/d6/classCResizeControl.html#o1">m_Cons</a>);
01292 
01293                 <span class="comment">//</span>
01294                 <span class="comment">// Column work (widths same)</span>
01295                 <span class="comment">//</span>
01296                 <span class="keywordflow">if</span>( bSpecialCol )
01297                 {
01298                         <span class="keywordflow">if</span>( ((pCons-&gt;GetCol() == iNumCols ) || (pCons-&gt;GetCol() + pCons-&gt;GetColW() &gt; iNumCols) ))
01299                         {
01300                                 <span class="keywordflow">if</span>( iColWidth==0 )
01301                                         iColWidth=pC-&gt;GetWidth();
01302                                 <span class="keywordflow">if</span>( pC-&gt;GetWidth() != iColWidth )
01303                                         bSpecialCol=<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01304                                 iColCount++;
01305                         }
01306 
01307                         <span class="comment">//</span>
01308                         <span class="comment">// If this item is wholy in this column</span>
01309                         <span class="comment">//</span>
01310                         <span class="keywordflow">if</span>( pCons-&gt;GetCol() == iNumCols )
01311                         {
01312                                 RECT r=pC-&gt;<a class="code" href="../../d3/d6/classCResizeControl.html#a26">GetLocation</a>();
01313                                 <span class="keywordflow">if</span>( r.top &lt; bounds.top )
01314                                         bounds.top = r.top;
01315                                 <span class="keywordflow">if</span>( r.bottom &gt; bounds.bottom )
01316                                         bounds.bottom = r.bottom;
01317                         }
01318                 }
01319 
01320                 <span class="keywordflow">if</span>( bSpecialRow )
01321                 {
01322                         <span class="keywordflow">if</span>( (pCons-&gt;GetRow() == iNumRows ) || (pCons-&gt;GetRow() + pCons-&gt;GetRowH() &gt; iNumRows) )
01323                         {
01324                                 <span class="keywordflow">if</span>( iRowHeight==0 )
01325                                         iRowHeight=pC-&gt;GetHeight();
01326                                 <span class="keywordflow">if</span>( pC-&gt;GetHeight() != iRowHeight )
01327                                         bSpecialRow=<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01328                                 iRowCount++;
01329                         }
01330 
01331                         <span class="comment">//</span>
01332                         <span class="comment">// If this item is wholy in this row</span>
01333                         <span class="comment">//</span>
01334                         <span class="keywordflow">if</span>( pCons-&gt;GetRow() == iNumRows )
01335                         {
01336                                 RECT r=pC-&gt;<a class="code" href="../../d3/d6/classCResizeControl.html#a26">GetLocation</a>();
01337                                 <span class="keywordflow">if</span>( r.left &lt; bounds.left )
01338                                         bounds.left = r.left;
01339                                 <span class="keywordflow">if</span>( r.right &gt; bounds.right )
01340                                         bounds.right = r.right;
01341                         }
01342                 }
01343 
01344                 <span class="keywordflow">if</span>( (bSpecialCol==<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) &amp;&amp; ( bSpecialRow==<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> ) )
01345                         <span class="keywordflow">break</span>;
01346         }
01347 
01348         <a class="code" href="../../d5/d6/classCResizeDlg.html#p5">m_SpecialRow</a>.<a class="code" href="../../d7/d9/struct__tagSPECIAL.html#o0">bSpecial</a> = iRowCount&gt;1?bSpecialRow:<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01349         <a class="code" href="../../d5/d6/classCResizeDlg.html#p6">m_SpecialCol</a>.<a class="code" href="../../d7/d9/struct__tagSPECIAL.html#o0">bSpecial</a> = iColCount&gt;1?bSpecialCol:<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01350 
01351         <span class="comment">//</span>
01352         <span class="comment">// Check the row alignment.</span>
01353         <span class="comment">//</span>
01354         <span class="keywordflow">if</span>( <a class="code" href="../../d5/d6/classCResizeDlg.html#p5">m_SpecialRow</a>.<a class="code" href="../../d7/d9/struct__tagSPECIAL.html#o0">bSpecial</a> )
01355         {
01356                 <span class="keywordtype">int</span> lGap = bounds.left - <a class="code" href="../../d5/d6/classCResizeDlg.html#p1">m_ParentInfo</a>.GetLeftBorder();
01357                 <span class="keywordtype">int</span> rGap = <a class="code" href="../../d5/d6/classCResizeDlg.html#p1">m_ParentInfo</a>.<a class="code" href="../../d4/d5/classCParentInfo.html#a8">GetWidth</a>() - <a class="code" href="../../d5/d6/classCResizeDlg.html#p1">m_ParentInfo</a>.GetRightBorder() - bounds.right;
01358                 <a class="code" href="../../d7/d5/ntuser_2client_2nt6_2debug_8h.html#a0">TRACE</a>(<span class="stringliteral">"Constraits on the special row are: left %d, right %d\n"</span>,bounds.left, bounds.right );
01359                 <a class="code" href="../../d7/d5/ntuser_2client_2nt6_2debug_8h.html#a0">TRACE</a>(<span class="stringliteral">"Parent info is: left %d, right %d\n"</span>, <a class="code" href="../../d5/d6/classCResizeDlg.html#p1">m_ParentInfo</a>.GetLeftBorder(), <a class="code" href="../../d5/d6/classCResizeDlg.html#p1">m_ParentInfo</a>.<a class="code" href="../../d4/d5/classCParentInfo.html#a8">GetWidth</a>() - <a class="code" href="../../d5/d6/classCResizeDlg.html#p1">m_ParentInfo</a>.GetRightBorder() );
01360                 <a class="code" href="../../d7/d5/ntuser_2client_2nt6_2debug_8h.html#a0">TRACE</a>(<span class="stringliteral">"Gaps are: left %d, right %d\n"</span>, lGap, rGap );
01361                 <span class="keywordtype">int</span> GapDiff = lGap - rGap;
01362                 <a class="code" href="../../d5/d6/classCResizeDlg.html#p5">m_SpecialRow</a>.<a class="code" href="../../d7/d9/struct__tagSPECIAL.html#o0">bSpecial</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01363                 <a class="code" href="../../d5/d6/classCResizeDlg.html#p5">m_SpecialRow</a>.<a class="code" href="../../d7/d9/struct__tagSPECIAL.html#o1">iMin</a> = bounds.left;
01364                 <a class="code" href="../../d5/d6/classCResizeDlg.html#p5">m_SpecialRow</a>.<a class="code" href="../../d7/d9/struct__tagSPECIAL.html#o2">iMax</a> = bounds.right;
01365                 <span class="keywordflow">if</span>( GapDiff &lt; -10 ) 
01366                 {
01367                         <a class="code" href="../../d7/d5/ntuser_2client_2nt6_2debug_8h.html#a0">TRACE</a>(<span class="stringliteral">"Probably a left aligned thing\n"</span>);
01368                         <a class="code" href="../../d5/d6/classCResizeDlg.html#p5">m_SpecialRow</a>.<a class="code" href="../../d7/d9/struct__tagSPECIAL.html#o3">iAlignment</a> = -1;
01369                 }
01370                 <span class="keywordflow">else</span>
01371                 <span class="keywordflow">if</span>( GapDiff &gt; 10 )
01372                 {
01373                         <a class="code" href="../../d7/d5/ntuser_2client_2nt6_2debug_8h.html#a0">TRACE</a>(<span class="stringliteral">" Probably a right aligned thing\n"</span>);
01374                         <a class="code" href="../../d5/d6/classCResizeDlg.html#p5">m_SpecialRow</a>.<a class="code" href="../../d7/d9/struct__tagSPECIAL.html#o3">iAlignment</a> = 1;
01375                 }
01376                 <span class="keywordflow">else</span>
01377                 {
01378                         <a class="code" href="../../d7/d5/ntuser_2client_2nt6_2debug_8h.html#a0">TRACE</a>(<span class="stringliteral">" Probably a centered thing\n"</span>);
01379                         <a class="code" href="../../d5/d6/classCResizeDlg.html#p5">m_SpecialRow</a>.<a class="code" href="../../d7/d9/struct__tagSPECIAL.html#o3">iAlignment</a> = 0;
01380                 }
01381                 <a class="code" href="../../d5/d6/classCResizeDlg.html#p5">m_SpecialRow</a>.<a class="code" href="../../d7/d9/struct__tagSPECIAL.html#o4">iDiff</a>=GapDiff;
01382         }
01383 
01384         <span class="comment">//</span>
01385         <span class="comment">// Check the Col alignment.</span>
01386         <span class="comment">//</span>
01387         <span class="keywordflow">if</span>( <a class="code" href="../../d5/d6/classCResizeDlg.html#p6">m_SpecialCol</a>.<a class="code" href="../../d7/d9/struct__tagSPECIAL.html#o0">bSpecial</a>  )
01388         {
01389                 <span class="keywordtype">int</span> tGap = bounds.top - <a class="code" href="../../d5/d6/classCResizeDlg.html#p1">m_ParentInfo</a>.GetTopBorder();
01390                 <span class="keywordtype">int</span> bGap = <a class="code" href="../../d5/d6/classCResizeDlg.html#p1">m_ParentInfo</a>.<a class="code" href="../../d4/d5/classCParentInfo.html#a9">GetHeight</a>() - <a class="code" href="../../d5/d6/classCResizeDlg.html#p1">m_ParentInfo</a>.GetBottomBorder() - bounds.bottom;
01391                 <a class="code" href="../../d7/d5/ntuser_2client_2nt6_2debug_8h.html#a0">TRACE</a>(<span class="stringliteral">"Constraits on the special Col are: top %d, bottom %d\n"</span>,bounds.top, bounds.bottom);
01392                 <a class="code" href="../../d7/d5/ntuser_2client_2nt6_2debug_8h.html#a0">TRACE</a>(<span class="stringliteral">"Parent info is: top %d, bottom %d\n"</span>, <a class="code" href="../../d5/d6/classCResizeDlg.html#p1">m_ParentInfo</a>.GetTopBorder(), <a class="code" href="../../d5/d6/classCResizeDlg.html#p1">m_ParentInfo</a>.<a class="code" href="../../d4/d5/classCParentInfo.html#a9">GetHeight</a>() - <a class="code" href="../../d5/d6/classCResizeDlg.html#p1">m_ParentInfo</a>.GetBottomBorder() );
01393                 <a class="code" href="../../d7/d5/ntuser_2client_2nt6_2debug_8h.html#a0">TRACE</a>(<span class="stringliteral">"Gaps are: top %d, bottom %d\n"</span>, tGap, bGap );
01394                 <span class="keywordtype">int</span> GapDiff = tGap - bGap;
01395                 <a class="code" href="../../d5/d6/classCResizeDlg.html#p6">m_SpecialCol</a>.<a class="code" href="../../d7/d9/struct__tagSPECIAL.html#o1">iMin</a> = bounds.top;
01396                 <a class="code" href="../../d5/d6/classCResizeDlg.html#p6">m_SpecialCol</a>.<a class="code" href="../../d7/d9/struct__tagSPECIAL.html#o2">iMax</a> = bounds.bottom;
01397                 <span class="keywordflow">if</span>( GapDiff &lt; -10 ) 
01398                 {
01399                         <a class="code" href="../../d7/d5/ntuser_2client_2nt6_2debug_8h.html#a0">TRACE</a>(<span class="stringliteral">"Probably a left aligned thing\n"</span>);
01400                         <a class="code" href="../../d5/d6/classCResizeDlg.html#p6">m_SpecialCol</a>.<a class="code" href="../../d7/d9/struct__tagSPECIAL.html#o3">iAlignment</a> = -1;
01401                 }
01402                 <span class="keywordflow">else</span>
01403                 <span class="keywordflow">if</span>( GapDiff &gt; 10 )
01404                 {
01405                         <a class="code" href="../../d7/d5/ntuser_2client_2nt6_2debug_8h.html#a0">TRACE</a>(<span class="stringliteral">" Probably a right aligned thing\n"</span>);
01406                         <a class="code" href="../../d5/d6/classCResizeDlg.html#p6">m_SpecialCol</a>.<a class="code" href="../../d7/d9/struct__tagSPECIAL.html#o3">iAlignment</a> = 1;
01407                 }
01408                 <span class="keywordflow">else</span>
01409                 {
01410                         <a class="code" href="../../d7/d5/ntuser_2client_2nt6_2debug_8h.html#a0">TRACE</a>(<span class="stringliteral">" Probably a centered thing\n"</span>);
01411                         <a class="code" href="../../d5/d6/classCResizeDlg.html#p6">m_SpecialCol</a>.<a class="code" href="../../d7/d9/struct__tagSPECIAL.html#o3">iAlignment</a> = 0;
01412                 }
01413                 <a class="code" href="../../d5/d6/classCResizeDlg.html#p6">m_SpecialCol</a>.<a class="code" href="../../d7/d9/struct__tagSPECIAL.html#o4">iDiff</a>=GapDiff;
01414         }
01415 }
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:41:39 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
