<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: classchg.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>classchg.c File Reference</h1><code>#include "<a class="el" href="../../d1/d3/w32_2ntuser_2kernel_2precomp_8h-source.html">precomp.h</a>"</code><br>

<p>
<a href="../../d7/d6/classchg_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d7/classchg_8c.html#a0">VisWindow</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a>, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d7/classchg_8c.html#a1">xxxSetClassIconEnum</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, LPARAM lParam)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d6/d1/structtagCURSOR.html">PCURSOR</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d7/classchg_8c.html#a2">xxxSetClassIcon</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, <a class="el" href="../../d7/d0/structtagCLS.html">PCLS</a> pcls, <a class="el" href="../../d6/d1/structtagCURSOR.html">PCURSOR</a> pCursor, int gcw)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d7/classchg_8c.html#a3">DestroyClassSmIcon</a> (<a class="el" href="../../d7/d0/structtagCLS.html">PCLS</a> pcls)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d7/classchg_8c.html#a4">xxxCreateClassSmIcon</a> (<a class="el" href="../../d7/d0/structtagCLS.html">PCLS</a> pcls)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d7/classchg_8c.html#a5">xxxSetWindowStyle</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, int gwl, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> styleNew)</td></tr>

</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a3" doxytag="classchg.c::DestroyClassSmIcon" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL DestroyClassSmIcon           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d7/d0/structtagCLS.html">PCLS</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pcls</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d6/classchg_8c-source.html#l00146">146</a> of file <a class="el" href="../../d7/d6/classchg_8c-source.html">classchg.c</a>.
<p>
References <a class="el" href="../../d8/d3/loadbits_8c-source.html#l00539">_DestroyCursor()</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01770">CSF_CACHEDSMICON</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01744">tagCLS::CSF_flags</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02169">CURSOR_ALWAYSDESTROY</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d7/d9/usercli_8h-source.html#l00368">Unlock</a>.
<p>
Referenced by <a class="el" href="../../d3/d6/class_8c-source.html#l01207">DestroyClass()</a>, <a class="el" href="../../d3/d7/metrics_8c-source.html#l00075">xxxRecreateSmallIcons()</a>, and <a class="el" href="../../d7/d6/classchg_8c-source.html#l00056">xxxSetClassIcon()</a>.
<p>
<pre class="fragment"><div>00148 {
00149 
00150     <span class="comment">/*</span>
00151 <span class="comment">     * If we don't have a cached icon, then no work.</span>
00152 <span class="comment">     */</span>
00153     <span class="keywordflow">if</span> (pcls-&gt;<a class="code" href="../../d7/d0/structtagCLS.html#o7">CSF_flags</a> &amp; <a class="code" href="../../d1/d0/inc_2user_8h.html#a490">CSF_CACHEDSMICON</a>) {
00154         <span class="keywordflow">if</span> (pcls-&gt;spicnSm) {
00155             <a class="code" href="../../d4/d1/userk_8h.html#a1782">_DestroyCursor</a>(pcls-&gt;spicnSm, CURSOR_ALWAYSDESTROY);
00156             <a class="code" href="../../d6/d0/usercli_8h.html#a42">Unlock</a>(&amp;pcls-&gt;spicnSm);
00157         }
00158         pcls-&gt;<a class="code" href="../../d7/d0/structtagCLS.html#o7">CSF_flags</a> &amp;= ~<a class="code" href="../../d1/d0/inc_2user_8h.html#a490">CSF_CACHEDSMICON</a>;
00159         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00160     }
00161 
00162     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00163 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="classchg.c::VisWindow" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL VisWindow           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname" nowrap>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d6/classchg_8c-source.html#l00475">475</a> of file <a class="el" href="../../d7/d6/classchg_8c-source.html">classchg.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, and <a class="el" href="../../d5/d0/userk_8h-source.html#l05844">FTopLevel</a>.
<p>
Referenced by <a class="el" href="../../d7/d6/classchg_8c-source.html#l00203">xxxSetWindowStyle()</a>.
<p>
<pre class="fragment"><div>00478 {
00479     <span class="keywordflow">return</span>(<a class="code" href="../../d4/d1/userk_8h.html#a596">FTopLevel</a>(pwnd) &amp;&amp;
00480             !(style &amp; WS_MINIMIZE) &amp;&amp;
00481             (style &amp; WS_VISIBLE));
00482 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="classchg.c::xxxCreateClassSmIcon" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID xxxCreateClassSmIcon           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d7/d0/structtagCLS.html">PCLS</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pcls</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d6/classchg_8c-source.html#l00172">172</a> of file <a class="el" href="../../d7/d6/classchg_8c-source.html">classchg.c</a>.
<p>
References <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01770">CSF_CACHEDSMICON</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01744">tagCLS::CSF_flags</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01662">tagCLS::cWndReferenceCount</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00367">Lock</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01512">PtoH</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00411">PTR_TO_ID</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00202">SYSMET</a>, <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>, and <a class="el" href="../../d4/d1/userk_8h.html#a1997">xxxClientCopyImage()</a>.
<p>
Referenced by <a class="el" href="../../d5/d7/createw_8c-source.html#l00033">xxxCreateWindowEx()</a>, <a class="el" href="../../d3/d7/metrics_8c-source.html#l00075">xxxRecreateSmallIcons()</a>, and <a class="el" href="../../d7/d6/classchg_8c-source.html#l00056">xxxSetClassIcon()</a>.
<p>
<pre class="fragment"><div>00174 {
00175     <a class="code" href="../../d6/d1/structtagCURSOR.html">PCURSOR</a> pcur;
00176 
00177     UserAssert(pcls-&gt;<a class="code" href="../../d7/d0/structtagCLS.html#o5">cWndReferenceCount</a> &gt; 0);
00178     UserAssert(pcls-&gt;spicn);
00179     UserAssert(!pcls-&gt;spicnSm);
00180 
00181     pcur = <a class="code" href="../../d4/d1/userk_8h.html#a1997">xxxClientCopyImage</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a448">PtoH</a>(pcls-&gt;spicn),
00182             pcls-&gt;spicn-&gt;rt == <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a99">PTR_TO_ID</a>(RT_ICON) ? IMAGE_ICON : IMAGE_CURSOR,
00183             <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXSMICON),
00184             <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYSMICON),
00185             LR_DEFAULTCOLOR | LR_COPYFROMRESOURCE);
00186 
00187     <a class="code" href="../../d6/d0/usercli_8h.html#a41">Lock</a>(&amp;pcls-&gt;spicnSm, pcur);
00188     <span class="keywordflow">if</span> (pcls-&gt;spicnSm)
00189         pcls-&gt;<a class="code" href="../../d7/d0/structtagCLS.html#o7">CSF_flags</a> |= <a class="code" href="../../d1/d0/inc_2user_8h.html#a490">CSF_CACHEDSMICON</a>;
00190 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="classchg.c::xxxSetClassIcon" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d6/d1/structtagCURSOR.html">PCURSOR</a> xxxSetClassIcon           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pwnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d7/d0/structtagCLS.html">PCLS</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pcls</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d6/d1/structtagCURSOR.html">PCURSOR</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pCursor</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>gcw</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d6/classchg_8c-source.html#l00056">56</a> of file <a class="el" href="../../d7/d6/classchg_8c-source.html">classchg.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03634">BWL_ENUMLIST</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00361">CheckLock</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01770">CSF_CACHEDSMICON</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01744">tagCLS::CSF_flags</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01662">tagCLS::cWndReferenceCount</a>, <a class="el" href="../../d7/d6/classchg_8c-source.html#l00146">DestroyClassSmIcon()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01484">HMRevalidateHandleNoRip</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00367">Lock</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02644">tagDESKTOP::pDeskInfo</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00058">PtiCurrent</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01512">PtoH</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03327">tagTHREADINFO::rpdesk</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02156">tagDESKTOPINFO::spwnd</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01746">tagWND::spwndChild</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00362">ThreadLock</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00366">ThreadUnlock</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d7/d6/classchg_8c-source.html#l00172">xxxCreateClassSmIcon()</a>, <a class="el" href="../../d5/d6/enumwin_8c-source.html#l00040">xxxInternalEnumWindow()</a>, and <a class="el" href="../../d7/d6/classchg_8c-source.html#l00026">xxxSetClassIconEnum()</a>.
<p>
Referenced by <a class="el" href="../../d3/d6/class_8c-source.html#l01329">SetClassCursor()</a>.
<p>
<pre class="fragment"><div>00061 {
00062     <a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a> pti = <a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>();
00063     <a class="code" href="../../d6/d1/structtagCURSOR.html">PCURSOR</a>     pCursorOld;
00064     HCURSOR     hCursorOld;
00065     <a class="code" href="../../d5/d1/struct__TL.html">TL</a>          tlpwndChild;
00066     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>        fRedraw;
00067 
00068     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwnd);
00069 
00070     <span class="comment">/*</span>
00071 <span class="comment">     * Save old icon</span>
00072 <span class="comment">     */</span>
00073     pCursorOld = ((gcw == GCLP_HICON) ? pcls-&gt;spicn : pcls-&gt;spicnSm);
00074 
00075     <span class="keywordflow">if</span> (pCursorOld != pCursor) {
00076 
00077         fRedraw = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00078 
00079         hCursorOld = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a448">PtoH</a>(pCursorOld);
00080 
00081         <span class="comment">/*</span>
00082 <span class="comment">         * Set new icon</span>
00083 <span class="comment">         */</span>
00084         <span class="keywordflow">if</span> (gcw == GCLP_HICON) {
00085 
00086             <span class="comment">/*</span>
00087 <span class="comment">             * Destroy private cached small icon first.</span>
00088 <span class="comment">             */</span>
00089             <span class="keywordflow">if</span> (pcls-&gt;spicnSm &amp;&amp; !<a class="code" href="../../d4/d1/userk_8h.html#a1450">DestroyClassSmIcon</a>(pcls))
00090                 fRedraw = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00091 
00092             <a class="code" href="../../d6/d0/usercli_8h.html#a41">Lock</a>(&amp;(pcls-&gt;spicn), pCursor);
00093 
00094         } <span class="keywordflow">else</span> {
00095 
00096             <span class="comment">/*</span>
00097 <span class="comment">             * We don't allow apps to see the small icons we create from</span>
00098 <span class="comment">             * their big icons.  They can see their own.  Saves memory</span>
00099 <span class="comment">             * leak problems and is easier.</span>
00100 <span class="comment">             */</span>
00101             <span class="keywordflow">if</span> (pcls-&gt;<a class="code" href="../../d7/d0/structtagCLS.html#o7">CSF_flags</a> &amp; <a class="code" href="../../d1/d0/inc_2user_8h.html#a490">CSF_CACHEDSMICON</a>) {
00102                 <a class="code" href="../../d4/d1/userk_8h.html#a1450">DestroyClassSmIcon</a>(pcls);
00103                 hCursorOld = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00104             }
00105 
00106             <a class="code" href="../../d6/d0/usercli_8h.html#a41">Lock</a>(&amp;(pcls-&gt;spicnSm), pCursor);
00107         }
00108 
00109         <span class="keywordflow">if</span> (pcls-&gt;spicn &amp;&amp; !pcls-&gt;spicnSm)
00110             <a class="code" href="../../d4/d1/userk_8h.html#a1447">xxxCreateClassSmIcon</a>(pcls);
00111 
00112         <span class="keywordflow">if</span> (fRedraw) {
00113 
00114             <span class="keywordflow">if</span> (pcls-&gt;<a class="code" href="../../d7/d0/structtagCLS.html#o5">cWndReferenceCount</a> &gt; 1) {
00115                 <a class="code" href="../../d6/d0/usercli_8h.html#a36">ThreadLock</a>(pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o6">rpdesk</a>-&gt;<a class="code" href="../../d0/d3/structtagDESKTOP.html#o0">pDeskInfo</a>-&gt;<a class="code" href="../../d1/d3/structtagDESKTOPINFO.html#o2">spwnd</a>-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o4">spwndChild</a>, &amp;tlpwndChild);
00116                 <a class="code" href="../../d4/d1/userk_8h.html#a1428">xxxInternalEnumWindow</a>(pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o6">rpdesk</a>-&gt;<a class="code" href="../../d0/d3/structtagDESKTOP.html#o0">pDeskInfo</a>-&gt;<a class="code" href="../../d1/d3/structtagDESKTOPINFO.html#o2">spwnd</a>-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o4">spwndChild</a>,
00117                                       xxxSetClassIconEnum,
00118                                       (LPARAM)pcls,
00119                                       BWL_ENUMLIST);
00120                 <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwndChild);
00121             } <span class="keywordflow">else</span> {
00122                 <a class="code" href="../../d6/d7/classchg_8c.html#a1">xxxSetClassIconEnum</a>(pwnd, (LPARAM)pcls);
00123             }
00124         }
00125 
00126         <span class="comment">/*</span>
00127 <span class="comment">         * Revalidate the old cursor</span>
00128 <span class="comment">         */</span>
00129         <span class="keywordflow">if</span> (hCursorOld != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00130             pCursorOld = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a440">HMRevalidateHandleNoRip</a>(hCursorOld);
00131         } <span class="keywordflow">else</span> {
00132             pCursorOld = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00133         }
00134     }
00135 
00136     <span class="keywordflow">return</span>(pCursorOld);
00137 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="classchg.c::xxxSetClassIconEnum" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL xxxSetClassIconEnum           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pwnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPARAM&nbsp;</td>
          <td class="mdname" nowrap> <em>lParam</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d6/classchg_8c-source.html#l00026">26</a> of file <a class="el" href="../../d7/d6/classchg_8c-source.html">classchg.c</a>.
<p>
References <a class="el" href="../../d8/d7/rtl_2winprop_8c-source.html#l00106">_GetProp()</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01311">tagSERVERINFO::atomIconSmProp</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00361">CheckLock</a>, <a class="el" href="../../d9/d2/dwp_8c-source.html#l01067">DestroyWindowSmIcon()</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00051">gpsi</a>, <a class="el" href="../../d7/d0/userrtl_8h-source.html#l00022">MAKEINTATOM</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01843">tagWND::pcls</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01722">PROPF_INTERNAL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02555">TestWF</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02382">WFSMQUERYDRAGICON</a>, and <a class="el" href="../../d9/d2/dwp_8c-source.html#l00766">xxxRedrawTitle()</a>.
<p>
Referenced by <a class="el" href="../../d7/d6/classchg_8c-source.html#l00056">xxxSetClassIcon()</a>.
<p>
<pre class="fragment"><div>00029 {
00030     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwnd);
00031 
00032     <span class="keywordflow">if</span> (pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o9">pcls</a> == (<a class="code" href="../../d7/d0/structtagCLS.html">PCLS</a>)lParam) {
00033         <span class="comment">/*</span>
00034 <span class="comment">         * If the window doesn't have a small icon or it comes from</span>
00035 <span class="comment">         * WM_QUERYDRAGICON, redraw the title.  In the WM_QUERYDRAGICON</span>
00036 <span class="comment">         * case, get rid of the small icon so redrawing the title will</span>
00037 <span class="comment">         * create it if necessary.</span>
00038 <span class="comment">         */</span>
00039         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFSMQUERYDRAGICON))
00040             <a class="code" href="../../d4/d1/userk_8h.html#a1449">DestroyWindowSmIcon</a>(pwnd);
00041 
00042         <span class="keywordflow">if</span> (!<a class="code" href="../../d7/d8/rtl_2winprop_8c.html#a2">_GetProp</a>(pwnd, <a class="code" href="../../d6/d1/userrtl_8h.html#a0">MAKEINTATOM</a>(<a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o28">atomIconSmProp</a>),PROPF_INTERNAL))
00043             <a class="code" href="../../d4/d1/userk_8h.html#a1995">xxxRedrawTitle</a>(pwnd, DC_ICON);
00044     }
00045 
00046     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00047 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="classchg.c::xxxSetWindowStyle" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LONG xxxSetWindowStyle           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pwnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>gwl</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>styleNew</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d6/classchg_8c-source.html#l00203">203</a> of file <a class="el" href="../../d7/d6/classchg_8c-source.html">classchg.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00361">CheckLock</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02557">ClrWF</a>, <a class="el" href="../../d3/d7/swp_8c-source.html#l05156">DecVisWindows()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00797">FNID_EDIT</a>, <a class="el" href="../../d7/d2/queue_8c-source.html#l01033">GetAppCompatFlags2()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00843">GETFNID</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01547">GETPTI</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02232">IDC_DEFAULT</a>, <a class="el" href="../../d3/d7/swp_8c-source.html#l05123">IncVisWindows()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06472">IsWinEventNotifyDeferredOK</a>, <a class="el" href="../../d3/d7/rtl_2winmgr_8c-source.html#l00727">NeedsWindowEdge()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00084">PpiCurrent</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02790">PWNDDESKTOP</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02556">SetWF</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01764">tagWND::spmenu</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01745">tagWND::spwndParent</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02555">TestWF</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02561">TestwndChild</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d3/d6/ntuser_2kernel_2menu_8c-source.html#l00458">UnlockWndMenu()</a>, <a class="el" href="../../d9/d3/sprite_8c-source.html#l00417">UnsetLayeredWindow()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00475">VER40</a>, <a class="el" href="../../d7/d6/classchg_8c-source.html#l00475">VisWindow()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02365">WEFWINDOWEDGE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02421">WFCHILD</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02262">WFCPRESENT</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02312">WFINDESTROY</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02420">WFMINIMIZED</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02259">WFMPRESENT</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02319">WFWIN40COMPAT</a>, <a class="el" href="../../d2/d1/drawfrm_8c-source.html#l00192">xxxRedrawFrame()</a>, <a class="el" href="../../d4/d5/kernel_2sendmsg_8c-source.html#l00688">xxxSendMessage()</a>, <a class="el" href="../../d9/d3/sprite_8c-source.html#l00467">xxxSetLayeredWindow()</a>, and <a class="el" href="../../d9/d2/dc_8c-source.html#l01812">zzzInvalidateDCCache()</a>.
<p>
Referenced by <a class="el" href="../../d1/d4/ntuser_2kernel_2getset_8c-source.html#l00568">xxxSetWindowData()</a>.
<p>
<pre class="fragment"><div>00207 {
00208     STYLESTRUCT sty;
00209     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>        fWasChild;
00210     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>        fIsChild;
00211 
00212     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwnd);
00213     UserAssert(<a class="code" href="../../d4/d1/userk_8h.html#a616">IsWinEventNotifyDeferredOK</a>());
00214 
00215     <span class="comment">/*</span>
00216 <span class="comment">     * HACK-O-RAMA</span>
00217 <span class="comment">     * A STYLESTRUCT currently has just one field: a DWORD for the style.</span>
00218 <span class="comment">     * Therefore, conveniently, we can pass a pointer into the stack for</span>
00219 <span class="comment">     * LPARAM.  But, if we add stuff, we'll have to change this.</span>
00220 <span class="comment">     */</span>
00221     sty.styleOld = ((gwl == GWL_STYLE) ? pwnd-&gt;style : pwnd-&gt;ExStyle);
00222     sty.styleNew = styleNew;
00223 
00224     <span class="comment">/*</span>
00225 <span class="comment">     * Note that we don't do validation before _and_ after.  It is sufficient</span>
00226 <span class="comment">     * to do our stuff at the end.</span>
00227 <span class="comment">     */</span>
00228 
00229     <span class="comment">/*</span>
00230 <span class="comment">     * We break Quicken 2.0 if we send the messages.  That's why we version</span>
00231 <span class="comment">     * switch them.</span>
00232 <span class="comment">     */</span>
00233 
00234     <span class="comment">/*</span>
00235 <span class="comment">     * Send a WM_STYLECHANGING message to the window, so it can muck with</span>
00236 <span class="comment">     * the style bits.  Like validate some stuff.</span>
00237 <span class="comment">     */</span>
00238     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFWIN40COMPAT)) {
00239         <a class="code" href="../../d4/d1/userk_8h.html#a1579">xxxSendMessage</a>(pwnd, WM_STYLECHANGING, gwl, (LPARAM)(LPSTYLESTRUCT)&amp;sty);
00240     }
00241 
00242     <span class="comment">/*</span>
00243 <span class="comment">     * Now do our own validation.</span>
00244 <span class="comment">     */</span>
00245     <span class="keywordflow">if</span> (gwl == GWL_STYLE) {
00246 
00247         <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fWasVisWindow;
00248 
00249         <span class="comment">/*</span>
00250 <span class="comment">         * If this is an edit control that has ES_PASSWORD set and</span>
00251 <span class="comment">         * the caller does not own it and is trying to reset it,</span>
00252 <span class="comment">         * fail the call.</span>
00253 <span class="comment">         */</span>
00254         <span class="keywordflow">if</span> ((<a class="code" href="../../d4/d1/userk_8h.html#a16">PpiCurrent</a>() != <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a455">GETPTI</a>(pwnd)-&gt;ppi) &amp;&amp;
00255                 (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a232">GETFNID</a>(pwnd) == <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a204">FNID_EDIT</a>) &amp;&amp;
00256                 (sty.styleOld &amp; ES_PASSWORD) &amp;&amp;
00257                 !(sty.styleNew &amp; ES_PASSWORD)) {
00258             RIPERR0(ERROR_ACCESS_DENIED,
00259                     RIP_WARNING,
00260                     <span class="stringliteral">"Access denied in xxxSetWindowStyle"</span>);
00261 
00262             <span class="keywordflow">return</span> 0;
00263         }
00264 
00265         <span class="comment">/* Listbox ownerdraw style check was moved to the client side (client\ntstubs.c) */</span>
00266 
00267         <span class="comment">/*</span>
00268 <span class="comment">         * Do proper validation on style bits</span>
00269 <span class="comment">         */</span>
00270         <span class="keywordflow">if</span> (pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o3">spwndParent</a> == <a class="code" href="../../d4/d1/userk_8h.html#a322">PWNDDESKTOP</a>(pwnd))
00271             sty.styleNew |= WS_CLIPSIBLINGS;
00272 
00273         <span class="comment">/*</span>
00274 <span class="comment">         * If the clipping-ness is changing, invalidate the dc cache.</span>
00275 <span class="comment">         */</span>
00276         <span class="keywordflow">if</span> ((sty.styleNew &amp; (WS_CLIPCHILDREN | WS_CLIPSIBLINGS)) !=
00277             (sty.styleOld &amp; (WS_CLIPCHILDREN | WS_CLIPSIBLINGS))) {
00278 
00279             <span class="comment">/*</span>
00280 <span class="comment">             * No need to DeferWinEventNotify() - pwnd is locked</span>
00281 <span class="comment">             */</span>
00282             <a class="code" href="../../d4/d1/userk_8h.html#a1004">zzzInvalidateDCCache</a>(pwnd, IDC_DEFAULT);
00283         }
00284 
00285         <span class="comment">/*</span>
00286 <span class="comment">         * This breaks all Paradox dialogs 1.0-5.0 that have combos.  They</span>
00287 <span class="comment">         * enumerate all child windows, add on minimized, then sit in a peek</span>
00288 <span class="comment">         * loop.  After that they enumerate all child windows and remove</span>
00289 <span class="comment">         * WS_MINIMIZE--except the code below won't let them.</span>
00290 <span class="comment">         *</span>
00291 <span class="comment">         * Result is weird painting and an inability to use the dialog any</span>
00292 <span class="comment">         * more short of dismissing it</span>
00293 <span class="comment">         *</span>
00294 <span class="comment">         * Temp fix:  Check for child window first.</span>
00295 <span class="comment">         */</span>
00296 
00297         <span class="comment">/*</span>
00298 <span class="comment">         * if this window is REALLY minimized (minimized bit is set and caption</span>
00299 <span class="comment">         * present bit is removed), then don't allow app to remove the minimize</span>
00300 <span class="comment">         * bit -- this fixes FoxBlow's attempt at being the OS -- jeffbog</span>
00301 <span class="comment">         */</span>
00302         <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFCHILD) &amp;&amp;
00303                 <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFMINIMIZED) &amp;&amp;
00304                 !<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFCPRESENT) &amp;&amp;
00305                 !(sty.styleNew &amp; WS_MINIMIZE)) {
00306 
00307             sty.styleNew |= WS_MINIMIZE;
00308         }
00309 
00310         <span class="comment">/*</span>
00311 <span class="comment">         * If we're changing the child bit, deal with spmenu appropriately.</span>
00312 <span class="comment">         * If we're turning into a child, change spmenu to an id. If we're</span>
00313 <span class="comment">         * turning into a top level window, turn spmenu into a menu.</span>
00314 <span class="comment">         */</span>
00315         fWasChild = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a735">TestwndChild</a>(pwnd);
00316 
00317         pwnd-&gt;style = sty.styleNew;
00318 
00319         fIsChild = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a735">TestwndChild</a>(pwnd);
00320 
00321         <span class="comment">/*</span>
00322 <span class="comment">         * If we turned into a top level window, change spmenu to NULL.</span>
00323 <span class="comment">         * If we turned into a child from a top level window, unlock spmenu.</span>
00324 <span class="comment">         */</span>
00325         <span class="keywordflow">if</span> (fWasChild &amp;&amp; !fIsChild)
00326             pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o16">spmenu</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00327 
00328         <span class="keywordflow">if</span> (!fWasChild &amp;&amp; fIsChild) {
00329             <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a733">ClrWF</a>(pwnd, WFMPRESENT);
00330             <a class="code" href="../../d4/d1/userk_8h.html#a1363">UnlockWndMenu</a>(pwnd, &amp;pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o16">spmenu</a>);
00331         }
00332 
00333         <span class="comment">/*</span>
00334 <span class="comment">         * If the visible, child, or minimized style is changing,</span>
00335 <span class="comment">         * then update the cVisWindows count</span>
00336 <span class="comment">         */</span>
00337         fWasVisWindow = <a class="code" href="../../d6/d7/classchg_8c.html#a0">VisWindow</a>(pwnd, sty.styleOld);
00338         <span class="keywordflow">if</span> (fWasVisWindow != <a class="code" href="../../d6/d7/classchg_8c.html#a0">VisWindow</a>(pwnd, sty.styleNew))
00339         {
00340 
00341 <span class="preprocessor">#if DBG</span>
00342 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFINDESTROY)) {
00343                 RIPMSG1(RIP_ERROR, <span class="stringliteral">"xxxSetWindowStyle: window INDESTROY 0x%08X"</span>, pwnd);
00344             }
00345 <span class="preprocessor">#endif</span>
00346 <span class="preprocessor"></span>
00347 <span class="comment">//            IncDecVisWindows(pwnd, !fWasVisWindow);</span>
00348             <span class="keywordflow">if</span> (fWasVisWindow)
00349                 <a class="code" href="../../d4/d1/userk_8h.html#a1624">DecVisWindows</a>(pwnd);
00350             <span class="keywordflow">else</span>
00351                 <a class="code" href="../../d4/d1/userk_8h.html#a1623">IncVisWindows</a>(pwnd);
00352         }
00353     } <span class="keywordflow">else</span> {
00354         <span class="comment">/*</span>
00355 <span class="comment">         * First, see if the app might be setting bits that it really</span>
00356 <span class="comment">         * doesn't know about.  If so, replace those bits with the</span>
00357 <span class="comment">         * current values.</span>
00358 <span class="comment">         */</span>
00359         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d3/queue_8c.html#a35">GetAppCompatFlags2</a>(VER40) &amp; GACF2_NO50EXSTYLEBITS) {
00360             sty.styleNew &amp;= WS_EX_VALID40;
00361         } <span class="keywordflow">else</span> {
00362             <span class="comment">/*</span>
00363 <span class="comment">             * Don't let aplications set unused extended bits</span>
00364 <span class="comment">             * Mcostea #237449</span>
00365 <span class="comment">             */</span>
00366 <span class="preprocessor">#if DBG</span>
00367 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (sty.styleNew &amp; ~WS_EX_ALLVALID) {
00368                 RIPMSG0(RIP_WARNING, <span class="stringliteral">"Trying to set reserved exStyle bits in SetWindowLong"</span>);
00369             }
00370 <span class="preprocessor">#endif</span>
00371 <span class="preprocessor"></span>            sty.styleNew &amp;= WS_EX_ALLVALID;
00372         }
00373         <span class="comment">/*</span>
00374 <span class="comment">         * Is someone trying to toggle the WS_EX_TOPMOST style bit?</span>
00375 <span class="comment">         */</span>
00376         <span class="keywordflow">if</span> ((sty.styleOld &amp; WS_EX_TOPMOST) != (sty.styleNew &amp; WS_EX_TOPMOST)) {
00377 
00378 <span class="preprocessor">#if DBG</span>
00379 <span class="preprocessor"></span>            <span class="comment">/*</span>
00380 <span class="comment">             * Rip in debug about this</span>
00381 <span class="comment">             */</span>
00382             RIPMSG0(RIP_WARNING, <span class="stringliteral">"Can't change WS_EX_TOPMOST with SetWindowLong"</span>);
00383 <span class="preprocessor">#endif</span>
00384 <span class="preprocessor"></span>
00385             <span class="comment">/*</span>
00386 <span class="comment">             * BACKWARDS COMPATIBILITY HACK</span>
00387 <span class="comment">             * If stuff is getting stored in the high word, then it must be</span>
00388 <span class="comment">             * Lotus 123-W sticking a FAR pointer in this field.  So don't</span>
00389 <span class="comment">             * modify it.</span>
00390 <span class="comment">             */</span>
00391             <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFWIN40COMPAT) || !HIWORD(sty.styleNew)) {
00392 
00393                 <span class="comment">/*</span>
00394 <span class="comment">                 * Don't let the bit be flipped</span>
00395 <span class="comment">                 */</span>
00396                 sty.styleNew &amp;= ~WS_EX_TOPMOST;
00397                 sty.styleNew |= (sty.styleOld &amp; WS_EX_TOPMOST);
00398             }
00399         }
00400 
00401         {
00402             <span class="comment">/*</span>
00403 <span class="comment">             * Check pwnd-&gt;ExStyle directly since sty.styleOld can now be</span>
00404 <span class="comment">             * different from the real state of the window, because of the</span>
00405 <span class="comment">             * callbacks in this function from the time sty.styleOld was</span>
00406 <span class="comment">             * remembered and up to now. We must call the layering functions</span>
00407 <span class="comment">             * based on the real state of the layering bit.</span>
00408 <span class="comment">             */</span>
00409             <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fWasSprite = (pwnd-&gt;ExStyle &amp; WS_EX_LAYERED);
00410             <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fSprite = (sty.styleNew &amp; WS_EX_LAYERED);
00411 
00412             <span class="keywordflow">if</span> (fWasSprite &amp;&amp; !fSprite) {
00413                 <span class="keywordflow">if</span> (!<a class="code" href="../../d4/d1/userk_8h.html#a1984">UnsetLayeredWindow</a>(pwnd)) {
00414                     <span class="keywordflow">return</span> 0;
00415                 }
00416             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!fWasSprite &amp;&amp; fSprite) {
00417                 <span class="keywordflow">if</span> (!<a class="code" href="../../d4/d1/userk_8h.html#a1983">xxxSetLayeredWindow</a>(pwnd, TRUE)) {
00418                     <span class="keywordflow">return</span> 0;
00419                 }
00420             }
00421         }
00422 
00423 <span class="preprocessor">#ifdef REDIRECTION</span>
00424 <span class="preprocessor"></span>        {
00425             <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fWasRedirected = (pwnd-&gt;ExStyle &amp; WS_EX_REDIRECTED);
00426             <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fRedirected = (sty.styleNew &amp; WS_EX_REDIRECTED);
00427 
00428             <span class="keywordflow">if</span> (fWasRedirected &amp;&amp; !fRedirected) {
00429                 <span class="keywordflow">if</span> (!UnsetRedirectedWindow(pwnd)) {
00430                     <span class="keywordflow">return</span> 0;
00431                 }
00432             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!fWasRedirected &amp;&amp; fRedirected) {
00433                 <span class="keywordflow">if</span> (!SetRedirectedWindow(pwnd)) {
00434                     <span class="keywordflow">return</span> 0;
00435                 }
00436             }
00437         }
00438 <span class="preprocessor">#endif // REDIRECTION</span>
00439 <span class="preprocessor"></span>
00440         <span class="comment">/*</span>
00441 <span class="comment">         * The bits we use internally should be preserved</span>
00442 <span class="comment">         */</span>
00443         pwnd-&gt;ExStyle = sty.styleNew | (sty.styleOld &amp; ~WS_EX_ALLVALID);
00444         <span class="keywordflow">if</span> ((sty.styleOld ^ sty.styleNew)
00445             &amp; (WS_EX_LEFTSCROLLBAR | WS_EX_RIGHT | WS_EX_RTLREADING | WS_EX_LAYOUTRTL)) {
00446             <a class="code" href="../../d4/d1/userk_8h.html#a1499">xxxRedrawFrame</a>(pwnd);
00447         }
00448     }
00449 
00450     <span class="comment">/*</span>
00451 <span class="comment">     * See if we still need the 3D edge since the window styles changed.</span>
00452 <span class="comment">     */</span>
00453     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d8/rtl_2winmgr_8c.html#a9">NeedsWindowEdge</a>(pwnd-&gt;style, pwnd-&gt;ExStyle, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFWIN40COMPAT)))
00454         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a732">SetWF</a>(pwnd, WEFWINDOWEDGE);
00455     <span class="keywordflow">else</span>
00456         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a733">ClrWF</a>(pwnd, WEFWINDOWEDGE);
00457 
00458     <span class="comment">/*</span>
00459 <span class="comment">     * Send a WM_STYLECHANGED message</span>
00460 <span class="comment">     */</span>
00461     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFWIN40COMPAT))
00462         <a class="code" href="../../d4/d1/userk_8h.html#a1579">xxxSendMessage</a>(pwnd, WM_STYLECHANGED, gwl, (LPARAM)(LPSTYLESTRUCT)&amp;sty);
00463 
00464     <span class="keywordflow">return</span>(sty.styleOld);
00465 }
</div></pre>    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:43:04 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
