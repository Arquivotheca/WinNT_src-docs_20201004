<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: ex.h Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>ex.h</h1><a href="../../d5/d8/ex_8h.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/*++ BUILD Version: 0007    // Increment this if a change has global effects</span>
00002 <span class="comment"></span>
00003 <span class="comment">Copyright (c) 1989  Microsoft Corporation</span>
00004 <span class="comment"></span>
00005 <span class="comment">Module Name:</span>
00006 <span class="comment"></span>
00007 <span class="comment">    ex.h</span>
00008 <span class="comment"></span>
00009 <span class="comment">Abstract:</span>
00010 <span class="comment"></span>
00011 <span class="comment">    Public executive data structures and procedure prototypes.</span>
00012 <span class="comment"></span>
00013 <span class="comment">Author:</span>
00014 <span class="comment"></span>
00015 <span class="comment">    Mark Lucovsky (markl) 23-Feb-1989</span>
00016 <span class="comment"></span>
00017 <span class="comment">Revision History:</span>
00018 <span class="comment"></span>
00019 <span class="comment">--*/</span>
00020 
00021 <span class="preprocessor">#ifndef _EX_</span>
00022 <span class="preprocessor"></span><span class="preprocessor">#define _EX_</span>
00023 <span class="preprocessor"></span>
00024 <span class="comment">//</span>
00025 <span class="comment">// Define caller count hash table structures and function prototypes.</span>
00026 <span class="comment">//</span>
00027 
<a name="l00028"></a><a class="code" href="../../d5/d8/ex_8h.html#a0">00028</a> <span class="preprocessor">#define CALL_HASH_TABLE_SIZE 64</span>
00029 <span class="preprocessor"></span>
<a name="l00030"></a><a class="code" href="../../d7/d6/struct__CALL__HASH__ENTRY.html">00030</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d7/d6/struct__CALL__HASH__ENTRY.html">_CALL_HASH_ENTRY</a> {
<a name="l00031"></a><a class="code" href="../../d7/d6/struct__CALL__HASH__ENTRY.html#o0">00031</a>     LIST_ENTRY <a class="code" href="../../d7/d6/struct__CALL__HASH__ENTRY.html#o0">ListEntry</a>;
<a name="l00032"></a><a class="code" href="../../d7/d6/struct__CALL__HASH__ENTRY.html#o1">00032</a>     PVOID <a class="code" href="../../d7/d6/struct__CALL__HASH__ENTRY.html#o1">CallersAddress</a>;
<a name="l00033"></a><a class="code" href="../../d7/d6/struct__CALL__HASH__ENTRY.html#o2">00033</a>     PVOID <a class="code" href="../../d7/d6/struct__CALL__HASH__ENTRY.html#o2">CallersCaller</a>;
<a name="l00034"></a><a class="code" href="../../d7/d6/struct__CALL__HASH__ENTRY.html#o3">00034</a>     ULONG <a class="code" href="../../d7/d6/struct__CALL__HASH__ENTRY.html#o3">CallCount</a>;
00035 } <a class="code" href="../../d7/d6/struct__CALL__HASH__ENTRY.html">CALL_HASH_ENTRY</a>, *<a class="code" href="../../d7/d6/struct__CALL__HASH__ENTRY.html">PCALL_HASH_ENTRY</a>;
00036 
<a name="l00037"></a><a class="code" href="../../d8/d6/struct__CALL__PERFORMANCE__DATA.html">00037</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d8/d6/struct__CALL__PERFORMANCE__DATA.html">_CALL_PERFORMANCE_DATA</a> {
<a name="l00038"></a><a class="code" href="../../d8/d6/struct__CALL__PERFORMANCE__DATA.html#o0">00038</a>     KSPIN_LOCK <a class="code" href="../../d8/d6/struct__CALL__PERFORMANCE__DATA.html#o0">SpinLock</a>;
<a name="l00039"></a><a class="code" href="../../d8/d6/struct__CALL__PERFORMANCE__DATA.html#o1">00039</a>     LIST_ENTRY <a class="code" href="../../d8/d6/struct__CALL__PERFORMANCE__DATA.html#o1">HashTable</a>[<a class="code" href="../../d5/d8/ex_8h.html#a0">CALL_HASH_TABLE_SIZE</a>];
00040 } <a class="code" href="../../d8/d6/struct__CALL__PERFORMANCE__DATA.html">CALL_PERFORMANCE_DATA</a>, *<a class="code" href="../../d8/d6/struct__CALL__PERFORMANCE__DATA.html">PCALL_PERFORMANCE_DATA</a>;
00041 
00042 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00043 <a class="code" href="../../d5/d8/ex_8h.html#a209">ExInitializeCallData</a>(
00044     IN PCALL_PERFORMANCE_DATA CallData
00045     );
00046 
00047 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00048 <a class="code" href="../../d5/d8/ex_8h.html#a210">ExRecordCallerInHashTable</a>(
00049     IN PCALL_PERFORMANCE_DATA CallData,
00050     IN PVOID CallersAddress,
00051     IN PVOID CallersCaller
00052     );
00053 
<a name="l00054"></a><a class="code" href="../../d5/d8/ex_8h.html#a1">00054</a> <span class="preprocessor">#define RECORD_CALL_DATA(Table)                                            \</span>
00055 <span class="preprocessor">    {                                                                      \</span>
00056 <span class="preprocessor">        PVOID CallersAddress;                                              \</span>
00057 <span class="preprocessor">        PVOID CallersCaller;                                               \</span>
00058 <span class="preprocessor">        RtlGetCallersAddress(&amp;CallersAddress, &amp;CallersCaller);             \</span>
00059 <span class="preprocessor">        ExRecordCallerInHashTable((Table), CallersAddress, CallersCaller); \</span>
00060 <span class="preprocessor">    }</span>
00061 <span class="preprocessor"></span>
00062 <span class="comment">//</span>
00063 <span class="comment">// Define executive event pair object structure.</span>
00064 <span class="comment">//</span>
00065 
<a name="l00066"></a><a class="code" href="../../d0/d2/struct__EEVENT__PAIR.html">00066</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d0/d2/struct__EEVENT__PAIR.html">_EEVENT_PAIR</a> {
<a name="l00067"></a><a class="code" href="../../d0/d2/struct__EEVENT__PAIR.html#o0">00067</a>     <a class="code" href="../../d3/d6/struct__KEVENT__PAIR.html">KEVENT_PAIR</a> <a class="code" href="../../d0/d2/struct__EEVENT__PAIR.html#o0">KernelEventPair</a>;
00068 } <a class="code" href="../../d0/d2/struct__EEVENT__PAIR.html">EEVENT_PAIR</a>, *<a class="code" href="../../d0/d2/struct__EEVENT__PAIR.html">PEEVENT_PAIR</a>;
00069 
00070 <span class="comment">//</span>
00071 <span class="comment">// empty struct def so we can forward reference ETHREAD</span>
00072 <span class="comment">//</span>
00073 
00074 <span class="keyword">struct </span><a class="code" href="../../d5/d6/struct__ETHREAD.html">_ETHREAD</a>;
00075 
00076 <span class="comment">//</span>
00077 <span class="comment">// System Initialization procedure for EX subcomponent of NTOS (in exinit.c)</span>
00078 <span class="comment">//</span>
00079 
00080 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
00081 BOOLEAN
00082 <a class="code" href="../../d5/d8/ex_8h.html#a211">ExInitSystem</a>(
00083     VOID
00084     );
00085 
00086 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
00087 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00088 <a class="code" href="../../d5/d8/ex_8h.html#a212">ExInitSystemPhase2</a>(
00089     VOID
00090     );
00091 
00092 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00093 <a class="code" href="../../d5/d8/ex_8h.html#a213">ExInitPoolLookasidePointers</a> (
00094     VOID
00095     );
00096 
00097 ULONG
00098 <a class="code" href="../../d5/d8/ex_8h.html#a214">ExComputeTickCountMultiplier</a> (
00099     IN ULONG TimeIncrement
00100     );
00101 
00102 <span class="comment">// begin_ntddk begin_wdm begin_nthal begin_ntifs begin_ntndis</span>
00103 <span class="comment">//</span>
00104 <span class="comment">// Pool Allocation routines (in pool.c)</span>
00105 <span class="comment">//</span>
00106 
<a name="l00107"></a><a class="code" href="../../d5/d8/ex_8h.html#a329">00107</a> <span class="keyword">typedef</span> <span class="keyword">enum</span> <a class="code" href="../../d5/d8/ex_8h.html#a329">_POOL_TYPE</a> {
00108     <a class="code" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>,
00109     <a class="code" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>,
00110     <a class="code" href="../../d5/d8/ex_8h.html#a329a175">NonPagedPoolMustSucceed</a>,
00111     <a class="code" href="../../d5/d8/ex_8h.html#a329a176">DontUseThisType</a>,
00112     <a class="code" href="../../d5/d8/ex_8h.html#a329a177">NonPagedPoolCacheAligned</a>,
00113     <a class="code" href="../../d5/d8/ex_8h.html#a329a178">PagedPoolCacheAligned</a>,
00114     <a class="code" href="../../d5/d8/ex_8h.html#a329a179">NonPagedPoolCacheAlignedMustS</a>,
00115     <a class="code" href="../../d5/d8/ex_8h.html#a329a180">MaxPoolType</a>
00116 
00117     <span class="comment">// end_wdm</span>
00118     ,
00119     <span class="comment">//</span>
00120     <span class="comment">// Note these per session types are carefully chosen so that the appropriate</span>
00121     <span class="comment">// masking still applies as well as MaxPoolType above.</span>
00122     <span class="comment">//</span>
00123 
00124     <a class="code" href="../../d5/d8/ex_8h.html#a329a181">NonPagedPoolSession</a> = 32,
00125     <a class="code" href="../../d5/d8/ex_8h.html#a329a182">PagedPoolSession</a> = <a class="code" href="../../d5/d8/ex_8h.html#a329a181">NonPagedPoolSession</a> + 1,
00126     <a class="code" href="../../d5/d8/ex_8h.html#a329a183">NonPagedPoolMustSucceedSession</a> = <a class="code" href="../../d5/d8/ex_8h.html#a329a182">PagedPoolSession</a> + 1,
00127     <a class="code" href="../../d5/d8/ex_8h.html#a329a184">DontUseThisTypeSession</a> = <a class="code" href="../../d5/d8/ex_8h.html#a329a183">NonPagedPoolMustSucceedSession</a> + 1,
00128     <a class="code" href="../../d5/d8/ex_8h.html#a329a185">NonPagedPoolCacheAlignedSession</a> = <a class="code" href="../../d5/d8/ex_8h.html#a329a184">DontUseThisTypeSession</a> + 1,
00129     <a class="code" href="../../d5/d8/ex_8h.html#a329a186">PagedPoolCacheAlignedSession</a> = <a class="code" href="../../d5/d8/ex_8h.html#a329a185">NonPagedPoolCacheAlignedSession</a> + 1,
00130     <a class="code" href="../../d5/d8/ex_8h.html#a329a187">NonPagedPoolCacheAlignedMustSSession</a> = <a class="code" href="../../d5/d8/ex_8h.html#a329a186">PagedPoolCacheAlignedSession</a> + 1,
00131 
00132     <span class="comment">// begin_wdm</span>
00133 
00134     } <a class="code" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a>;
00135 
00136 <span class="comment">// end_ntddk end_wdm end_nthal end_ntifs end_ntndis</span>
00137 
00138 <span class="comment">//</span>
00139 <span class="comment">// The following two definitions control the raising of exceptions on quota</span>
00140 <span class="comment">// and allocation failures.</span>
00141 <span class="comment">//</span>
00142 
<a name="l00143"></a><a class="code" href="../../d5/d8/ex_8h.html#a2">00143</a> <span class="preprocessor">#define POOL_QUOTA_FAIL_INSTEAD_OF_RAISE 8</span>
<a name="l00144"></a><a class="code" href="../../d5/d8/ex_8h.html#a3">00144</a> <span class="preprocessor"></span><span class="preprocessor">#define POOL_RAISE_IF_ALLOCATION_FAILURE 16               // ntifs</span>
00145 <span class="preprocessor"></span>
00146 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00147 <a class="code" href="../../d5/d8/ex_8h.html#a215">InitializePool</a>(
00148     IN POOL_TYPE PoolType,
00149     IN ULONG Threshold
00150     );
00151 
00152 <span class="comment">//</span>
00153 <span class="comment">// These routines are private to the pool manager and the memory manager.</span>
00154 <span class="comment">//</span>
00155 
00156 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00157 <a class="code" href="../../d5/d8/ex_8h.html#a216">ExInsertPoolTag</a> (
00158     ULONG Tag,
00159     PVOID Va,
00160     SIZE_T NumberOfBytes,
00161     POOL_TYPE PoolType
00162     );
00163 
00164 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00165 <a class="code" href="../../d5/d8/ex_8h.html#a217">ExAllocatePoolSanityChecks</a>(
00166     IN POOL_TYPE PoolType,
00167     IN SIZE_T NumberOfBytes
00168     );
00169 
00170 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00171 <a class="code" href="../../d5/d8/ex_8h.html#a218">ExFreePoolSanityChecks</a>(
00172     IN PVOID P
00173     );
00174 
00175 <span class="comment">// begin_ntddk begin_nthal begin_ntifs begin_wdm</span>
00176 
00177 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
00178 PVOID
00179 <a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>(
00180     IN POOL_TYPE PoolType,
00181     IN SIZE_T NumberOfBytes
00182     );
00183 
00184 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
00185 PVOID
00186 <a class="code" href="../../d5/d5/cc_8h.html#a11">ExAllocatePoolWithQuota</a>(
00187     IN POOL_TYPE PoolType,
00188     IN SIZE_T NumberOfBytes
00189     );
00190 
00191 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
00192 PVOID
00193 NTAPI
00194 <a class="code" href="../../d5/d8/ex_8h.html#a4">ExAllocatePoolWithTag</a>(
00195     IN POOL_TYPE PoolType,
00196     IN SIZE_T NumberOfBytes,
00197     IN ULONG Tag
00198     );
00199 
00200 <span class="comment">// end_wdm</span>
00201 
00202 <span class="comment">//</span>
00203 <span class="comment">// _EX_POOL_PRIORITY_ provides a method for the system to handle requests</span>
00204 <span class="comment">// intelligently in low resource conditions.</span>
00205 <span class="comment">//</span>
00206 <span class="comment">// LowPoolPriority should be used when it is acceptable to the driver for the</span>
00207 <span class="comment">// mapping request to fail if the system is low on resources.  An example of</span>
00208 <span class="comment">// this could be for a non-critical network connection where the driver can</span>
00209 <span class="comment">// handle the failure case when system resources are close to being depleted.</span>
00210 <span class="comment">//</span>
00211 <span class="comment">// NormalPoolPriority should be used when it is acceptable to the driver for the</span>
00212 <span class="comment">// mapping request to fail if the system is very low on resources.  An example</span>
00213 <span class="comment">// of this could be for a non-critical local filesystem request.</span>
00214 <span class="comment">//</span>
00215 <span class="comment">// HighPoolPriority should be used when it is unacceptable to the driver for the</span>
00216 <span class="comment">// mapping request to fail unless the system is completely out of resources.</span>
00217 <span class="comment">// An example of this would be the paging file path in a driver.</span>
00218 <span class="comment">//</span>
00219 <span class="comment">// SpecialPool can be specified to bound the allocation at a page end (or</span>
00220 <span class="comment">// beginning).  This should only be done on systems being debugged as the</span>
00221 <span class="comment">// memory cost is expensive.</span>
00222 <span class="comment">//</span>
00223 <span class="comment">// N.B.  These values are very carefully chosen so that the pool allocation</span>
00224 <span class="comment">//       code can quickly crack the priority request.</span>
00225 <span class="comment">//</span>
00226 
<a name="l00227"></a><a class="code" href="../../d5/d8/ex_8h.html#a330">00227</a> <span class="keyword">typedef</span> <span class="keyword">enum</span> <a class="code" href="../../d5/d8/ex_8h.html#a330">_EX_POOL_PRIORITY</a> {
00228     <a class="code" href="../../d5/d8/ex_8h.html#a330a188">LowPoolPriority</a>,
00229     <a class="code" href="../../d5/d8/ex_8h.html#a330a189">LowPoolPrioritySpecialPoolOverrun</a> = 8,
00230     <a class="code" href="../../d5/d8/ex_8h.html#a330a190">LowPoolPrioritySpecialPoolUnderrun</a> = 9,
00231     <a class="code" href="../../d5/d8/ex_8h.html#a330a191">NormalPoolPriority</a> = 16,
00232     <a class="code" href="../../d5/d8/ex_8h.html#a330a192">NormalPoolPrioritySpecialPoolOverrun</a> = 24,
00233     <a class="code" href="../../d5/d8/ex_8h.html#a330a193">NormalPoolPrioritySpecialPoolUnderrun</a> = 25,
00234     <a class="code" href="../../d5/d8/ex_8h.html#a330a194">HighPoolPriority</a> = 32,
00235     <a class="code" href="../../d5/d8/ex_8h.html#a330a195">HighPoolPrioritySpecialPoolOverrun</a> = 40,
00236     <a class="code" href="../../d5/d8/ex_8h.html#a330a196">HighPoolPrioritySpecialPoolUnderrun</a> = 41
00237 
00238     } <a class="code" href="../../d5/d8/ex_8h.html#a97">EX_POOL_PRIORITY</a>;
00239 
00240 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
00241 PVOID
00242 NTAPI
00243 <a class="code" href="../../d5/d8/ex_8h.html#a222">ExAllocatePoolWithTagPriority</a>(
00244     IN POOL_TYPE PoolType,
00245     IN SIZE_T NumberOfBytes,
00246     IN ULONG Tag,
00247     IN EX_POOL_PRIORITY Priority
00248     );
00249 
00250 <span class="comment">// begin_wdm</span>
00251 
00252 <span class="preprocessor">#ifndef POOL_TAGGING</span>
<a name="l00253"></a><a class="code" href="../../d5/d8/ex_8h.html#a4">00253</a> <span class="preprocessor"></span><span class="preprocessor">#define ExAllocatePoolWithTag(a,b,c) ExAllocatePool(a,b)</span>
00254 <span class="preprocessor"></span><span class="preprocessor">#endif //POOL_TAGGING</span>
00255 <span class="preprocessor"></span>
00256 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
00257 PVOID
00258 <a class="code" href="../../d5/d8/ex_8h.html#a5">ExAllocatePoolWithQuotaTag</a>(
00259     IN POOL_TYPE PoolType,
00260     IN SIZE_T NumberOfBytes,
00261     IN ULONG Tag
00262     );
00263 
00264 <span class="preprocessor">#ifndef POOL_TAGGING</span>
<a name="l00265"></a><a class="code" href="../../d5/d8/ex_8h.html#a5">00265</a> <span class="preprocessor"></span><span class="preprocessor">#define ExAllocatePoolWithQuotaTag(a,b,c) ExAllocatePoolWithQuota(a,b)</span>
00266 <span class="preprocessor"></span><span class="preprocessor">#endif //POOL_TAGGING</span>
00267 <span class="preprocessor"></span>
00268 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
00269 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00270 NTAPI
00271 <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>(
00272     IN PVOID P
00273     );
00274 
00275 <span class="comment">// end_ntddk end_wdm end_nthal end_ntifs</span>
00276 
00277 <span class="comment">//</span>
00278 <span class="comment">// If high order bit in Pool tag is set, then must use ExFreePoolWithTag to free</span>
00279 <span class="comment">//</span>
00280 
<a name="l00281"></a><a class="code" href="../../d5/d8/ex_8h.html#a6">00281</a> <span class="preprocessor">#define PROTECTED_POOL 0x80000000</span>
00282 <span class="preprocessor"></span>
00283 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
00284 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00285 <a class="code" href="../../d5/d8/ex_8h.html#a7">ExFreePoolWithTag</a>(
00286     IN PVOID P,
00287     IN ULONG Tag
00288     );
00289 
00290 <span class="preprocessor">#ifndef POOL_TAGGING</span>
<a name="l00291"></a><a class="code" href="../../d5/d8/ex_8h.html#a7">00291</a> <span class="preprocessor"></span><span class="preprocessor">#define ExFreePoolWithTag(a,b) ExFreePool(a)</span>
00292 <span class="preprocessor"></span><span class="preprocessor">#endif //POOL_TAGGING</span>
00293 <span class="preprocessor"></span>
00294 
00295 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
00296 KIRQL
00297 <a class="code" href="../../d5/d8/ex_8h.html#a226">ExLockPool</a>(
00298     IN POOL_TYPE PoolType
00299     );
00300 
00301 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
00302 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00303 <a class="code" href="../../d5/d8/ex_8h.html#a227">ExUnlockPool</a>(
00304     IN POOL_TYPE PoolType,
00305     IN KIRQL LockHandle
00306     );
00307 
00308 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>                                     <span class="comment">// ntifs</span>
00309 ULONG                                           <span class="comment">// ntifs</span>
00310 <a class="code" href="../../d5/d8/ex_8h.html#a228">ExQueryPoolBlockSize</a> (                          <span class="comment">// ntifs</span>
00311     IN PVOID PoolBlock,                         <span class="comment">// ntifs</span>
00312     OUT PBOOLEAN QuotaCharged                   <span class="comment">// ntifs</span>
00313     );                                          <span class="comment">// ntifs</span>
00314 
00315 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
00316 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00317 <a class="code" href="../../d5/d8/ex_8h.html#a229">ExQueryPoolUsage</a>(
00318     OUT PULONG PagedPoolPages,
00319     OUT PULONG NonPagedPoolPages,
00320     OUT PULONG PagedPoolAllocs,
00321     OUT PULONG PagedPoolFrees,
00322     OUT PULONG PagedPoolLookasideHits,
00323     OUT PULONG NonPagedPoolAllocs,
00324     OUT PULONG NonPagedPoolFrees,
00325     OUT PULONG NonPagedPoolLookasideHits
00326     );
00327 
00328 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00329 <a class="code" href="../../d5/d8/ex_8h.html#a230">ExReturnPoolQuota</a> (
00330     IN PVOID P
00331     );
00332 
00333 <span class="preprocessor">#if DBG || (i386 &amp;&amp; !FPO)</span>
00334 <span class="preprocessor"></span><a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
00335 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00336 ExSnapShotPool(
00337     IN POOL_TYPE PoolType,
00338     IN PSYSTEM_POOL_INFORMATION PoolInformation,
00339     IN ULONG Length,
00340     OUT PULONG ReturnLength OPTIONAL
00341     );
00342 <span class="preprocessor">#endif // DBG || (i386 &amp;&amp; !FPO)</span>
00343 <span class="preprocessor"></span>
00344 
00345 <span class="comment">// begin_ntifs begin_ntddk begin_wdm begin_nthal</span>
00346 <span class="comment">//</span>
00347 <span class="comment">// Routines to support fast mutexes.</span>
00348 <span class="comment">//</span>
00349 
<a name="l00350"></a><a class="code" href="../../d6/d9/struct__FAST__MUTEX.html">00350</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d6/d9/struct__FAST__MUTEX.html">_FAST_MUTEX</a> {
<a name="l00351"></a><a class="code" href="../../d6/d9/struct__FAST__MUTEX.html#o0">00351</a>     LONG <a class="code" href="../../d6/d9/struct__FAST__MUTEX.html#o0">Count</a>;
<a name="l00352"></a><a class="code" href="../../d6/d9/struct__FAST__MUTEX.html#o1">00352</a>     <a class="code" href="../../d1/d8/struct__KTHREAD.html">PKTHREAD</a> <a class="code" href="../../d6/d9/struct__FAST__MUTEX.html#o1">Owner</a>;
<a name="l00353"></a><a class="code" href="../../d6/d9/struct__FAST__MUTEX.html#o2">00353</a>     ULONG <a class="code" href="../../d6/d9/struct__FAST__MUTEX.html#o2">Contention</a>;
<a name="l00354"></a><a class="code" href="../../d6/d9/struct__FAST__MUTEX.html#o3">00354</a>     <a class="code" href="../../d2/d6/struct__KEVENT.html">KEVENT</a> <a class="code" href="../../d6/d9/struct__FAST__MUTEX.html#o3">Event</a>;
<a name="l00355"></a><a class="code" href="../../d6/d9/struct__FAST__MUTEX.html#o4">00355</a>     ULONG <a class="code" href="../../d6/d9/struct__FAST__MUTEX.html#o4">OldIrql</a>;
00356 } <a class="code" href="../../d6/d9/struct__FAST__MUTEX.html">FAST_MUTEX</a>, *<a class="code" href="../../d6/d9/struct__FAST__MUTEX.html">PFAST_MUTEX</a>;
00357 
00358 <span class="preprocessor">#if DBG</span>
00359 <span class="preprocessor"></span><span class="preprocessor">#define ExInitializeFastMutex(_FastMutex)                            \</span>
00360 <span class="preprocessor">    (_FastMutex)-&gt;Count = 1;                                         \</span>
00361 <span class="preprocessor">    (_FastMutex)-&gt;Owner = NULL;                                      \</span>
00362 <span class="preprocessor">    (_FastMutex)-&gt;Contention = 0;                                    \</span>
00363 <span class="preprocessor">    KeInitializeEvent(&amp;(_FastMutex)-&gt;Event,                          \</span>
00364 <span class="preprocessor">                      SynchronizationEvent,                          \</span>
00365 <span class="preprocessor">                      FALSE);</span>
00366 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00367"></a><a class="code" href="../../d5/d8/ex_8h.html#a8">00367</a> <span class="preprocessor"></span><span class="preprocessor">#define ExInitializeFastMutex(_FastMutex)                            \</span>
00368 <span class="preprocessor">    (_FastMutex)-&gt;Count = 1;                                         \</span>
00369 <span class="preprocessor">    (_FastMutex)-&gt;Contention = 0;                                    \</span>
00370 <span class="preprocessor">    KeInitializeEvent(&amp;(_FastMutex)-&gt;Event,                          \</span>
00371 <span class="preprocessor">                      SynchronizationEvent,                          \</span>
00372 <span class="preprocessor">                      FALSE);</span>
00373 <span class="preprocessor"></span><span class="preprocessor">#endif // DBG</span>
00374 <span class="preprocessor"></span>
00375 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
00376 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00377 <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a0">FASTCALL</a>
00378 <a class="code" href="../../d5/d8/ex_8h.html#a231">ExAcquireFastMutexUnsafe</a> (
00379     IN PFAST_MUTEX FastMutex
00380     );
00381 
00382 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
00383 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00384 <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a0">FASTCALL</a>
00385 <a class="code" href="../../d5/d8/ex_8h.html#a232">ExReleaseFastMutexUnsafe</a> (
00386     IN PFAST_MUTEX FastMutex
00387     );
00388 
00389 <span class="preprocessor">#if defined(_ALPHA_) || defined(_IA64_)</span>
00390 <span class="preprocessor"></span>
00391 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
00392 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00393 <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a0">FASTCALL</a>
00394 ExAcquireFastMutex (
00395     IN PFAST_MUTEX FastMutex
00396     );
00397 
00398 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
00399 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00400 <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a0">FASTCALL</a>
00401 ExReleaseFastMutex (
00402     IN PFAST_MUTEX FastMutex
00403     );
00404 
00405 <span class="comment">// end_wdm</span>
00406 
00407 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
00408 BOOLEAN
00409 <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a0">FASTCALL</a>
00410 ExTryToAcquireFastMutex (
00411     IN PFAST_MUTEX FastMutex
00412     );
00413 
00414 <span class="comment">// begin_wdm</span>
00415 
00416 <span class="preprocessor">#elif defined(_X86_)</span>
00417 <span class="preprocessor"></span>
00418 <a class="code" href="../../d0/d9/ntosdef_8h.html#a30">NTHALAPI</a>
00419 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00420 <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a0">FASTCALL</a>
00421 ExAcquireFastMutex (
00422     IN PFAST_MUTEX FastMutex
00423     );
00424 
00425 <a class="code" href="../../d0/d9/ntosdef_8h.html#a30">NTHALAPI</a>
00426 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00427 <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a0">FASTCALL</a>
00428 ExReleaseFastMutex (
00429     IN PFAST_MUTEX FastMutex
00430     );
00431 
00432 <span class="comment">// end_wdm</span>
00433 
00434 <a class="code" href="../../d0/d9/ntosdef_8h.html#a30">NTHALAPI</a>
00435 BOOLEAN
00436 <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a0">FASTCALL</a>
00437 ExTryToAcquireFastMutex (
00438     IN PFAST_MUTEX FastMutex
00439     );
00440 
00441 <span class="comment">// begin_wdm</span>
00442 
00443 <span class="preprocessor">#else</span>
00444 <span class="preprocessor"></span>
00445 <span class="preprocessor">#error "Target architecture not defined"</span>
00446 <span class="preprocessor"></span>
00447 <span class="preprocessor">#endif</span>
00448 <span class="preprocessor"></span>
00449 <span class="comment">// end_ntifs end_ntddk end_wdm end_nthal</span>
00450 
00451 <span class="comment">//</span>
00452 <span class="comment">// Interlocked support routine definitions.</span>
00453 <span class="comment">//</span>
00454 <span class="comment">// begin_ntddk begin_wdm begin_nthal begin_ntifs begin_ntndis</span>
00455 <span class="comment">//</span>
00456 
00457 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
00458 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00459 <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a0">FASTCALL</a>
00460 <a class="code" href="../../d5/d8/ex_8h.html#a233">ExInterlockedAddLargeStatistic</a> (
00461     IN PLARGE_INTEGER Addend,
00462     IN ULONG Increment
00463     );
00464 
00465 <span class="comment">// end_ntndis</span>
00466 
00467 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
00468 LARGE_INTEGER
00469 <a class="code" href="../../d5/d8/ex_8h.html#a234">ExInterlockedAddLargeInteger</a> (
00470     IN PLARGE_INTEGER Addend,
00471     IN LARGE_INTEGER Increment,
00472     IN PKSPIN_LOCK Lock
00473     );
00474 
00475 <span class="comment">//  end_wdm end_ntifs end_ntddk end_nthal</span>
00476 
00477 <span class="preprocessor">#if defined(NT_UP) &amp;&amp; !defined(_NTHAL_) &amp;&amp; !defined(_NTDDK_) &amp;&amp; !defined(_NTIFS_)</span>
00478 <span class="preprocessor"></span>
00479 <span class="preprocessor">#undef ExInterlockedAddUlong</span>
00480 <span class="preprocessor"></span><span class="preprocessor">#define ExInterlockedAddUlong(x, y, z) InterlockedExchangeAdd((PLONG)(x), (LONG)(y))</span>
00481 <span class="preprocessor"></span>
00482 <span class="preprocessor">#else</span>
00483 <span class="preprocessor"></span>
00484 <span class="comment">//  begin_wdm begin_ntddk begin_nthal begin_ntifs</span>
00485 
00486 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
00487 ULONG
00488 <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a0">FASTCALL</a>
00489 <a class="code" href="../../d5/d8/ex_8h.html#a235">ExInterlockedAddUlong</a> (
00490     IN PULONG Addend,
00491     IN ULONG Increment,
00492     IN PKSPIN_LOCK Lock
00493     );
00494 
00495 <span class="comment">// end_wdm end_ntifs end_ntddk end_nthal</span>
00496 
00497 <span class="preprocessor">#endif</span>
00498 <span class="preprocessor"></span>
00499 <span class="comment">// begin_wdm begin_ntddk begin_nthal begin_ntifs</span>
00500 
00501 <span class="preprocessor">#if defined(_AXP64_)</span>
00502 <span class="preprocessor"></span>
00503 <span class="preprocessor">#define ExInterlockedCompareExchange64(Destination, Exchange, Comperand, Lock) \</span>
00504 <span class="preprocessor">    InterlockedCompareExchange64(Destination, *(Exchange), *(Comperand))</span>
00505 <span class="preprocessor"></span>
00506 <span class="preprocessor">#elif defined(_ALPHA_)</span>
00507 <span class="preprocessor"></span>
00508 <span class="preprocessor">#define ExInterlockedCompareExchange64(Destination, Exchange, Comperand, Lock) \</span>
00509 <span class="preprocessor">    ExpInterlockedCompareExchange64(Destination, Exchange, Comperand)</span>
00510 <span class="preprocessor"></span>
00511 <span class="preprocessor">#elif defined(_IA64_)</span>
00512 <span class="preprocessor"></span>
00513 <span class="preprocessor">#define ExInterlockedCompareExchange64(Destination, Exchange, Comperand, Lock) \</span>
00514 <span class="preprocessor">    InterlockedCompareExchange64(Destination, *(Exchange), *(Comperand))</span>
00515 <span class="preprocessor"></span>
00516 <span class="preprocessor">#else</span>
00517 <span class="preprocessor"></span>
00518 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
00519 LONGLONG
00520 <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a0">FASTCALL</a>
00521 <a class="code" href="../../d5/d8/ex_8h.html#a236">ExInterlockedCompareExchange64</a> (
00522     IN PLONGLONG Destination,
00523     IN PLONGLONG Exchange,
00524     IN PLONGLONG Comperand,
00525     IN PKSPIN_LOCK Lock
00526     );
00527 
00528 <span class="preprocessor">#endif</span>
00529 <span class="preprocessor"></span>
00530 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
00531 PLIST_ENTRY
00532 <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a0">FASTCALL</a>
00533 <a class="code" href="../../d5/d8/ex_8h.html#a237">ExInterlockedInsertHeadList</a> (
00534     IN PLIST_ENTRY ListHead,
00535     IN PLIST_ENTRY ListEntry,
00536     IN PKSPIN_LOCK Lock
00537     );
00538 
00539 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
00540 PLIST_ENTRY
00541 <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a0">FASTCALL</a>
00542 <a class="code" href="../../d5/d8/ex_8h.html#a238">ExInterlockedInsertTailList</a> (
00543     IN PLIST_ENTRY ListHead,
00544     IN PLIST_ENTRY ListEntry,
00545     IN PKSPIN_LOCK Lock
00546     );
00547 
00548 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
00549 PLIST_ENTRY
00550 <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a0">FASTCALL</a>
00551 <a class="code" href="../../d5/d8/ex_8h.html#a239">ExInterlockedRemoveHeadList</a> (
00552     IN PLIST_ENTRY ListHead,
00553     IN PKSPIN_LOCK Lock
00554     );
00555 
00556 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
00557 PSINGLE_LIST_ENTRY
00558 <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a0">FASTCALL</a>
00559 <a class="code" href="../../d5/d8/ex_8h.html#a240">ExInterlockedPopEntryList</a> (
00560     IN PSINGLE_LIST_ENTRY ListHead,
00561     IN PKSPIN_LOCK Lock
00562     );
00563 
00564 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
00565 PSINGLE_LIST_ENTRY
00566 <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a0">FASTCALL</a>
00567 <a class="code" href="../../d5/d8/ex_8h.html#a241">ExInterlockedPushEntryList</a> (
00568     IN PSINGLE_LIST_ENTRY ListHead,
00569     IN PSINGLE_LIST_ENTRY ListEntry,
00570     IN PKSPIN_LOCK Lock
00571     );
00572 
00573 <span class="comment">// begin_ntndis</span>
00574 
00575 <span class="comment">//</span>
00576 <span class="comment">// Define interlocked sequenced listhead functions.</span>
00577 <span class="comment">//</span>
00578 <span class="comment">// A sequenced interlocked list is a singly linked list with a header that</span>
00579 <span class="comment">// contains the current depth and a sequence number. Each time an entry is</span>
00580 <span class="comment">// inserted or removed from the list the depth is updated and the sequence</span>
00581 <span class="comment">// number is incremented. This enables MIPS, Alpha, and Pentium and later</span>
00582 <span class="comment">// machines to insert and remove from the list without the use of spinlocks.</span>
00583 <span class="comment">// The PowerPc, however, must use a spinlock to synchronize access to the</span>
00584 <span class="comment">// list.</span>
00585 <span class="comment">//</span>
00586 <span class="comment">// N.B. A spinlock must be specified with SLIST operations. However, it may</span>
00587 <span class="comment">//      not actually be used.</span>
00588 <span class="comment">//</span>
00589 
00590 <span class="comment">/*++</span>
00591 <span class="comment"></span>
00592 <span class="comment">VOID</span>
00593 <span class="comment">ExInitializeSListHead (</span>
00594 <span class="comment">    IN PSLIST_HEADER SListHead</span>
00595 <span class="comment">    )</span>
00596 <span class="comment"></span>
00597 <span class="comment">Routine Description:</span>
00598 <span class="comment"></span>
00599 <span class="comment">    This function initializes a sequenced singly linked listhead.</span>
00600 <span class="comment"></span>
00601 <span class="comment">Arguments:</span>
00602 <span class="comment"></span>
00603 <span class="comment">    SListHead - Supplies a pointer to a sequenced singly linked listhead.</span>
00604 <span class="comment"></span>
00605 <span class="comment">Return Value:</span>
00606 <span class="comment"></span>
00607 <span class="comment">    None.</span>
00608 <span class="comment"></span>
00609 <span class="comment">--*/</span>
00610 
<a name="l00611"></a><a class="code" href="../../d5/d8/ex_8h.html#a9">00611</a> <span class="preprocessor">#define ExInitializeSListHead(_listhead_) (_listhead_)-&gt;Alignment = 0</span>
00612 <span class="preprocessor"></span>
00613 <span class="comment">/*++</span>
00614 <span class="comment"></span>
00615 <span class="comment">USHORT</span>
00616 <span class="comment">ExQueryDepthSList (</span>
00617 <span class="comment">    IN PSLIST_HEADERT SListHead</span>
00618 <span class="comment">    )</span>
00619 <span class="comment"></span>
00620 <span class="comment">Routine Description:</span>
00621 <span class="comment"></span>
00622 <span class="comment">    This function queries the current number of entries contained in a</span>
00623 <span class="comment">    sequenced single linked list.</span>
00624 <span class="comment"></span>
00625 <span class="comment">Arguments:</span>
00626 <span class="comment"></span>
00627 <span class="comment">    SListHead - Supplies a pointer to the sequenced listhead which is</span>
00628 <span class="comment">        be queried.</span>
00629 <span class="comment"></span>
00630 <span class="comment">Return Value:</span>
00631 <span class="comment"></span>
00632 <span class="comment">    The current number of entries in the sequenced singly linked list is</span>
00633 <span class="comment">    returned as the function value.</span>
00634 <span class="comment"></span>
00635 <span class="comment">--*/</span>
00636 
<a name="l00637"></a><a class="code" href="../../d5/d8/ex_8h.html#a10">00637</a> <span class="preprocessor">#define ExQueryDepthSList(_listhead_) (USHORT)(_listhead_)-&gt;Depth</span>
00638 <span class="preprocessor"></span>
00639 <span class="preprocessor">#if defined(_MIPS_) || defined(_ALPHA_) || defined(_IA64_)</span>
00640 <span class="preprocessor"></span>
00641 <span class="preprocessor">#define ExInterlockedPopEntrySList(Head, Lock) \</span>
00642 <span class="preprocessor">    ExpInterlockedPopEntrySList(Head)</span>
00643 <span class="preprocessor"></span>
00644 <span class="preprocessor">#define ExInterlockedPushEntrySList(Head, Entry, Lock) \</span>
00645 <span class="preprocessor">    ExpInterlockedPushEntrySList(Head, Entry)</span>
00646 <span class="preprocessor"></span>
00647 <span class="preprocessor">#define ExInterlockedFlushSList(Head) \</span>
00648 <span class="preprocessor">    ExpInterlockedFlushSList(Head)</span>
00649 <span class="preprocessor"></span>
00650 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
00651 PSINGLE_LIST_ENTRY
00652 ExpInterlockedPopEntrySList (
00653     IN <a class="code" href="../../d9/d3/union__SLIST__HEADER.html">PSLIST_HEADER</a> ListHead
00654     );
00655 
00656 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
00657 PSINGLE_LIST_ENTRY
00658 ExpInterlockedPushEntrySList (
00659     IN <a class="code" href="../../d9/d3/union__SLIST__HEADER.html">PSLIST_HEADER</a> ListHead,
00660     IN PSINGLE_LIST_ENTRY ListEntry
00661     );
00662 
00663 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
00664 PSINGLE_LIST_ENTRY
00665 ExpInterlockedFlushSList (
00666     IN <a class="code" href="../../d9/d3/union__SLIST__HEADER.html">PSLIST_HEADER</a> ListHead
00667     );
00668 
00669 <span class="preprocessor">#else</span>
00670 <span class="preprocessor"></span>
00671 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
00672 PSINGLE_LIST_ENTRY
00673 <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a0">FASTCALL</a>
00674 <a class="code" href="../../d5/d8/ex_8h.html#a242">ExInterlockedPopEntrySList</a> (
00675     IN <a class="code" href="../../d9/d3/union__SLIST__HEADER.html">PSLIST_HEADER</a> ListHead,
00676     IN PKSPIN_LOCK Lock
00677     );
00678 
00679 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
00680 PSINGLE_LIST_ENTRY
00681 <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a0">FASTCALL</a>
00682 <a class="code" href="../../d5/d8/ex_8h.html#a243">ExInterlockedPushEntrySList</a> (
00683     IN <a class="code" href="../../d9/d3/union__SLIST__HEADER.html">PSLIST_HEADER</a> ListHead,
00684     IN PSINGLE_LIST_ENTRY ListEntry,
00685     IN PKSPIN_LOCK Lock
00686     );
00687 
00688 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
00689 PSINGLE_LIST_ENTRY
00690 <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a0">FASTCALL</a>
00691 <a class="code" href="../../d5/d8/ex_8h.html#a244">ExInterlockedFlushSList</a> (
00692     IN <a class="code" href="../../d9/d3/union__SLIST__HEADER.html">PSLIST_HEADER</a> ListHead
00693     );
00694 
00695 <span class="preprocessor">#endif</span>
00696 <span class="preprocessor"></span>
00697 <span class="comment">// end_ntddk end_wdm</span>
00698 <span class="comment">//</span>
00699 <span class="comment">// Define interlocked lookaside list structure and allocation functions.</span>
00700 <span class="comment">//</span>
00701 
00702 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00703 <a class="code" href="../../d5/d8/ex_8h.html#a245">ExAdjustLookasideDepth</a> (
00704     VOID
00705     );
00706 
00707 <span class="comment">// begin_ntddk begin_wdm</span>
00708 
00709 <span class="keyword">typedef</span>
00710 PVOID
<a name="l00711"></a><a class="code" href="../../d5/d8/ex_8h.html#a100">00711</a> (*PALLOCATE_FUNCTION) (
00712     IN <a class="code" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a> PoolType,
00713     IN SIZE_T NumberOfBytes,
00714     IN ULONG Tag
00715     );
00716 
00717 <span class="keyword">typedef</span>
00718 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00719"></a><a class="code" href="../../d5/d8/ex_8h.html#a101">00719</a> (*PFREE_FUNCTION) (
00720     IN PVOID <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>
00721     );
00722 
<a name="l00723"></a><a class="code" href="../../d6/d1/struct__GENERAL__LOOKASIDE.html">00723</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d6/d1/struct__GENERAL__LOOKASIDE.html">_GENERAL_LOOKASIDE</a> {
<a name="l00724"></a><a class="code" href="../../d6/d1/struct__GENERAL__LOOKASIDE.html#o0">00724</a>     <a class="code" href="../../d9/d3/union__SLIST__HEADER.html">SLIST_HEADER</a> <a class="code" href="../../d6/d1/struct__GENERAL__LOOKASIDE.html#o0">ListHead</a>;
<a name="l00725"></a><a class="code" href="../../d6/d1/struct__GENERAL__LOOKASIDE.html#o1">00725</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d6/d1/struct__GENERAL__LOOKASIDE.html#o1">Depth</a>;
<a name="l00726"></a><a class="code" href="../../d6/d1/struct__GENERAL__LOOKASIDE.html#o2">00726</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d6/d1/struct__GENERAL__LOOKASIDE.html#o2">MaximumDepth</a>;
<a name="l00727"></a><a class="code" href="../../d6/d1/struct__GENERAL__LOOKASIDE.html#o3">00727</a>     ULONG <a class="code" href="../../d6/d1/struct__GENERAL__LOOKASIDE.html#o3">TotalAllocates</a>;
00728     <span class="keyword">union </span>{
<a name="l00729"></a><a class="code" href="../../d6/d1/struct__GENERAL__LOOKASIDE.html#o4">00729</a>         ULONG <a class="code" href="../../d6/d1/struct__GENERAL__LOOKASIDE.html#o4">AllocateMisses</a>;
<a name="l00730"></a><a class="code" href="../../d6/d1/struct__GENERAL__LOOKASIDE.html#o5">00730</a>         ULONG <a class="code" href="../../d6/d1/struct__GENERAL__LOOKASIDE.html#o5">AllocateHits</a>;
00731     };
00732 
<a name="l00733"></a><a class="code" href="../../d6/d1/struct__GENERAL__LOOKASIDE.html#o6">00733</a>     ULONG <a class="code" href="../../d6/d1/struct__GENERAL__LOOKASIDE.html#o6">TotalFrees</a>;
00734     <span class="keyword">union </span>{
<a name="l00735"></a><a class="code" href="../../d6/d1/struct__GENERAL__LOOKASIDE.html#o7">00735</a>         ULONG <a class="code" href="../../d6/d1/struct__GENERAL__LOOKASIDE.html#o7">FreeMisses</a>;
<a name="l00736"></a><a class="code" href="../../d6/d1/struct__GENERAL__LOOKASIDE.html#o8">00736</a>         ULONG <a class="code" href="../../d6/d1/struct__GENERAL__LOOKASIDE.html#o8">FreeHits</a>;
00737     };
00738 
<a name="l00739"></a><a class="code" href="../../d6/d1/struct__GENERAL__LOOKASIDE.html#o9">00739</a>     <a class="code" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a> <a class="code" href="../../d6/d1/struct__GENERAL__LOOKASIDE.html#o9">Type</a>;
<a name="l00740"></a><a class="code" href="../../d6/d1/struct__GENERAL__LOOKASIDE.html#o10">00740</a>     ULONG <a class="code" href="../../d6/d1/struct__GENERAL__LOOKASIDE.html#o10">Tag</a>;
<a name="l00741"></a><a class="code" href="../../d6/d1/struct__GENERAL__LOOKASIDE.html#o11">00741</a>     ULONG <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>;
<a name="l00742"></a><a class="code" href="../../d6/d1/struct__GENERAL__LOOKASIDE.html#o12">00742</a>     <a class="code" href="../../d5/d8/ex_8h.html#a100">PALLOCATE_FUNCTION</a> <a class="code" href="../../d6/d1/struct__GENERAL__LOOKASIDE.html#o12">Allocate</a>;
<a name="l00743"></a><a class="code" href="../../d6/d1/struct__GENERAL__LOOKASIDE.html#o13">00743</a>     <a class="code" href="../../d5/d8/ex_8h.html#a101">PFREE_FUNCTION</a> <a class="code" href="../../d6/d1/struct__GENERAL__LOOKASIDE.html#o13">Free</a>;
<a name="l00744"></a><a class="code" href="../../d6/d1/struct__GENERAL__LOOKASIDE.html#o14">00744</a>     LIST_ENTRY <a class="code" href="../../d6/d1/struct__GENERAL__LOOKASIDE.html#o14">ListEntry</a>;
<a name="l00745"></a><a class="code" href="../../d6/d1/struct__GENERAL__LOOKASIDE.html#o15">00745</a>     ULONG <a class="code" href="../../d6/d1/struct__GENERAL__LOOKASIDE.html#o15">LastTotalAllocates</a>;
00746     <span class="keyword">union </span>{
<a name="l00747"></a><a class="code" href="../../d6/d1/struct__GENERAL__LOOKASIDE.html#o16">00747</a>         ULONG <a class="code" href="../../d6/d1/struct__GENERAL__LOOKASIDE.html#o16">LastAllocateMisses</a>;
<a name="l00748"></a><a class="code" href="../../d6/d1/struct__GENERAL__LOOKASIDE.html#o17">00748</a>         ULONG <a class="code" href="../../d6/d1/struct__GENERAL__LOOKASIDE.html#o17">LastAllocateHits</a>;
00749     };
00750 
<a name="l00751"></a><a class="code" href="../../d6/d1/struct__GENERAL__LOOKASIDE.html#o18">00751</a>     ULONG <a class="code" href="../../d6/d1/struct__GENERAL__LOOKASIDE.html#o18">Future</a>[2];
00752 } <a class="code" href="../../d6/d1/struct__GENERAL__LOOKASIDE.html">GENERAL_LOOKASIDE</a>, *<a class="code" href="../../d6/d1/struct__GENERAL__LOOKASIDE.html">PGENERAL_LOOKASIDE</a>;
00753 
<a name="l00754"></a><a class="code" href="../../d1/d4/struct__NPAGED__LOOKASIDE__LIST.html">00754</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d1/d4/struct__NPAGED__LOOKASIDE__LIST.html">_NPAGED_LOOKASIDE_LIST</a> {
<a name="l00755"></a><a class="code" href="../../d1/d4/struct__NPAGED__LOOKASIDE__LIST.html#o0">00755</a>     <a class="code" href="../../d6/d1/struct__GENERAL__LOOKASIDE.html">GENERAL_LOOKASIDE</a> <a class="code" href="../../d1/d4/struct__NPAGED__LOOKASIDE__LIST.html#o0">L</a>;
<a name="l00756"></a><a class="code" href="../../d1/d4/struct__NPAGED__LOOKASIDE__LIST.html#o1">00756</a>     KSPIN_LOCK <a class="code" href="../../d1/d4/struct__NPAGED__LOOKASIDE__LIST.html#o1">Lock</a>;
00757 } <a class="code" href="../../d1/d4/struct__NPAGED__LOOKASIDE__LIST.html">NPAGED_LOOKASIDE_LIST</a>, *<a class="code" href="../../d1/d4/struct__NPAGED__LOOKASIDE__LIST.html">PNPAGED_LOOKASIDE_LIST</a>;
00758 
00759 
00760 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
00761 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00762 <a class="code" href="../../d5/d8/ex_8h.html#a246">ExInitializeNPagedLookasideList</a> (
00763     IN PNPAGED_LOOKASIDE_LIST Lookaside,
00764     IN <a class="code" href="../../d5/d8/ex_8h.html#a100">PALLOCATE_FUNCTION</a> Allocate,
00765     IN <a class="code" href="../../d5/d8/ex_8h.html#a101">PFREE_FUNCTION</a> Free,
00766     IN ULONG Flags,
00767     IN SIZE_T Size,
00768     IN ULONG Tag,
00769     IN USHORT Depth
00770     );
00771 
00772 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
00773 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00774 <a class="code" href="../../d5/d8/ex_8h.html#a247">ExDeleteNPagedLookasideList</a> (
00775     IN PNPAGED_LOOKASIDE_LIST Lookaside
00776     );
00777 
00778 __inline
00779 PVOID
<a name="l00780"></a><a class="code" href="../../d5/d8/ex_8h.html#a248">00780</a> <a class="code" href="../../d5/d8/ex_8h.html#a248">ExAllocateFromNPagedLookasideList</a>(
00781     IN PNPAGED_LOOKASIDE_LIST Lookaside
00782     )
00783 
00784 <span class="comment">/*++</span>
00785 <span class="comment"></span>
00786 <span class="comment">Routine Description:</span>
00787 <span class="comment"></span>
00788 <span class="comment">    This function removes (pops) the first entry from the specified</span>
00789 <span class="comment">    nonpaged lookaside list.</span>
00790 <span class="comment"></span>
00791 <span class="comment">Arguments:</span>
00792 <span class="comment"></span>
00793 <span class="comment">    Lookaside - Supplies a pointer to a nonpaged lookaside list structure.</span>
00794 <span class="comment"></span>
00795 <span class="comment">Return Value:</span>
00796 <span class="comment"></span>
00797 <span class="comment">    If an entry is removed from the specified lookaside list, then the</span>
00798 <span class="comment">    address of the entry is returned as the function value. Otherwise,</span>
00799 <span class="comment">    NULL is returned.</span>
00800 <span class="comment"></span>
00801 <span class="comment">--*/</span>
00802 
00803 {
00804 
00805     PVOID Entry;
00806 
00807     Lookaside-&gt;L.TotalAllocates += 1;
00808     Entry = <a class="code" href="../../d5/d8/ex_8h.html#a242">ExInterlockedPopEntrySList</a>(&amp;Lookaside-&gt;L.ListHead, &amp;Lookaside-&gt;Lock);
00809     <span class="keywordflow">if</span> (Entry == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00810         Lookaside-&gt;L.AllocateMisses += 1;
00811         Entry = (Lookaside-&gt;L.Allocate)(Lookaside-&gt;L.Type,
00812                                         Lookaside-&gt;L.Size,
00813                                         Lookaside-&gt;L.Tag);
00814     }
00815 
00816     <span class="keywordflow">return</span> Entry;
00817 }
00818 
00819 __inline
00820 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00821"></a><a class="code" href="../../d5/d8/ex_8h.html#a249">00821</a> <a class="code" href="../../d5/d8/ex_8h.html#a249">ExFreeToNPagedLookasideList</a>(
00822     IN PNPAGED_LOOKASIDE_LIST Lookaside,
00823     IN PVOID Entry
00824     )
00825 
00826 <span class="comment">/*++</span>
00827 <span class="comment"></span>
00828 <span class="comment">Routine Description:</span>
00829 <span class="comment"></span>
00830 <span class="comment">    This function inserts (pushes) the specified entry into the specified</span>
00831 <span class="comment">    nonpaged lookaside list.</span>
00832 <span class="comment"></span>
00833 <span class="comment">Arguments:</span>
00834 <span class="comment"></span>
00835 <span class="comment">    Lookaside - Supplies a pointer to a nonpaged lookaside list structure.</span>
00836 <span class="comment"></span>
00837 <span class="comment">    Entry - Supples a pointer to the entry that is inserted in the</span>
00838 <span class="comment">        lookaside list.</span>
00839 <span class="comment"></span>
00840 <span class="comment">Return Value:</span>
00841 <span class="comment"></span>
00842 <span class="comment">    None.</span>
00843 <span class="comment"></span>
00844 <span class="comment">--*/</span>
00845 
00846 {
00847 
00848     Lookaside-&gt;L.TotalFrees += 1;
00849     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d8/ex_8h.html#a10">ExQueryDepthSList</a>(&amp;Lookaside-&gt;L.ListHead) &gt;= Lookaside-&gt;L.Depth) {
00850         Lookaside-&gt;L.FreeMisses += 1;
00851         (Lookaside-&gt;L.Free)(Entry);
00852 
00853     } <span class="keywordflow">else</span> {
00854         <a class="code" href="../../d5/d8/ex_8h.html#a243">ExInterlockedPushEntrySList</a>(&amp;Lookaside-&gt;L.ListHead,
00855                                     (PSINGLE_LIST_ENTRY)Entry,
00856                                     &amp;Lookaside-&gt;Lock);
00857     }
00858 
00859     <span class="keywordflow">return</span>;
00860 }
00861 
00862 <span class="comment">// end_ntndis</span>
00863 
<a name="l00864"></a><a class="code" href="../../d1/d8/struct__PAGED__LOOKASIDE__LIST.html">00864</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d1/d8/struct__PAGED__LOOKASIDE__LIST.html">_PAGED_LOOKASIDE_LIST</a> {
<a name="l00865"></a><a class="code" href="../../d1/d8/struct__PAGED__LOOKASIDE__LIST.html#o0">00865</a>     <a class="code" href="../../d6/d1/struct__GENERAL__LOOKASIDE.html">GENERAL_LOOKASIDE</a> <a class="code" href="../../d1/d8/struct__PAGED__LOOKASIDE__LIST.html#o0">L</a>;
<a name="l00866"></a><a class="code" href="../../d1/d8/struct__PAGED__LOOKASIDE__LIST.html#o1">00866</a>     <a class="code" href="../../d6/d9/struct__FAST__MUTEX.html">FAST_MUTEX</a> <a class="code" href="../../d1/d8/struct__PAGED__LOOKASIDE__LIST.html#o1">Lock</a>;
00867 } <a class="code" href="../../d1/d8/struct__PAGED__LOOKASIDE__LIST.html">PAGED_LOOKASIDE_LIST</a>, *<a class="code" href="../../d1/d8/struct__PAGED__LOOKASIDE__LIST.html">PPAGED_LOOKASIDE_LIST</a>;
00868 
00869 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
00870 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00871 <a class="code" href="../../d5/d8/ex_8h.html#a250">ExInitializePagedLookasideList</a> (
00872     IN PPAGED_LOOKASIDE_LIST Lookaside,
00873     IN PALLOCATE_FUNCTION Allocate,
00874     IN PFREE_FUNCTION Free,
00875     IN ULONG Flags,
00876     IN SIZE_T Size,
00877     IN ULONG Tag,
00878     IN USHORT Depth
00879     );
00880 
00881 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
00882 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00883 <a class="code" href="../../d5/d8/ex_8h.html#a251">ExDeletePagedLookasideList</a> (
00884     IN PPAGED_LOOKASIDE_LIST Lookaside
00885     );
00886 
00887 <span class="preprocessor">#if defined(_X86_)</span>
00888 <span class="preprocessor"></span>
00889 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
00890 PVOID
00891 <a class="code" href="../../d5/d8/ex_8h.html#a252">ExAllocateFromPagedLookasideList</a>(
00892     IN PPAGED_LOOKASIDE_LIST Lookaside
00893     );
00894 
00895 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
00896 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00897 <a class="code" href="../../d5/d8/ex_8h.html#a253">ExFreeToPagedLookasideList</a>(
00898     IN PPAGED_LOOKASIDE_LIST Lookaside,
00899     IN PVOID Entry
00900     );
00901 
00902 <span class="preprocessor">#else</span>
00903 <span class="preprocessor"></span>
00904 __inline
00905 PVOID
<a name="l00906"></a><a class="code" href="../../d5/d8/ex_8h.html#a252">00906</a> <a class="code" href="../../d5/d8/ex_8h.html#a252">ExAllocateFromPagedLookasideList</a>(
00907     IN PPAGED_LOOKASIDE_LIST Lookaside
00908     )
00909 
00910 <span class="comment">/*++</span>
00911 <span class="comment"></span>
00912 <span class="comment">Routine Description:</span>
00913 <span class="comment"></span>
00914 <span class="comment">    This function removes (pops) the first entry from the specified</span>
00915 <span class="comment">    paged lookaside list.</span>
00916 <span class="comment"></span>
00917 <span class="comment">Arguments:</span>
00918 <span class="comment"></span>
00919 <span class="comment">    Lookaside - Supplies a pointer to a paged lookaside list structure.</span>
00920 <span class="comment"></span>
00921 <span class="comment">Return Value:</span>
00922 <span class="comment"></span>
00923 <span class="comment">    If an entry is removed from the specified lookaside list, then the</span>
00924 <span class="comment">    address of the entry is returned as the function value. Otherwise,</span>
00925 <span class="comment">    NULL is returned.</span>
00926 <span class="comment"></span>
00927 <span class="comment">--*/</span>
00928 
00929 {
00930 
00931     PVOID Entry;
00932 
00933     Lookaside-&gt;L.TotalAllocates += 1;
00934     Entry = <a class="code" href="../../d5/d8/ex_8h.html#a242">ExInterlockedPopEntrySList</a>(&amp;Lookaside-&gt;L.ListHead, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00935     <span class="keywordflow">if</span> (Entry == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00936         Lookaside-&gt;L.AllocateMisses += 1;
00937         Entry = (Lookaside-&gt;L.Allocate)(Lookaside-&gt;L.Type,
00938                                         Lookaside-&gt;L.Size,
00939                                         Lookaside-&gt;L.Tag);
00940     }
00941 
00942     <span class="keywordflow">return</span> Entry;
00943 }
00944 
00945 __inline
00946 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00947"></a><a class="code" href="../../d5/d8/ex_8h.html#a253">00947</a> <a class="code" href="../../d5/d8/ex_8h.html#a253">ExFreeToPagedLookasideList</a>(
00948     IN PPAGED_LOOKASIDE_LIST Lookaside,
00949     IN PVOID Entry
00950     )
00951 
00952 <span class="comment">/*++</span>
00953 <span class="comment"></span>
00954 <span class="comment">Routine Description:</span>
00955 <span class="comment"></span>
00956 <span class="comment">    This function inserts (pushes) the specified entry into the specified</span>
00957 <span class="comment">    paged lookaside list.</span>
00958 <span class="comment"></span>
00959 <span class="comment">Arguments:</span>
00960 <span class="comment"></span>
00961 <span class="comment">    Lookaside - Supplies a pointer to a nonpaged lookaside list structure.</span>
00962 <span class="comment"></span>
00963 <span class="comment">    Entry - Supples a pointer to the entry that is inserted in the</span>
00964 <span class="comment">        lookaside list.</span>
00965 <span class="comment"></span>
00966 <span class="comment">Return Value:</span>
00967 <span class="comment"></span>
00968 <span class="comment">    None.</span>
00969 <span class="comment"></span>
00970 <span class="comment">--*/</span>
00971 
00972 {
00973 
00974     Lookaside-&gt;L.TotalFrees += 1;
00975     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d8/ex_8h.html#a10">ExQueryDepthSList</a>(&amp;Lookaside-&gt;L.ListHead) &gt;= Lookaside-&gt;L.Depth) {
00976         Lookaside-&gt;L.FreeMisses += 1;
00977         (Lookaside-&gt;L.Free)(Entry);
00978 
00979     } <span class="keywordflow">else</span> {
00980         <a class="code" href="../../d5/d8/ex_8h.html#a243">ExInterlockedPushEntrySList</a>(&amp;Lookaside-&gt;L.ListHead,
00981                                     (PSINGLE_LIST_ENTRY)Entry,
00982                                     <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00983     }
00984 
00985     <span class="keywordflow">return</span>;
00986 }
00987 
00988 <span class="preprocessor">#endif</span>
00989 <span class="preprocessor"></span>
00990 <span class="comment">// end_ntddk end_nthal end_ntifs end_wdm</span>
00991 
00992 <span class="comment">//</span>
00993 <span class="comment">// Define per processor nonpage lookaside list structures.</span>
00994 <span class="comment">//</span>
00995 
<a name="l00996"></a><a class="code" href="../../d5/d8/ex_8h.html#a331">00996</a> <span class="keyword">typedef</span> <span class="keyword">enum</span> <a class="code" href="../../d5/d8/ex_8h.html#a331">_PP_NPAGED_LOOKASIDE_NUMBER</a> {
00997     <a class="code" href="../../d5/d8/ex_8h.html#a331a197">LookasideSmallIrpList</a>,
00998     <a class="code" href="../../d5/d8/ex_8h.html#a331a198">LookasideLargeIrpList</a>,
00999     <a class="code" href="../../d5/d8/ex_8h.html#a331a199">LookasideMdlList</a>,
01000     <a class="code" href="../../d5/d8/ex_8h.html#a331a200">LookasideCreateInfoList</a>,
01001     <a class="code" href="../../d5/d8/ex_8h.html#a331a201">LookasideNameBufferList</a>,
01002     <a class="code" href="../../d5/d8/ex_8h.html#a331a202">LookasideTwilightList</a>,
01003     <a class="code" href="../../d5/d8/ex_8h.html#a331a203">LookasideCompletionList</a>,
01004     <a class="code" href="../../d5/d8/ex_8h.html#a331a204">LookasideMaximumList</a>
01005 } <a class="code" href="../../d5/d8/ex_8h.html#a108">PP_NPAGED_LOOKASIDE_NUMBER</a>, *<a class="code" href="../../d5/d8/ex_8h.html#a109">PPP_NPAGED_LOOKASIDE_NUMBER</a>;
01006 
01007 <span class="preprocessor">#if !defined(_CROSS_PLATFORM_)</span>
01008 <span class="preprocessor"></span>
01009 __inline
01010 PVOID
<a name="l01011"></a><a class="code" href="../../d5/d8/ex_8h.html#a254">01011</a> <a class="code" href="../../d5/d8/ex_8h.html#a254">ExAllocateFromPPNPagedLookasideList</a>(
01012     IN PP_NPAGED_LOOKASIDE_NUMBER Number
01013     )
01014 
01015 <span class="comment">/*++</span>
01016 <span class="comment"></span>
01017 <span class="comment">Routine Description:</span>
01018 <span class="comment"></span>
01019 <span class="comment">    This function removes (pops) the first entry from the specified</span>
01020 <span class="comment">    nonpaged per processor lookaside list.</span>
01021 <span class="comment"></span>
01022 <span class="comment">Arguments:</span>
01023 <span class="comment"></span>
01024 <span class="comment">    Number - Supplies the per processor nonpaged lookaside list number.</span>
01025 <span class="comment"></span>
01026 <span class="comment">Return Value:</span>
01027 <span class="comment"></span>
01028 <span class="comment">    If an entry is removed from the specified lookaside list, then the</span>
01029 <span class="comment">    address of the entry is returned as the function value. Otherwise,</span>
01030 <span class="comment">    NULL is returned.</span>
01031 <span class="comment"></span>
01032 <span class="comment">--*/</span>
01033 
01034 {
01035 
01036     PVOID Entry;
01037     <a class="code" href="../../d5/d8/ex_8h.html#a105">PNPAGED_LOOKASIDE_LIST</a> Lookaside;
01038     PKPRCB Prcb;
01039 
01040     <span class="comment">//</span>
01041     <span class="comment">// Get address of current processor block.</span>
01042     <span class="comment">//</span>
01043     <span class="comment">// N.B. It is possible to context switch during the allocation from a</span>
01044     <span class="comment">//      per processor nonpaged lookaside list, but this should happen</span>
01045     <span class="comment">//      infrequently and should not aversely effect the benefits of</span>
01046     <span class="comment">//      per processor lookaside lists.</span>
01047     <span class="comment">//</span>
01048 
01049     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>((Number &gt;= 0) &amp;&amp; (Number &lt; <a class="code" href="../../d5/d8/ex_8h.html#a331a204">LookasideMaximumList</a>));
01050 
01051     Prcb = <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a2">KeGetCurrentPrcb</a>();
01052 
01053     <span class="comment">//</span>
01054     <span class="comment">// Attempt to allocate from the per processor lookaside list.</span>
01055     <span class="comment">//</span>
01056 
01057     Lookaside = Prcb-&gt;PPLookasideList[Number].P;
01058     Lookaside-&gt;<a class="code" href="../../d1/d4/struct__NPAGED__LOOKASIDE__LIST.html#o0">L</a>.<a class="code" href="../../d6/d1/struct__GENERAL__LOOKASIDE.html#o3">TotalAllocates</a> += 1;
01059     Entry = <a class="code" href="../../d5/d8/ex_8h.html#a242">ExInterlockedPopEntrySList</a>(&amp;Lookaside-&gt;<a class="code" href="../../d1/d4/struct__NPAGED__LOOKASIDE__LIST.html#o0">L</a>.<a class="code" href="../../d6/d1/struct__GENERAL__LOOKASIDE.html#o0">ListHead</a>, &amp;Lookaside-&gt;<a class="code" href="../../d1/d4/struct__NPAGED__LOOKASIDE__LIST.html#o1">Lock</a>);
01060 
01061     <span class="comment">//</span>
01062     <span class="comment">// If the per processor allocation attempt failed, then attempt to</span>
01063     <span class="comment">// allocate from the system lookaside list.</span>
01064     <span class="comment">//</span>
01065 
01066     <span class="keywordflow">if</span> (Entry == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01067         Lookaside-&gt;<a class="code" href="../../d1/d4/struct__NPAGED__LOOKASIDE__LIST.html#o0">L</a>.<a class="code" href="../../d6/d1/struct__GENERAL__LOOKASIDE.html#o4">AllocateMisses</a> += 1;
01068         Lookaside = Prcb-&gt;PPLookasideList[Number].<a class="code" href="../../d1/d4/struct__NPAGED__LOOKASIDE__LIST.html#o0">L</a>;
01069         Entry = <a class="code" href="../../d5/d8/ex_8h.html#a248">ExAllocateFromNPagedLookasideList</a>(Lookaside);
01070     }
01071 
01072     <span class="keywordflow">return</span> Entry;
01073 }
01074 
01075 __inline
01076 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l01077"></a><a class="code" href="../../d5/d8/ex_8h.html#a255">01077</a> <a class="code" href="../../d5/d8/ex_8h.html#a255">ExFreeToPPNPagedLookasideList</a>(
01078     IN PP_NPAGED_LOOKASIDE_NUMBER Number,
01079     IN PVOID Entry
01080     )
01081 
01082 <span class="comment">/*++</span>
01083 <span class="comment"></span>
01084 <span class="comment">Routine Description:</span>
01085 <span class="comment"></span>
01086 <span class="comment">    This function inserts (pushes) the specified entry into the specified</span>
01087 <span class="comment">    nonpaged per processor lookaside list.</span>
01088 <span class="comment"></span>
01089 <span class="comment">Arguments:</span>
01090 <span class="comment"></span>
01091 <span class="comment">    Number - Supplies the per processor nonpaged lookaside list number.</span>
01092 <span class="comment"></span>
01093 <span class="comment">    Entry - Supples a pointer to the entry that is inserted in the nonpaged</span>
01094 <span class="comment">        per processor lookaside list.</span>
01095 <span class="comment"></span>
01096 <span class="comment">Return Value:</span>
01097 <span class="comment"></span>
01098 <span class="comment">    None.</span>
01099 <span class="comment"></span>
01100 <span class="comment">--*/</span>
01101 
01102 {
01103 
01104     <a class="code" href="../../d5/d8/ex_8h.html#a105">PNPAGED_LOOKASIDE_LIST</a> Lookaside;
01105     PKPRCB Prcb;
01106 
01107     <span class="comment">//</span>
01108     <span class="comment">// Get address of current processor block.</span>
01109     <span class="comment">//</span>
01110     <span class="comment">// N.B. It is possible to context switch during the free to a per</span>
01111     <span class="comment">//      processor nonpaged lookaside list, but this should happen</span>
01112     <span class="comment">//      infrequently and should not aversely effect the benefits of</span>
01113     <span class="comment">//      per processor lookaside lists.</span>
01114     <span class="comment">//</span>
01115 
01116     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>((Number &gt;= 0) &amp;&amp; (Number &lt; <a class="code" href="../../d5/d8/ex_8h.html#a331a204">LookasideMaximumList</a>));
01117 
01118     Prcb = <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a2">KeGetCurrentPrcb</a>();
01119 
01120     <span class="comment">//</span>
01121     <span class="comment">// If the current depth is less than of equal to the maximum depth, then</span>
01122     <span class="comment">// free the specified entry to the per processor lookaside list. Otherwise,</span>
01123     <span class="comment">// free the entry to the system lookaside list;</span>
01124     <span class="comment">//</span>
01125     <span class="comment">//</span>
01126 
01127     Lookaside = Prcb-&gt;PPLookasideList[Number].P;
01128     Lookaside-&gt;<a class="code" href="../../d1/d4/struct__NPAGED__LOOKASIDE__LIST.html#o0">L</a>.<a class="code" href="../../d6/d1/struct__GENERAL__LOOKASIDE.html#o6">TotalFrees</a> += 1;
01129     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d8/ex_8h.html#a10">ExQueryDepthSList</a>(&amp;Lookaside-&gt;<a class="code" href="../../d1/d4/struct__NPAGED__LOOKASIDE__LIST.html#o0">L</a>.<a class="code" href="../../d6/d1/struct__GENERAL__LOOKASIDE.html#o0">ListHead</a>) &gt;= Lookaside-&gt;<a class="code" href="../../d1/d4/struct__NPAGED__LOOKASIDE__LIST.html#o0">L</a>.<a class="code" href="../../d6/d1/struct__GENERAL__LOOKASIDE.html#o1">Depth</a>) {
01130         Lookaside-&gt;<a class="code" href="../../d1/d4/struct__NPAGED__LOOKASIDE__LIST.html#o0">L</a>.<a class="code" href="../../d6/d1/struct__GENERAL__LOOKASIDE.html#o7">FreeMisses</a> += 1;
01131         Lookaside = Prcb-&gt;PPLookasideList[Number].<a class="code" href="../../d1/d4/struct__NPAGED__LOOKASIDE__LIST.html#o0">L</a>;
01132         <a class="code" href="../../d5/d8/ex_8h.html#a249">ExFreeToNPagedLookasideList</a>(Lookaside, Entry);
01133 
01134     } <span class="keywordflow">else</span> {
01135         <a class="code" href="../../d5/d8/ex_8h.html#a243">ExInterlockedPushEntrySList</a>(&amp;Lookaside-&gt;<a class="code" href="../../d1/d4/struct__NPAGED__LOOKASIDE__LIST.html#o0">L</a>.<a class="code" href="../../d6/d1/struct__GENERAL__LOOKASIDE.html#o0">ListHead</a>,
01136                                     (PSINGLE_LIST_ENTRY)Entry,
01137                                     &amp;Lookaside-&gt;<a class="code" href="../../d1/d4/struct__NPAGED__LOOKASIDE__LIST.html#o1">Lock</a>);
01138     }
01139 
01140     <span class="keywordflow">return</span>;
01141 }
01142 
01143 <span class="preprocessor">#endif</span>
01144 <span class="preprocessor"></span>
01145 <span class="preprocessor">#if i386 &amp;&amp; !FPO</span>
01146 <span class="preprocessor"></span>
01147 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
01148 ExQuerySystemBackTraceInformation(
01149     OUT PRTL_PROCESS_BACKTRACES BackTraceInformation,
01150     IN ULONG BackTraceInformationLength,
01151     OUT PULONG ReturnLength OPTIONAL
01152     );
01153 
01154 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
01155 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>
01156 ExGetPoolBackTraceIndex(
01157     IN PVOID P
01158     );
01159 
01160 <span class="preprocessor">#endif // i386 &amp;&amp; !FPO</span>
01161 <span class="preprocessor"></span>
01162 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
01163 PVOID
01164 <a class="code" href="../../d5/d8/ex_8h.html#a256">ExLockUserBuffer</a>(
01165     IN PVOID Buffer,
01166     IN ULONG Length,
01167     OUT PVOID *LockVariable
01168     );
01169 
01170 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
01171 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
01172 <a class="code" href="../../d5/d8/ex_8h.html#a257">ExUnlockUserBuffer</a>(
01173     IN PVOID LockVariable
01174     );
01175 
01176 
01177 
01178 <span class="comment">// begin_ntddk begin_wdm begin_ntifs</span>
01179 
01180 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
01181 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
01182 NTAPI
01183 <a class="code" href="../../d5/d8/ex_8h.html#a11">ProbeForRead</a>(
01184     IN CONST VOID *Address,
01185     IN ULONG Length,
01186     IN ULONG Alignment
01187     );
01188 
01189 <span class="comment">// end_ntddk end_wdm end_ntifs</span>
01190 
01191 <span class="preprocessor">#if !defined(_NTHAL_) &amp;&amp; !defined(_NTDDK_) &amp;&amp; !defined(_NTIFS_)</span>
01192 <span class="preprocessor"></span>
01193 <span class="comment">//</span>
01194 <span class="comment">// Probe function definitions</span>
01195 <span class="comment">//</span>
01196 <span class="comment">// Probe for read functions.</span>
01197 <span class="comment">//</span>
01198 <span class="comment">//++</span>
01199 <span class="comment">//</span>
01200 <span class="comment">// VOID</span>
01201 <span class="comment">// ProbeForRead(</span>
01202 <span class="comment">//     IN PVOID Address,</span>
01203 <span class="comment">//     IN ULONG Length,</span>
01204 <span class="comment">//     IN ULONG Alignment</span>
01205 <span class="comment">//     )</span>
01206 <span class="comment">//</span>
01207 <span class="comment">//--</span>
01208 
<a name="l01209"></a><a class="code" href="../../d5/d8/ex_8h.html#a11">01209</a> <span class="preprocessor">#define ProbeForRead(Address, Length, Alignment)                             \</span>
01210 <span class="preprocessor">    ASSERT(((Alignment) == 1) || ((Alignment) == 2) ||                       \</span>
01211 <span class="preprocessor">           ((Alignment) == 4) || ((Alignment) == 8) ||                       \</span>
01212 <span class="preprocessor">           ((Alignment) == 16));                                             \</span>
01213 <span class="preprocessor">                                                                             \</span>
01214 <span class="preprocessor">    if ((Length) != 0) {                                                     \</span>
01215 <span class="preprocessor">        if (((ULONG_PTR)(Address) &amp; ((Alignment) - 1)) != 0) {                   \</span>
01216 <span class="preprocessor">            ExRaiseDatatypeMisalignment();                                   \</span>
01217 <span class="preprocessor">                                                                             \</span>
01218 <span class="preprocessor">        } else if ((((ULONG_PTR)(Address) + (Length)) &lt; (ULONG_PTR)(Address)) ||                                  \</span>
01219 <span class="preprocessor">                   (((ULONG_PTR)(Address) + (Length)) &gt; (ULONG_PTR)MM_USER_PROBE_ADDRESS)) { \</span>
01220 <span class="preprocessor">            ExRaiseAccessViolation();                                        \</span>
01221 <span class="preprocessor">        }                                                                    \</span>
01222 <span class="preprocessor">    }</span>
01223 <span class="preprocessor"></span>
01224 <span class="preprocessor">#endif</span>
01225 <span class="preprocessor"></span>
01226 <span class="comment">//++</span>
01227 <span class="comment">//</span>
01228 <span class="comment">// BOOLEAN</span>
01229 <span class="comment">// ProbeAndReadBoolean(</span>
01230 <span class="comment">//     IN PBOOLEAN Address</span>
01231 <span class="comment">//     )</span>
01232 <span class="comment">//</span>
01233 <span class="comment">//--</span>
01234 
<a name="l01235"></a><a class="code" href="../../d5/d8/ex_8h.html#a12">01235</a> <span class="preprocessor">#define ProbeAndReadBoolean(Address) \</span>
01236 <span class="preprocessor">    (((Address) &gt;= (BOOLEAN * const)MM_USER_PROBE_ADDRESS) ? \</span>
01237 <span class="preprocessor">        (*(volatile BOOLEAN * const)MM_USER_PROBE_ADDRESS) : (*(volatile BOOLEAN *)(Address)))</span>
01238 <span class="preprocessor"></span>
01239 <span class="comment">//++</span>
01240 <span class="comment">//</span>
01241 <span class="comment">// CHAR</span>
01242 <span class="comment">// ProbeAndReadChar(</span>
01243 <span class="comment">//     IN PCHAR Address</span>
01244 <span class="comment">//     )</span>
01245 <span class="comment">//</span>
01246 <span class="comment">//--</span>
01247 
<a name="l01248"></a><a class="code" href="../../d5/d8/ex_8h.html#a13">01248</a> <span class="preprocessor">#define ProbeAndReadChar(Address) \</span>
01249 <span class="preprocessor">    (((Address) &gt;= (CHAR * const)MM_USER_PROBE_ADDRESS) ? \</span>
01250 <span class="preprocessor">        (*(volatile CHAR * const)MM_USER_PROBE_ADDRESS) : (*(volatile CHAR *)(Address)))</span>
01251 <span class="preprocessor"></span>
01252 <span class="comment">//++</span>
01253 <span class="comment">//</span>
01254 <span class="comment">// UCHAR</span>
01255 <span class="comment">// ProbeAndReadUchar(</span>
01256 <span class="comment">//     IN PUCHAR Address</span>
01257 <span class="comment">//     )</span>
01258 <span class="comment">//</span>
01259 <span class="comment">//--</span>
01260 
<a name="l01261"></a><a class="code" href="../../d5/d8/ex_8h.html#a14">01261</a> <span class="preprocessor">#define ProbeAndReadUchar(Address) \</span>
01262 <span class="preprocessor">    (((Address) &gt;= (UCHAR * const)MM_USER_PROBE_ADDRESS) ? \</span>
01263 <span class="preprocessor">        (*(volatile UCHAR * const)MM_USER_PROBE_ADDRESS) : (*(volatile UCHAR *)(Address)))</span>
01264 <span class="preprocessor"></span>
01265 <span class="comment">//++</span>
01266 <span class="comment">//</span>
01267 <span class="comment">// SHORT</span>
01268 <span class="comment">// ProbeAndReadShort(</span>
01269 <span class="comment">//     IN PSHORT Address</span>
01270 <span class="comment">//     )</span>
01271 <span class="comment">//</span>
01272 <span class="comment">//--</span>
01273 
<a name="l01274"></a><a class="code" href="../../d5/d8/ex_8h.html#a15">01274</a> <span class="preprocessor">#define ProbeAndReadShort(Address) \</span>
01275 <span class="preprocessor">    (((Address) &gt;= (SHORT * const)MM_USER_PROBE_ADDRESS) ? \</span>
01276 <span class="preprocessor">        (*(volatile SHORT * const)MM_USER_PROBE_ADDRESS) : (*(volatile SHORT *)(Address)))</span>
01277 <span class="preprocessor"></span>
01278 <span class="comment">//++</span>
01279 <span class="comment">//</span>
01280 <span class="comment">// USHORT</span>
01281 <span class="comment">// ProbeAndReadUshort(</span>
01282 <span class="comment">//     IN PUSHORT Address</span>
01283 <span class="comment">//     )</span>
01284 <span class="comment">//</span>
01285 <span class="comment">//--</span>
01286 
<a name="l01287"></a><a class="code" href="../../d5/d8/ex_8h.html#a16">01287</a> <span class="preprocessor">#define ProbeAndReadUshort(Address) \</span>
01288 <span class="preprocessor">    (((Address) &gt;= (USHORT * const)MM_USER_PROBE_ADDRESS) ? \</span>
01289 <span class="preprocessor">        (*(volatile USHORT * const)MM_USER_PROBE_ADDRESS) : (*(volatile USHORT *)(Address)))</span>
01290 <span class="preprocessor"></span>
01291 <span class="comment">//++</span>
01292 <span class="comment">//</span>
01293 <span class="comment">// HANDLE</span>
01294 <span class="comment">// ProbeAndReadHandle(</span>
01295 <span class="comment">//     IN PHANDLE Address</span>
01296 <span class="comment">//     )</span>
01297 <span class="comment">//</span>
01298 <span class="comment">//--</span>
01299 
<a name="l01300"></a><a class="code" href="../../d5/d8/ex_8h.html#a17">01300</a> <span class="preprocessor">#define ProbeAndReadHandle(Address) \</span>
01301 <span class="preprocessor">    (((Address) &gt;= (HANDLE * const)MM_USER_PROBE_ADDRESS) ? \</span>
01302 <span class="preprocessor">        (*(volatile HANDLE * const)MM_USER_PROBE_ADDRESS) : (*(volatile HANDLE *)(Address)))</span>
01303 <span class="preprocessor"></span>
01304 <span class="comment">//++</span>
01305 <span class="comment">//</span>
01306 <span class="comment">// PVOID</span>
01307 <span class="comment">// ProbeAndReadPointer(</span>
01308 <span class="comment">//     IN PVOID *Address</span>
01309 <span class="comment">//     )</span>
01310 <span class="comment">//</span>
01311 <span class="comment">//--</span>
01312 
<a name="l01313"></a><a class="code" href="../../d5/d8/ex_8h.html#a18">01313</a> <span class="preprocessor">#define ProbeAndReadPointer(Address) \</span>
01314 <span class="preprocessor">    (((Address) &gt;= (PVOID * const)MM_USER_PROBE_ADDRESS) ? \</span>
01315 <span class="preprocessor">        (*(volatile PVOID * const)MM_USER_PROBE_ADDRESS) : (*(volatile PVOID *)(Address)))</span>
01316 <span class="preprocessor"></span>
01317 <span class="comment">//++</span>
01318 <span class="comment">//</span>
01319 <span class="comment">// LONG</span>
01320 <span class="comment">// ProbeAndReadLong(</span>
01321 <span class="comment">//     IN PLONG Address</span>
01322 <span class="comment">//     )</span>
01323 <span class="comment">//</span>
01324 <span class="comment">//--</span>
01325 
<a name="l01326"></a><a class="code" href="../../d5/d8/ex_8h.html#a19">01326</a> <span class="preprocessor">#define ProbeAndReadLong(Address) \</span>
01327 <span class="preprocessor">    (((Address) &gt;= (LONG * const)MM_USER_PROBE_ADDRESS) ? \</span>
01328 <span class="preprocessor">        (*(volatile LONG * const)MM_USER_PROBE_ADDRESS) : (*(volatile LONG *)(Address)))</span>
01329 <span class="preprocessor"></span>
01330 <span class="comment">//++</span>
01331 <span class="comment">//</span>
01332 <span class="comment">// ULONG</span>
01333 <span class="comment">// ProbeAndReadUlong(</span>
01334 <span class="comment">//     IN PULONG Address</span>
01335 <span class="comment">//     )</span>
01336 <span class="comment">//</span>
01337 <span class="comment">//--</span>
01338 
<a name="l01339"></a><a class="code" href="../../d5/d8/ex_8h.html#a20">01339</a> <span class="preprocessor">#define ProbeAndReadUlong(Address) \</span>
01340 <span class="preprocessor">    (((Address) &gt;= (ULONG * const)MM_USER_PROBE_ADDRESS) ? \</span>
01341 <span class="preprocessor">        (*(volatile ULONG * const)MM_USER_PROBE_ADDRESS) : (*(volatile ULONG *)(Address)))</span>
01342 <span class="preprocessor"></span>
01343 <span class="comment">//++</span>
01344 <span class="comment">//</span>
01345 <span class="comment">// ULONG_PTR</span>
01346 <span class="comment">// ProbeAndReadUlong_ptr(</span>
01347 <span class="comment">//     IN PULONG_PTR Address</span>
01348 <span class="comment">//     )</span>
01349 <span class="comment">//</span>
01350 <span class="comment">//--</span>
01351 
<a name="l01352"></a><a class="code" href="../../d5/d8/ex_8h.html#a21">01352</a> <span class="preprocessor">#define ProbeAndReadUlong_ptr(Address) \</span>
01353 <span class="preprocessor">    (((Address) &gt;= (ULONG_PTR * const)MM_USER_PROBE_ADDRESS) ? \</span>
01354 <span class="preprocessor">        (*(volatile ULONG_PTR * const)MM_USER_PROBE_ADDRESS) : (*(volatile ULONG_PTR *)(Address)))</span>
01355 <span class="preprocessor"></span>
01356 <span class="comment">//++</span>
01357 <span class="comment">//</span>
01358 <span class="comment">// QUAD</span>
01359 <span class="comment">// ProbeAndReadQuad(</span>
01360 <span class="comment">//     IN PQUAD Address</span>
01361 <span class="comment">//     )</span>
01362 <span class="comment">//</span>
01363 <span class="comment">//--</span>
01364 
<a name="l01365"></a><a class="code" href="../../d5/d8/ex_8h.html#a22">01365</a> <span class="preprocessor">#define ProbeAndReadQuad(Address) \</span>
01366 <span class="preprocessor">    (((Address) &gt;= (QUAD * const)MM_USER_PROBE_ADDRESS) ? \</span>
01367 <span class="preprocessor">        (*(volatile QUAD * const)MM_USER_PROBE_ADDRESS) : (*(volatile QUAD *)(Address)))</span>
01368 <span class="preprocessor"></span>
01369 <span class="comment">//++</span>
01370 <span class="comment">//</span>
01371 <span class="comment">// UQUAD</span>
01372 <span class="comment">// ProbeAndReadUquad(</span>
01373 <span class="comment">//     IN PUQUAD Address</span>
01374 <span class="comment">//     )</span>
01375 <span class="comment">//</span>
01376 <span class="comment">//--</span>
01377 
<a name="l01378"></a><a class="code" href="../../d5/d8/ex_8h.html#a23">01378</a> <span class="preprocessor">#define ProbeAndReadUquad(Address) \</span>
01379 <span class="preprocessor">    (((Address) &gt;= (UQUAD * const)MM_USER_PROBE_ADDRESS) ? \</span>
01380 <span class="preprocessor">        (*(volatile UQUAD * const)MM_USER_PROBE_ADDRESS) : (*(volatile UQUAD *)(Address)))</span>
01381 <span class="preprocessor"></span>
01382 <span class="comment">//++</span>
01383 <span class="comment">//</span>
01384 <span class="comment">// LARGE_INTEGER</span>
01385 <span class="comment">// ProbeAndReadLargeInteger(</span>
01386 <span class="comment">//     IN PLARGE_INTEGER Source</span>
01387 <span class="comment">//     )</span>
01388 <span class="comment">//</span>
01389 <span class="comment">//--</span>
01390 
<a name="l01391"></a><a class="code" href="../../d5/d8/ex_8h.html#a24">01391</a> <span class="preprocessor">#define ProbeAndReadLargeInteger(Source)  \</span>
01392 <span class="preprocessor">    (((Source) &gt;= (LARGE_INTEGER * const)MM_USER_PROBE_ADDRESS) ? \</span>
01393 <span class="preprocessor">        (*(volatile LARGE_INTEGER * const)MM_USER_PROBE_ADDRESS) : (*(volatile LARGE_INTEGER *)(Source)))</span>
01394 <span class="preprocessor"></span>
01395 <span class="comment">//++</span>
01396 <span class="comment">//</span>
01397 <span class="comment">// ULARGE_INTEGER</span>
01398 <span class="comment">// ProbeAndReadUlargeInteger(</span>
01399 <span class="comment">//     IN PULARGE_INTEGER Source</span>
01400 <span class="comment">//     )</span>
01401 <span class="comment">//</span>
01402 <span class="comment">//--</span>
01403 
<a name="l01404"></a><a class="code" href="../../d5/d8/ex_8h.html#a25">01404</a> <span class="preprocessor">#define ProbeAndReadUlargeInteger(Source)  \</span>
01405 <span class="preprocessor">    (((Source) &gt;= (ULARGE_INTEGER * const)MM_USER_PROBE_ADDRESS) ? \</span>
01406 <span class="preprocessor">        (*(volatile ULARGE_INTEGER * const)MM_USER_PROBE_ADDRESS) : (*(volatile ULARGE_INTEGER *)(Source)))</span>
01407 <span class="preprocessor"></span>
01408 <span class="comment">//++</span>
01409 <span class="comment">//</span>
01410 <span class="comment">// UNICODE_STRING</span>
01411 <span class="comment">// ProbeAndReadUnicodeString(</span>
01412 <span class="comment">//     IN PUNICODE_STRING Source</span>
01413 <span class="comment">//     )</span>
01414 <span class="comment">//</span>
01415 <span class="comment">//--</span>
01416 
<a name="l01417"></a><a class="code" href="../../d5/d8/ex_8h.html#a26">01417</a> <span class="preprocessor">#define ProbeAndReadUnicodeString(Source)  \</span>
01418 <span class="preprocessor">    (((Source) &gt;= (UNICODE_STRING * const)MM_USER_PROBE_ADDRESS) ? \</span>
01419 <span class="preprocessor">        (*(volatile UNICODE_STRING * const)MM_USER_PROBE_ADDRESS) : (*(volatile UNICODE_STRING *)(Source)))</span>
01420 <span class="preprocessor"></span>
01421 <span class="comment">//++</span>
01422 <span class="comment">//</span>
01423 <span class="comment">// &lt;STRUCTURE&gt;</span>
01424 <span class="comment">// ProbeAndReadStructure(</span>
01425 <span class="comment">//     IN P&lt;STRUCTURE&gt; Source</span>
01426 <span class="comment">//     &lt;STRUCTURE&gt;</span>
01427 <span class="comment">//     )</span>
01428 <span class="comment">//</span>
01429 <span class="comment">//--</span>
01430 
<a name="l01431"></a><a class="code" href="../../d5/d8/ex_8h.html#a27">01431</a> <span class="preprocessor">#define ProbeAndReadStructure(Source,STRUCTURE)  \</span>
01432 <span class="preprocessor">    (((Source) &gt;= (STRUCTURE * const)MM_USER_PROBE_ADDRESS) ? \</span>
01433 <span class="preprocessor">        (*(STRUCTURE * const)MM_USER_PROBE_ADDRESS) : (*(STRUCTURE *)(Source)))</span>
01434 <span class="preprocessor"></span>
01435 <span class="comment">//</span>
01436 <span class="comment">// Probe for write functions definitions.</span>
01437 <span class="comment">//</span>
01438 <span class="comment">//++</span>
01439 <span class="comment">//</span>
01440 <span class="comment">// VOID</span>
01441 <span class="comment">// ProbeForWriteBoolean(</span>
01442 <span class="comment">//     IN PBOOLEAN Address</span>
01443 <span class="comment">//     )</span>
01444 <span class="comment">//</span>
01445 <span class="comment">//--</span>
01446 
<a name="l01447"></a><a class="code" href="../../d5/d8/ex_8h.html#a28">01447</a> <span class="preprocessor">#define ProbeForWriteBoolean(Address) {                                      \</span>
01448 <span class="preprocessor">    if ((Address) &gt;= (BOOLEAN * const)MM_USER_PROBE_ADDRESS) {               \</span>
01449 <span class="preprocessor">        *(volatile BOOLEAN * const)MM_USER_PROBE_ADDRESS = 0;                \</span>
01450 <span class="preprocessor">    }                                                                        \</span>
01451 <span class="preprocessor">                                                                             \</span>
01452 <span class="preprocessor">    *(volatile BOOLEAN *)(Address) = *(volatile BOOLEAN *)(Address);         \</span>
01453 <span class="preprocessor">}</span>
01454 <span class="preprocessor"></span>
01455 <span class="comment">//++</span>
01456 <span class="comment">//</span>
01457 <span class="comment">// VOID</span>
01458 <span class="comment">// ProbeForWriteChar(</span>
01459 <span class="comment">//     IN PCHAR Address</span>
01460 <span class="comment">//     )</span>
01461 <span class="comment">//</span>
01462 <span class="comment">//--</span>
01463 
<a name="l01464"></a><a class="code" href="../../d5/d8/ex_8h.html#a29">01464</a> <span class="preprocessor">#define ProbeForWriteChar(Address) {                                         \</span>
01465 <span class="preprocessor">    if ((Address) &gt;= (CHAR * const)MM_USER_PROBE_ADDRESS) {                  \</span>
01466 <span class="preprocessor">        *(volatile CHAR * const)MM_USER_PROBE_ADDRESS = 0;                   \</span>
01467 <span class="preprocessor">    }                                                                        \</span>
01468 <span class="preprocessor">                                                                             \</span>
01469 <span class="preprocessor">    *(volatile CHAR *)(Address) = *(volatile CHAR *)(Address);               \</span>
01470 <span class="preprocessor">}</span>
01471 <span class="preprocessor"></span>
01472 <span class="comment">//++</span>
01473 <span class="comment">//</span>
01474 <span class="comment">// VOID</span>
01475 <span class="comment">// ProbeForWriteUchar(</span>
01476 <span class="comment">//     IN PUCHAR Address</span>
01477 <span class="comment">//     )</span>
01478 <span class="comment">//</span>
01479 <span class="comment">//--</span>
01480 
<a name="l01481"></a><a class="code" href="../../d5/d8/ex_8h.html#a30">01481</a> <span class="preprocessor">#define ProbeForWriteUchar(Address) {                                        \</span>
01482 <span class="preprocessor">    if ((Address) &gt;= (UCHAR * const)MM_USER_PROBE_ADDRESS) {                 \</span>
01483 <span class="preprocessor">        *(volatile UCHAR * const)MM_USER_PROBE_ADDRESS = 0;                  \</span>
01484 <span class="preprocessor">    }                                                                        \</span>
01485 <span class="preprocessor">                                                                             \</span>
01486 <span class="preprocessor">    *(volatile UCHAR *)(Address) = *(volatile UCHAR *)(Address);             \</span>
01487 <span class="preprocessor">}</span>
01488 <span class="preprocessor"></span>
01489 <span class="comment">//++</span>
01490 <span class="comment">//</span>
01491 <span class="comment">// VOID</span>
01492 <span class="comment">// ProbeForWriteIoStatus(</span>
01493 <span class="comment">//     IN PIO_STATUS_BLOCK Address</span>
01494 <span class="comment">//     )</span>
01495 <span class="comment">//</span>
01496 <span class="comment">//--</span>
01497 
<a name="l01498"></a><a class="code" href="../../d5/d8/ex_8h.html#a31">01498</a> <span class="preprocessor">#define ProbeForWriteIoStatus(Address) {                                     \</span>
01499 <span class="preprocessor">    if ((Address) &gt;= (IO_STATUS_BLOCK * const)MM_USER_PROBE_ADDRESS) {       \</span>
01500 <span class="preprocessor">        *(volatile ULONG * const)MM_USER_PROBE_ADDRESS = 0;                  \</span>
01501 <span class="preprocessor">    }                                                                        \</span>
01502 <span class="preprocessor">                                                                             \</span>
01503 <span class="preprocessor">    *(volatile IO_STATUS_BLOCK *)(Address) = *(volatile IO_STATUS_BLOCK *)(Address); \</span>
01504 <span class="preprocessor">}</span>
01505 <span class="preprocessor"></span>
01506 <span class="preprocessor">#ifdef  _WIN64</span>
01507 <span class="preprocessor"></span><span class="preprocessor">#define ProbeForWriteIoStatusEx(Address, Cookie) {                                          \</span>
01508 <span class="preprocessor">    if ((Address) &gt;= (IO_STATUS_BLOCK * const)MM_USER_PROBE_ADDRESS) {                      \</span>
01509 <span class="preprocessor">        *(volatile ULONG * const)MM_USER_PROBE_ADDRESS = 0;                                 \</span>
01510 <span class="preprocessor">    }                                                                                       \</span>
01511 <span class="preprocessor">    if ((ULONG_PTR)(Cookie) &amp; (ULONG)1) {                                                            \</span>
01512 <span class="preprocessor">        *(volatile IO_STATUS_BLOCK32 *)(Address) = *(volatile IO_STATUS_BLOCK32 *)(Address);\</span>
01513 <span class="preprocessor">    } else {                                                                                \</span>
01514 <span class="preprocessor">        *(volatile IO_STATUS_BLOCK *)(Address) = *(volatile IO_STATUS_BLOCK *)(Address);    \</span>
01515 <span class="preprocessor">    }                                                                                       \</span>
01516 <span class="preprocessor">}</span>
01517 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l01518"></a><a class="code" href="../../d5/d8/ex_8h.html#a32">01518</a> <span class="preprocessor"></span><span class="preprocessor">#define ProbeForWriteIoStatusEx(Address, Cookie)    ProbeForWriteIoStatus(Address)</span>
01519 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
01520 <span class="preprocessor"></span>
01521 <span class="comment">//++</span>
01522 <span class="comment">//</span>
01523 <span class="comment">// VOID</span>
01524 <span class="comment">// ProbeForWriteShort(</span>
01525 <span class="comment">//     IN PSHORT Address</span>
01526 <span class="comment">//     )</span>
01527 <span class="comment">//</span>
01528 <span class="comment">//--</span>
01529 
<a name="l01530"></a><a class="code" href="../../d5/d8/ex_8h.html#a33">01530</a> <span class="preprocessor">#define ProbeForWriteShort(Address) {                                        \</span>
01531 <span class="preprocessor">    if ((Address) &gt;= (SHORT * const)MM_USER_PROBE_ADDRESS) {                 \</span>
01532 <span class="preprocessor">        *(volatile SHORT * const)MM_USER_PROBE_ADDRESS = 0;                  \</span>
01533 <span class="preprocessor">    }                                                                        \</span>
01534 <span class="preprocessor">                                                                             \</span>
01535 <span class="preprocessor">    *(volatile SHORT *)(Address) = *(volatile SHORT *)(Address);             \</span>
01536 <span class="preprocessor">}</span>
01537 <span class="preprocessor"></span>
01538 <span class="comment">//++</span>
01539 <span class="comment">//</span>
01540 <span class="comment">// VOID</span>
01541 <span class="comment">// ProbeForWriteUshort(</span>
01542 <span class="comment">//     IN PUSHORT Address</span>
01543 <span class="comment">//     )</span>
01544 <span class="comment">//</span>
01545 <span class="comment">//--</span>
01546 
<a name="l01547"></a><a class="code" href="../../d5/d8/ex_8h.html#a34">01547</a> <span class="preprocessor">#define ProbeForWriteUshort(Address) {                                       \</span>
01548 <span class="preprocessor">    if ((Address) &gt;= (USHORT * const)MM_USER_PROBE_ADDRESS) {                \</span>
01549 <span class="preprocessor">        *(volatile USHORT * const)MM_USER_PROBE_ADDRESS = 0;                 \</span>
01550 <span class="preprocessor">    }                                                                        \</span>
01551 <span class="preprocessor">                                                                             \</span>
01552 <span class="preprocessor">    *(volatile USHORT *)(Address) = *(volatile USHORT *)(Address);           \</span>
01553 <span class="preprocessor">}</span>
01554 <span class="preprocessor"></span>
01555 <span class="comment">//++</span>
01556 <span class="comment">//</span>
01557 <span class="comment">// VOID</span>
01558 <span class="comment">// ProbeForWriteHandle(</span>
01559 <span class="comment">//     IN PHANDLE Address</span>
01560 <span class="comment">//     )</span>
01561 <span class="comment">//</span>
01562 <span class="comment">//--</span>
01563 
<a name="l01564"></a><a class="code" href="../../d5/d8/ex_8h.html#a35">01564</a> <span class="preprocessor">#define ProbeForWriteHandle(Address) {                                       \</span>
01565 <span class="preprocessor">    if ((Address) &gt;= (HANDLE * const)MM_USER_PROBE_ADDRESS) {                \</span>
01566 <span class="preprocessor">        *(volatile HANDLE * const)MM_USER_PROBE_ADDRESS = 0;                 \</span>
01567 <span class="preprocessor">    }                                                                        \</span>
01568 <span class="preprocessor">                                                                             \</span>
01569 <span class="preprocessor">    *(volatile HANDLE *)(Address) = *(volatile HANDLE *)(Address);           \</span>
01570 <span class="preprocessor">}</span>
01571 <span class="preprocessor"></span>
01572 <span class="comment">//++</span>
01573 <span class="comment">//</span>
01574 <span class="comment">// VOID</span>
01575 <span class="comment">// ProbeAndZeroHandle(</span>
01576 <span class="comment">//     IN PHANDLE Address</span>
01577 <span class="comment">//     )</span>
01578 <span class="comment">//</span>
01579 <span class="comment">//--</span>
01580 
<a name="l01581"></a><a class="code" href="../../d5/d8/ex_8h.html#a36">01581</a> <span class="preprocessor">#define ProbeAndZeroHandle(Address) {                                        \</span>
01582 <span class="preprocessor">    if ((Address) &gt;= (HANDLE * const)MM_USER_PROBE_ADDRESS) {                \</span>
01583 <span class="preprocessor">        *(volatile HANDLE * const)MM_USER_PROBE_ADDRESS = 0;                 \</span>
01584 <span class="preprocessor">    }                                                                        \</span>
01585 <span class="preprocessor">                                                                             \</span>
01586 <span class="preprocessor">    *(volatile HANDLE *)(Address) = 0;                                       \</span>
01587 <span class="preprocessor">}</span>
01588 <span class="preprocessor"></span>
01589 <span class="comment">//++</span>
01590 <span class="comment">//</span>
01591 <span class="comment">// VOID</span>
01592 <span class="comment">// ProbeForWritePointer(</span>
01593 <span class="comment">//     IN PVOID Address</span>
01594 <span class="comment">//     )</span>
01595 <span class="comment">//</span>
01596 <span class="comment">//--</span>
01597 
<a name="l01598"></a><a class="code" href="../../d5/d8/ex_8h.html#a37">01598</a> <span class="preprocessor">#define ProbeForWritePointer(Address) {                                      \</span>
01599 <span class="preprocessor">    if ((PVOID *)(Address) &gt;= (PVOID * const)MM_USER_PROBE_ADDRESS) {        \</span>
01600 <span class="preprocessor">        *(volatile PVOID * const)MM_USER_PROBE_ADDRESS = NULL;               \</span>
01601 <span class="preprocessor">    }                                                                        \</span>
01602 <span class="preprocessor">                                                                             \</span>
01603 <span class="preprocessor">    *(volatile PVOID *)(Address) = *(volatile PVOID *)(Address);             \</span>
01604 <span class="preprocessor">}</span>
01605 <span class="preprocessor"></span>
01606 <span class="comment">//++</span>
01607 <span class="comment">//</span>
01608 <span class="comment">// VOID</span>
01609 <span class="comment">// ProbeAndNullPointer(</span>
01610 <span class="comment">//     IN PVOID *Address</span>
01611 <span class="comment">//     )</span>
01612 <span class="comment">//</span>
01613 <span class="comment">//--</span>
01614 
<a name="l01615"></a><a class="code" href="../../d5/d8/ex_8h.html#a38">01615</a> <span class="preprocessor">#define ProbeAndNullPointer(Address) {                                       \</span>
01616 <span class="preprocessor">    if ((PVOID *)(Address) &gt;= (PVOID * const)MM_USER_PROBE_ADDRESS) {        \</span>
01617 <span class="preprocessor">        *(volatile PVOID * const)MM_USER_PROBE_ADDRESS = NULL;               \</span>
01618 <span class="preprocessor">    }                                                                        \</span>
01619 <span class="preprocessor">                                                                             \</span>
01620 <span class="preprocessor">    *(volatile PVOID *)(Address) = NULL;                                     \</span>
01621 <span class="preprocessor">}</span>
01622 <span class="preprocessor"></span>
01623 <span class="comment">//++</span>
01624 <span class="comment">//</span>
01625 <span class="comment">// VOID</span>
01626 <span class="comment">// ProbeForWriteLong(</span>
01627 <span class="comment">//     IN PLONG Address</span>
01628 <span class="comment">//     )</span>
01629 <span class="comment">//</span>
01630 <span class="comment">//--</span>
01631 
<a name="l01632"></a><a class="code" href="../../d5/d8/ex_8h.html#a39">01632</a> <span class="preprocessor">#define ProbeForWriteLong(Address) {                                        \</span>
01633 <span class="preprocessor">    if ((Address) &gt;= (LONG * const)MM_USER_PROBE_ADDRESS) {                 \</span>
01634 <span class="preprocessor">        *(volatile LONG * const)MM_USER_PROBE_ADDRESS = 0;                  \</span>
01635 <span class="preprocessor">    }                                                                       \</span>
01636 <span class="preprocessor">                                                                            \</span>
01637 <span class="preprocessor">    *(volatile LONG *)(Address) = *(volatile LONG *)(Address);              \</span>
01638 <span class="preprocessor">}</span>
01639 <span class="preprocessor"></span>
01640 <span class="comment">//++</span>
01641 <span class="comment">//</span>
01642 <span class="comment">// VOID</span>
01643 <span class="comment">// ProbeForWriteUlong(</span>
01644 <span class="comment">//     IN PULONG Address</span>
01645 <span class="comment">//     )</span>
01646 <span class="comment">//</span>
01647 <span class="comment">//--</span>
01648 
<a name="l01649"></a><a class="code" href="../../d5/d8/ex_8h.html#a40">01649</a> <span class="preprocessor">#define ProbeForWriteUlong(Address) {                                        \</span>
01650 <span class="preprocessor">    if ((Address) &gt;= (ULONG * const)MM_USER_PROBE_ADDRESS) {                 \</span>
01651 <span class="preprocessor">        *(volatile ULONG * const)MM_USER_PROBE_ADDRESS = 0;                  \</span>
01652 <span class="preprocessor">    }                                                                        \</span>
01653 <span class="preprocessor">                                                                             \</span>
01654 <span class="preprocessor">    *(volatile ULONG *)(Address) = *(volatile ULONG *)(Address);             \</span>
01655 <span class="preprocessor">}</span>
01656 <span class="preprocessor"></span>
01657 <span class="comment">//++</span>
01658 <span class="comment">//</span>
01659 <span class="comment">// VOID</span>
01660 <span class="comment">// ProbeForWriteUlong_ptr(</span>
01661 <span class="comment">//     IN PULONG_PTR Address</span>
01662 <span class="comment">//     )</span>
01663 <span class="comment">//</span>
01664 <span class="comment">//--</span>
01665 
<a name="l01666"></a><a class="code" href="../../d5/d8/ex_8h.html#a41">01666</a> <span class="preprocessor">#define ProbeForWriteUlong_ptr(Address) {                                    \</span>
01667 <span class="preprocessor">    if ((Address) &gt;= (ULONG_PTR * const)MM_USER_PROBE_ADDRESS) {             \</span>
01668 <span class="preprocessor">        *(volatile ULONG_PTR * const)MM_USER_PROBE_ADDRESS = 0;              \</span>
01669 <span class="preprocessor">    }                                                                        \</span>
01670 <span class="preprocessor">                                                                             \</span>
01671 <span class="preprocessor">    *(volatile ULONG_PTR *)(Address) = *(volatile ULONG_PTR *)(Address);     \</span>
01672 <span class="preprocessor">}</span>
01673 <span class="preprocessor"></span>
01674 <span class="comment">//++</span>
01675 <span class="comment">//</span>
01676 <span class="comment">// VOID</span>
01677 <span class="comment">// ProbeForWriteQuad(</span>
01678 <span class="comment">//     IN PQUAD Address</span>
01679 <span class="comment">//     )</span>
01680 <span class="comment">//</span>
01681 <span class="comment">//--</span>
01682 
<a name="l01683"></a><a class="code" href="../../d5/d8/ex_8h.html#a42">01683</a> <span class="preprocessor">#define ProbeForWriteQuad(Address) {                                         \</span>
01684 <span class="preprocessor">    if ((Address) &gt;= (QUAD * const)MM_USER_PROBE_ADDRESS) {                  \</span>
01685 <span class="preprocessor">        *(volatile LONG * const)MM_USER_PROBE_ADDRESS = 0;                   \</span>
01686 <span class="preprocessor">    }                                                                        \</span>
01687 <span class="preprocessor">                                                                             \</span>
01688 <span class="preprocessor">    *(volatile QUAD *)(Address) = *(volatile QUAD *)(Address);               \</span>
01689 <span class="preprocessor">}</span>
01690 <span class="preprocessor"></span>
01691 <span class="comment">//++</span>
01692 <span class="comment">//</span>
01693 <span class="comment">// VOID</span>
01694 <span class="comment">// ProbeForWriteUquad(</span>
01695 <span class="comment">//     IN PUQUAD Address</span>
01696 <span class="comment">//     )</span>
01697 <span class="comment">//</span>
01698 <span class="comment">//--</span>
01699 
<a name="l01700"></a><a class="code" href="../../d5/d8/ex_8h.html#a43">01700</a> <span class="preprocessor">#define ProbeForWriteUquad(Address) {                                        \</span>
01701 <span class="preprocessor">    if ((Address) &gt;= (QUAD * const)MM_USER_PROBE_ADDRESS) {                  \</span>
01702 <span class="preprocessor">        *(volatile ULONG * const)MM_USER_PROBE_ADDRESS = 0;                  \</span>
01703 <span class="preprocessor">    }                                                                        \</span>
01704 <span class="preprocessor">                                                                             \</span>
01705 <span class="preprocessor">    *(volatile UQUAD *)(Address) = *(volatile UQUAD *)(Address);             \</span>
01706 <span class="preprocessor">}</span>
01707 <span class="preprocessor"></span>
01708 <span class="comment">//</span>
01709 <span class="comment">// Probe and write functions definitions.</span>
01710 <span class="comment">//</span>
01711 <span class="comment">//++</span>
01712 <span class="comment">//</span>
01713 <span class="comment">// VOID</span>
01714 <span class="comment">// ProbeAndWriteBoolean(</span>
01715 <span class="comment">//     IN PBOOLEAN Address,</span>
01716 <span class="comment">//     IN BOOLEAN Value</span>
01717 <span class="comment">//     )</span>
01718 <span class="comment">//</span>
01719 <span class="comment">//--</span>
01720 
<a name="l01721"></a><a class="code" href="../../d5/d8/ex_8h.html#a44">01721</a> <span class="preprocessor">#define ProbeAndWriteBoolean(Address, Value) {                               \</span>
01722 <span class="preprocessor">    if ((Address) &gt;= (BOOLEAN * const)MM_USER_PROBE_ADDRESS) {               \</span>
01723 <span class="preprocessor">        *(volatile BOOLEAN * const)MM_USER_PROBE_ADDRESS = 0;                \</span>
01724 <span class="preprocessor">    }                                                                        \</span>
01725 <span class="preprocessor">                                                                             \</span>
01726 <span class="preprocessor">    *(Address) = (Value);                                                    \</span>
01727 <span class="preprocessor">}</span>
01728 <span class="preprocessor"></span>
01729 <span class="comment">//++</span>
01730 <span class="comment">//</span>
01731 <span class="comment">// VOID</span>
01732 <span class="comment">// ProbeAndWriteChar(</span>
01733 <span class="comment">//     IN PCHAR Address,</span>
01734 <span class="comment">//     IN CHAR Value</span>
01735 <span class="comment">//     )</span>
01736 <span class="comment">//</span>
01737 <span class="comment">//--</span>
01738 
<a name="l01739"></a><a class="code" href="../../d5/d8/ex_8h.html#a45">01739</a> <span class="preprocessor">#define ProbeAndWriteChar(Address, Value) {                                  \</span>
01740 <span class="preprocessor">    if ((Address) &gt;= (CHAR * const)MM_USER_PROBE_ADDRESS) {                  \</span>
01741 <span class="preprocessor">        *(volatile CHAR * const)MM_USER_PROBE_ADDRESS = 0;                   \</span>
01742 <span class="preprocessor">    }                                                                        \</span>
01743 <span class="preprocessor">                                                                             \</span>
01744 <span class="preprocessor">    *(Address) = (Value);                                                    \</span>
01745 <span class="preprocessor">}</span>
01746 <span class="preprocessor"></span>
01747 <span class="comment">//++</span>
01748 <span class="comment">//</span>
01749 <span class="comment">// VOID</span>
01750 <span class="comment">// ProbeAndWriteUchar(</span>
01751 <span class="comment">//     IN PUCHAR Address,</span>
01752 <span class="comment">//     IN UCHAR Value</span>
01753 <span class="comment">//     )</span>
01754 <span class="comment">//</span>
01755 <span class="comment">//--</span>
01756 
<a name="l01757"></a><a class="code" href="../../d5/d8/ex_8h.html#a46">01757</a> <span class="preprocessor">#define ProbeAndWriteUchar(Address, Value) {                                 \</span>
01758 <span class="preprocessor">    if ((Address) &gt;= (UCHAR * const)MM_USER_PROBE_ADDRESS) {                 \</span>
01759 <span class="preprocessor">        *(volatile UCHAR * const)MM_USER_PROBE_ADDRESS = 0;                  \</span>
01760 <span class="preprocessor">    }                                                                        \</span>
01761 <span class="preprocessor">                                                                             \</span>
01762 <span class="preprocessor">    *(Address) = (Value);                                                    \</span>
01763 <span class="preprocessor">}</span>
01764 <span class="preprocessor"></span>
01765 <span class="comment">//++</span>
01766 <span class="comment">//</span>
01767 <span class="comment">// VOID</span>
01768 <span class="comment">// ProbeAndWriteShort(</span>
01769 <span class="comment">//     IN PSHORT Address,</span>
01770 <span class="comment">//     IN SHORT Value</span>
01771 <span class="comment">//     )</span>
01772 <span class="comment">//</span>
01773 <span class="comment">//--</span>
01774 
<a name="l01775"></a><a class="code" href="../../d5/d8/ex_8h.html#a47">01775</a> <span class="preprocessor">#define ProbeAndWriteShort(Address, Value) {                                 \</span>
01776 <span class="preprocessor">    if ((Address) &gt;= (SHORT * const)MM_USER_PROBE_ADDRESS) {                 \</span>
01777 <span class="preprocessor">        *(volatile SHORT * const)MM_USER_PROBE_ADDRESS = 0;                  \</span>
01778 <span class="preprocessor">    }                                                                        \</span>
01779 <span class="preprocessor">                                                                             \</span>
01780 <span class="preprocessor">    *(Address) = (Value);                                                    \</span>
01781 <span class="preprocessor">}</span>
01782 <span class="preprocessor"></span>
01783 <span class="comment">//++</span>
01784 <span class="comment">//</span>
01785 <span class="comment">// VOID</span>
01786 <span class="comment">// ProbeAndWriteUshort(</span>
01787 <span class="comment">//     IN PUSHORT Address,</span>
01788 <span class="comment">//     IN USHORT Value</span>
01789 <span class="comment">//     )</span>
01790 <span class="comment">//</span>
01791 <span class="comment">//--</span>
01792 
<a name="l01793"></a><a class="code" href="../../d5/d8/ex_8h.html#a48">01793</a> <span class="preprocessor">#define ProbeAndWriteUshort(Address, Value) {                                \</span>
01794 <span class="preprocessor">    if ((Address) &gt;= (USHORT * const)MM_USER_PROBE_ADDRESS) {                \</span>
01795 <span class="preprocessor">        *(volatile USHORT * const)MM_USER_PROBE_ADDRESS = 0;                 \</span>
01796 <span class="preprocessor">    }                                                                        \</span>
01797 <span class="preprocessor">                                                                             \</span>
01798 <span class="preprocessor">    *(Address) = (Value);                                                    \</span>
01799 <span class="preprocessor">}</span>
01800 <span class="preprocessor"></span>
01801 <span class="comment">//++</span>
01802 <span class="comment">//</span>
01803 <span class="comment">// VOID</span>
01804 <span class="comment">// ProbeAndWriteHandle(</span>
01805 <span class="comment">//     IN PHANDLE Address,</span>
01806 <span class="comment">//     IN HANDLE Value</span>
01807 <span class="comment">//     )</span>
01808 <span class="comment">//</span>
01809 <span class="comment">//--</span>
01810 
<a name="l01811"></a><a class="code" href="../../d5/d8/ex_8h.html#a49">01811</a> <span class="preprocessor">#define ProbeAndWriteHandle(Address, Value) {                                \</span>
01812 <span class="preprocessor">    if ((Address) &gt;= (HANDLE * const)MM_USER_PROBE_ADDRESS) {                \</span>
01813 <span class="preprocessor">        *(volatile HANDLE * const)MM_USER_PROBE_ADDRESS = 0;                 \</span>
01814 <span class="preprocessor">    }                                                                        \</span>
01815 <span class="preprocessor">                                                                             \</span>
01816 <span class="preprocessor">    *(Address) = (Value);                                                    \</span>
01817 <span class="preprocessor">}</span>
01818 <span class="preprocessor"></span>
01819 <span class="comment">//++</span>
01820 <span class="comment">//</span>
01821 <span class="comment">// VOID</span>
01822 <span class="comment">// ProbeAndWriteLong(</span>
01823 <span class="comment">//     IN PLONG Address,</span>
01824 <span class="comment">//     IN LONG Value</span>
01825 <span class="comment">//     )</span>
01826 <span class="comment">//</span>
01827 <span class="comment">//--</span>
01828 
<a name="l01829"></a><a class="code" href="../../d5/d8/ex_8h.html#a50">01829</a> <span class="preprocessor">#define ProbeAndWriteLong(Address, Value) {                                  \</span>
01830 <span class="preprocessor">    if ((Address) &gt;= (LONG * const)MM_USER_PROBE_ADDRESS) {                  \</span>
01831 <span class="preprocessor">        *(volatile LONG * const)MM_USER_PROBE_ADDRESS = 0;                   \</span>
01832 <span class="preprocessor">    }                                                                        \</span>
01833 <span class="preprocessor">                                                                             \</span>
01834 <span class="preprocessor">    *(Address) = (Value);                                                    \</span>
01835 <span class="preprocessor">}</span>
01836 <span class="preprocessor"></span>
01837 <span class="comment">//++</span>
01838 <span class="comment">//</span>
01839 <span class="comment">// VOID</span>
01840 <span class="comment">// ProbeAndWriteUlong(</span>
01841 <span class="comment">//     IN PULONG Address,</span>
01842 <span class="comment">//     IN ULONG Value</span>
01843 <span class="comment">//     )</span>
01844 <span class="comment">//</span>
01845 <span class="comment">//--</span>
01846 
<a name="l01847"></a><a class="code" href="../../d5/d8/ex_8h.html#a51">01847</a> <span class="preprocessor">#define ProbeAndWriteUlong(Address, Value) {                                 \</span>
01848 <span class="preprocessor">    if ((Address) &gt;= (ULONG * const)MM_USER_PROBE_ADDRESS) {                 \</span>
01849 <span class="preprocessor">        *(volatile ULONG * const)MM_USER_PROBE_ADDRESS = 0;                  \</span>
01850 <span class="preprocessor">    }                                                                        \</span>
01851 <span class="preprocessor">                                                                             \</span>
01852 <span class="preprocessor">    *(Address) = (Value);                                                    \</span>
01853 <span class="preprocessor">}</span>
01854 <span class="preprocessor"></span>
01855 <span class="comment">//++</span>
01856 <span class="comment">//</span>
01857 <span class="comment">// VOID</span>
01858 <span class="comment">// ProbeAndWriteQuad(</span>
01859 <span class="comment">//     IN PQUAD Address,</span>
01860 <span class="comment">//     IN QUAD Value</span>
01861 <span class="comment">//     )</span>
01862 <span class="comment">//</span>
01863 <span class="comment">//--</span>
01864 
<a name="l01865"></a><a class="code" href="../../d5/d8/ex_8h.html#a52">01865</a> <span class="preprocessor">#define ProbeAndWriteQuad(Address, Value) {                                  \</span>
01866 <span class="preprocessor">    if ((Address) &gt;= (QUAD * const)MM_USER_PROBE_ADDRESS) {                  \</span>
01867 <span class="preprocessor">        *(volatile LONG * const)MM_USER_PROBE_ADDRESS = 0;                   \</span>
01868 <span class="preprocessor">    }                                                                        \</span>
01869 <span class="preprocessor">                                                                             \</span>
01870 <span class="preprocessor">    *(Address) = (Value);                                                    \</span>
01871 <span class="preprocessor">}</span>
01872 <span class="preprocessor"></span>
01873 <span class="comment">//++</span>
01874 <span class="comment">//</span>
01875 <span class="comment">// VOID</span>
01876 <span class="comment">// ProbeAndWriteUquad(</span>
01877 <span class="comment">//     IN PUQUAD Address,</span>
01878 <span class="comment">//     IN UQUAD Value</span>
01879 <span class="comment">//     )</span>
01880 <span class="comment">//</span>
01881 <span class="comment">//--</span>
01882 
<a name="l01883"></a><a class="code" href="../../d5/d8/ex_8h.html#a53">01883</a> <span class="preprocessor">#define ProbeAndWriteUquad(Address, Value) {                                 \</span>
01884 <span class="preprocessor">    if ((Address) &gt;= (UQUAD * const)MM_USER_PROBE_ADDRESS) {                 \</span>
01885 <span class="preprocessor">        *(volatile ULONG * const)MM_USER_PROBE_ADDRESS = 0;                  \</span>
01886 <span class="preprocessor">    }                                                                        \</span>
01887 <span class="preprocessor">                                                                             \</span>
01888 <span class="preprocessor">    *(Address) = (Value);                                                    \</span>
01889 <span class="preprocessor">}</span>
01890 <span class="preprocessor"></span>
01891 <span class="comment">//++</span>
01892 <span class="comment">//</span>
01893 <span class="comment">// VOID</span>
01894 <span class="comment">// ProbeAndWriteSturcture(</span>
01895 <span class="comment">//     IN P&lt;STRUCTURE&gt; Address,</span>
01896 <span class="comment">//     IN &lt;STRUCTURE&gt; Value,</span>
01897 <span class="comment">//     &lt;STRUCTURE&gt;</span>
01898 <span class="comment">//     )</span>
01899 <span class="comment">//</span>
01900 <span class="comment">//--</span>
01901 
<a name="l01902"></a><a class="code" href="../../d5/d8/ex_8h.html#a54">01902</a> <span class="preprocessor">#define ProbeAndWriteStructure(Address, Value,STRUCTURE) {                   \</span>
01903 <span class="preprocessor">    if ((STRUCTURE * const)(Address) &gt;= (STRUCTURE * const)MM_USER_PROBE_ADDRESS) {    \</span>
01904 <span class="preprocessor">        *(volatile ULONG * const)MM_USER_PROBE_ADDRESS = 0;                  \</span>
01905 <span class="preprocessor">    }                                                                        \</span>
01906 <span class="preprocessor">                                                                             \</span>
01907 <span class="preprocessor">    *(Address) = (Value);                                                    \</span>
01908 <span class="preprocessor">}</span>
01909 <span class="preprocessor"></span>
01910 <span class="comment">// begin_ntifs begin_ntddk begin_wdm</span>
01911 <span class="comment">//</span>
01912 <span class="comment">// Common probe for write functions.</span>
01913 <span class="comment">//</span>
01914 
01915 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
01916 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
01917 NTAPI
01918 <a class="code" href="../../d5/d8/ex_8h.html#a259">ProbeForWrite</a> (
01919     IN PVOID Address,
01920     IN ULONG Length,
01921     IN ULONG Alignment
01922     );
01923 
01924 <span class="comment">// end_ntifs end_ntddk end_wdm</span>
01925 
01926 <span class="comment">//</span>
01927 <span class="comment">// Timer Rundown</span>
01928 <span class="comment">//</span>
01929 
01930 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
01931 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
01932 <a class="code" href="../../d2/d2/timer_8c.html#a10">ExTimerRundown</a> (
01933     VOID
01934     );
01935 
01936 <span class="comment">// begin_ntddk begin_wdm begin_nthal begin_ntifs</span>
01937 <span class="comment">//</span>
01938 <span class="comment">// Worker Thread</span>
01939 <span class="comment">//</span>
01940 
<a name="l01941"></a><a class="code" href="../../d5/d8/ex_8h.html#a332">01941</a> <span class="keyword">typedef</span> <span class="keyword">enum</span> <a class="code" href="../../d5/d8/ex_8h.html#a332">_WORK_QUEUE_TYPE</a> {
01942     <a class="code" href="../../d5/d8/ex_8h.html#a332a205">CriticalWorkQueue</a>,
01943     <a class="code" href="../../d5/d8/ex_8h.html#a332a206">DelayedWorkQueue</a>,
01944     <a class="code" href="../../d5/d8/ex_8h.html#a332a207">HyperCriticalWorkQueue</a>,
01945     <a class="code" href="../../d5/d8/ex_8h.html#a332a208">MaximumWorkQueue</a>
01946 } <a class="code" href="../../d5/d8/ex_8h.html#a110">WORK_QUEUE_TYPE</a>;
01947 
01948 <span class="keyword">typedef</span>
01949 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l01950"></a><a class="code" href="../../d5/d8/ex_8h.html#a111">01950</a> (*PWORKER_THREAD_ROUTINE)(
01951     IN PVOID Parameter
01952     );
01953 
<a name="l01954"></a><a class="code" href="../../d7/d9/struct__WORK__QUEUE__ITEM.html">01954</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d7/d9/struct__WORK__QUEUE__ITEM.html">_WORK_QUEUE_ITEM</a> {
<a name="l01955"></a><a class="code" href="../../d7/d9/struct__WORK__QUEUE__ITEM.html#o0">01955</a>     LIST_ENTRY <a class="code" href="../../d7/d9/struct__WORK__QUEUE__ITEM.html#o0">List</a>;
<a name="l01956"></a><a class="code" href="../../d7/d9/struct__WORK__QUEUE__ITEM.html#o1">01956</a>     <a class="code" href="../../d5/d8/ex_8h.html#a111">PWORKER_THREAD_ROUTINE</a> <a class="code" href="../../d7/d9/struct__WORK__QUEUE__ITEM.html#o1">WorkerRoutine</a>;
<a name="l01957"></a><a class="code" href="../../d7/d9/struct__WORK__QUEUE__ITEM.html#o2">01957</a>     PVOID <a class="code" href="../../d7/d9/struct__WORK__QUEUE__ITEM.html#o2">Parameter</a>;
01958 } <a class="code" href="../../d7/d9/struct__WORK__QUEUE__ITEM.html">WORK_QUEUE_ITEM</a>, *<a class="code" href="../../d7/d9/struct__WORK__QUEUE__ITEM.html">PWORK_QUEUE_ITEM</a>;
01959 
01960 
<a name="l01961"></a><a class="code" href="../../d5/d8/ex_8h.html#a55">01961</a> <span class="preprocessor">#define ExInitializeWorkItem(Item, Routine, Context) \</span>
01962 <span class="preprocessor">    (Item)-&gt;WorkerRoutine = (Routine);               \</span>
01963 <span class="preprocessor">    (Item)-&gt;Parameter = (Context);                   \</span>
01964 <span class="preprocessor">    (Item)-&gt;List.Flink = NULL;</span>
01965 <span class="preprocessor"></span>
01966 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
01967 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
01968 <a class="code" href="../../d5/d8/ex_8h.html#a261">ExQueueWorkItem</a>(
01969     IN PWORK_QUEUE_ITEM WorkItem,
01970     IN WORK_QUEUE_TYPE QueueType
01971     );
01972 
01973 <span class="comment">//  end_wdm</span>
01974 
01975 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
01976 BOOLEAN
01977 <a class="code" href="../../d5/d8/ex_8h.html#a262">ExIsProcessorFeaturePresent</a>(
01978     ULONG ProcessorFeature
01979     );
01980 
01981 <span class="comment">// end_ntddk end_nthal end_ntifs</span>
01982 
<a name="l01983"></a><a class="code" href="../../d8/d7/struct__EX__WORK__QUEUE.html">01983</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d8/d7/struct__EX__WORK__QUEUE.html">_EX_WORK_QUEUE</a> {
01984 
01985     <span class="comment">//</span>
01986     <span class="comment">// Queue objects that that are used to hold work queue entries and</span>
01987     <span class="comment">// synchronize worker thread activity.</span>
01988     <span class="comment">//</span>
01989 
<a name="l01990"></a><a class="code" href="../../d8/d7/struct__EX__WORK__QUEUE.html#o0">01990</a>     <a class="code" href="../../d7/d7/struct__KQUEUE.html">KQUEUE</a> <a class="code" href="../../d8/d7/struct__EX__WORK__QUEUE.html#o0">WorkerQueue</a>;
01991 
01992     <span class="comment">//</span>
01993     <span class="comment">// Number of dynamic worker threads that have been created "on the fly"</span>
01994     <span class="comment">// as part of worker thread deadlock prevention</span>
01995     <span class="comment">//</span>
01996 
<a name="l01997"></a><a class="code" href="../../d8/d7/struct__EX__WORK__QUEUE.html#o1">01997</a>     ULONG <a class="code" href="../../d8/d7/struct__EX__WORK__QUEUE.html#o1">DynamicThreadCount</a>;
01998 
01999     <span class="comment">//</span>
02000     <span class="comment">// Count of the number of work items processed.</span>
02001     <span class="comment">//</span>
02002 
<a name="l02003"></a><a class="code" href="../../d8/d7/struct__EX__WORK__QUEUE.html#o2">02003</a>     ULONG <a class="code" href="../../d8/d7/struct__EX__WORK__QUEUE.html#o2">WorkItemsProcessed</a>;
02004 
02005     <span class="comment">//</span>
02006     <span class="comment">// Used for deadlock detection, WorkItemsProcessedLastPass equals the value</span>
02007     <span class="comment">// of WorkItemsProcessed the last time ExpDetectWorkerThreadDeadlock()</span>
02008     <span class="comment">// ran.</span>
02009     <span class="comment">//</span>
02010 
<a name="l02011"></a><a class="code" href="../../d8/d7/struct__EX__WORK__QUEUE.html#o3">02011</a>     ULONG <a class="code" href="../../d8/d7/struct__EX__WORK__QUEUE.html#o3">WorkItemsProcessedLastPass</a>;
02012 
02013     <span class="comment">//</span>
02014     <span class="comment">// QueueDepthLastPass is also part of the worker queue state snapshot</span>
02015     <span class="comment">// taken by ExpDetectWorkerThreadDeadlock().</span>
02016     <span class="comment">//</span>
02017 
<a name="l02018"></a><a class="code" href="../../d8/d7/struct__EX__WORK__QUEUE.html#o4">02018</a>     ULONG <a class="code" href="../../d8/d7/struct__EX__WORK__QUEUE.html#o4">QueueDepthLastPass</a>;
02019 
02020     <span class="comment">//</span>
02021     <span class="comment">// MakeThreadsAsNecessary indicates whether this work queue is elligible</span>
02022     <span class="comment">// for dynamic creation of threads not just for deadlock detection,</span>
02023     <span class="comment">// but to ensure that the CPUs are all kept busy clearing any work</span>
02024     <span class="comment">// item backlog.</span>
02025     <span class="comment">//</span>
02026 
<a name="l02027"></a><a class="code" href="../../d8/d7/struct__EX__WORK__QUEUE.html#o5">02027</a>     BOOLEAN <a class="code" href="../../d8/d7/struct__EX__WORK__QUEUE.html#o5">MakeThreadsAsNecessary</a>;
02028 
02029 } <a class="code" href="../../d8/d7/struct__EX__WORK__QUEUE.html">EX_WORK_QUEUE</a>, *<a class="code" href="../../d8/d7/struct__EX__WORK__QUEUE.html">PEX_WORK_QUEUE</a>;
02030 
<a name="l02031"></a><a class="code" href="../../d5/d8/ex_8h.html#a116">02031</a> <span class="keyword">extern</span> <a class="code" href="../../d8/d7/struct__EX__WORK__QUEUE.html">EX_WORK_QUEUE</a> <a class="code" href="../../d1/d9/worker_8c.html#a12">ExWorkerQueue</a>[];
02032 
02033 
02034 <span class="comment">// begin_ntddk begin_nthal begin_ntifs</span>
02035 <span class="comment">//</span>
02036 <span class="comment">// Zone Allocation</span>
02037 <span class="comment">//</span>
02038 
<a name="l02039"></a><a class="code" href="../../d1/d0/struct__ZONE__SEGMENT__HEADER.html">02039</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d1/d0/struct__ZONE__SEGMENT__HEADER.html">_ZONE_SEGMENT_HEADER</a> {
<a name="l02040"></a><a class="code" href="../../d1/d0/struct__ZONE__SEGMENT__HEADER.html#o0">02040</a>     SINGLE_LIST_ENTRY <a class="code" href="../../d1/d0/struct__ZONE__SEGMENT__HEADER.html#o0">SegmentList</a>;
<a name="l02041"></a><a class="code" href="../../d1/d0/struct__ZONE__SEGMENT__HEADER.html#o1">02041</a>     PVOID <a class="code" href="../../d1/d0/struct__ZONE__SEGMENT__HEADER.html#o1">Reserved</a>;
02042 } <a class="code" href="../../d1/d0/struct__ZONE__SEGMENT__HEADER.html">ZONE_SEGMENT_HEADER</a>, *<a class="code" href="../../d1/d0/struct__ZONE__SEGMENT__HEADER.html">PZONE_SEGMENT_HEADER</a>;
02043 
<a name="l02044"></a><a class="code" href="../../d0/d0/struct__ZONE__HEADER.html">02044</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d0/d0/struct__ZONE__HEADER.html">_ZONE_HEADER</a> {
<a name="l02045"></a><a class="code" href="../../d0/d0/struct__ZONE__HEADER.html#o0">02045</a>     SINGLE_LIST_ENTRY <a class="code" href="../../d0/d0/struct__ZONE__HEADER.html#o0">FreeList</a>;
<a name="l02046"></a><a class="code" href="../../d0/d0/struct__ZONE__HEADER.html#o1">02046</a>     SINGLE_LIST_ENTRY <a class="code" href="../../d0/d0/struct__ZONE__HEADER.html#o1">SegmentList</a>;
<a name="l02047"></a><a class="code" href="../../d0/d0/struct__ZONE__HEADER.html#o2">02047</a>     ULONG <a class="code" href="../../d0/d0/struct__ZONE__HEADER.html#o2">BlockSize</a>;
<a name="l02048"></a><a class="code" href="../../d0/d0/struct__ZONE__HEADER.html#o3">02048</a>     ULONG <a class="code" href="../../d0/d0/struct__ZONE__HEADER.html#o3">TotalSegmentSize</a>;
02049 } <a class="code" href="../../d0/d0/struct__ZONE__HEADER.html">ZONE_HEADER</a>, *<a class="code" href="../../d0/d0/struct__ZONE__HEADER.html">PZONE_HEADER</a>;
02050 
02051 
02052 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
02053 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
02054 <a class="code" href="../../d5/d8/ex_8h.html#a263">ExInitializeZone</a>(
02055     IN PZONE_HEADER Zone,
02056     IN ULONG BlockSize,
02057     IN PVOID InitialSegment,
02058     IN ULONG InitialSegmentSize
02059     );
02060 
02061 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
02062 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
02063 <a class="code" href="../../d5/d8/ex_8h.html#a264">ExExtendZone</a>(
02064     IN PZONE_HEADER Zone,
02065     IN PVOID Segment,
02066     IN ULONG SegmentSize
02067     );
02068 
02069 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
02070 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
02071 <a class="code" href="../../d5/d8/ex_8h.html#a265">ExInterlockedExtendZone</a>(
02072     IN PZONE_HEADER Zone,
02073     IN PVOID Segment,
02074     IN ULONG SegmentSize,
02075     IN PKSPIN_LOCK Lock
02076     );
02077 
02078 <span class="comment">//++</span>
02079 <span class="comment">//</span>
02080 <span class="comment">// PVOID</span>
02081 <span class="comment">// ExAllocateFromZone(</span>
02082 <span class="comment">//     IN PZONE_HEADER Zone</span>
02083 <span class="comment">//     )</span>
02084 <span class="comment">//</span>
02085 <span class="comment">// Routine Description:</span>
02086 <span class="comment">//</span>
02087 <span class="comment">//     This routine removes an entry from the zone and returns a pointer to it.</span>
02088 <span class="comment">//</span>
02089 <span class="comment">// Arguments:</span>
02090 <span class="comment">//</span>
02091 <span class="comment">//     Zone - Pointer to the zone header controlling the storage from which the</span>
02092 <span class="comment">//         entry is to be allocated.</span>
02093 <span class="comment">//</span>
02094 <span class="comment">// Return Value:</span>
02095 <span class="comment">//</span>
02096 <span class="comment">//     The function value is a pointer to the storage allocated from the zone.</span>
02097 <span class="comment">//</span>
02098 <span class="comment">//--</span>
02099 
<a name="l02100"></a><a class="code" href="../../d5/d8/ex_8h.html#a56">02100</a> <span class="preprocessor">#define ExAllocateFromZone(Zone) \</span>
02101 <span class="preprocessor">    (PVOID)((Zone)-&gt;FreeList.Next); \</span>
02102 <span class="preprocessor">    if ( (Zone)-&gt;FreeList.Next ) (Zone)-&gt;FreeList.Next = (Zone)-&gt;FreeList.Next-&gt;Next</span>
02103 <span class="preprocessor"></span>
02104 
02105 <span class="comment">//++</span>
02106 <span class="comment">//</span>
02107 <span class="comment">// PVOID</span>
02108 <span class="comment">// ExFreeToZone(</span>
02109 <span class="comment">//     IN PZONE_HEADER Zone,</span>
02110 <span class="comment">//     IN PVOID Block</span>
02111 <span class="comment">//     )</span>
02112 <span class="comment">//</span>
02113 <span class="comment">// Routine Description:</span>
02114 <span class="comment">//</span>
02115 <span class="comment">//     This routine places the specified block of storage back onto the free</span>
02116 <span class="comment">//     list in the specified zone.</span>
02117 <span class="comment">//</span>
02118 <span class="comment">// Arguments:</span>
02119 <span class="comment">//</span>
02120 <span class="comment">//     Zone - Pointer to the zone header controlling the storage to which the</span>
02121 <span class="comment">//         entry is to be inserted.</span>
02122 <span class="comment">//</span>
02123 <span class="comment">//     Block - Pointer to the block of storage to be freed back to the zone.</span>
02124 <span class="comment">//</span>
02125 <span class="comment">// Return Value:</span>
02126 <span class="comment">//</span>
02127 <span class="comment">//     Pointer to previous block of storage that was at the head of the free</span>
02128 <span class="comment">//         list.  NULL implies the zone went from no available free blocks to</span>
02129 <span class="comment">//         at least one free block.</span>
02130 <span class="comment">//</span>
02131 <span class="comment">//--</span>
02132 
<a name="l02133"></a><a class="code" href="../../d5/d8/ex_8h.html#a57">02133</a> <span class="preprocessor">#define ExFreeToZone(Zone,Block)                                    \</span>
02134 <span class="preprocessor">    ( ((PSINGLE_LIST_ENTRY)(Block))-&gt;Next = (Zone)-&gt;FreeList.Next,  \</span>
02135 <span class="preprocessor">      (Zone)-&gt;FreeList.Next = ((PSINGLE_LIST_ENTRY)(Block)),        \</span>
02136 <span class="preprocessor">      ((PSINGLE_LIST_ENTRY)(Block))-&gt;Next                           \</span>
02137 <span class="preprocessor">    )</span>
02138 <span class="preprocessor"></span>
02139 <span class="comment">//++</span>
02140 <span class="comment">//</span>
02141 <span class="comment">// BOOLEAN</span>
02142 <span class="comment">// ExIsFullZone(</span>
02143 <span class="comment">//     IN PZONE_HEADER Zone</span>
02144 <span class="comment">//     )</span>
02145 <span class="comment">//</span>
02146 <span class="comment">// Routine Description:</span>
02147 <span class="comment">//</span>
02148 <span class="comment">//     This routine determines if the specified zone is full or not.  A zone</span>
02149 <span class="comment">//     is considered full if the free list is empty.</span>
02150 <span class="comment">//</span>
02151 <span class="comment">// Arguments:</span>
02152 <span class="comment">//</span>
02153 <span class="comment">//     Zone - Pointer to the zone header to be tested.</span>
02154 <span class="comment">//</span>
02155 <span class="comment">// Return Value:</span>
02156 <span class="comment">//</span>
02157 <span class="comment">//     TRUE if the zone is full and FALSE otherwise.</span>
02158 <span class="comment">//</span>
02159 <span class="comment">//--</span>
02160 
<a name="l02161"></a><a class="code" href="../../d5/d8/ex_8h.html#a58">02161</a> <span class="preprocessor">#define ExIsFullZone(Zone) \</span>
02162 <span class="preprocessor">    ( (Zone)-&gt;FreeList.Next == (PSINGLE_LIST_ENTRY)NULL )</span>
02163 <span class="preprocessor"></span>
02164 <span class="comment">//++</span>
02165 <span class="comment">//</span>
02166 <span class="comment">// PVOID</span>
02167 <span class="comment">// ExInterlockedAllocateFromZone(</span>
02168 <span class="comment">//     IN PZONE_HEADER Zone,</span>
02169 <span class="comment">//     IN PKSPIN_LOCK Lock</span>
02170 <span class="comment">//     )</span>
02171 <span class="comment">//</span>
02172 <span class="comment">// Routine Description:</span>
02173 <span class="comment">//</span>
02174 <span class="comment">//     This routine removes an entry from the zone and returns a pointer to it.</span>
02175 <span class="comment">//     The removal is performed with the specified lock owned for the sequence</span>
02176 <span class="comment">//     to make it MP-safe.</span>
02177 <span class="comment">//</span>
02178 <span class="comment">// Arguments:</span>
02179 <span class="comment">//</span>
02180 <span class="comment">//     Zone - Pointer to the zone header controlling the storage from which the</span>
02181 <span class="comment">//         entry is to be allocated.</span>
02182 <span class="comment">//</span>
02183 <span class="comment">//     Lock - Pointer to the spin lock which should be obtained before removing</span>
02184 <span class="comment">//         the entry from the allocation list.  The lock is released before</span>
02185 <span class="comment">//         returning to the caller.</span>
02186 <span class="comment">//</span>
02187 <span class="comment">// Return Value:</span>
02188 <span class="comment">//</span>
02189 <span class="comment">//     The function value is a pointer to the storage allocated from the zone.</span>
02190 <span class="comment">//</span>
02191 <span class="comment">//--</span>
02192 
<a name="l02193"></a><a class="code" href="../../d5/d8/ex_8h.html#a59">02193</a> <span class="preprocessor">#define ExInterlockedAllocateFromZone(Zone,Lock) \</span>
02194 <span class="preprocessor">    (PVOID) ExInterlockedPopEntryList( &amp;(Zone)-&gt;FreeList, Lock )</span>
02195 <span class="preprocessor"></span>
02196 <span class="comment">//++</span>
02197 <span class="comment">//</span>
02198 <span class="comment">// PVOID</span>
02199 <span class="comment">// ExInterlockedFreeToZone(</span>
02200 <span class="comment">//     IN PZONE_HEADER Zone,</span>
02201 <span class="comment">//     IN PVOID Block,</span>
02202 <span class="comment">//     IN PKSPIN_LOCK Lock</span>
02203 <span class="comment">//     )</span>
02204 <span class="comment">//</span>
02205 <span class="comment">// Routine Description:</span>
02206 <span class="comment">//</span>
02207 <span class="comment">//     This routine places the specified block of storage back onto the free</span>
02208 <span class="comment">//     list in the specified zone.  The insertion is performed with the lock</span>
02209 <span class="comment">//     owned for the sequence to make it MP-safe.</span>
02210 <span class="comment">//</span>
02211 <span class="comment">// Arguments:</span>
02212 <span class="comment">//</span>
02213 <span class="comment">//     Zone - Pointer to the zone header controlling the storage to which the</span>
02214 <span class="comment">//         entry is to be inserted.</span>
02215 <span class="comment">//</span>
02216 <span class="comment">//     Block - Pointer to the block of storage to be freed back to the zone.</span>
02217 <span class="comment">//</span>
02218 <span class="comment">//     Lock - Pointer to the spin lock which should be obtained before inserting</span>
02219 <span class="comment">//         the entry onto the free list.  The lock is released before returning</span>
02220 <span class="comment">//         to the caller.</span>
02221 <span class="comment">//</span>
02222 <span class="comment">// Return Value:</span>
02223 <span class="comment">//</span>
02224 <span class="comment">//     Pointer to previous block of storage that was at the head of the free</span>
02225 <span class="comment">//         list.  NULL implies the zone went from no available free blocks to</span>
02226 <span class="comment">//         at least one free block.</span>
02227 <span class="comment">//</span>
02228 <span class="comment">//--</span>
02229 
<a name="l02230"></a><a class="code" href="../../d5/d8/ex_8h.html#a60">02230</a> <span class="preprocessor">#define ExInterlockedFreeToZone(Zone,Block,Lock) \</span>
02231 <span class="preprocessor">    ExInterlockedPushEntryList( &amp;(Zone)-&gt;FreeList, ((PSINGLE_LIST_ENTRY) (Block)), Lock )</span>
02232 <span class="preprocessor"></span>
02233 
02234 <span class="comment">//++</span>
02235 <span class="comment">//</span>
02236 <span class="comment">// BOOLEAN</span>
02237 <span class="comment">// ExIsObjectInFirstZoneSegment(</span>
02238 <span class="comment">//     IN PZONE_HEADER Zone,</span>
02239 <span class="comment">//     IN PVOID Object</span>
02240 <span class="comment">//     )</span>
02241 <span class="comment">//</span>
02242 <span class="comment">// Routine Description:</span>
02243 <span class="comment">//</span>
02244 <span class="comment">//     This routine determines if the specified pointer lives in the zone.</span>
02245 <span class="comment">//</span>
02246 <span class="comment">// Arguments:</span>
02247 <span class="comment">//</span>
02248 <span class="comment">//     Zone - Pointer to the zone header controlling the storage to which the</span>
02249 <span class="comment">//         object may belong.</span>
02250 <span class="comment">//</span>
02251 <span class="comment">//     Object - Pointer to the object in question.</span>
02252 <span class="comment">//</span>
02253 <span class="comment">// Return Value:</span>
02254 <span class="comment">//</span>
02255 <span class="comment">//     TRUE if the Object came from the first segment of zone.</span>
02256 <span class="comment">//</span>
02257 <span class="comment">//--</span>
02258 
<a name="l02259"></a><a class="code" href="../../d5/d8/ex_8h.html#a61">02259</a> <span class="preprocessor">#define ExIsObjectInFirstZoneSegment(Zone,Object) ((BOOLEAN)     \</span>
02260 <span class="preprocessor">    (((PUCHAR)(Object) &gt;= (PUCHAR)(Zone)-&gt;SegmentList.Next) &amp;&amp;   \</span>
02261 <span class="preprocessor">     ((PUCHAR)(Object) &lt; (PUCHAR)(Zone)-&gt;SegmentList.Next +      \</span>
02262 <span class="preprocessor">                         (Zone)-&gt;TotalSegmentSize))              \</span>
02263 <span class="preprocessor">)</span>
02264 <span class="preprocessor"></span>
02265 <span class="comment">// end_ntddk end_nthal end_ntifs</span>
02266 
02267 
02268 
02269 <span class="comment">// begin_ntifs begin_ntddk</span>
02270 <span class="comment">//</span>
02271 <span class="comment">//  Define executive resource data structures.</span>
02272 <span class="comment">//</span>
02273 
<a name="l02274"></a><a class="code" href="../../d5/d8/ex_8h.html#a121">02274</a> <span class="keyword">typedef</span> ULONG_PTR <a class="code" href="../../d5/d8/ex_8h.html#a121">ERESOURCE_THREAD</a>;
<a name="l02275"></a><a class="code" href="../../d5/d8/ex_8h.html#a122">02275</a> <span class="keyword">typedef</span> <a class="code" href="../../d5/d8/ex_8h.html#a121">ERESOURCE_THREAD</a> *<a class="code" href="../../d5/d8/ex_8h.html#a122">PERESOURCE_THREAD</a>;
02276 
<a name="l02277"></a><a class="code" href="../../d6/d7/struct__OWNER__ENTRY.html">02277</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d6/d7/struct__OWNER__ENTRY.html">_OWNER_ENTRY</a> {
<a name="l02278"></a><a class="code" href="../../d6/d7/struct__OWNER__ENTRY.html#o0">02278</a>     <a class="code" href="../../d5/d8/ex_8h.html#a121">ERESOURCE_THREAD</a> <a class="code" href="../../d6/d7/struct__OWNER__ENTRY.html#o0">OwnerThread</a>;
02279     <span class="keyword">union </span>{
<a name="l02280"></a><a class="code" href="../../d6/d7/struct__OWNER__ENTRY.html#o1">02280</a>         LONG <a class="code" href="../../d6/d7/struct__OWNER__ENTRY.html#o1">OwnerCount</a>;
<a name="l02281"></a><a class="code" href="../../d6/d7/struct__OWNER__ENTRY.html#o2">02281</a>         ULONG <a class="code" href="../../d6/d7/struct__OWNER__ENTRY.html#o2">TableSize</a>;
02282     };
02283 
02284 } <a class="code" href="../../d6/d7/struct__OWNER__ENTRY.html">OWNER_ENTRY</a>, *<a class="code" href="../../d6/d7/struct__OWNER__ENTRY.html">POWNER_ENTRY</a>;
02285 
<a name="l02286"></a><a class="code" href="../../d6/d4/struct__ERESOURCE.html">02286</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d6/d4/struct__ERESOURCE.html">_ERESOURCE</a> {
<a name="l02287"></a><a class="code" href="../../d6/d4/struct__ERESOURCE.html#o0">02287</a>     LIST_ENTRY <a class="code" href="../../d6/d4/struct__ERESOURCE.html#o0">SystemResourcesList</a>;
<a name="l02288"></a><a class="code" href="../../d6/d4/struct__ERESOURCE.html#o1">02288</a>     <a class="code" href="../../d5/d8/ex_8h.html#a124">POWNER_ENTRY</a> <a class="code" href="../../d6/d4/struct__ERESOURCE.html#o1">OwnerTable</a>;
<a name="l02289"></a><a class="code" href="../../d6/d4/struct__ERESOURCE.html#o2">02289</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> <a class="code" href="../../d6/d4/struct__ERESOURCE.html#o2">ActiveCount</a>;
<a name="l02290"></a><a class="code" href="../../d6/d4/struct__ERESOURCE.html#o3">02290</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d6/d4/struct__ERESOURCE.html#o3">Flag</a>;
<a name="l02291"></a><a class="code" href="../../d6/d4/struct__ERESOURCE.html#o4">02291</a>     <a class="code" href="../../d8/d7/struct__KSEMAPHORE.html">PKSEMAPHORE</a> <a class="code" href="../../d6/d4/struct__ERESOURCE.html#o4">SharedWaiters</a>;
<a name="l02292"></a><a class="code" href="../../d6/d4/struct__ERESOURCE.html#o5">02292</a>     <a class="code" href="../../d2/d6/struct__KEVENT.html">PKEVENT</a> <a class="code" href="../../d6/d4/struct__ERESOURCE.html#o5">ExclusiveWaiters</a>;
<a name="l02293"></a><a class="code" href="../../d6/d4/struct__ERESOURCE.html#o6">02293</a>     <a class="code" href="../../d6/d7/struct__OWNER__ENTRY.html">OWNER_ENTRY</a> <a class="code" href="../../d6/d4/struct__ERESOURCE.html#o6">OwnerThreads</a>[2];
<a name="l02294"></a><a class="code" href="../../d6/d4/struct__ERESOURCE.html#o7">02294</a>     ULONG <a class="code" href="../../d6/d4/struct__ERESOURCE.html#o7">ContentionCount</a>;
<a name="l02295"></a><a class="code" href="../../d6/d4/struct__ERESOURCE.html#o8">02295</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d6/d4/struct__ERESOURCE.html#o8">NumberOfSharedWaiters</a>;
<a name="l02296"></a><a class="code" href="../../d6/d4/struct__ERESOURCE.html#o9">02296</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d6/d4/struct__ERESOURCE.html#o9">NumberOfExclusiveWaiters</a>;
02297     <span class="keyword">union </span>{
<a name="l02298"></a><a class="code" href="../../d6/d4/struct__ERESOURCE.html#o10">02298</a>         PVOID <a class="code" href="../../d6/d4/struct__ERESOURCE.html#o10">Address</a>;
<a name="l02299"></a><a class="code" href="../../d6/d4/struct__ERESOURCE.html#o11">02299</a>         ULONG_PTR <a class="code" href="../../d6/d4/struct__ERESOURCE.html#o11">CreatorBackTraceIndex</a>;
02300     };
02301 
<a name="l02302"></a><a class="code" href="../../d6/d4/struct__ERESOURCE.html#o12">02302</a>     KSPIN_LOCK <a class="code" href="../../d6/d4/struct__ERESOURCE.html#o12">SpinLock</a>;
02303 } <a class="code" href="../../d6/d4/struct__ERESOURCE.html">ERESOURCE</a>, *<a class="code" href="../../d6/d4/struct__ERESOURCE.html">PERESOURCE</a>;
02304 
02305 <span class="comment">//</span>
02306 <span class="comment">//  Values for ERESOURCE.Flag</span>
02307 <span class="comment">//</span>
02308 
<a name="l02309"></a><a class="code" href="../../d5/d8/ex_8h.html#a62">02309</a> <span class="preprocessor">#define ResourceNeverExclusive       0x10</span>
<a name="l02310"></a><a class="code" href="../../d5/d8/ex_8h.html#a63">02310</a> <span class="preprocessor"></span><span class="preprocessor">#define ResourceReleaseByOtherThread 0x20</span>
<a name="l02311"></a><a class="code" href="../../d5/d8/ex_8h.html#a64">02311</a> <span class="preprocessor"></span><span class="preprocessor">#define ResourceOwnedExclusive       0x80</span>
02312 <span class="preprocessor"></span>
<a name="l02313"></a><a class="code" href="../../d5/d8/ex_8h.html#a65">02313</a> <span class="preprocessor">#define RESOURCE_HASH_TABLE_SIZE 64</span>
02314 <span class="preprocessor"></span>
<a name="l02315"></a><a class="code" href="../../d3/d4/struct__RESOURCE__HASH__ENTRY.html">02315</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d3/d4/struct__RESOURCE__HASH__ENTRY.html">_RESOURCE_HASH_ENTRY</a> {
<a name="l02316"></a><a class="code" href="../../d3/d4/struct__RESOURCE__HASH__ENTRY.html#o0">02316</a>     LIST_ENTRY <a class="code" href="../../d3/d4/struct__RESOURCE__HASH__ENTRY.html#o0">ListEntry</a>;
<a name="l02317"></a><a class="code" href="../../d3/d4/struct__RESOURCE__HASH__ENTRY.html#o1">02317</a>     PVOID <a class="code" href="../../d3/d4/struct__RESOURCE__HASH__ENTRY.html#o1">Address</a>;
<a name="l02318"></a><a class="code" href="../../d3/d4/struct__RESOURCE__HASH__ENTRY.html#o2">02318</a>     ULONG <a class="code" href="../../d3/d4/struct__RESOURCE__HASH__ENTRY.html#o2">ContentionCount</a>;
<a name="l02319"></a><a class="code" href="../../d3/d4/struct__RESOURCE__HASH__ENTRY.html#o3">02319</a>     ULONG <a class="code" href="../../d3/d4/struct__RESOURCE__HASH__ENTRY.html#o3">Number</a>;
02320 } <a class="code" href="../../d3/d4/struct__RESOURCE__HASH__ENTRY.html">RESOURCE_HASH_ENTRY</a>, *<a class="code" href="../../d3/d4/struct__RESOURCE__HASH__ENTRY.html">PRESOURCE_HASH_ENTRY</a>;
02321 
<a name="l02322"></a><a class="code" href="../../d4/d4/struct__RESOURCE__PERFORMANCE__DATA.html">02322</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d4/d4/struct__RESOURCE__PERFORMANCE__DATA.html">_RESOURCE_PERFORMANCE_DATA</a> {
<a name="l02323"></a><a class="code" href="../../d4/d4/struct__RESOURCE__PERFORMANCE__DATA.html#o0">02323</a>     ULONG <a class="code" href="../../d4/d4/struct__RESOURCE__PERFORMANCE__DATA.html#o0">ActiveResourceCount</a>;
<a name="l02324"></a><a class="code" href="../../d4/d4/struct__RESOURCE__PERFORMANCE__DATA.html#o1">02324</a>     ULONG <a class="code" href="../../d4/d4/struct__RESOURCE__PERFORMANCE__DATA.html#o1">TotalResourceCount</a>;
<a name="l02325"></a><a class="code" href="../../d4/d4/struct__RESOURCE__PERFORMANCE__DATA.html#o2">02325</a>     ULONG <a class="code" href="../../d4/d4/struct__RESOURCE__PERFORMANCE__DATA.html#o2">ExclusiveAcquire</a>;
<a name="l02326"></a><a class="code" href="../../d4/d4/struct__RESOURCE__PERFORMANCE__DATA.html#o3">02326</a>     ULONG <a class="code" href="../../d4/d4/struct__RESOURCE__PERFORMANCE__DATA.html#o3">SharedFirstLevel</a>;
<a name="l02327"></a><a class="code" href="../../d4/d4/struct__RESOURCE__PERFORMANCE__DATA.html#o4">02327</a>     ULONG <a class="code" href="../../d4/d4/struct__RESOURCE__PERFORMANCE__DATA.html#o4">SharedSecondLevel</a>;
<a name="l02328"></a><a class="code" href="../../d4/d4/struct__RESOURCE__PERFORMANCE__DATA.html#o5">02328</a>     ULONG <a class="code" href="../../d4/d4/struct__RESOURCE__PERFORMANCE__DATA.html#o5">StarveFirstLevel</a>;
<a name="l02329"></a><a class="code" href="../../d4/d4/struct__RESOURCE__PERFORMANCE__DATA.html#o6">02329</a>     ULONG <a class="code" href="../../d4/d4/struct__RESOURCE__PERFORMANCE__DATA.html#o6">StarveSecondLevel</a>;
<a name="l02330"></a><a class="code" href="../../d4/d4/struct__RESOURCE__PERFORMANCE__DATA.html#o7">02330</a>     ULONG <a class="code" href="../../d4/d4/struct__RESOURCE__PERFORMANCE__DATA.html#o7">WaitForExclusive</a>;
<a name="l02331"></a><a class="code" href="../../d4/d4/struct__RESOURCE__PERFORMANCE__DATA.html#o8">02331</a>     ULONG <a class="code" href="../../d4/d4/struct__RESOURCE__PERFORMANCE__DATA.html#o8">OwnerTableExpands</a>;
<a name="l02332"></a><a class="code" href="../../d4/d4/struct__RESOURCE__PERFORMANCE__DATA.html#o9">02332</a>     ULONG <a class="code" href="../../d4/d4/struct__RESOURCE__PERFORMANCE__DATA.html#o9">MaximumTableExpand</a>;
<a name="l02333"></a><a class="code" href="../../d4/d4/struct__RESOURCE__PERFORMANCE__DATA.html#o10">02333</a>     LIST_ENTRY <a class="code" href="../../d4/d4/struct__RESOURCE__PERFORMANCE__DATA.html#o10">HashTable</a>[<a class="code" href="../../d5/d8/ex_8h.html#a65">RESOURCE_HASH_TABLE_SIZE</a>];
02334 } <a class="code" href="../../d4/d4/struct__RESOURCE__PERFORMANCE__DATA.html">RESOURCE_PERFORMANCE_DATA</a>, *<a class="code" href="../../d4/d4/struct__RESOURCE__PERFORMANCE__DATA.html">PRESOURCE_PERFORMANCE_DATA</a>;
02335 
02336 <span class="comment">//</span>
02337 <span class="comment">// Define executive resource function prototypes.</span>
02338 <span class="comment">//</span>
02339 
02340 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
02341 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
02342 <a class="code" href="../../d5/d8/ex_8h.html#a266">ExInitializeResourceLite</a>(
02343     IN PERESOURCE Resource
02344     );
02345 
02346 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
02347 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
02348 <a class="code" href="../../d5/d8/ex_8h.html#a267">ExReinitializeResourceLite</a>(
02349     IN PERESOURCE Resource
02350     );
02351 
02352 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
02353 BOOLEAN
02354 <a class="code" href="../../d5/d8/ex_8h.html#a268">ExAcquireResourceSharedLite</a>(
02355     IN PERESOURCE Resource,
02356     IN BOOLEAN Wait
02357     );
02358 
02359 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
02360 BOOLEAN
02361 <a class="code" href="../../d5/d8/ex_8h.html#a269">ExAcquireResourceExclusiveLite</a>(
02362     IN PERESOURCE Resource,
02363     IN BOOLEAN Wait
02364     );
02365 
02366 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
02367 BOOLEAN
02368 <a class="code" href="../../d5/d8/ex_8h.html#a270">ExAcquireSharedStarveExclusive</a>(
02369     IN PERESOURCE Resource,
02370     IN BOOLEAN Wait
02371     );
02372 
02373 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
02374 BOOLEAN
02375 <a class="code" href="../../d5/d8/ex_8h.html#a271">ExAcquireSharedWaitForExclusive</a>(
02376     IN PERESOURCE Resource,
02377     IN BOOLEAN Wait
02378     );
02379 
02380 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
02381 BOOLEAN
02382 <a class="code" href="../../d5/d8/ex_8h.html#a272">ExTryToAcquireResourceExclusiveLite</a>(
02383     IN PERESOURCE Resource
02384     );
02385 
02386 <span class="comment">//</span>
02387 <span class="comment">//  VOID</span>
02388 <span class="comment">//  ExReleaseResource(</span>
02389 <span class="comment">//      IN PERESOURCE Resource</span>
02390 <span class="comment">//      );</span>
02391 <span class="comment">//</span>
02392 
<a name="l02393"></a><a class="code" href="../../d5/d8/ex_8h.html#a66">02393</a> <span class="preprocessor">#define ExReleaseResource(R) (ExReleaseResourceLite(R))</span>
02394 <span class="preprocessor"></span>
02395 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
02396 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
02397 <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a0">FASTCALL</a>
02398 <a class="code" href="../../d5/d8/ex_8h.html#a273">ExReleaseResourceLite</a>(
02399     IN PERESOURCE Resource
02400     );
02401 
02402 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
02403 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
02404 <a class="code" href="../../d5/d8/ex_8h.html#a274">ExReleaseResourceForThreadLite</a>(
02405     IN PERESOURCE Resource,
02406     IN ERESOURCE_THREAD ResourceThreadId
02407     );
02408 
02409 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
02410 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
02411 <a class="code" href="../../d5/d8/ex_8h.html#a275">ExSetResourceOwnerPointer</a>(
02412     IN PERESOURCE Resource,
02413     IN PVOID OwnerPointer
02414     );
02415 
02416 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
02417 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
02418 <a class="code" href="../../d5/d8/ex_8h.html#a276">ExConvertExclusiveToSharedLite</a>(
02419     IN PERESOURCE Resource
02420     );
02421 
02422 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
02423 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
02424 <a class="code" href="../../d5/d8/ex_8h.html#a277">ExDeleteResourceLite</a> (
02425     IN PERESOURCE Resource
02426     );
02427 
02428 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
02429 ULONG
02430 <a class="code" href="../../d5/d8/ex_8h.html#a278">ExGetExclusiveWaiterCount</a> (
02431     IN PERESOURCE Resource
02432     );
02433 
02434 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
02435 ULONG
02436 <a class="code" href="../../d5/d8/ex_8h.html#a279">ExGetSharedWaiterCount</a> (
02437     IN PERESOURCE Resource
02438     );
02439 
02440 <span class="comment">// end_ntddk</span>
02441 
02442 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
02443 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
02444 <a class="code" href="../../d5/d8/ex_8h.html#a280">ExDisableResourceBoostLite</a> (
02445     IN PERESOURCE Resource
02446     );
02447 
02448 <span class="comment">// begin_ntddk</span>
02449 <span class="comment">//</span>
02450 <span class="comment">//  ERESOURCE_THREAD</span>
02451 <span class="comment">//  ExGetCurrentResourceThread(</span>
02452 <span class="comment">//      );</span>
02453 <span class="comment">//</span>
02454 
<a name="l02455"></a><a class="code" href="../../d5/d8/ex_8h.html#a67">02455</a> <span class="preprocessor">#define ExGetCurrentResourceThread() ((ULONG_PTR)PsGetCurrentThread())</span>
02456 <span class="preprocessor"></span>
02457 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
02458 BOOLEAN
02459 <a class="code" href="../../d5/d8/ex_8h.html#a281">ExIsResourceAcquiredExclusiveLite</a> (
02460     IN PERESOURCE Resource
02461     );
02462 
02463 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
02464 ULONG
02465 <a class="code" href="../../d5/d8/ex_8h.html#a282">ExIsResourceAcquiredSharedLite</a> (
02466     IN PERESOURCE Resource
02467     );
02468 
02469 <span class="comment">//</span>
02470 <span class="comment">//  ntddk.h stole the entrypoints we wanted so fix them up here.</span>
02471 <span class="comment">//</span>
02472 
<a name="l02473"></a><a class="code" href="../../d5/d8/ex_8h.html#a68">02473</a> <span class="preprocessor">#define ExInitializeResource ExInitializeResourceLite</span>
<a name="l02474"></a><a class="code" href="../../d5/d8/ex_8h.html#a69">02474</a> <span class="preprocessor"></span><span class="preprocessor">#define ExAcquireResourceShared ExAcquireResourceSharedLite</span>
<a name="l02475"></a><a class="code" href="../../d5/d8/ex_8h.html#a70">02475</a> <span class="preprocessor"></span><span class="preprocessor">#define ExAcquireResourceExclusive ExAcquireResourceExclusiveLite</span>
<a name="l02476"></a><a class="code" href="../../d5/d8/ex_8h.html#a71">02476</a> <span class="preprocessor"></span><span class="preprocessor">#define ExReleaseResourceForThread ExReleaseResourceForThreadLite</span>
<a name="l02477"></a><a class="code" href="../../d5/d8/ex_8h.html#a72">02477</a> <span class="preprocessor"></span><span class="preprocessor">#define ExConvertExclusiveToShared ExConvertExclusiveToSharedLite</span>
<a name="l02478"></a><a class="code" href="../../d5/d8/ex_8h.html#a73">02478</a> <span class="preprocessor"></span><span class="preprocessor">#define ExDeleteResource ExDeleteResourceLite</span>
<a name="l02479"></a><a class="code" href="../../d5/d8/ex_8h.html#a74">02479</a> <span class="preprocessor"></span><span class="preprocessor">#define ExIsResourceAcquiredExclusive ExIsResourceAcquiredExclusiveLite</span>
<a name="l02480"></a><a class="code" href="../../d5/d8/ex_8h.html#a75">02480</a> <span class="preprocessor"></span><span class="preprocessor">#define ExIsResourceAcquiredShared ExIsResourceAcquiredSharedLite</span>
02481 <span class="preprocessor"></span><span class="comment">// end_ntddk</span>
<a name="l02482"></a><a class="code" href="../../d5/d8/ex_8h.html#a76">02482</a> <span class="preprocessor">#define ExDisableResourceBoost ExDisableResourceBoostLite</span>
02483 <span class="preprocessor"></span><span class="comment">// end_ntifs</span>
02484 
02485 <span class="preprocessor">#if DEVL</span>
02486 <span class="preprocessor"></span><a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
02487 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
02488 <a class="code" href="../../d8/d8/ex_2resource_8c.html#a32">ExQuerySystemLockInformation</a>(
02489     OUT <span class="keyword">struct</span> _RTL_PROCESS_LOCKS *LockInformation,
02490     IN ULONG LockInformationLength,
02491     OUT PULONG ReturnLength OPTIONAL
02492     );
02493 <span class="preprocessor">#endif // DEVL</span>
02494 <span class="preprocessor"></span>
02495 <span class="comment">//</span>
02496 <span class="comment">//  Shared resource function definitions (in resource.c).</span>
02497 <span class="comment">//</span>
02498 <span class="comment">//  This definition here matches the ntddk one defined above.  It allows</span>
02499 <span class="comment">//  the resource package to deal with these antiquated objects.</span>
02500 <span class="comment">//</span>
02501 
<a name="l02502"></a><a class="code" href="../../d3/d4/struct__NTDDK__ERESOURCE.html">02502</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d3/d4/struct__NTDDK__ERESOURCE.html">_NTDDK_ERESOURCE</a> {
02503 
02504     <span class="comment">//</span>
02505     <span class="comment">//  First 8 bytes are used to align the next part of the structure</span>
02506     <span class="comment">//  onto 16 bytes.  (typical case)</span>
02507     <span class="comment">//</span>
02508 
<a name="l02509"></a><a class="code" href="../../d3/d4/struct__NTDDK__ERESOURCE.html#o0">02509</a>     LIST_ENTRY          <a class="code" href="../../d3/d4/struct__NTDDK__ERESOURCE.html#o0">SystemResourcesList</a>;
02510 
02511     <span class="comment">//</span>
02512     <span class="comment">//  Next 128 bits of this structure are field which we know</span>
02513     <span class="comment">//  we will hit to obtain this resource either shared or exclusive</span>
02514     <span class="comment">//</span>
02515 
<a name="l02516"></a><a class="code" href="../../d3/d4/struct__NTDDK__ERESOURCE.html#o1">02516</a>     <a class="code" href="../../d5/d8/ex_8h.html#a122">PERESOURCE_THREAD</a>   <a class="code" href="../../d3/d4/struct__NTDDK__ERESOURCE.html#o1">OwnerThreads</a>;
<a name="l02517"></a><a class="code" href="../../d3/d4/struct__NTDDK__ERESOURCE.html#o2">02517</a>     PUCHAR              <a class="code" href="../../d3/d4/struct__NTDDK__ERESOURCE.html#o2">OwnerCounts</a>;
02518 
<a name="l02519"></a><a class="code" href="../../d3/d4/struct__NTDDK__ERESOURCE.html#o3">02519</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>              <a class="code" href="../../d3/d4/struct__NTDDK__ERESOURCE.html#o3">TableSize</a>;
<a name="l02520"></a><a class="code" href="../../d3/d4/struct__NTDDK__ERESOURCE.html#o4">02520</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>              <a class="code" href="../../d3/d4/struct__NTDDK__ERESOURCE.html#o4">ActiveCount</a>;
02521 
<a name="l02522"></a><a class="code" href="../../d3/d4/struct__NTDDK__ERESOURCE.html#o5">02522</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>              <a class="code" href="../../d3/d4/struct__NTDDK__ERESOURCE.html#o5">Flag</a>;
<a name="l02523"></a><a class="code" href="../../d3/d4/struct__NTDDK__ERESOURCE.html#o6">02523</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>              <a class="code" href="../../d3/d4/struct__NTDDK__ERESOURCE.html#o6">TableRover</a>;                 <span class="comment">// (0 - 128 bits)</span>
02524 
02525     <span class="comment">//</span>
02526     <span class="comment">//  Next 128 bits contain the initial counters and at least the</span>
02527     <span class="comment">//  first initial thread (which is also highly updated)</span>
02528     <span class="comment">//</span>
02529 
<a name="l02530"></a><a class="code" href="../../d3/d4/struct__NTDDK__ERESOURCE.html#o7">02530</a>     UCHAR               <a class="code" href="../../d3/d4/struct__NTDDK__ERESOURCE.html#o7">InitialOwnerCounts</a>[4];
<a name="l02531"></a><a class="code" href="../../d3/d4/struct__NTDDK__ERESOURCE.html#o8">02531</a>     <a class="code" href="../../d5/d8/ex_8h.html#a121">ERESOURCE_THREAD</a>    <a class="code" href="../../d3/d4/struct__NTDDK__ERESOURCE.html#o8">InitialOwnerThreads</a>[4];
02532 
<a name="l02533"></a><a class="code" href="../../d3/d4/struct__NTDDK__ERESOURCE.html#o9">02533</a>     ULONG               <a class="code" href="../../d3/d4/struct__NTDDK__ERESOURCE.html#o9">Spare1</a>;
02534 
02535     <span class="comment">//</span>
02536     <span class="comment">//  The rest is what ever was left.  The spinlock is in with</span>
02537     <span class="comment">//  a part of the structure we normally don't touch in the</span>
02538     <span class="comment">//  hot paths (read or write)</span>
02539     <span class="comment">//</span>
02540 
<a name="l02541"></a><a class="code" href="../../d3/d4/struct__NTDDK__ERESOURCE.html#o10">02541</a>     ULONG               <a class="code" href="../../d3/d4/struct__NTDDK__ERESOURCE.html#o10">ContentionCount</a>;
02542 
<a name="l02543"></a><a class="code" href="../../d3/d4/struct__NTDDK__ERESOURCE.html#o11">02543</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>              <a class="code" href="../../d3/d4/struct__NTDDK__ERESOURCE.html#o11">NumberOfExclusiveWaiters</a>;
<a name="l02544"></a><a class="code" href="../../d3/d4/struct__NTDDK__ERESOURCE.html#o12">02544</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>              <a class="code" href="../../d3/d4/struct__NTDDK__ERESOURCE.html#o12">NumberOfSharedWaiters</a>;
02545 
<a name="l02546"></a><a class="code" href="../../d3/d4/struct__NTDDK__ERESOURCE.html#o13">02546</a>     <a class="code" href="../../d8/d7/struct__KSEMAPHORE.html">KSEMAPHORE</a>          <a class="code" href="../../d3/d4/struct__NTDDK__ERESOURCE.html#o13">SharedWaiters</a>;
<a name="l02547"></a><a class="code" href="../../d3/d4/struct__NTDDK__ERESOURCE.html#o14">02547</a>     <a class="code" href="../../d2/d6/struct__KEVENT.html">KEVENT</a>              <a class="code" href="../../d3/d4/struct__NTDDK__ERESOURCE.html#o14">ExclusiveWaiters</a>;
02548 
<a name="l02549"></a><a class="code" href="../../d3/d4/struct__NTDDK__ERESOURCE.html#o15">02549</a>     KSPIN_LOCK          <a class="code" href="../../d3/d4/struct__NTDDK__ERESOURCE.html#o15">SpinLock</a>;
02550 
<a name="l02551"></a><a class="code" href="../../d3/d4/struct__NTDDK__ERESOURCE.html#o16">02551</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d3/d4/struct__NTDDK__ERESOURCE.html#o16">CreatorBackTraceIndex</a>;
<a name="l02552"></a><a class="code" href="../../d3/d4/struct__NTDDK__ERESOURCE.html#o17">02552</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d3/d4/struct__NTDDK__ERESOURCE.html#o17">Spare2</a>;
02553 
02554 } <a class="code" href="../../d3/d4/struct__NTDDK__ERESOURCE.html">NTDDK_ERESOURCE</a>;
<a name="l02555"></a><a class="code" href="../../d5/d8/ex_8h.html#a132">02555</a> <span class="keyword">typedef</span> <a class="code" href="../../d3/d4/struct__NTDDK__ERESOURCE.html">NTDDK_ERESOURCE</a> *<a class="code" href="../../d3/d4/struct__NTDDK__ERESOURCE.html">PNTDDK_ERESOURCE</a>;
02556 
02557 <span class="comment">//</span>
02558 <span class="comment">//  These are routines that were unfortunately exported to ntddk.h</span>
02559 <span class="comment">//</span>
02560 <span class="comment">//  They live in ntos\ex\ddkresrc.c</span>
02561 <span class="comment">//</span>
02562 
02563 <span class="comment">//</span>
02564 <span class="comment">//  NTKERNELAPI</span>
02565 <span class="comment">//  NTSTATUS</span>
02566 <span class="comment">//  ExInitializeResource(</span>
02567 <span class="comment">//      IN PNTDDK_ERESOURCE Resource</span>
02568 <span class="comment">//      );</span>
02569 <span class="comment">//</span>
02570 <span class="comment">//  NTKERNELAPI</span>
02571 <span class="comment">//  BOOLEAN</span>
02572 <span class="comment">//  ExAcquireResourceExclusive(</span>
02573 <span class="comment">//      IN PNTDDK_ERESOURCE Resource,</span>
02574 <span class="comment">//      IN BOOLEAN Wait</span>
02575 <span class="comment">//      );</span>
02576 <span class="comment">//</span>
02577 <span class="comment">//  NTKERNELAPI</span>
02578 <span class="comment">//  VOID</span>
02579 <span class="comment">//  ExReleaseResourceForThread(</span>
02580 <span class="comment">//      IN PNTDDK_ERESOURCE Resource,</span>
02581 <span class="comment">//      IN ERESOURCE_THREAD ResourceThreadId</span>
02582 <span class="comment">//      );</span>
02583 <span class="comment">//</span>
02584 <span class="comment">//  NTKERNELAPI</span>
02585 <span class="comment">//  NTSTATUS</span>
02586 <span class="comment">//      ExDeleteResource (</span>
02587 <span class="comment">//      IN PNTDDK_ERESOURCE Resource</span>
02588 <span class="comment">//      );</span>
02589 <span class="comment">//</span>
02590 
02591 
02592 <span class="comment">//</span>
02593 <span class="comment">//  The Ex/Ob handle table interface package (in handle.c)</span>
02594 <span class="comment">//</span>
02595 
02596 <span class="comment">//</span>
02597 <span class="comment">//  The Ex/Ob handle table package uses a common handle definition.  The actual</span>
02598 <span class="comment">//  type definition for a handle is a pvoid and is declared in sdk/inc.  This</span>
02599 <span class="comment">//  package uses only the low 32 bits of the pvoid pointer.</span>
02600 <span class="comment">//</span>
02601 <span class="comment">//  For simplicity we declare a new typedef called an exhandle</span>
02602 <span class="comment">//</span>
02603 <span class="comment">//  The 2 bits of an EXHANDLE is available to the application and is</span>
02604 <span class="comment">//  ignored by the system.  The next 24 bits store the handle table entry</span>
02605 <span class="comment">//  index and is used to refer to a particular entry in a handle table.</span>
02606 <span class="comment">//</span>
02607 <span class="comment">//  Note that this format is immutable because there are outside programs with</span>
02608 <span class="comment">//  hardwired code that already assumes the format of a handle.</span>
02609 <span class="comment">//</span>
02610 
<a name="l02611"></a><a class="code" href="../../d7/d8/struct__EXHANDLE.html">02611</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d7/d8/struct__EXHANDLE.html">_EXHANDLE</a> {
02612 
02613     <span class="keyword">union </span>{
02614 
02615         <span class="keyword">struct </span>{
02616 
02617             <span class="comment">//</span>
02618             <span class="comment">//  Application available tag bits</span>
02619             <span class="comment">//</span>
02620 
<a name="l02621"></a><a class="code" href="../../d7/d8/struct__EXHANDLE.html#o0">02621</a>             ULONG <a class="code" href="../../d7/d8/struct__EXHANDLE.html#o0">TagBits</a> : 2;
02622 
02623             <span class="comment">//</span>
02624             <span class="comment">//  The handle table entry index</span>
02625             <span class="comment">//</span>
02626 
<a name="l02627"></a><a class="code" href="../../d7/d8/struct__EXHANDLE.html#o1">02627</a>             ULONG <a class="code" href="../../d7/d8/struct__EXHANDLE.html#o1">Index</a> : 30;
02628         };
02629 
<a name="l02630"></a><a class="code" href="../../d7/d8/struct__EXHANDLE.html#o2">02630</a>         HANDLE <a class="code" href="../../d7/d8/struct__EXHANDLE.html#o2">GenericHandleOverlay</a>;
02631     };
02632 
02633 } <a class="code" href="../../d7/d8/struct__EXHANDLE.html">EXHANDLE</a>, *<a class="code" href="../../d7/d8/struct__EXHANDLE.html">PEXHANDLE</a>;
02634 
02635 <span class="comment">//</span>
02636 <span class="comment">//  A handle table stores multiple handle table entries, each entry is looked</span>
02637 <span class="comment">//  up by its exhandle.  A handle table entry has really two fields.</span>
02638 <span class="comment">//</span>
02639 <span class="comment">//  The first field contains a pointer object and is overloaded with the three</span>
02640 <span class="comment">//  low order bits used by ob to denote inherited, protected, and audited</span>
02641 <span class="comment">//  objects.   The upper bit used as a handle table entry lock.  Note, this</span>
02642 <span class="comment">//  means that all valid object pointers must be at least longword aligned and</span>
02643 <span class="comment">//  have their sign bit set (i.e., be negative).</span>
02644 <span class="comment">//</span>
02645 <span class="comment">//  The next field contains the acces mask (sometimes in the form of a granted</span>
02646 <span class="comment">//  access index, and creator callback trace) if the entry is in use or a</span>
02647 <span class="comment">//  pointer in the free list if the entry is free.</span>
02648 <span class="comment">//</span>
02649 <span class="comment">//  Two things to note:</span>
02650 <span class="comment">//</span>
02651 <span class="comment">//  1. An entry is free if the object pointer is null, this means that the</span>
02652 <span class="comment">//     following field contains the FreeTableEntryList.</span>
02653 <span class="comment">//</span>
02654 <span class="comment">//  2. An entry is unlocked if the object pointer is positive and locked if its</span>
02655 <span class="comment">//     negative.  The handle package through callbacks and Map Handle to</span>
02656 <span class="comment">//     Pointer will lock the entry (thus making the pointer valid) outside</span>
02657 <span class="comment">//     routines can then read and reset the attributes field and the object</span>
02658 <span class="comment">//     provided they don't unlock the entry.  When the callbacks return the</span>
02659 <span class="comment">//     entry will be unlocked and the callers or MapHandleToPointer will need</span>
02660 <span class="comment">//     to call UnlockHandleTableEntry explicitly.</span>
02661 <span class="comment">//</span>
02662 
<a name="l02663"></a><a class="code" href="../../d7/d3/struct__HANDLE__TABLE__ENTRY.html">02663</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d7/d3/struct__HANDLE__TABLE__ENTRY.html">_HANDLE_TABLE_ENTRY</a> {
02664 
02665     <span class="comment">//</span>
02666     <span class="comment">//  The pointer to the object overloaded with three ob attributes bits in</span>
02667     <span class="comment">//  the lower order and the high bit to denote locked or unlocked entries</span>
02668     <span class="comment">//</span>
02669 
02670     <span class="keyword">union </span>{
02671 
<a name="l02672"></a><a class="code" href="../../d7/d3/struct__HANDLE__TABLE__ENTRY.html#o0">02672</a>         PVOID <a class="code" href="../../d7/d3/struct__HANDLE__TABLE__ENTRY.html#o0">Object</a>;
02673 
<a name="l02674"></a><a class="code" href="../../d7/d3/struct__HANDLE__TABLE__ENTRY.html#o1">02674</a>         ULONG <a class="code" href="../../d7/d3/struct__HANDLE__TABLE__ENTRY.html#o1">ObAttributes</a>;
02675     };
02676 
02677     <span class="comment">//</span>
02678     <span class="comment">//  This field either contains the granted access mask for the handle or an</span>
02679     <span class="comment">//  ob variation that also stores the same information.  Or in the case of</span>
02680     <span class="comment">//  a free entry the field stores the index for the next free entry in the</span>
02681     <span class="comment">//  free list.  This is like a FAT chain, and is used instead of pointers</span>
02682     <span class="comment">//  to make table duplication easier, because the entries can just be</span>
02683     <span class="comment">//  copied without needing to modify pointers.</span>
02684     <span class="comment">//</span>
02685 
02686     <span class="keyword">union </span>{
02687 
02688         <span class="keyword">union </span>{
02689 
<a name="l02690"></a><a class="code" href="../../d7/d3/struct__HANDLE__TABLE__ENTRY.html#o2">02690</a>             ACCESS_MASK <a class="code" href="../../d7/d3/struct__HANDLE__TABLE__ENTRY.html#o2">GrantedAccess</a>;
02691 
02692             <span class="keyword">struct </span>{
02693 
<a name="l02694"></a><a class="code" href="../../d7/d3/struct__HANDLE__TABLE__ENTRY.html#o3">02694</a>                 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d7/d3/struct__HANDLE__TABLE__ENTRY.html#o3">GrantedAccessIndex</a>;
<a name="l02695"></a><a class="code" href="../../d7/d3/struct__HANDLE__TABLE__ENTRY.html#o4">02695</a>                 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d7/d3/struct__HANDLE__TABLE__ENTRY.html#o4">CreatorBackTraceIndex</a>;
02696             };
02697         };
02698 
<a name="l02699"></a><a class="code" href="../../d7/d3/struct__HANDLE__TABLE__ENTRY.html#o5">02699</a>         LONG <a class="code" href="../../d7/d3/struct__HANDLE__TABLE__ENTRY.html#o5">NextFreeTableEntry</a>;
02700     };
02701 
02702 } <a class="code" href="../../d7/d3/struct__HANDLE__TABLE__ENTRY.html">HANDLE_TABLE_ENTRY</a>, *<a class="code" href="../../d7/d3/struct__HANDLE__TABLE__ENTRY.html">PHANDLE_TABLE_ENTRY</a>;
02703 
02704 <span class="comment">//</span>
02705 <span class="comment">//  One handle table exists per process.  Unless otherwise specified, via a</span>
02706 <span class="comment">//  call to RemoveHandleTable, all handle tables are linked together in a</span>
02707 <span class="comment">//  global list.  This list is used by the snapshot handle tables call.</span>
02708 <span class="comment">//</span>
02709 
<a name="l02710"></a><a class="code" href="../../d6/d3/struct__HANDLE__TABLE.html">02710</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d6/d3/struct__HANDLE__TABLE.html">_HANDLE_TABLE</a> {
02711 
02712     <span class="comment">//</span>
02713     <span class="comment">//  A set of flags used to denote the state or attributes of this</span>
02714     <span class="comment">//  particular handle table</span>
02715     <span class="comment">//</span>
02716 
<a name="l02717"></a><a class="code" href="../../d6/d3/struct__HANDLE__TABLE.html#o0">02717</a>     ULONG <a class="code" href="../../d6/d3/struct__HANDLE__TABLE.html#o0">Flags</a>;
02718 
02719     <span class="comment">//</span>
02720     <span class="comment">//  The number of handle table entries in use.</span>
02721     <span class="comment">//</span>
02722 
<a name="l02723"></a><a class="code" href="../../d6/d3/struct__HANDLE__TABLE.html#o1">02723</a>     LONG <a class="code" href="../../d6/d3/struct__HANDLE__TABLE.html#o1">HandleCount</a>;
02724 
02725     <span class="comment">//</span>
02726     <span class="comment">//  A pointer to the top level handle table tree node.</span>
02727     <span class="comment">//</span>
02728 
<a name="l02729"></a><a class="code" href="../../d6/d3/struct__HANDLE__TABLE.html#o2">02729</a>     <a class="code" href="../../d5/d8/ex_8h.html#a136">PHANDLE_TABLE_ENTRY</a> **<a class="code" href="../../d6/d3/struct__HANDLE__TABLE.html#o2">Table</a>;
02730 
02731     <span class="comment">//</span>
02732     <span class="comment">//  The process who is being charged quota for this handle table and a</span>
02733     <span class="comment">//  unique process id to use in our callbacks</span>
02734     <span class="comment">//</span>
02735 
<a name="l02736"></a><a class="code" href="../../d6/d3/struct__HANDLE__TABLE.html#o3">02736</a>     <span class="keyword">struct </span><a class="code" href="../../d0/d4/struct__EPROCESS.html">_EPROCESS</a> *<a class="code" href="../../d6/d3/struct__HANDLE__TABLE.html#o3">QuotaProcess</a>;
<a name="l02737"></a><a class="code" href="../../d6/d3/struct__HANDLE__TABLE.html#o4">02737</a>     HANDLE <a class="code" href="../../d6/d3/struct__HANDLE__TABLE.html#o4">UniqueProcessId</a>;
02738 
02739     <span class="comment">//</span>
02740     <span class="comment">//  This is a singly linked list of free table entries.  We don't actually</span>
02741     <span class="comment">//  use pointers, but have each store the index of the next free entry</span>
02742     <span class="comment">//  in the list.  The list is managed as a lifo list.  We also keep track</span>
02743     <span class="comment">//  of the next index that we have to allocate pool to hold.</span>
02744     <span class="comment">//</span>
02745 
<a name="l02746"></a><a class="code" href="../../d6/d3/struct__HANDLE__TABLE.html#o5">02746</a>     LONG <a class="code" href="../../d6/d3/struct__HANDLE__TABLE.html#o5">FirstFreeTableEntry</a>;
<a name="l02747"></a><a class="code" href="../../d6/d3/struct__HANDLE__TABLE.html#o6">02747</a>     LONG <a class="code" href="../../d6/d3/struct__HANDLE__TABLE.html#o6">NextIndexNeedingPool</a>;
02748 
02749     <span class="comment">//</span>
02750     <span class="comment">//  This is the lock used to protect the fields in the record, and the</span>
02751     <span class="comment">//  handle table tree in general.  Individual handle table entries that are</span>
02752     <span class="comment">//  not free have their own lock</span>
02753     <span class="comment">//</span>
02754 
<a name="l02755"></a><a class="code" href="../../d6/d3/struct__HANDLE__TABLE.html#o7">02755</a>     <a class="code" href="../../d6/d4/struct__ERESOURCE.html">ERESOURCE</a> <a class="code" href="../../d6/d3/struct__HANDLE__TABLE.html#o7">HandleTableLock</a>;
02756 
02757     <span class="comment">//</span>
02758     <span class="comment">//  The list of global handle tables.  This field is protected by a global</span>
02759     <span class="comment">//  lock.</span>
02760     <span class="comment">//</span>
02761 
<a name="l02762"></a><a class="code" href="../../d6/d3/struct__HANDLE__TABLE.html#o8">02762</a>     LIST_ENTRY <a class="code" href="../../d6/d3/struct__HANDLE__TABLE.html#o8">HandleTableList</a>;
02763 
02764     <span class="comment">//</span>
02765     <span class="comment">//  The following field is used to loosely synchronize thread contention</span>
02766     <span class="comment">//  on a handle.  If a thread wants to wait for a handle to be unlocked</span>
02767     <span class="comment">//  it will wait on this event with a short timeout.  Any handle unlock</span>
02768     <span class="comment">//  operation will pulse this event if there are threads waiting on it</span>
02769     <span class="comment">//</span>
02770 
<a name="l02771"></a><a class="code" href="../../d6/d3/struct__HANDLE__TABLE.html#o9">02771</a>     <a class="code" href="../../d2/d6/struct__KEVENT.html">KEVENT</a> <a class="code" href="../../d6/d3/struct__HANDLE__TABLE.html#o9">HandleContentionEvent</a>;
02772 
02773 } <a class="code" href="../../d6/d3/struct__HANDLE__TABLE.html">HANDLE_TABLE</a>, *<a class="code" href="../../d6/d3/struct__HANDLE__TABLE.html">PHANDLE_TABLE</a>;
02774 
02775 <span class="comment">//</span>
02776 <span class="comment">//  Routines for handle manipulation.</span>
02777 <span class="comment">//</span>
02778 
02779 <span class="comment">//</span>
02780 <span class="comment">//  Functions for locking and unlocking the handle table, and for locking and</span>
02781 <span class="comment">//  locking handle table entries</span>
02782 <span class="comment">//</span>
02783 
02784 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
02785 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
02786 <a class="code" href="../../d5/d8/ex_8h.html#a283">ExLockHandleTableShared</a> (
02787     PHANDLE_TABLE HandleTable
02788     );
02789 
02790 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
02791 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
02792 <a class="code" href="../../d5/d8/ex_8h.html#a284">ExLockHandleTableExclusive</a> (
02793     PHANDLE_TABLE HandleTable
02794     );
02795 
02796 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
02797 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
02798 <a class="code" href="../../d5/d8/ex_8h.html#a285">ExUnlockHandleTableShared</a> (
02799     PHANDLE_TABLE HandleTable
02800     );
02801 
02802 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
02803 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
02804 <a class="code" href="../../d5/d8/ex_8h.html#a286">ExUnlockHandleTableExclusive</a> (
02805     PHANDLE_TABLE HandleTable
02806     );
02807 
02808 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
02809 BOOLEAN
02810 <a class="code" href="../../d5/d8/ex_8h.html#a287">ExLockHandleTableEntry</a> (
02811     PHANDLE_TABLE HandleTable,
02812     PHANDLE_TABLE_ENTRY HandleTableEntry
02813     );
02814 
02815 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
02816 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
02817 <a class="code" href="../../d5/d8/ex_8h.html#a288">ExUnlockHandleTableEntry</a> (
02818     PHANDLE_TABLE HandleTable,
02819     PHANDLE_TABLE_ENTRY HandleTableEntry
02820     );
02821 
02822 <span class="comment">//</span>
02823 <span class="comment">//  A global initialization function called on at system start up</span>
02824 <span class="comment">//</span>
02825 
02826 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
02827 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
02828 <a class="code" href="../../d5/d8/ex_8h.html#a289">ExInitializeHandleTablePackage</a> (
02829     VOID
02830     );
02831 
02832 <span class="comment">//</span>
02833 <span class="comment">//  Functions to create, remove, and destroy handle tables per process.  The</span>
02834 <span class="comment">//  destroy function uses a callback.</span>
02835 <span class="comment">//</span>
02836 
02837 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
02838 <a class="code" href="../../d5/d8/ex_8h.html#a138">PHANDLE_TABLE</a>
02839 <a class="code" href="../../d5/d8/ex_8h.html#a290">ExCreateHandleTable</a> (
02840     IN <span class="keyword">struct</span> <a class="code" href="../../d0/d4/struct__EPROCESS.html">_EPROCESS</a> *Process OPTIONAL
02841     );
02842 
02843 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
02844 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
02845 <a class="code" href="../../d5/d8/ex_8h.html#a291">ExRemoveHandleTable</a> (
02846     IN PHANDLE_TABLE HandleTable
02847     );
02848 
<a name="l02849"></a><a class="code" href="../../d5/d8/ex_8h.html#a139">02849</a> <span class="keyword">typedef</span> <a class="code" href="../../d0/d6/iop_8h.html#a145">VOID</a> (*<a class="code" href="../../d5/d8/ex_8h.html#a139">EX_DESTROY_HANDLE_ROUTINE</a>)(
02850     IN HANDLE <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a>
02851     );
02852 
02853 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
02854 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
02855 <a class="code" href="../../d5/d8/ex_8h.html#a292">ExDestroyHandleTable</a> (
02856     IN PHANDLE_TABLE HandleTable,
02857     IN EX_DESTROY_HANDLE_ROUTINE DestroyHandleProcedure
02858     );
02859 
02860 <span class="comment">//</span>
02861 <span class="comment">//  A function to enumerate through the handle table of a process using a</span>
02862 <span class="comment">//  callback.</span>
02863 <span class="comment">//</span>
02864 
<a name="l02865"></a><a class="code" href="../../d5/d8/ex_8h.html#a140">02865</a> <span class="keyword">typedef</span> BOOLEAN (*<a class="code" href="../../d5/d8/ex_8h.html#a140">EX_ENUMERATE_HANDLE_ROUTINE</a>)(
02866     IN <a class="code" href="../../d5/d8/ex_8h.html#a136">PHANDLE_TABLE_ENTRY</a> HandleTableEntry,
02867     IN HANDLE <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a>,
02868     IN PVOID EnumParameter
02869     );
02870 
02871 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
02872 BOOLEAN
02873 <a class="code" href="../../d5/d8/ex_8h.html#a293">ExEnumHandleTable</a> (
02874     IN PHANDLE_TABLE HandleTable,
02875     IN EX_ENUMERATE_HANDLE_ROUTINE EnumHandleProcedure,
02876     IN PVOID EnumParameter,
02877     OUT PHANDLE Handle OPTIONAL
02878     );
02879 
02880 <span class="comment">//</span>
02881 <span class="comment">//  A function to duplicate the handle table of a process using a callback</span>
02882 <span class="comment">//</span>
02883 
<a name="l02884"></a><a class="code" href="../../d5/d8/ex_8h.html#a141">02884</a> <span class="keyword">typedef</span> BOOLEAN (*<a class="code" href="../../d5/d8/ex_8h.html#a141">EX_DUPLICATE_HANDLE_ROUTINE</a>)(
02885     IN <span class="keyword">struct </span><a class="code" href="../../d0/d4/struct__EPROCESS.html">_EPROCESS</a> *Process OPTIONAL,
02886     IN <a class="code" href="../../d5/d8/ex_8h.html#a136">PHANDLE_TABLE_ENTRY</a> HandleTableEntry
02887     );
02888 
02889 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
02890 <a class="code" href="../../d5/d8/ex_8h.html#a138">PHANDLE_TABLE</a>
02891 <a class="code" href="../../d5/d8/ex_8h.html#a294">ExDupHandleTable</a> (
02892     IN <span class="keyword">struct</span> <a class="code" href="../../d0/d4/struct__EPROCESS.html">_EPROCESS</a> *Process OPTIONAL,
02893     IN PHANDLE_TABLE OldHandleTable,
02894     IN EX_DUPLICATE_HANDLE_ROUTINE DupHandleProcedure OPTIONAL
02895     );
02896 
02897 <span class="comment">//</span>
02898 <span class="comment">//  A function that enumerates all the handles in all the handle tables</span>
02899 <span class="comment">//  throughout the system using a callback.</span>
02900 <span class="comment">//</span>
02901 
<a name="l02902"></a><a class="code" href="../../d5/d8/ex_8h.html#a142">02902</a> <span class="keyword">typedef</span> <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> (*<a class="code" href="../../d5/d8/ex_8h.html#a142">PEX_SNAPSHOT_HANDLE_ENTRY</a>)(
02903     IN OUT PSYSTEM_HANDLE_TABLE_ENTRY_INFO *HandleEntryInfo,
02904     IN HANDLE UniqueProcessId,
02905     IN <a class="code" href="../../d5/d8/ex_8h.html#a136">PHANDLE_TABLE_ENTRY</a> HandleEntry,
02906     IN HANDLE <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a>,
02907     IN ULONG Length,
02908     IN OUT PULONG RequiredLength
02909     );
02910 
02911 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
02912 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
02913 <a class="code" href="../../d5/d8/ex_8h.html#a295">ExSnapShotHandleTables</a> (
02914     IN PEX_SNAPSHOT_HANDLE_ENTRY SnapShotHandleEntry,
02915     IN OUT PSYSTEM_HANDLE_INFORMATION HandleInformation,
02916     IN ULONG Length,
02917     IN OUT PULONG RequiredLength
02918     );
02919 
02920 <span class="comment">//</span>
02921 <span class="comment">//  Functions to create, destroy, and modify handle table entries the modify</span>
02922 <span class="comment">//  function using a callback</span>
02923 <span class="comment">//</span>
02924 
02925 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
02926 HANDLE
02927 <a class="code" href="../../d5/d8/ex_8h.html#a296">ExCreateHandle</a> (
02928     IN PHANDLE_TABLE HandleTable,
02929     IN PHANDLE_TABLE_ENTRY HandleTableEntry
02930     );
02931 
02932 
02933 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
02934 BOOLEAN
02935 <a class="code" href="../../d5/d8/ex_8h.html#a297">ExDestroyHandle</a> (
02936     IN PHANDLE_TABLE HandleTable,
02937     IN HANDLE Handle,
02938     IN PHANDLE_TABLE_ENTRY HandleTableEntry OPTIONAL
02939     );
02940 
02941 
<a name="l02942"></a><a class="code" href="../../d5/d8/ex_8h.html#a143">02942</a> <span class="keyword">typedef</span> BOOLEAN (*<a class="code" href="../../d5/d8/ex_8h.html#a143">PEX_CHANGE_HANDLE_ROUTINE</a>) (
02943     IN OUT <a class="code" href="../../d5/d8/ex_8h.html#a136">PHANDLE_TABLE_ENTRY</a> HandleTableEntry,
02944     IN ULONG_PTR Parameter
02945     );
02946 
02947 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
02948 BOOLEAN
02949 <a class="code" href="../../d5/d8/ex_8h.html#a298">ExChangeHandle</a> (
02950     IN PHANDLE_TABLE HandleTable,
02951     IN HANDLE Handle,
02952     IN PEX_CHANGE_HANDLE_ROUTINE ChangeRoutine,
02953     IN ULONG_PTR Parameter
02954     );
02955 
02956 <span class="comment">//</span>
02957 <span class="comment">//  A function that takes a handle value and returns a pointer to the</span>
02958 <span class="comment">//  associated handle table entry.</span>
02959 <span class="comment">//</span>
02960 
02961 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
02962 <a class="code" href="../../d5/d8/ex_8h.html#a136">PHANDLE_TABLE_ENTRY</a>
02963 <a class="code" href="../../d5/d8/ex_8h.html#a299">ExMapHandleToPointer</a> (
02964     IN PHANDLE_TABLE HandleTable,
02965     IN HANDLE Handle
02966     );
02967 
02968 <span class="comment">//</span>
02969 <span class="comment">//  Macros for resetting the owner of the handle table, and current</span>
02970 <span class="comment">//  noop macro for setting fifo/lifo behaviour of the table</span>
02971 <span class="comment">//</span>
02972 
<a name="l02973"></a><a class="code" href="../../d5/d8/ex_8h.html#a77">02973</a> <span class="preprocessor">#define ExSetHandleTableOwner(ht,id) {(ht)-&gt;UniqueProcessId = (id);}</span>
02974 <span class="preprocessor"></span>
<a name="l02975"></a><a class="code" href="../../d5/d8/ex_8h.html#a78">02975</a> <span class="preprocessor">#define ExSetHandleTableOrder(ht,or) {NOTHING;}</span>
02976 <span class="preprocessor"></span>
02977 
02978 <span class="comment">//</span>
02979 <span class="comment">// Locally Unique Identifier Services</span>
02980 <span class="comment">//</span>
02981 
02982 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
02983 BOOLEAN
02984 <a class="code" href="../../d5/d8/ex_8h.html#a300">ExLuidInitialization</a> (
02985     VOID
02986     );
02987 
02988 <span class="comment">//</span>
02989 <span class="comment">// VOID</span>
02990 <span class="comment">// ExAllocateLocallyUniqueId (</span>
02991 <span class="comment">//     PLUID Luid</span>
02992 <span class="comment">//     )</span>
02993 <span class="comment">//</span>
02994 <span class="comment">//*++</span>
02995 <span class="comment">//</span>
02996 <span class="comment">// Routine Description:</span>
02997 <span class="comment">//</span>
02998 <span class="comment">//     This function returns an LUID value that is unique since the system</span>
02999 <span class="comment">//     was last rebooted. It is unique only on the system it is generated on</span>
03000 <span class="comment">//     and not network wide.</span>
03001 <span class="comment">//</span>
03002 <span class="comment">//     N.B. A LUID is a 64-bit value and for all practical purposes will</span>
03003 <span class="comment">//          never carry in the lifetime of a single boot of the system.</span>
03004 <span class="comment">//          At an increment rate of 1ns, the value would carry to zero in</span>
03005 <span class="comment">//          approximately 126 years.</span>
03006 <span class="comment">//</span>
03007 <span class="comment">// Arguments:</span>
03008 <span class="comment">//</span>
03009 <span class="comment">//     Luid - Supplies a pointer to a variable that receives the allocated</span>
03010 <span class="comment">//          locally unique Id.</span>
03011 <span class="comment">//</span>
03012 <span class="comment">// Return Value:</span>
03013 <span class="comment">//</span>
03014 <span class="comment">//     The allocated LUID value.</span>
03015 <span class="comment">//</span>
03016 <span class="comment">// --*/</span>
03017 
03018 
<a name="l03019"></a><a class="code" href="../../d5/d8/ex_8h.html#a144">03019</a> <span class="keyword">extern</span> LARGE_INTEGER <a class="code" href="../../d0/d8/luid_8c.html#a0">ExpLuid</a>;
<a name="l03020"></a><a class="code" href="../../d5/d8/ex_8h.html#a145">03020</a> <span class="keyword">extern</span> LARGE_INTEGER <a class="code" href="../../d0/d8/luid_8c.html#a1">ExpLuidIncrement</a>;
<a name="l03021"></a><a class="code" href="../../d5/d8/ex_8h.html#a146">03021</a> <span class="keyword">extern</span> KSPIN_LOCK <a class="code" href="../../d4/d4/alpha_2splocks_8c.html#a4">ExpLuidLock</a>;
03022 
03023 
<a name="l03024"></a><a class="code" href="../../d5/d8/ex_8h.html#a79">03024</a> <span class="preprocessor">#define ExAllocateLocallyUniqueId(Luid)                                 \</span>
03025 <span class="preprocessor">    {                                                                   \</span>
03026 <span class="preprocessor">    LARGE_INTEGER _TempLi;                                              \</span>
03027 <span class="preprocessor">                                                                        \</span>
03028 <span class="preprocessor">    _TempLi = ExInterlockedExchangeAddLargeInteger(&amp;ExpLuid,            \</span>
03029 <span class="preprocessor">                                                   ExpLuidIncrement,    \</span>
03030 <span class="preprocessor">                                                   &amp;ExpLuidLock);       \</span>
03031 <span class="preprocessor">    (Luid)-&gt;LowPart = _TempLi.LowPart;                                  \</span>
03032 <span class="preprocessor">    (Luid)-&gt;HighPart = _TempLi.HighPart;                                \</span>
03033 <span class="preprocessor">    }</span>
03034 <span class="preprocessor"></span>
03035 
03036 <span class="comment">// begin_ntddk begin_wdm begin_ntifs</span>
03037 <span class="comment">//</span>
03038 <span class="comment">// Get previous mode</span>
03039 <span class="comment">//</span>
03040 
03041 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
03042 <a class="code" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a>
03043 <a class="code" href="../../d5/d8/ex_8h.html#a301">ExGetPreviousMode</a>(
03044     VOID
03045     );
03046 <span class="comment">// end_ntddk end_wdm end_ntifs</span>
03047 
03048 <span class="comment">//</span>
03049 <span class="comment">// Raise exception from kernel mode.</span>
03050 <span class="comment">//</span>
03051 
03052 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
03053 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
03054 NTAPI
03055 <a class="code" href="../../d5/d8/ex_8h.html#a302">ExRaiseException</a> (
03056     PEXCEPTION_RECORD ExceptionRecord
03057     );
03058 
03059 <span class="comment">// begin_ntddk begin_wdm begin_ntifs</span>
03060 <span class="comment">//</span>
03061 <span class="comment">// Raise status from kernel mode.</span>
03062 <span class="comment">//</span>
03063 
03064 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
03065 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
03066 NTAPI
03067 <a class="code" href="../../d5/d8/ex_8h.html#a303">ExRaiseStatus</a> (
03068     IN NTSTATUS Status
03069     );
03070 
03071 <span class="comment">// end_wdm</span>
03072 
03073 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
03074 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
03075 <a class="code" href="../../d5/d8/ex_8h.html#a304">ExRaiseDatatypeMisalignment</a> (
03076     VOID
03077     );
03078 
03079 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
03080 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
03081 <a class="code" href="../../d5/d8/ex_8h.html#a305">ExRaiseAccessViolation</a> (
03082     VOID
03083     );
03084 
03085 <span class="comment">// end_ntddk end_ntifs</span>
03086 
<a name="l03087"></a><a class="code" href="../../d5/d8/ex_8h.html#a147">03087</a> <span class="keyword">extern</span> BOOLEAN <a class="code" href="../../d6/d8/ex_2harderr_8c.html#a5">ExReadyForErrors</a>;
03088 
03089 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
03090 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
03091 <a class="code" href="../../d5/d8/ex_8h.html#a306">ExRaiseHardError</a>(
03092     IN NTSTATUS ErrorStatus,
03093     IN ULONG NumberOfParameters,
03094     IN ULONG UnicodeStringParameterMask,
03095     IN PULONG_PTR Parameters,
03096     IN ULONG ValidResponseOptions,
03097     OUT PULONG Response
03098     );
03099 
03100 <span class="keywordtype">int</span>
03101 <a class="code" href="../../d5/d8/ex_8h.html#a307">ExSystemExceptionFilter</a>(
03102     VOID
03103     );
03104 
03105 <span class="comment">//</span>
03106 <span class="comment">// The following are global counters used by the EX component to indicate</span>
03107 <span class="comment">// the amount of EventPair transactions being performed in the system.</span>
03108 <span class="comment">//</span>
03109 
<a name="l03110"></a><a class="code" href="../../d5/d8/ex_8h.html#a148">03110</a> <span class="keyword">extern</span> ULONG <a class="code" href="../../d3/d8/eventpr_8c.html#a0">EvPrSetHigh</a>;
<a name="l03111"></a><a class="code" href="../../d5/d8/ex_8h.html#a149">03111</a> <span class="keyword">extern</span> ULONG <a class="code" href="../../d3/d8/eventpr_8c.html#a1">EvPrSetLow</a>;
03112 
03113 
03114 <span class="comment">//</span>
03115 <span class="comment">// Debug event logging facility</span>
03116 <span class="comment">//</span>
03117 
<a name="l03118"></a><a class="code" href="../../d5/d8/ex_8h.html#a80">03118</a> <span class="preprocessor">#define EX_DEBUG_LOG_FORMAT_NONE     (UCHAR)0</span>
<a name="l03119"></a><a class="code" href="../../d5/d8/ex_8h.html#a81">03119</a> <span class="preprocessor"></span><span class="preprocessor">#define EX_DEBUG_LOG_FORMAT_ULONG    (UCHAR)1</span>
<a name="l03120"></a><a class="code" href="../../d5/d8/ex_8h.html#a82">03120</a> <span class="preprocessor"></span><span class="preprocessor">#define EX_DEBUG_LOG_FORMAT_PSZ      (UCHAR)2</span>
<a name="l03121"></a><a class="code" href="../../d5/d8/ex_8h.html#a83">03121</a> <span class="preprocessor"></span><span class="preprocessor">#define EX_DEBUG_LOG_FORMAT_PWSZ     (UCHAR)3</span>
<a name="l03122"></a><a class="code" href="../../d5/d8/ex_8h.html#a84">03122</a> <span class="preprocessor"></span><span class="preprocessor">#define EX_DEBUG_LOG_FORMAT_STRING   (UCHAR)4</span>
<a name="l03123"></a><a class="code" href="../../d5/d8/ex_8h.html#a85">03123</a> <span class="preprocessor"></span><span class="preprocessor">#define EX_DEBUG_LOG_FORMAT_USTRING  (UCHAR)5</span>
<a name="l03124"></a><a class="code" href="../../d5/d8/ex_8h.html#a86">03124</a> <span class="preprocessor"></span><span class="preprocessor">#define EX_DEBUG_LOG_FORMAT_OBJECT   (UCHAR)6</span>
<a name="l03125"></a><a class="code" href="../../d5/d8/ex_8h.html#a87">03125</a> <span class="preprocessor"></span><span class="preprocessor">#define EX_DEBUG_LOG_FORMAT_HANDLE   (UCHAR)7</span>
03126 <span class="preprocessor"></span>
<a name="l03127"></a><a class="code" href="../../d5/d8/ex_8h.html#a88">03127</a> <span class="preprocessor">#define EX_DEBUG_LOG_NUMBER_OF_DATA_VALUES 4</span>
<a name="l03128"></a><a class="code" href="../../d5/d8/ex_8h.html#a89">03128</a> <span class="preprocessor"></span><span class="preprocessor">#define EX_DEBUG_LOG_NUMBER_OF_BACK_TRACES 4</span>
03129 <span class="preprocessor"></span>
<a name="l03130"></a><a class="code" href="../../d6/d7/struct__EX__DEBUG__LOG__TAG.html">03130</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d6/d7/struct__EX__DEBUG__LOG__TAG.html">_EX_DEBUG_LOG_TAG</a> {
<a name="l03131"></a><a class="code" href="../../d6/d7/struct__EX__DEBUG__LOG__TAG.html#o0">03131</a>     UCHAR <a class="code" href="../../d6/d7/struct__EX__DEBUG__LOG__TAG.html#o0">Format</a>[ <a class="code" href="../../d5/d8/ex_8h.html#a88">EX_DEBUG_LOG_NUMBER_OF_DATA_VALUES</a> ];
<a name="l03132"></a><a class="code" href="../../d6/d7/struct__EX__DEBUG__LOG__TAG.html#o1">03132</a>     PCHAR <a class="code" href="../../d6/d7/struct__EX__DEBUG__LOG__TAG.html#o1">Name</a>;
03133 } <a class="code" href="../../d6/d7/struct__EX__DEBUG__LOG__TAG.html">EX_DEBUG_LOG_TAG</a>, *<a class="code" href="../../d6/d7/struct__EX__DEBUG__LOG__TAG.html">PEX_DEBUG_LOG_TAG</a>;
03134 
<a name="l03135"></a><a class="code" href="../../d5/d7/struct__EX__DEBUG__LOG__EVENT.html">03135</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d5/d7/struct__EX__DEBUG__LOG__EVENT.html">_EX_DEBUG_LOG_EVENT</a> {
<a name="l03136"></a><a class="code" href="../../d5/d7/struct__EX__DEBUG__LOG__EVENT.html#o0">03136</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d5/d7/struct__EX__DEBUG__LOG__EVENT.html#o0">ThreadId</a>;
<a name="l03137"></a><a class="code" href="../../d5/d7/struct__EX__DEBUG__LOG__EVENT.html#o1">03137</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d5/d7/struct__EX__DEBUG__LOG__EVENT.html#o1">ProcessId</a>;
<a name="l03138"></a><a class="code" href="../../d5/d7/struct__EX__DEBUG__LOG__EVENT.html#o2">03138</a>     ULONG <a class="code" href="../../d5/d7/struct__EX__DEBUG__LOG__EVENT.html#o2">Time</a> : 24;
<a name="l03139"></a><a class="code" href="../../d5/d7/struct__EX__DEBUG__LOG__EVENT.html#o3">03139</a>     ULONG <a class="code" href="../../d5/d7/struct__EX__DEBUG__LOG__EVENT.html#o3">Tag</a> : 8;
<a name="l03140"></a><a class="code" href="../../d5/d7/struct__EX__DEBUG__LOG__EVENT.html#o4">03140</a>     ULONG <a class="code" href="../../d5/d7/struct__EX__DEBUG__LOG__EVENT.html#o4">BackTrace</a>[ <a class="code" href="../../d5/d8/ex_8h.html#a89">EX_DEBUG_LOG_NUMBER_OF_BACK_TRACES</a> ];
<a name="l03141"></a><a class="code" href="../../d5/d7/struct__EX__DEBUG__LOG__EVENT.html#o5">03141</a>     ULONG <a class="code" href="../../d5/d7/struct__EX__DEBUG__LOG__EVENT.html#o5">Data</a>[ <a class="code" href="../../d5/d8/ex_8h.html#a88">EX_DEBUG_LOG_NUMBER_OF_DATA_VALUES</a> ];
03142 } <a class="code" href="../../d5/d7/struct__EX__DEBUG__LOG__EVENT.html">EX_DEBUG_LOG_EVENT</a>, *<a class="code" href="../../d5/d7/struct__EX__DEBUG__LOG__EVENT.html">PEX_DEBUG_LOG_EVENT</a>;
03143 
<a name="l03144"></a><a class="code" href="../../d4/d7/struct__EX__DEBUG__LOG.html">03144</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d4/d7/struct__EX__DEBUG__LOG.html">_EX_DEBUG_LOG</a> {
<a name="l03145"></a><a class="code" href="../../d4/d7/struct__EX__DEBUG__LOG.html#o0">03145</a>     KSPIN_LOCK <a class="code" href="../../d4/d7/struct__EX__DEBUG__LOG.html#o0">Lock</a>;
<a name="l03146"></a><a class="code" href="../../d4/d7/struct__EX__DEBUG__LOG.html#o1">03146</a>     ULONG <a class="code" href="../../d4/d7/struct__EX__DEBUG__LOG.html#o1">NumberOfTags</a>;
<a name="l03147"></a><a class="code" href="../../d4/d7/struct__EX__DEBUG__LOG.html#o2">03147</a>     ULONG <a class="code" href="../../d4/d7/struct__EX__DEBUG__LOG.html#o2">MaximumNumberOfTags</a>;
<a name="l03148"></a><a class="code" href="../../d4/d7/struct__EX__DEBUG__LOG.html#o3">03148</a>     <a class="code" href="../../d5/d8/ex_8h.html#a151">PEX_DEBUG_LOG_TAG</a> <a class="code" href="../../d4/d7/struct__EX__DEBUG__LOG.html#o3">Tags</a>;
<a name="l03149"></a><a class="code" href="../../d4/d7/struct__EX__DEBUG__LOG.html#o4">03149</a>     ULONG <a class="code" href="../../d4/d7/struct__EX__DEBUG__LOG.html#o4">CountOfEventsLogged</a>;
<a name="l03150"></a><a class="code" href="../../d4/d7/struct__EX__DEBUG__LOG.html#o5">03150</a>     <a class="code" href="../../d5/d8/ex_8h.html#a153">PEX_DEBUG_LOG_EVENT</a> <a class="code" href="../../d4/d7/struct__EX__DEBUG__LOG.html#o5">First</a>;
<a name="l03151"></a><a class="code" href="../../d4/d7/struct__EX__DEBUG__LOG.html#o6">03151</a>     <a class="code" href="../../d5/d8/ex_8h.html#a153">PEX_DEBUG_LOG_EVENT</a> <a class="code" href="../../d4/d7/struct__EX__DEBUG__LOG.html#o6">Last</a>;
<a name="l03152"></a><a class="code" href="../../d4/d7/struct__EX__DEBUG__LOG.html#o7">03152</a>     <a class="code" href="../../d5/d8/ex_8h.html#a153">PEX_DEBUG_LOG_EVENT</a> <a class="code" href="../../d4/d7/struct__EX__DEBUG__LOG.html#o7">Next</a>;
03153 } <a class="code" href="../../d4/d7/struct__EX__DEBUG__LOG.html">EX_DEBUG_LOG</a>, *<a class="code" href="../../d4/d7/struct__EX__DEBUG__LOG.html">PEX_DEBUG_LOG</a>;
03154 
03155 
03156 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
03157 <a class="code" href="../../d5/d8/ex_8h.html#a155">PEX_DEBUG_LOG</a>
03158 <a class="code" href="../../d5/d8/ex_8h.html#a308">ExCreateDebugLog</a>(
03159     IN UCHAR MaximumNumberOfTags,
03160     IN ULONG MaximumNumberOfEvents
03161     );
03162 
03163 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
03164 UCHAR
03165 <a class="code" href="../../d5/d8/ex_8h.html#a309">ExCreateDebugLogTag</a>(
03166     IN PEX_DEBUG_LOG Log,
03167     IN PCHAR Name,
03168     IN UCHAR Format1,
03169     IN UCHAR Format2,
03170     IN UCHAR Format3,
03171     IN UCHAR Format4
03172     );
03173 
03174 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
03175 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
03176 <a class="code" href="../../d5/d8/ex_8h.html#a310">ExDebugLogEvent</a>(
03177     IN PEX_DEBUG_LOG Log,
03178     IN UCHAR Tag,
03179     IN ULONG Data1,
03180     IN ULONG Data2,
03181     IN ULONG Data3,
03182     IN ULONG Data4
03183     );
03184 
03185 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
03186 <a class="code" href="../../d5/d8/ex_8h.html#a311">ExShutdownSystem</a>(
03187     VOID
03188     );
03189 
03190 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
03191 <a class="code" href="../../d5/d8/ex_8h.html#a312">ExAcquireTimeRefreshLock</a>(
03192     VOID
03193     );
03194 
03195 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
03196 <a class="code" href="../../d5/d8/ex_8h.html#a313">ExReleaseTimeRefreshLock</a>(
03197     VOID
03198     );
03199 
03200 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
03201 <a class="code" href="../../d5/d8/ex_8h.html#a314">ExUpdateSystemTimeFromCmos</a> (
03202     IN BOOLEAN UpdateInterruptTime,
03203     IN ULONG   MaxSepInSeconds
03204     );
03205 
03206 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
03207 <a class="code" href="../../d5/d8/ex_8h.html#a315">ExGetNextWakeTime</a> (
03208     OUT PULONGLONG      DueTime,
03209     OUT PTIME_FIELDS    TimeFields,
03210     OUT PVOID           *TimerObject
03211     );
03212 
03213 <span class="comment">// begin_ntddk begin_wdm begin_ntifs</span>
03214 <span class="comment">//</span>
03215 <span class="comment">// Set timer resolution.</span>
03216 <span class="comment">//</span>
03217 
03218 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
03219 ULONG
03220 <a class="code" href="../../d5/d8/ex_8h.html#a316">ExSetTimerResolution</a> (
03221     IN ULONG DesiredTime,
03222     IN BOOLEAN SetResolution
03223     );
03224 
03225 <span class="comment">// end_wdm</span>
03226 <span class="comment">//</span>
03227 <span class="comment">// Subtract time zone bias from system time to get local time.</span>
03228 <span class="comment">//</span>
03229 
03230 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
03231 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
03232 <a class="code" href="../../d5/d8/ex_8h.html#a317">ExSystemTimeToLocalTime</a> (
03233     IN PLARGE_INTEGER SystemTime,
03234     OUT PLARGE_INTEGER LocalTime
03235     );
03236 
03237 <span class="comment">//</span>
03238 <span class="comment">// Add time zone bias to local time to get system time.</span>
03239 <span class="comment">//</span>
03240 
03241 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
03242 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
03243 <a class="code" href="../../d5/d8/ex_8h.html#a318">ExLocalTimeToSystemTime</a> (
03244     IN PLARGE_INTEGER LocalTime,
03245     OUT PLARGE_INTEGER SystemTime
03246     );
03247 
03248 <span class="comment">// end_ntddk end_ntifs</span>
03249 
03250 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
03251 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
03252 <a class="code" href="../../d5/d8/ex_8h.html#a319">ExInitializeTimeRefresh</a>(
03253     VOID
03254     );
03255 
03256 <span class="comment">// begin_ntddk begin_wdm begin_ntifs begin_nthal begin_ntminiport</span>
03257 
03258 <span class="comment">//</span>
03259 <span class="comment">// Define the type for Callback function.</span>
03260 <span class="comment">//</span>
03261 
<a name="l03262"></a><a class="code" href="../../d5/d8/ex_8h.html#a156">03262</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d9/d6/struct__CALLBACK__OBJECT.html">_CALLBACK_OBJECT</a> *<a class="code" href="../../d9/d6/struct__CALLBACK__OBJECT.html">PCALLBACK_OBJECT</a>;
03263 
<a name="l03264"></a><a class="code" href="../../d5/d8/ex_8h.html#a157">03264</a> <span class="keyword">typedef</span> <a class="code" href="../../d0/d6/iop_8h.html#a145">VOID</a> (*PCALLBACK_FUNCTION ) (
03265     IN PVOID CallbackContext,
03266     IN PVOID Argument1,
03267     IN PVOID Argument2
03268     );
03269 
03270 
03271 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
03272 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
03273 <a class="code" href="../../d5/d8/ex_8h.html#a320">ExCreateCallback</a> (
03274     OUT <a class="code" href="../../d9/d6/struct__CALLBACK__OBJECT.html">PCALLBACK_OBJECT</a> *CallbackObject,
03275     IN POBJECT_ATTRIBUTES ObjectAttributes,
03276     IN BOOLEAN Create,
03277     IN BOOLEAN AllowMultipleCallbacks
03278     );
03279 
03280 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
03281 PVOID
03282 <a class="code" href="../../d5/d8/ex_8h.html#a321">ExRegisterCallback</a> (
03283     IN <a class="code" href="../../d9/d6/struct__CALLBACK__OBJECT.html">PCALLBACK_OBJECT</a> CallbackObject,
03284     IN PCALLBACK_FUNCTION CallbackFunction,
03285     IN PVOID CallbackContext
03286     );
03287 
03288 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
03289 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
03290 <a class="code" href="../../d5/d8/ex_8h.html#a322">ExUnregisterCallback</a> (
03291     IN PVOID CallbackRegistration
03292     );
03293 
03294 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
03295 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
03296 <a class="code" href="../../d5/d8/ex_8h.html#a323">ExNotifyCallback</a> (
03297     IN PVOID CallbackObject,
03298     IN PVOID Argument1,
03299     IN PVOID Argument2
03300     );
03301 
03302 <span class="comment">// end_ntddk end_wdm end_ntifs end_nthal end_ntminiport</span>
03303 
03304 <span class="comment">//</span>
03305 <span class="comment">// The current bias from GMT to LocalTime</span>
03306 <span class="comment">//</span>
03307 
<a name="l03308"></a><a class="code" href="../../d5/d8/ex_8h.html#a158">03308</a> <span class="keyword">extern</span> LARGE_INTEGER <a class="code" href="../../d5/d8/ex_8h.html#a158">ExpTimeZoneBias</a>;
<a name="l03309"></a><a class="code" href="../../d5/d8/ex_8h.html#a159">03309</a> <span class="keyword">extern</span> LONG <a class="code" href="../../d5/d8/ex_8h.html#a159">ExpLastTimeZoneBias</a>;
<a name="l03310"></a><a class="code" href="../../d5/d8/ex_8h.html#a160">03310</a> <span class="keyword">extern</span> LONG <a class="code" href="../../d5/d8/ex_8h.html#a160">ExpAltTimeZoneBias</a>;
<a name="l03311"></a><a class="code" href="../../d5/d8/ex_8h.html#a161">03311</a> <span class="keyword">extern</span> ULONG <a class="code" href="../../d5/d8/ex_8h.html#a161">ExpCurrentTimeZoneId</a>;
<a name="l03312"></a><a class="code" href="../../d5/d8/ex_8h.html#a162">03312</a> <span class="keyword">extern</span> ULONG <a class="code" href="../../d5/d8/ex_8h.html#a162">ExpRealTimeIsUniversal</a>;
<a name="l03313"></a><a class="code" href="../../d5/d8/ex_8h.html#a163">03313</a> <span class="keyword">extern</span> ULONG <a class="code" href="../../d1/d9/worker_8c.html#a15">ExCriticalWorkerThreads</a>;
<a name="l03314"></a><a class="code" href="../../d5/d8/ex_8h.html#a164">03314</a> <span class="keyword">extern</span> ULONG <a class="code" href="../../d1/d9/worker_8c.html#a16">ExDelayedWorkerThreads</a>;
<a name="l03315"></a><a class="code" href="../../d5/d8/ex_8h.html#a165">03315</a> <span class="keyword">extern</span> ULONG <a class="code" href="../../d5/d8/ex_8h.html#a165">ExpTickCountMultiplier</a>;
03316 
03317 <span class="comment">//</span>
03318 <span class="comment">// The lock handle for PAGELK section, initialized in init\init.c</span>
03319 <span class="comment">//</span>
03320 
<a name="l03321"></a><a class="code" href="../../d5/d8/ex_8h.html#a166">03321</a> <span class="keyword">extern</span> PVOID <a class="code" href="../../d5/d8/ex_8h.html#a166">ExPageLockHandle</a>;
03322 
03323 <span class="comment">//</span>
03324 <span class="comment">// Global executive callbacks</span>
03325 <span class="comment">//</span>
03326 
<a name="l03327"></a><a class="code" href="../../d5/d8/ex_8h.html#a167">03327</a> <span class="keyword">extern</span> <a class="code" href="../../d9/d6/struct__CALLBACK__OBJECT.html">PCALLBACK_OBJECT</a> <a class="code" href="../../d4/d9/exdata_8c.html#a0">ExCbSetSystemTime</a>;
<a name="l03328"></a><a class="code" href="../../d5/d8/ex_8h.html#a168">03328</a> <span class="keyword">extern</span> <a class="code" href="../../d9/d6/struct__CALLBACK__OBJECT.html">PCALLBACK_OBJECT</a> <a class="code" href="../../d4/d9/exdata_8c.html#a1">ExCbSetSystemState</a>;
<a name="l03329"></a><a class="code" href="../../d5/d8/ex_8h.html#a169">03329</a> <span class="keyword">extern</span> <a class="code" href="../../d9/d6/struct__CALLBACK__OBJECT.html">PCALLBACK_OBJECT</a> <a class="code" href="../../d4/d9/exdata_8c.html#a2">ExCbPowerState</a>;
03330 
03331 
03332 <span class="keyword">typedef</span>
03333 PVOID
<a name="l03334"></a><a class="code" href="../../d5/d8/ex_8h.html#a170">03334</a> (*PKWIN32_GLOBALATOMTABLE_CALLOUT) ( <span class="keywordtype">void</span> );
03335 
<a name="l03336"></a><a class="code" href="../../d5/d8/ex_8h.html#a171">03336</a> <span class="keyword">extern</span> <a class="code" href="../../d5/d8/ex_8h.html#a170">PKWIN32_GLOBALATOMTABLE_CALLOUT</a> <a class="code" href="../../d6/d8/exatom_8c.html#a0">ExGlobalAtomTableCallout</a>;
03337 
03338 <span class="comment">// begin_ntddk</span>
03339 
03340 <span class="comment">//</span>
03341 <span class="comment">// UUID Generation</span>
03342 <span class="comment">//</span>
03343 
<a name="l03344"></a><a class="code" href="../../d5/d8/ex_8h.html#a172">03344</a> <span class="keyword">typedef</span> GUID <a class="code" href="../../d5/d8/ex_8h.html#a172">UUID</a>;
03345 
03346 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
03347 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
03348 <a class="code" href="../../d5/d8/ex_8h.html#a324">ExUuidCreate</a>(
03349     OUT UUID *Uuid
03350     );
03351 
03352 <span class="comment">// end_ntddk</span>
03353 
03354 <span class="comment">//</span>
03355 <span class="comment">// suite support</span>
03356 <span class="comment">//</span>
03357 
03358 
03359 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
03360 BOOLEAN
03361 <a class="code" href="../../d5/d8/ex_8h.html#a325">ExVerifySuite</a>(
03362     SUITE_TYPE SuiteType
03363     );
03364 
03365 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
03366 ULONG
03367 <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a0">FASTCALL</a>
03368 <a class="code" href="../../d5/d8/ex_8h.html#a326">ExInterlockedSetBits</a> (
03369     IN OUT PULONG Flags,
03370     IN ULONG Flag
03371     );
03372 
03373 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
03374 ULONG
03375 <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a0">FASTCALL</a>
03376 <a class="code" href="../../d5/d8/ex_8h.html#a327">ExInterlockedClearBits</a> (
03377     IN OUT PULONG Flags,
03378     IN ULONG Flag
03379     );
03380 
03381 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
03382 ULONG
03383 <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a0">FASTCALL</a>
03384 <a class="code" href="../../d5/d8/ex_8h.html#a328">ExInterlockedSetClearBits</a> (
03385     IN OUT PULONG Flags,
03386     IN ULONG sFlag,
03387     IN ULONG cFlag
03388     );
03389 <span class="preprocessor">#endif </span><span class="comment">/* _EX_ */</span>
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:39:57 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
