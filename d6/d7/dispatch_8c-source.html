<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: dispatch.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>dispatch.c</h1><a href="../../d5/d8/dispatch_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/*++</span>
00002 <span class="comment"></span>
00003 <span class="comment">Copyright (c) 1985 - 1999, Microsoft Corporation</span>
00004 <span class="comment"></span>
00005 <span class="comment">Module Name:</span>
00006 <span class="comment"></span>
00007 <span class="comment">    dispatch.c</span>
00008 <span class="comment"></span>
00009 <span class="comment">Abstract:</span>
00010 <span class="comment"></span>
00011 <span class="comment">Author:</span>
00012 <span class="comment"></span>
00013 <span class="comment">    KazuM Apr.19.1996</span>
00014 <span class="comment"></span>
00015 <span class="comment">Revision History:</span>
00016 <span class="comment"></span>
00017 <span class="comment">--*/</span>
00018 
00019 <span class="preprocessor">#include "<a class="code" href="../../d6/d3/w32_2ntcon_2server_2precomp_8h.html">precomp.h</a>"</span>
00020 <span class="preprocessor">#pragma hdrstop</span>
00021 <span class="preprocessor"></span>
<a name="l00022"></a><a class="code" href="../../d5/d8/dispatch_8c.html#a0">00022</a> <span class="preprocessor">#define WWSB_NOFE</span>
00023 <span class="preprocessor"></span><span class="preprocessor">#include "<a class="code" href="../../d6/d8/dispatch_8h.html">dispatch.h</a>"</span>
00024 <span class="preprocessor">#undef  WWSB_NOFE</span>
<a name="l00025"></a><a class="code" href="../../d5/d8/dispatch_8c.html#a1">00025</a> <span class="preprocessor"></span><span class="preprocessor">#define WWSB_FE</span>
00026 <span class="preprocessor"></span><span class="preprocessor">#include "<a class="code" href="../../d6/d8/dispatch_8h.html">dispatch.h</a>"</span>
00027 <span class="preprocessor">#undef  WWSB_FE</span>
00028 <span class="preprocessor"></span>
00029 <span class="preprocessor">#if defined(FE_SB)</span>
00030 <span class="preprocessor"></span>
00031 
00032 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00033 <a class="code" href="../../d6/d8/dispatch_8h.html#a1">DoSrvWriteConsole</a>(
00034     IN OUT PCSR_API_MSG m,
00035     IN OUT PCSR_REPLY_STATUS ReplyStatus,
00036     IN <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console,
00037     IN <a class="code" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData
00038     )
00039 {
00040     <span class="keywordflow">if</span> (CONSOLE_IS_DBCS_OUTPUTCP(Console))
00041         <span class="keywordflow">return</span> FE_DoSrvWriteConsole(m,ReplyStatus,Console,HandleData);
00042     <span class="keywordflow">else</span>
00043         <span class="keywordflow">return</span> SB_DoSrvWriteConsole(m,ReplyStatus,Console,HandleData);
00044 }
00045 
00046 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00047 <a class="code" href="../../d6/d8/dispatch_8h.html#a2">WriteOutputString</a>(
00048     IN <a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo,
00049     IN PVOID Buffer,
00050     IN COORD WriteCoord,
00051     IN ULONG StringType,
00052     IN OUT PULONG NumRecords, <span class="comment">// this value is valid even for error cases</span>
00053     OUT PULONG NumColumns OPTIONAL
00054     )
00055 {
00056     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console = ScreenInfo-&gt;Console;
00057 
00058     <span class="keywordflow">if</span> (CONSOLE_IS_DBCS_OUTPUTCP(Console))
00059         <span class="keywordflow">return</span> FE_WriteOutputString(ScreenInfo, Buffer, WriteCoord, StringType, NumRecords, NumColumns);
00060     <span class="keywordflow">else</span>
00061         <span class="keywordflow">return</span> SB_WriteOutputString(ScreenInfo, Buffer, WriteCoord, StringType, NumRecords, NumColumns);
00062 }
00063 
00064 
00065 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00066 <a class="code" href="../../d6/d8/dispatch_8h.html#a3">WriteRectToScreenBuffer</a>(
00067     PBYTE Source,
00068     COORD SourceSize,
00069     PSMALL_RECT SourceRect,
00070     <a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo,
00071     COORD TargetPoint,
00072     IN UINT Codepage
00073     )
00074 {
00075     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console = ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o0">Console</a>;
00076 
00077     <span class="keywordflow">if</span> (CONSOLE_IS_DBCS_OUTPUTCP(Console))
00078         FE_WriteRectToScreenBuffer(Source,SourceSize,SourceRect,ScreenInfo,TargetPoint,Codepage);
00079     <span class="keywordflow">else</span>
00080         SB_WriteRectToScreenBuffer(Source,SourceSize,SourceRect,ScreenInfo,TargetPoint,Codepage);
00081 }
00082 
00083 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00084 <a class="code" href="../../d6/d8/dispatch_8h.html#a4">WriteToScreen</a>(
00085     IN <a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo,
00086     PSMALL_RECT Region    <span class="comment">// region is inclusive</span>
00087     )
00088 {
00089     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console = ScreenInfo-&gt;Console;
00090 
00091     <span class="keywordflow">if</span> (CONSOLE_IS_DBCS_OUTPUTCP(Console))
00092         FE_WriteToScreen(ScreenInfo, Region);
00093     <span class="keywordflow">else</span>
00094         SB_WriteToScreen(ScreenInfo, Region);
00095 }
00096 
00097 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00098 <a class="code" href="../../d6/d8/dispatch_8h.html#a5">WriteRegionToScreen</a>(
00099     IN <a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo,
00100     IN PSMALL_RECT Region
00101     )
00102 {
00103     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console = ScreenInfo-&gt;Console;
00104 
00105     <span class="keywordflow">if</span> (CONSOLE_IS_DBCS_OUTPUTCP(Console))
00106         FE_WriteRegionToScreen(ScreenInfo, Region);
00107     <span class="keywordflow">else</span>
00108         SB_WriteRegionToScreen(ScreenInfo, Region);
00109 }
00110 
00111 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00112 <a class="code" href="../../d6/d8/dispatch_8h.html#a6">FillOutput</a>(
00113     IN <a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo,
00114     IN WORD Element,
00115     IN COORD WriteCoord,
00116     IN ULONG ElementType,
00117     IN OUT PULONG Length <span class="comment">// this value is valid even for error cases</span>
00118     )
00119 {
00120     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console = ScreenInfo-&gt;Console;
00121 
00122     <span class="keywordflow">if</span> (CONSOLE_IS_DBCS_OUTPUTCP(Console))
00123         <span class="keywordflow">return</span> FE_FillOutput(ScreenInfo, Element, WriteCoord, ElementType, Length);
00124     <span class="keywordflow">else</span>
00125         <span class="keywordflow">return</span> SB_FillOutput(ScreenInfo, Element, WriteCoord, ElementType, Length);
00126 }
00127 
00128 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00129 <a class="code" href="../../d6/d8/dispatch_8h.html#a7">FillRectangle</a>(
00130     IN CHAR_INFO Fill,
00131     IN OUT <a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo,
00132     IN PSMALL_RECT TargetRect
00133     )
00134 {
00135     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console = ScreenInfo-&gt;Console;
00136 
00137     <span class="keywordflow">if</span> (CONSOLE_IS_DBCS_OUTPUTCP(Console))
00138         FE_FillRectangle(Fill, ScreenInfo, TargetRect);
00139     <span class="keywordflow">else</span>
00140         SB_FillRectangle(Fill, ScreenInfo, TargetRect);
00141 }
00142 
00143 
00144 ULONG
00145 <a class="code" href="../../d6/d8/dispatch_8h.html#a8">DoWriteConsole</a>(
00146     IN OUT PCSR_API_MSG m,
00147     IN <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console,
00148     IN PCSR_THREAD Thread
00149     )
00150 {
00151     <span class="keywordflow">if</span> (CONSOLE_IS_DBCS_OUTPUTCP(Console))
00152         <span class="keywordflow">return</span> FE_DoWriteConsole(m,Console,Thread);
00153     <span class="keywordflow">else</span>
00154         <span class="keywordflow">return</span> SB_DoWriteConsole(m,Console,Thread);
00155 }
00156 
00157 
00158 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00159 <a class="code" href="../../d6/d8/dispatch_8h.html#a9">WriteChars</a>(
00160     IN <a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo,
00161     IN PWCHAR lpBufferBackupLimit,
00162     IN PWCHAR lpBuffer,
00163     IN PWCHAR lpRealUnicodeString,
00164     IN OUT PDWORD NumBytes,
00165     OUT PLONG NumSpaces OPTIONAL,
00166     IN SHORT OriginalXPosition,
00167     IN DWORD dwFlags,
00168     OUT PSHORT ScrollY OPTIONAL
00169     )
00170 {
00171     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console = ScreenInfo-&gt;Console;
00172 
00173     <span class="keywordflow">if</span> (CONSOLE_IS_DBCS_OUTPUTCP(Console))
00174         <span class="keywordflow">return</span> FE_WriteChars(ScreenInfo,lpBufferBackupLimit,lpBuffer,lpRealUnicodeString,NumBytes,NumSpaces,OriginalXPosition,dwFlags,ScrollY);
00175     <span class="keywordflow">else</span>
00176         <span class="keywordflow">return</span> SB_WriteChars(ScreenInfo,lpBufferBackupLimit,lpBuffer,lpRealUnicodeString,NumBytes,NumSpaces,OriginalXPosition,dwFlags,ScrollY);
00177 }
00178 
00179 
00180 
00181 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00182 <a class="code" href="../../d6/d8/dispatch_8h.html#a10">AdjustCursorPosition</a>(
00183     IN <a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo,
00184     IN COORD CursorPosition,
00185     IN BOOL KeepCursorVisible,
00186     OUT PSHORT ScrollY OPTIONAL
00187     )
00188 {
00189     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console = ScreenInfo-&gt;Console;
00190 
00191     <span class="keywordflow">if</span> (CONSOLE_IS_DBCS_OUTPUTCP(Console))
00192         <span class="keywordflow">return</span> FE_AdjustCursorPosition(ScreenInfo, CursorPosition, KeepCursorVisible, ScrollY);
00193     <span class="keywordflow">else</span>
00194         <span class="keywordflow">return</span> SB_AdjustCursorPosition(ScreenInfo, CursorPosition, KeepCursorVisible, ScrollY);
00195 }
00196 
00197 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00198 <a class="code" href="../../d6/d8/dispatch_8h.html#a13">TranslateOutputToAnsiUnicode</a>(
00199     IN <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console,
00200     IN OUT PCHAR_INFO OutputBuffer,
00201     IN COORD Size,
00202     IN OUT PCHAR_INFO OutputBufferR
00203     )
00204 {
00205     <span class="keywordflow">if</span> (CONSOLE_IS_DBCS_OUTPUTCP(Console))
00206         <span class="keywordflow">return</span> <a class="code" href="../../d6/d8/dispatch_8h.html#a14">FE_TranslateOutputToAnsiUnicode</a>(Console,OutputBuffer,Size,OutputBufferR);
00207     <span class="keywordflow">else</span>
00208         <span class="keywordflow">return</span> <a class="code" href="../../d6/d8/dispatch_8h.html#a15">SB_TranslateOutputToAnsiUnicode</a>(Console,OutputBuffer,Size);
00209 }
00210 
00211 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00212 <a class="code" href="../../d6/d8/dispatch_8h.html#a11">TranslateOutputToUnicode</a>(
00213     IN <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console,
00214     IN OUT PCHAR_INFO OutputBuffer,
00215     IN COORD Size)
00216 {
00217     <span class="keywordflow">if</span> (CONSOLE_IS_DBCS_OUTPUTCP(Console))
00218         <span class="keywordflow">return</span> FE_TranslateOutputToUnicode(Console,OutputBuffer,Size);
00219     <span class="keywordflow">else</span>
00220         <span class="keywordflow">return</span> <a class="code" href="../../d2/d8/directio_8c.html#a7">SB_TranslateOutputToUnicode</a>(Console,OutputBuffer,Size);
00221 }
00222 
00223 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00224 <a class="code" href="../../d6/d8/dispatch_8h.html#a16">TranslateOutputToOemUnicode</a>(
00225     IN <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console,
00226     IN OUT PCHAR_INFO OutputBuffer,
00227     IN COORD Size,
00228     IN BOOL fRemoveDbcsMark
00229     )
00230 {
00231     <span class="keywordflow">if</span> (CONSOLE_IS_DBCS_OUTPUTCP(Console))
00232         <span class="keywordflow">return</span> <a class="code" href="../../d6/d8/dispatch_8h.html#a17">FE_TranslateOutputToOemUnicode</a>(Console,OutputBuffer,Size,fRemoveDbcsMark);
00233     <span class="keywordflow">else</span>
00234         <span class="keywordflow">return</span> <a class="code" href="../../d6/d8/dispatch_8h.html#a18">SB_TranslateOutputToOemUnicode</a>(Console,OutputBuffer,Size);
00235 }
00236 
00237 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00238 <a class="code" href="../../d3/d0/w32_2ntcon_2fullscr_2vga_2misc_8c.html#a1">TranslateOutputToOem</a>(
00239     IN <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console,
00240     IN OUT PCHAR_INFO OutputBuffer,
00241     IN COORD Size
00242     )
00243 {
00244     <span class="keywordflow">if</span> (CONSOLE_IS_DBCS_OUTPUTCP(Console))
00245         <span class="keywordflow">return</span> FE_TranslateOutputToOem(Console,OutputBuffer,Size);
00246     <span class="keywordflow">else</span>
00247         <span class="keywordflow">return</span> <a class="code" href="../../d2/d8/directio_8c.html#a5">SB_TranslateOutputToOem</a>(Console,OutputBuffer,Size);
00248 }
00249 
00250 ULONG
00251 <a class="code" href="../../d6/d8/dispatch_8h.html#a19">TranslateInputToUnicode</a>(
00252     IN <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console,
00253     IN OUT PINPUT_RECORD InputRecords,
00254     IN ULONG NumRecords,
00255     IN OUT PINPUT_RECORD DBCSLeadByte
00256     )
00257 {
00258     <span class="keywordflow">if</span> (CONSOLE_IS_DBCS_CP(Console))
00259         <span class="keywordflow">return</span> <a class="code" href="../../d6/d8/dispatch_8h.html#a20">FE_TranslateInputToUnicode</a>(Console,InputRecords,NumRecords,DBCSLeadByte);
00260     <span class="keywordflow">else</span>
00261         <span class="keywordflow">return</span> <a class="code" href="../../d6/d8/dispatch_8h.html#a21">SB_TranslateInputToUnicode</a>(Console,InputRecords,NumRecords);
00262 }
00263 
00264 ULONG
00265 <a class="code" href="../../d6/d8/dispatch_8h.html#a22">TranslateInputToOem</a>(
00266     IN <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console,
00267     IN OUT PINPUT_RECORD InputRecords,
00268     IN ULONG NumRecords,    <span class="comment">// in : ASCII byte count</span>
00269     IN ULONG UnicodeLength, <span class="comment">// in : Number of events (char count)</span>
00270     OUT PINPUT_RECORD DbcsLeadInpRec
00271     )
00272 {
00273     <span class="keywordflow">if</span> (CONSOLE_IS_DBCS_CP(Console))
00274         <span class="keywordflow">return</span> <a class="code" href="../../d6/d8/dispatch_8h.html#a23">FE_TranslateInputToOem</a>(Console,InputRecords,NumRecords,UnicodeLength,DbcsLeadInpRec);
00275     <span class="keywordflow">else</span>
00276         <span class="keywordflow">return</span> <a class="code" href="../../d6/d8/dispatch_8h.html#a24">SB_TranslateInputToOem</a>(Console,InputRecords,NumRecords);
00277 }
00278 
00279 WCHAR
00280 <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a39">CharToWchar</a>(
00281     IN <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console,
00282     IN UINT Codepage,
00283     IN <span class="keywordtype">char</span> *Ch
00284     )
00285 {
00286     WCHAR wc;
00287     <span class="keywordflow">if</span> (CONSOLE_IS_DBCS_CP(Console))
00288     {
00289         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d3/dbcs_8h.html#a37">IsDBCSLeadByteConsole</a>(*Ch, &amp;Console-&gt;OutputCPInfo))
00290         {
00291             <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a37">ConvertOutputToUnicode</a>(Console-&gt;OutputCP,
00292                                    Ch,
00293                                    2,
00294                                    &amp;wc,
00295                                    1);
00296         }
00297         <span class="keywordflow">else</span>
00298         {
00299             <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a37">ConvertOutputToUnicode</a>(Console-&gt;OutputCP,
00300                                    Ch,
00301                                    1,
00302                                    &amp;wc,
00303                                    1);
00304         }
00305     }
00306     <span class="keywordflow">else</span>
00307     {
00308         wc = SB_CharToWchar(Codepage, *Ch);
00309     }
00310     <span class="keywordflow">return</span> wc;
00311 }
00312 
00313 
00314 <span class="preprocessor">#ifdef i386</span>
00315 <span class="preprocessor"></span><a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00316 WriteRegionToScreenHW(
00317     IN <a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo,
00318     IN PSMALL_RECT Region
00319     )
00320 {
00321     <span class="keywordflow">if</span> (CONSOLE_IS_DBCS_OUTPUTCP(ScreenInfo-&gt;Console))
00322         <a class="code" href="../../d9/d2/__priv_8h.html#a1">FE_WriteRegionToScreenHW</a>(ScreenInfo,Region);
00323     <span class="keywordflow">else</span>
00324         SB_WriteRegionToScreenHW(ScreenInfo,Region);
00325 }
00326 <span class="preprocessor">#endif</span>
00327 <span class="preprocessor"></span>
00328 <span class="preprocessor">#endif</span>
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:39:45 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
