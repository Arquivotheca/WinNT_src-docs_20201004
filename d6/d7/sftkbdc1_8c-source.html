<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: sftkbdc1.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>sftkbdc1.c</h1><a href="../../d5/d8/sftkbdc1_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/**************************************************************************\</span>
00002 <span class="comment">* Module Name: sftkbdc1.c</span>
00003 <span class="comment">*</span>
00004 <span class="comment">* Copyright (c) 1985 - 1999, Microsoft Corporation</span>
00005 <span class="comment">*</span>
00006 <span class="comment">* Softkeyboard support for Simplified Chinese</span>
00007 <span class="comment">*</span>
00008 <span class="comment">* History:</span>
00009 <span class="comment">* 03-Jan-1996 wkwok    Ported from Win95</span>
00010 <span class="comment">\**************************************************************************/</span>
00011 <span class="preprocessor">#include "<a class="code" href="../../d8/d3/w32_2ntuser_2imm_2precomp_8h.html">precomp.h</a>"</span>
00012 <span class="preprocessor">#pragma hdrstop</span>
00013 <span class="preprocessor"></span>
00014 <span class="preprocessor">#include "<a class="code" href="../../d7/d9/softkbd_8h.html">softkbd.h</a>"</span>
00015 
00016 <span class="comment">// Virtual Key for Letter Buttons</span>
<a name="l00017"></a><a class="code" href="../../d5/d8/sftkbdc1_8c.html#a1">00017</a> CONST <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a1">SKC1VirtKey</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a103">BUTTON_NUM_C1</a>] = {
00018    VK_OEM_3, <span class="charliteral">'1'</span>, <span class="charliteral">'2'</span>, <span class="charliteral">'3'</span>, <span class="charliteral">'4'</span>, <span class="charliteral">'5'</span>, <span class="charliteral">'6'</span>,<span class="charliteral">'7'</span>, <span class="charliteral">'8'</span>, <span class="charliteral">'9'</span>, <span class="charliteral">'0'</span>, VK_OEM_MINUS, VK_OEM_EQUAL,
00019    <span class="charliteral">'Q'</span>, <span class="charliteral">'W'</span>, <span class="charliteral">'E'</span>, <span class="charliteral">'R'</span>, <span class="charliteral">'T'</span>, <span class="charliteral">'Y'</span>, <span class="charliteral">'U'</span>, <span class="charliteral">'I'</span>, <span class="charliteral">'O'</span>, <span class="charliteral">'P'</span>, VK_OEM_LBRACKET, VK_OEM_RBRACKET, VK_OEM_BSLASH,
00020    <span class="charliteral">'A'</span>, <span class="charliteral">'S'</span>, <span class="charliteral">'D'</span>, <span class="charliteral">'F'</span>, <span class="charliteral">'G'</span>, <span class="charliteral">'H'</span>, <span class="charliteral">'J'</span>, <span class="charliteral">'K'</span>, <span class="charliteral">'L'</span>, VK_OEM_SEMICLN, VK_OEM_QUOTE,
00021    <span class="charliteral">'Z'</span>, <span class="charliteral">'X'</span>, <span class="charliteral">'C'</span>, <span class="charliteral">'V'</span>, <span class="charliteral">'B'</span>, <span class="charliteral">'N'</span>, <span class="charliteral">'M'</span>, VK_OEM_COMMA, VK_OEM_PERIOD, VK_OEM_SLASH,
00022    VK_BACK, VK_TAB, VK_CAPITAL, VK_RETURN, VK_SHIFT, VK_INSERT, VK_DELETE, VK_SPACE,
00023    VK_ESCAPE
00024 };
00025 
<a name="l00026"></a><a class="code" href="../../d5/d8/sftkbdc1_8c.html#a2">00026</a> POINT <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a2">gptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a103">BUTTON_NUM_C1</a>]; <span class="comment">// button point array, in the client area</span>
<a name="l00027"></a><a class="code" href="../../d5/d8/sftkbdc1_8c.html#a3">00027</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>  <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a3">gfSoftKbdC1Init</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;              <span class="comment">// init flag</span>
00028 
00029 <span class="comment">/**********************************************************************\</span>
00030 <span class="comment">* InitSKC1ButtonPos -- init gptButtonPos</span>
00031 <span class="comment">*</span>
00032 <span class="comment">\**********************************************************************/</span>
<a name="l00033"></a><a class="code" href="../../d5/d8/sftkbdc1_8c.html#a4">00033</a> <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a> <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a4">InitSKC1ButtonPos</a>()
00034 {
00035     <span class="keywordtype">int</span>  i, x, y;
00036 
00037     <span class="comment">// init the first row</span>
00038     y = 0;
00039     <span class="keywordflow">for</span> (i=0, x=<a class="code" href="../../d7/d9/softkbd_8h.html#a95">X_ROW_LETTER_C1</a>; i &lt; <a class="code" href="../../d7/d9/softkbd_8h.html#a66">COL_LETTER_C1</a>; i++, x += <a class="code" href="../../d7/d9/softkbd_8h.html#a73">W_LETTER_BTN_C1</a>) {
00040       <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a2">gptButtonPos</a>[i].x = x;
00041       <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a2">gptButtonPos</a>[i].y = y;
00042     }
00043     <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a2">gptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a106">BACKSP_TYPE_C1</a>].x = x;
00044     <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a2">gptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a106">BACKSP_TYPE_C1</a>].y = y;
00045 
00046     <span class="comment">// init the second row</span>
00047     y += <a class="code" href="../../d7/d9/softkbd_8h.html#a74">H_LETTER_BTN_C1</a>;
00048     x = 0;
00049     <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a2">gptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a107">TAB_TYPE_C1</a>].x = x;
00050     <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a2">gptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a107">TAB_TYPE_C1</a>].y = y;
00051     <span class="keywordflow">for</span> (i=0, x=<a class="code" href="../../d7/d9/softkbd_8h.html#a96">X_ROW2_LETTER_C1</a>; i &lt; <a class="code" href="../../d7/d9/softkbd_8h.html#a67">COL2_LETTER_C1</a>; i++, x += <a class="code" href="../../d7/d9/softkbd_8h.html#a73">W_LETTER_BTN_C1</a>) {
00052       <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a2">gptButtonPos</a>[i + <a class="code" href="../../d7/d9/softkbd_8h.html#a66">COL_LETTER_C1</a>].x = x;
00053       <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a2">gptButtonPos</a>[i + <a class="code" href="../../d7/d9/softkbd_8h.html#a66">COL_LETTER_C1</a>].y = y;
00054     }
00055 
00056     <span class="comment">// init the third row</span>
00057     y += <a class="code" href="../../d7/d9/softkbd_8h.html#a74">H_LETTER_BTN_C1</a>;
00058     x = 0;
00059     <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a2">gptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a108">CAPS_TYPE_C1</a>].x = x;
00060     <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a2">gptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a108">CAPS_TYPE_C1</a>].y = y;
00061     <span class="keywordflow">for</span> (i=0, x=<a class="code" href="../../d7/d9/softkbd_8h.html#a97">X_ROW3_LETTER_C1</a>; i &lt; <a class="code" href="../../d7/d9/softkbd_8h.html#a68">COL3_LETTER_C1</a>; i++, x += <a class="code" href="../../d7/d9/softkbd_8h.html#a73">W_LETTER_BTN_C1</a>) {
00062       <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a2">gptButtonPos</a>[i + <a class="code" href="../../d7/d9/softkbd_8h.html#a66">COL_LETTER_C1</a> + <a class="code" href="../../d7/d9/softkbd_8h.html#a67">COL2_LETTER_C1</a>].x = x;
00063       <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a2">gptButtonPos</a>[i + <a class="code" href="../../d7/d9/softkbd_8h.html#a66">COL_LETTER_C1</a> + <a class="code" href="../../d7/d9/softkbd_8h.html#a67">COL2_LETTER_C1</a>].y = y;
00064     }
00065     <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a2">gptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a109">ENTER_TYPE_C1</a>].x = x;
00066     <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a2">gptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a109">ENTER_TYPE_C1</a>].y = y;
00067 
00068     <span class="comment">// init the forth row</span>
00069     y += <a class="code" href="../../d7/d9/softkbd_8h.html#a74">H_LETTER_BTN_C1</a>;
00070     x = 0;
00071     <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a2">gptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a110">SHIFT_TYPE_C1</a>].x = x;
00072     <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a2">gptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a110">SHIFT_TYPE_C1</a>].y = y;
00073     <span class="keywordflow">for</span> (i=0, x=<a class="code" href="../../d7/d9/softkbd_8h.html#a98">X_ROW4_LETTER_C1</a>; i &lt; <a class="code" href="../../d7/d9/softkbd_8h.html#a69">COL4_LETTER_C1</a>; i++, x += <a class="code" href="../../d7/d9/softkbd_8h.html#a73">W_LETTER_BTN_C1</a>) {
00074       <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a2">gptButtonPos</a>[i + <a class="code" href="../../d7/d9/softkbd_8h.html#a66">COL_LETTER_C1</a> + <a class="code" href="../../d7/d9/softkbd_8h.html#a67">COL2_LETTER_C1</a> + <a class="code" href="../../d7/d9/softkbd_8h.html#a68">COL3_LETTER_C1</a>].x = x;
00075       <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a2">gptButtonPos</a>[i + <a class="code" href="../../d7/d9/softkbd_8h.html#a66">COL_LETTER_C1</a> + <a class="code" href="../../d7/d9/softkbd_8h.html#a67">COL2_LETTER_C1</a> + <a class="code" href="../../d7/d9/softkbd_8h.html#a68">COL3_LETTER_C1</a>].y = y;
00076     }
00077 
00078     <span class="comment">// init the bottom row</span>
00079     y += <a class="code" href="../../d7/d9/softkbd_8h.html#a74">H_LETTER_BTN_C1</a>;
00080     x = 0;
00081     <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a2">gptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a111">INS_TYPE_C1</a>].x = x;
00082     <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a2">gptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a111">INS_TYPE_C1</a>].y = y;
00083     x = <a class="code" href="../../d7/d9/softkbd_8h.html#a99">X_DEL_C1</a>;
00084     <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a2">gptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a112">DEL_TYPE_C1</a>].x = x;
00085     <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a2">gptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a112">DEL_TYPE_C1</a>].y = y;
00086     x += <a class="code" href="../../d7/d9/softkbd_8h.html#a89">W_DEL_C1</a> + 2 * <a class="code" href="../../d7/d9/softkbd_8h.html#a72">BORDER_C1</a>;
00087     <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a2">gptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a113">SPACE_TYPE_C1</a>].x = x;
00088     <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a2">gptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a113">SPACE_TYPE_C1</a>].y = y;
00089     x = <a class="code" href="../../d7/d9/softkbd_8h.html#a100">X_ESC_C1</a>;
00090     <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a2">gptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a114">ESC_TYPE_C1</a>].x = x;
00091     <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a2">gptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a114">ESC_TYPE_C1</a>].y = y;
00092 
00093     <span class="keywordflow">return</span>;
00094 }
00095 
00096 
00097 <span class="comment">/**********************************************************************\</span>
00098 <span class="comment">* SKC1DrawConvexRect --- draw button</span>
00099 <span class="comment">*</span>
00100 <span class="comment">*              (x1,y1)     x2-1</span>
00101 <span class="comment">*               +----3------&gt;^</span>
00102 <span class="comment">*               |+----3-----||y1+1</span>
00103 <span class="comment">*               ||          ||</span>
00104 <span class="comment">*               33    1     42</span>
00105 <span class="comment">*               ||          ||</span>
00106 <span class="comment">*               |V          ||</span>
00107 <span class="comment">*               |&lt;----4-----+|</span>
00108 <span class="comment">*         y2-1  ------2------+</span>
00109 <span class="comment">*                             (x2,y2)</span>
00110 <span class="comment">*</span>
00111 <span class="comment">*  1 - light gray</span>
00112 <span class="comment">*  2 - black</span>
00113 <span class="comment">*  3 - white</span>
00114 <span class="comment">*  4 - dark gray</span>
00115 <span class="comment">*</span>
00116 <span class="comment">\**********************************************************************/</span>
<a name="l00117"></a><a class="code" href="../../d5/d8/sftkbdc1_8c.html#a5">00117</a> <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a> <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a5">SKC1DrawConvexRect</a>(
00118     HDC  hDC,
00119     <span class="keywordtype">int</span>  x,
00120     <span class="keywordtype">int</span>  y,
00121     <span class="keywordtype">int</span>  nWidth,
00122     <span class="keywordtype">int</span>  nHeight)
00123 {
00124     <span class="comment">// paint background</span>
00125     SelectObject(hDC, GetStockObject(LTGRAY_BRUSH));
00126     SelectObject(hDC, GetStockObject(BLACK_PEN));
00127     Rectangle(hDC, x, y, x + nWidth, y + nHeight);
00128 
00129     <span class="comment">// paint white border</span>
00130     SelectObject(hDC, GetStockObject(WHITE_BRUSH));
00131     PatBlt(hDC, x, y + nHeight - 1, <a class="code" href="../../d7/d9/softkbd_8h.html#a72">BORDER_C1</a>, -nHeight + 1, PATCOPY);
00132     PatBlt(hDC, x, y, nWidth - 1 , <a class="code" href="../../d7/d9/softkbd_8h.html#a72">BORDER_C1</a>, PATCOPY);
00133 
00134     <span class="comment">// paint dark gray border</span>
00135     SelectObject(hDC, GetStockObject(GRAY_BRUSH));
00136     PatBlt(hDC, x + 1, y + nHeight -1, nWidth - <a class="code" href="../../d7/d9/softkbd_8h.html#a72">BORDER_C1</a>, -1, PATCOPY);
00137     PatBlt(hDC, x + nWidth - 1, y + nHeight - 1, -1, -nHeight + <a class="code" href="../../d7/d9/softkbd_8h.html#a72">BORDER_C1</a>, PATCOPY);
00138 
00139     <span class="keywordflow">return</span>;
00140 }
00141 
00142 
00143 <span class="comment">/**********************************************************************\</span>
00144 <span class="comment">* SKC1InvertButton --- Invert Button</span>
00145 <span class="comment">*</span>
00146 <span class="comment">\**********************************************************************/</span>
<a name="l00147"></a><a class="code" href="../../d5/d8/sftkbdc1_8c.html#a6">00147</a> <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a> <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a6">SKC1InvertButton</a>(
00148     HDC  hDC,
00149     <span class="keywordtype">int</span>  uKeyIndex)
00150 {
00151     <span class="keywordtype">int</span>  nWidth, nHeight;
00152 
00153     <span class="keywordflow">if</span> (uKeyIndex &lt; 0) <span class="keywordflow">return</span>;
00154 
00155     <span class="keywordflow">if</span> (uKeyIndex &lt; <a class="code" href="../../d7/d9/softkbd_8h.html#a101">LETTER_NUM_C1</a>) {
00156       nWidth = <a class="code" href="../../d7/d9/softkbd_8h.html#a73">W_LETTER_BTN_C1</a>;
00157       nHeight = <a class="code" href="../../d7/d9/softkbd_8h.html#a74">H_LETTER_BTN_C1</a>;
00158     } <span class="keywordflow">else</span> {
00159       <span class="keywordflow">switch</span> (uKeyIndex) {
00160         <span class="keywordflow">case</span> <a class="code" href="../../d7/d9/softkbd_8h.html#a106">BACKSP_TYPE_C1</a>:
00161              nWidth = <a class="code" href="../../d7/d9/softkbd_8h.html#a77">W_BACKSP_C1</a> + 2 * <a class="code" href="../../d7/d9/softkbd_8h.html#a72">BORDER_C1</a>;
00162              nHeight = <a class="code" href="../../d7/d9/softkbd_8h.html#a74">H_LETTER_BTN_C1</a>;
00163              <span class="keywordflow">break</span>;
00164         <span class="keywordflow">case</span> <a class="code" href="../../d7/d9/softkbd_8h.html#a107">TAB_TYPE_C1</a>:
00165              nWidth = <a class="code" href="../../d7/d9/softkbd_8h.html#a79">W_TAB_C1</a> + 2 * <a class="code" href="../../d7/d9/softkbd_8h.html#a72">BORDER_C1</a>;
00166              nHeight = <a class="code" href="../../d7/d9/softkbd_8h.html#a74">H_LETTER_BTN_C1</a>;
00167              <span class="keywordflow">break</span>;
00168         <span class="keywordflow">case</span> <a class="code" href="../../d7/d9/softkbd_8h.html#a108">CAPS_TYPE_C1</a>:
00169              nWidth = <a class="code" href="../../d7/d9/softkbd_8h.html#a81">W_CAPS_C1</a> + 2 * <a class="code" href="../../d7/d9/softkbd_8h.html#a72">BORDER_C1</a>;
00170              nHeight = <a class="code" href="../../d7/d9/softkbd_8h.html#a74">H_LETTER_BTN_C1</a>;
00171              <span class="keywordflow">break</span>;
00172         <span class="keywordflow">case</span> <a class="code" href="../../d7/d9/softkbd_8h.html#a109">ENTER_TYPE_C1</a>:
00173              nWidth = <a class="code" href="../../d7/d9/softkbd_8h.html#a83">W_ENTER_C1</a> + 2 * <a class="code" href="../../d7/d9/softkbd_8h.html#a72">BORDER_C1</a>;
00174              nHeight = <a class="code" href="../../d7/d9/softkbd_8h.html#a74">H_LETTER_BTN_C1</a>;
00175              <span class="keywordflow">break</span>;
00176         <span class="keywordflow">case</span> <a class="code" href="../../d7/d9/softkbd_8h.html#a110">SHIFT_TYPE_C1</a>:
00177              nWidth = <a class="code" href="../../d7/d9/softkbd_8h.html#a85">W_SHIFT_C1</a> + 2 * <a class="code" href="../../d7/d9/softkbd_8h.html#a72">BORDER_C1</a>;
00178              nHeight = <a class="code" href="../../d7/d9/softkbd_8h.html#a74">H_LETTER_BTN_C1</a>;
00179              <span class="keywordflow">break</span>;
00180         <span class="keywordflow">case</span> <a class="code" href="../../d7/d9/softkbd_8h.html#a111">INS_TYPE_C1</a>:
00181              nWidth = <a class="code" href="../../d7/d9/softkbd_8h.html#a87">W_INS_C1</a> + 2 * <a class="code" href="../../d7/d9/softkbd_8h.html#a72">BORDER_C1</a>;
00182              nHeight = <a class="code" href="../../d7/d9/softkbd_8h.html#a76">H_BOTTOM_BTN_C1</a>;
00183              <span class="keywordflow">break</span>;
00184         <span class="keywordflow">case</span> <a class="code" href="../../d7/d9/softkbd_8h.html#a112">DEL_TYPE_C1</a>:
00185              nWidth = <a class="code" href="../../d7/d9/softkbd_8h.html#a89">W_DEL_C1</a> + 2 * <a class="code" href="../../d7/d9/softkbd_8h.html#a72">BORDER_C1</a>;
00186              nHeight = <a class="code" href="../../d7/d9/softkbd_8h.html#a76">H_BOTTOM_BTN_C1</a>;
00187              <span class="keywordflow">break</span>;
00188         <span class="keywordflow">case</span> <a class="code" href="../../d7/d9/softkbd_8h.html#a113">SPACE_TYPE_C1</a>:
00189              nWidth = <a class="code" href="../../d7/d9/softkbd_8h.html#a91">W_SPACE_C1</a> + 2 * <a class="code" href="../../d7/d9/softkbd_8h.html#a72">BORDER_C1</a>;
00190              nHeight = <a class="code" href="../../d7/d9/softkbd_8h.html#a76">H_BOTTOM_BTN_C1</a>;
00191              <span class="keywordflow">break</span>;
00192         <span class="keywordflow">case</span> <a class="code" href="../../d7/d9/softkbd_8h.html#a114">ESC_TYPE_C1</a>:
00193              nWidth = <a class="code" href="../../d7/d9/softkbd_8h.html#a93">W_ESC_C1</a> + 2 * <a class="code" href="../../d7/d9/softkbd_8h.html#a72">BORDER_C1</a>;
00194              nHeight = <a class="code" href="../../d7/d9/softkbd_8h.html#a76">H_BOTTOM_BTN_C1</a>;
00195              <span class="keywordflow">break</span>;
00196       }
00197     }
00198 
00199     BitBlt(hDC, <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a2">gptButtonPos</a>[uKeyIndex].x, <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a2">gptButtonPos</a>[uKeyIndex].y,
00200            nWidth, nHeight, hDC, <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a2">gptButtonPos</a>[uKeyIndex].x , <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a2">gptButtonPos</a>[uKeyIndex].y,
00201            DSTINVERT);
00202 
00203     <span class="keywordflow">return</span>;
00204 }
00205 
00206 
00207 <span class="comment">/**********************************************************************\</span>
00208 <span class="comment">* SKC1DrawBitmap --- Draw bitmap within rectangle</span>
00209 <span class="comment">*</span>
00210 <span class="comment">\**********************************************************************/</span>
<a name="l00211"></a><a class="code" href="../../d5/d8/sftkbdc1_8c.html#a7">00211</a> <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a> <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a7">SKC1DrawBitmap</a>(
00212     HDC hDC,
00213     <span class="keywordtype">int</span> x,
00214     <span class="keywordtype">int</span> y,
00215     <span class="keywordtype">int</span> nWidth,
00216     <span class="keywordtype">int</span> nHeight,
00217     LPWSTR lpszBitmap)
00218 {
00219     HDC     hMemDC;
00220     HBITMAP hBitmap, hOldBmp;
00221 
00222     hBitmap = LoadBitmap(<a class="code" href="../../d2/d6/ntuser_2imm_2globals_8c.html#a2">ghInst</a>, lpszBitmap);
00223     hMemDC = CreateCompatibleDC(hDC);
00224     hOldBmp = SelectObject(hMemDC, hBitmap);
00225 
00226     BitBlt(hDC, x, y, nWidth, nHeight, hMemDC, 0 , 0, SRCCOPY);
00227 
00228     SelectObject(hMemDC, hOldBmp);
00229     DeleteDC(hMemDC);
00230     DeleteObject(hBitmap);
00231 
00232     <span class="keywordflow">return</span>;
00233 }
00234 
00235 
00236 <span class="comment">/**********************************************************************\</span>
00237 <span class="comment">* SKC1DrawLabel -- Draw the label of button</span>
00238 <span class="comment">*</span>
00239 <span class="comment">\**********************************************************************/</span>
<a name="l00240"></a><a class="code" href="../../d5/d8/sftkbdc1_8c.html#a8">00240</a> <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a> <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a8">SKC1DrawLabel</a>(
00241     HDC hDC,
00242     LPWSTR lpszLabel)
00243 {
00244     HDC     hMemDC;
00245     HBITMAP hBitmap, hOldBmp;
00246     <span class="keywordtype">int</span>     i, x;
00247 
00248     hBitmap = LoadBitmap(<a class="code" href="../../d2/d6/ntuser_2imm_2globals_8c.html#a2">ghInst</a>, lpszLabel);
00249     hMemDC = CreateCompatibleDC(hDC);
00250     hOldBmp = SelectObject(hMemDC, hBitmap);
00251 
00252     <span class="keywordflow">for</span> (i=x=0; i &lt; <a class="code" href="../../d7/d9/softkbd_8h.html#a101">LETTER_NUM_C1</a>; i++, x += <a class="code" href="../../d7/d9/softkbd_8h.html#a116">SIZELABEL_C1</a>){
00253      BitBlt(hDC, <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a2">gptButtonPos</a>[i].x + <a class="code" href="../../d7/d9/softkbd_8h.html#a117">X_LABEL_C1</a>, <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a2">gptButtonPos</a>[i].y + <a class="code" href="../../d7/d9/softkbd_8h.html#a118">Y_LABEL_C1</a>,
00254             <a class="code" href="../../d7/d9/softkbd_8h.html#a116">SIZELABEL_C1</a>, <a class="code" href="../../d7/d9/softkbd_8h.html#a116">SIZELABEL_C1</a>, hMemDC, x , 0, SRCCOPY);
00255     }
00256 
00257     SelectObject(hMemDC, hOldBmp);
00258     DeleteDC(hMemDC);
00259     DeleteObject(hBitmap);
00260 
00261     <span class="keywordflow">return</span>;
00262 }
00263 
00264 
00265 <span class="comment">/**********************************************************************\</span>
00266 <span class="comment">* InitSKC1Bitmap -- init bitmap</span>
00267 <span class="comment">*</span>
00268 <span class="comment">\**********************************************************************/</span>
<a name="l00269"></a><a class="code" href="../../d5/d8/sftkbdc1_8c.html#a9">00269</a> <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a> <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a9">InitSKC1Bitmap</a>(
00270     HDC  hDC,
00271     RECT rcClient)
00272 {
00273     <span class="keywordtype">int</span>  i;
00274 
00275     <span class="comment">// draw softkbd rectangle</span>
00276     SelectObject(hDC, GetStockObject(LTGRAY_BRUSH));
00277     SelectObject(hDC, GetStockObject(NULL_PEN));
00278     Rectangle(hDC, rcClient.left, rcClient.top, rcClient.right + 1, rcClient.bottom + 1);
00279 
00280     <span class="comment">// draw letter buttons</span>
00281     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../d7/d9/softkbd_8h.html#a101">LETTER_NUM_C1</a>; i++) {
00282       <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a5">SKC1DrawConvexRect</a>(hDC, <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a2">gptButtonPos</a>[i].x, <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a2">gptButtonPos</a>[i].y,
00283                          <a class="code" href="../../d7/d9/softkbd_8h.html#a73">W_LETTER_BTN_C1</a>, <a class="code" href="../../d7/d9/softkbd_8h.html#a74">H_LETTER_BTN_C1</a>);
00284     }
00285     <span class="comment">// draw letter label</span>
00286     <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a8">SKC1DrawLabel</a>(hDC, MAKEINTRESOURCEW(<a class="code" href="../../d4/d0/immcli_8h.html#a45">LABEL_C1</a>));
00287 
00288     <span class="comment">// draw other buttons</span>
00289     <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a5">SKC1DrawConvexRect</a>(hDC, <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a2">gptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a106">BACKSP_TYPE_C1</a>].x, <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a2">gptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a106">BACKSP_TYPE_C1</a>].y,
00290                        <a class="code" href="../../d7/d9/softkbd_8h.html#a77">W_BACKSP_C1</a> + 2 * <a class="code" href="../../d7/d9/softkbd_8h.html#a72">BORDER_C1</a>, <a class="code" href="../../d7/d9/softkbd_8h.html#a74">H_LETTER_BTN_C1</a>);
00291     <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a7">SKC1DrawBitmap</a>(hDC, <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a2">gptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a106">BACKSP_TYPE_C1</a>].x + <a class="code" href="../../d7/d9/softkbd_8h.html#a72">BORDER_C1</a>, <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a2">gptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a106">BACKSP_TYPE_C1</a>].y + <a class="code" href="../../d7/d9/softkbd_8h.html#a72">BORDER_C1</a>,
00292                    <a class="code" href="../../d7/d9/softkbd_8h.html#a77">W_BACKSP_C1</a>, <a class="code" href="../../d7/d9/softkbd_8h.html#a78">H_BACKSP_C1</a>, MAKEINTRESOURCEW(<a class="code" href="../../d4/d0/immcli_8h.html#a37">BACKSP_C1</a>));
00293 
00294     <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a5">SKC1DrawConvexRect</a>(hDC, <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a2">gptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a107">TAB_TYPE_C1</a>].x, <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a2">gptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a107">TAB_TYPE_C1</a>].y,
00295                        <a class="code" href="../../d7/d9/softkbd_8h.html#a79">W_TAB_C1</a> + 2 * <a class="code" href="../../d7/d9/softkbd_8h.html#a72">BORDER_C1</a>, <a class="code" href="../../d7/d9/softkbd_8h.html#a74">H_LETTER_BTN_C1</a>);
00296     <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a7">SKC1DrawBitmap</a>(hDC, <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a2">gptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a107">TAB_TYPE_C1</a>].x + <a class="code" href="../../d7/d9/softkbd_8h.html#a72">BORDER_C1</a>, <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a2">gptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a107">TAB_TYPE_C1</a>].y + <a class="code" href="../../d7/d9/softkbd_8h.html#a72">BORDER_C1</a>,
00297                    <a class="code" href="../../d7/d9/softkbd_8h.html#a79">W_TAB_C1</a>, <a class="code" href="../../d7/d9/softkbd_8h.html#a80">H_TAB_C1</a>, MAKEINTRESOURCEW(<a class="code" href="../../d4/d0/immcli_8h.html#a38">TAB_C1</a>));
00298 
00299     <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a5">SKC1DrawConvexRect</a>(hDC, <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a2">gptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a108">CAPS_TYPE_C1</a>].x, <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a2">gptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a108">CAPS_TYPE_C1</a>].y,
00300                        <a class="code" href="../../d7/d9/softkbd_8h.html#a81">W_CAPS_C1</a> + 2 * <a class="code" href="../../d7/d9/softkbd_8h.html#a72">BORDER_C1</a>, <a class="code" href="../../d7/d9/softkbd_8h.html#a74">H_LETTER_BTN_C1</a>);
00301     <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a7">SKC1DrawBitmap</a>(hDC, <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a2">gptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a108">CAPS_TYPE_C1</a>].x + <a class="code" href="../../d7/d9/softkbd_8h.html#a72">BORDER_C1</a>, <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a2">gptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a108">CAPS_TYPE_C1</a>].y + <a class="code" href="../../d7/d9/softkbd_8h.html#a72">BORDER_C1</a>,
00302                    <a class="code" href="../../d7/d9/softkbd_8h.html#a81">W_CAPS_C1</a>, <a class="code" href="../../d7/d9/softkbd_8h.html#a82">H_CAPS_C1</a>, MAKEINTRESOURCEW(<a class="code" href="../../d4/d0/immcli_8h.html#a39">CAPS_C1</a>));
00303 
00304     <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a5">SKC1DrawConvexRect</a>(hDC, <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a2">gptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a109">ENTER_TYPE_C1</a>].x, <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a2">gptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a109">ENTER_TYPE_C1</a>].y,
00305                        <a class="code" href="../../d7/d9/softkbd_8h.html#a83">W_ENTER_C1</a> + 2 * <a class="code" href="../../d7/d9/softkbd_8h.html#a72">BORDER_C1</a>, <a class="code" href="../../d7/d9/softkbd_8h.html#a74">H_LETTER_BTN_C1</a>);
00306     <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a7">SKC1DrawBitmap</a>(hDC, <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a2">gptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a109">ENTER_TYPE_C1</a>].x + <a class="code" href="../../d7/d9/softkbd_8h.html#a72">BORDER_C1</a>, <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a2">gptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a109">ENTER_TYPE_C1</a>].y + <a class="code" href="../../d7/d9/softkbd_8h.html#a72">BORDER_C1</a>,
00307                    <a class="code" href="../../d7/d9/softkbd_8h.html#a83">W_ENTER_C1</a>, <a class="code" href="../../d7/d9/softkbd_8h.html#a84">H_ENTER_C1</a>, MAKEINTRESOURCEW(<a class="code" href="../../d4/d0/immcli_8h.html#a40">ENTER_C1</a>));
00308 
00309     <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a5">SKC1DrawConvexRect</a>(hDC, <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a2">gptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a110">SHIFT_TYPE_C1</a>].x, <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a2">gptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a110">SHIFT_TYPE_C1</a>].y,
00310                        <a class="code" href="../../d7/d9/softkbd_8h.html#a85">W_SHIFT_C1</a> + 2 * <a class="code" href="../../d7/d9/softkbd_8h.html#a72">BORDER_C1</a>, <a class="code" href="../../d7/d9/softkbd_8h.html#a74">H_LETTER_BTN_C1</a>);
00311     <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a7">SKC1DrawBitmap</a>(hDC, <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a2">gptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a110">SHIFT_TYPE_C1</a>].x + <a class="code" href="../../d7/d9/softkbd_8h.html#a72">BORDER_C1</a>, <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a2">gptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a110">SHIFT_TYPE_C1</a>].y + <a class="code" href="../../d7/d9/softkbd_8h.html#a72">BORDER_C1</a>,
00312                    <a class="code" href="../../d7/d9/softkbd_8h.html#a85">W_SHIFT_C1</a>, <a class="code" href="../../d7/d9/softkbd_8h.html#a86">H_SHIFT_C1</a>, MAKEINTRESOURCEW(<a class="code" href="../../d4/d0/immcli_8h.html#a41">SHIFT_C1</a>));
00313 
00314     <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a5">SKC1DrawConvexRect</a>(hDC, <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a2">gptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a111">INS_TYPE_C1</a>].x, <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a2">gptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a111">INS_TYPE_C1</a>].y,
00315                        <a class="code" href="../../d7/d9/softkbd_8h.html#a87">W_INS_C1</a> + 2 * <a class="code" href="../../d7/d9/softkbd_8h.html#a72">BORDER_C1</a>, <a class="code" href="../../d7/d9/softkbd_8h.html#a76">H_BOTTOM_BTN_C1</a>);
00316     <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a7">SKC1DrawBitmap</a>(hDC, <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a2">gptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a111">INS_TYPE_C1</a>].x + <a class="code" href="../../d7/d9/softkbd_8h.html#a72">BORDER_C1</a>, <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a2">gptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a111">INS_TYPE_C1</a>].y + <a class="code" href="../../d7/d9/softkbd_8h.html#a72">BORDER_C1</a>,
00317                    <a class="code" href="../../d7/d9/softkbd_8h.html#a87">W_INS_C1</a>, <a class="code" href="../../d7/d9/softkbd_8h.html#a88">H_INS_C1</a>, MAKEINTRESOURCEW(<a class="code" href="../../d4/d0/immcli_8h.html#a42">INS_C1</a>));
00318 
00319     <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a5">SKC1DrawConvexRect</a>(hDC, <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a2">gptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a112">DEL_TYPE_C1</a>].x, <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a2">gptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a112">DEL_TYPE_C1</a>].y,
00320                        <a class="code" href="../../d7/d9/softkbd_8h.html#a89">W_DEL_C1</a> + 2 * <a class="code" href="../../d7/d9/softkbd_8h.html#a72">BORDER_C1</a>, <a class="code" href="../../d7/d9/softkbd_8h.html#a76">H_BOTTOM_BTN_C1</a>);
00321     <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a7">SKC1DrawBitmap</a>(hDC, <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a2">gptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a112">DEL_TYPE_C1</a>].x + <a class="code" href="../../d7/d9/softkbd_8h.html#a72">BORDER_C1</a>, <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a2">gptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a112">DEL_TYPE_C1</a>].y + <a class="code" href="../../d7/d9/softkbd_8h.html#a72">BORDER_C1</a>,
00322                    <a class="code" href="../../d7/d9/softkbd_8h.html#a89">W_DEL_C1</a>, <a class="code" href="../../d7/d9/softkbd_8h.html#a90">H_DEL_C1</a>, MAKEINTRESOURCEW(<a class="code" href="../../d4/d0/immcli_8h.html#a43">DEL_C1</a>));
00323 
00324     <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a5">SKC1DrawConvexRect</a>(hDC, <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a2">gptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a113">SPACE_TYPE_C1</a>].x, <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a2">gptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a113">SPACE_TYPE_C1</a>].y,
00325                        <a class="code" href="../../d7/d9/softkbd_8h.html#a91">W_SPACE_C1</a> + 2 * <a class="code" href="../../d7/d9/softkbd_8h.html#a72">BORDER_C1</a>, <a class="code" href="../../d7/d9/softkbd_8h.html#a76">H_BOTTOM_BTN_C1</a>);
00326 
00327     <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a5">SKC1DrawConvexRect</a>(hDC, <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a2">gptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a114">ESC_TYPE_C1</a>].x, <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a2">gptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a114">ESC_TYPE_C1</a>].y,
00328                        <a class="code" href="../../d7/d9/softkbd_8h.html#a93">W_ESC_C1</a> + 2 * <a class="code" href="../../d7/d9/softkbd_8h.html#a72">BORDER_C1</a>, <a class="code" href="../../d7/d9/softkbd_8h.html#a76">H_BOTTOM_BTN_C1</a>);
00329     <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a7">SKC1DrawBitmap</a>(hDC, <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a2">gptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a114">ESC_TYPE_C1</a>].x + <a class="code" href="../../d7/d9/softkbd_8h.html#a72">BORDER_C1</a>, <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a2">gptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a114">ESC_TYPE_C1</a>].y + <a class="code" href="../../d7/d9/softkbd_8h.html#a72">BORDER_C1</a>,
00330                    <a class="code" href="../../d7/d9/softkbd_8h.html#a93">W_ESC_C1</a>, <a class="code" href="../../d7/d9/softkbd_8h.html#a94">H_ESC_C1</a>, MAKEINTRESOURCEW(<a class="code" href="../../d4/d0/immcli_8h.html#a44">ESC_C1</a>));
00331 
00332     <span class="keywordflow">return</span>;
00333 }
00334 
00335 
00336 <span class="comment">/**********************************************************************\</span>
00337 <span class="comment">* CreateC1Window</span>
00338 <span class="comment">*</span>
00339 <span class="comment">* Init softkeyboard gloabl variabls, context and bitmap</span>
00340 <span class="comment">*</span>
00341 <span class="comment">\**********************************************************************/</span>
<a name="l00342"></a><a class="code" href="../../d5/d8/sftkbdc1_8c.html#a10">00342</a> LRESULT <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a10">CreateC1Window</a>(
00343     HWND hSKWnd)
00344 {
00345     HGLOBAL   hSKC1Ctxt;
00346     <a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html">PSKC1CTXT</a> pSKC1Ctxt;
00347 
00348     <span class="comment">// alloc and lock hSKC1CTxt</span>
00349     hSKC1Ctxt = GlobalAlloc(GHND, <span class="keyword">sizeof</span>(<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html">SKC1CTXT</a>));
00350     <span class="keywordflow">if</span> (!hSKC1Ctxt) {
00351         <span class="keywordflow">return</span> (-1<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>);
00352     }
00353 
00354     pSKC1Ctxt = (<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html">PSKC1CTXT</a>)GlobalLock(hSKC1Ctxt);
00355     <span class="keywordflow">if</span> (!pSKC1Ctxt) {
00356         GlobalFree(hSKC1Ctxt);
00357         <span class="keywordflow">return</span> (-1<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>);
00358     }
00359 
00360     <span class="comment">// save handle in SKC1_CONTEXT</span>
00361     <a class="code" href="../../d5/d9/cltxt_8h.html#a12">SetWindowLongPtr</a>(hSKWnd, <a class="code" href="../../d7/d9/softkbd_8h.html#a123">SKC1_CONTEXT</a>, (LONG_PTR)hSKC1Ctxt);
00362 
00363     <span class="comment">// init global varialbles</span>
00364     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d8/sftkbdc1_8c.html#a3">gfSoftKbdC1Init</a>){
00365       <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a4">InitSKC1ButtonPos</a>();
00366       <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a3">gfSoftKbdC1Init</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00367     }
00368 
00369     <span class="comment">// no index and default char set</span>
00370     pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o5">uKeyIndex</a> = -1;
00371     pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o8">lfCharSet</a> = GB2312_CHARSET;
00372 
00373     <span class="comment">// init softkeyboard</span>
00374     {
00375       HDC        hDC, hMemDC;
00376       HBITMAP    hBitmap, hOldBmp;
00377       RECT       rcClient;
00378 
00379       <a class="code" href="../../d3/d9/client_2wow_8c.html#a24">GetClientRect</a>(hSKWnd, &amp;rcClient);
00380 
00381       hDC = <a class="code" href="../../d3/d4/w32_2ntuser_2client_2nt6_2pch_8h.html#a1">GetDC</a>(hSKWnd);
00382       hMemDC = CreateCompatibleDC(hDC);
00383       hBitmap = CreateCompatibleBitmap(hDC, rcClient.right - rcClient.left,
00384                                        rcClient.bottom - rcClient.top);
00385       <a class="code" href="../../d3/d8/client_8c.html#a45">ReleaseDC</a>(hSKWnd, hDC);
00386 
00387       hOldBmp = SelectObject(hMemDC, hBitmap);
00388 
00389       <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a9">InitSKC1Bitmap</a>(hMemDC, rcClient);
00390 
00391       SelectObject(hMemDC, hOldBmp);
00392       pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o3">hSoftkbd</a> = hBitmap; <span class="comment">// save hBitmap in SKC1CTXT</span>
00393 
00394       DeleteDC(hMemDC);
00395     }
00396 
00397     <span class="comment">// unlock hSKC1CTxt</span>
00398     GlobalUnlock(hSKC1Ctxt);
00399 
00400     <span class="keywordflow">return</span> (0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>);
00401 }
00402 
00403 
00404 <span class="comment">/**********************************************************************\</span>
00405 <span class="comment">* DestroyC1Window</span>
00406 <span class="comment">*</span>
00407 <span class="comment">* Destroy softkeyboard context and bitmap</span>
00408 <span class="comment">*</span>
00409 <span class="comment">\**********************************************************************/</span>
<a name="l00410"></a><a class="code" href="../../d5/d8/sftkbdc1_8c.html#a11">00410</a> <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a> <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a11">DestroyC1Window</a>(
00411     HWND hSKWnd)
00412 {
00413     HGLOBAL   hSKC1Ctxt;
00414     <a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html">PSKC1CTXT</a> pSKC1Ctxt;
00415     HWND      hUIWnd;
00416 
00417     <span class="comment">// Get and Lock hSKC1Ctxt</span>
00418     hSKC1Ctxt = (HGLOBAL)<a class="code" href="../../d5/d9/cltxt_8h.html#a11">GetWindowLongPtr</a>(hSKWnd, <a class="code" href="../../d7/d9/softkbd_8h.html#a123">SKC1_CONTEXT</a>);
00419     <span class="keywordflow">if</span> (!hSKC1Ctxt) <span class="keywordflow">return</span>;
00420 
00421     pSKC1Ctxt = (<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html">PSKC1CTXT</a>)GlobalLock(hSKC1Ctxt);
00422     <span class="keywordflow">if</span> (!pSKC1Ctxt) <span class="keywordflow">return</span>;
00423 
00424     <span class="keywordflow">if</span> (pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o2">uState</a> &amp; <a class="code" href="../../d7/d9/softkbd_8h.html#a125">FLAG_DRAG_C1</a>) {
00425        <a class="code" href="../../d7/d9/softkbd_8h.html#a148">SKC1DrawDragBorder</a>(hSKWnd, &amp;pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o6">ptSkCursor</a>,
00426                           &amp;pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o7">ptSkOffset</a>);
00427     }
00428 
00429     DeleteObject(pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o3">hSoftkbd</a>); <span class="comment">// delete hBitmap</span>
00430 
00431     <span class="comment">// Unlock and Free hSKC1Ctxt</span>
00432     GlobalUnlock(hSKC1Ctxt);
00433     GlobalFree(hSKC1Ctxt);
00434 
00435     <span class="comment">// send message to parent window</span>
00436     hUIWnd = <a class="code" href="../../d3/d9/client_2wow_8c.html#a12">GetWindow</a>(hSKWnd, GW_OWNER);
00437     <span class="keywordflow">if</span> (hUIWnd) {
00438       <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(hUIWnd, WM_IME_NOTIFY, IMN_SOFTKBDDESTROYED, 0);\
00439     }
00440 
00441     <span class="keywordflow">return</span>;
00442 }
00443 
00444 
00445 <span class="comment">/**********************************************************************\</span>
00446 <span class="comment">* ShowSKC1Window -- Show softkeyboard</span>
00447 <span class="comment">*</span>
00448 <span class="comment">\**********************************************************************/</span>
<a name="l00449"></a><a class="code" href="../../d5/d8/sftkbdc1_8c.html#a12">00449</a> <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a> <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a12">ShowSKC1Window</a>(
00450     HDC  hDC,
00451     HWND hSKWnd)
00452 {
00453     HGLOBAL   hSKC1Ctxt;
00454     <a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html">PSKC1CTXT</a> pSKC1Ctxt;
00455 
00456     <span class="comment">// Get and Lock hSKC1Ctxt</span>
00457     hSKC1Ctxt = (HGLOBAL)<a class="code" href="../../d5/d9/cltxt_8h.html#a11">GetWindowLongPtr</a>(hSKWnd, <a class="code" href="../../d7/d9/softkbd_8h.html#a123">SKC1_CONTEXT</a>);
00458     <span class="keywordflow">if</span> (!hSKC1Ctxt) <span class="keywordflow">return</span>;
00459 
00460     pSKC1Ctxt = (<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html">PSKC1CTXT</a>)GlobalLock(hSKC1Ctxt);
00461     <span class="keywordflow">if</span> (!pSKC1Ctxt) <span class="keywordflow">return</span>;
00462 
00463     <span class="comment">// create mem dc to show softkeyboard</span>
00464     {
00465        HDC      hMemDC;
00466        HBITMAP  hOldBmp;
00467        RECT     rcClient;
00468 
00469        hMemDC = CreateCompatibleDC(hDC);
00470        hOldBmp = SelectObject(hMemDC, pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o3">hSoftkbd</a>);
00471        <a class="code" href="../../d3/d9/client_2wow_8c.html#a24">GetClientRect</a>(hSKWnd, &amp;rcClient);
00472        BitBlt(hDC, 0, 0, rcClient.right - rcClient.left, rcClient.bottom - rcClient.top,
00473               hMemDC, 0, 0, SRCCOPY);
00474        SelectObject(hMemDC, hOldBmp);
00475        DeleteDC(hMemDC);
00476     }
00477 
00478     <span class="comment">// Unlock hSKC1Ctxt</span>
00479     GlobalUnlock(hSKC1Ctxt);
00480 
00481     <span class="keywordflow">return</span>;
00482 }
00483 
00484 
00485 <span class="comment">/**********************************************************************\</span>
00486 <span class="comment">* UpdateSKC1Window -- update softkeyboard</span>
00487 <span class="comment">*</span>
00488 <span class="comment">\**********************************************************************/</span>
<a name="l00489"></a><a class="code" href="../../d5/d8/sftkbdc1_8c.html#a13">00489</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a13">UpdateSKC1Window</a>(
00490     HWND          hSKWnd,
00491     LPSOFTKBDDATA lpSoftKbdData)
00492 {
00493     HGLOBAL   hSKC1Ctxt;
00494     <a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html">PSKC1CTXT</a> pSKC1Ctxt;
00495     LOGFONT   lfFont;
00496     HFONT     hOldFont, hFont;
00497     HDC       hDC, hMemDC;
00498     HBITMAP   hOldBmp;
00499     <span class="keywordtype">int</span>       i;
00500 
00501     <span class="comment">// check the lpSoftKbdData</span>
00502     <span class="keywordflow">if</span> (lpSoftKbdData-&gt;uCount!=2) <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00503 
00504     <span class="comment">// Get and Lock hSKC1Ctxt</span>
00505     hSKC1Ctxt = (HGLOBAL)<a class="code" href="../../d5/d9/cltxt_8h.html#a11">GetWindowLongPtr</a>(hSKWnd, <a class="code" href="../../d7/d9/softkbd_8h.html#a123">SKC1_CONTEXT</a>);
00506     <span class="keywordflow">if</span> (!hSKC1Ctxt) <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00507 
00508     pSKC1Ctxt = (<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html">PSKC1CTXT</a>)GlobalLock(hSKC1Ctxt);
00509     <span class="keywordflow">if</span> (!pSKC1Ctxt) <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00510 
00511     <span class="comment">// create font</span>
00512     hDC = <a class="code" href="../../d3/d4/w32_2ntuser_2client_2nt6_2pch_8h.html#a1">GetDC</a>(hSKWnd);
00513     hMemDC = CreateCompatibleDC(hDC);
00514     hOldBmp = SelectObject(hMemDC, pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o3">hSoftkbd</a>);
00515 
00516     GetObject(GetStockObject(DEFAULT_GUI_FONT), <span class="keyword">sizeof</span>(lfFont), &amp;lfFont);
00517     lfFont.lfHeight = -<a class="code" href="../../d7/d9/softkbd_8h.html#a115">SIZEFONT_C1</a>;
00518     <span class="keywordflow">if</span> (pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o8">lfCharSet</a> != DEFAULT_CHARSET) {
00519         lfFont.lfCharSet = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o8">lfCharSet</a>;
00520     }
00521 
00522     hFont = CreateFontIndirect(&amp;lfFont);
00523     hOldFont = SelectObject(hMemDC, hFont);
00524 
00525 
00526     <span class="comment">// update shift/non-shift chars</span>
00527     <span class="keywordflow">for</span> (i=0; i &lt; <a class="code" href="../../d7/d9/softkbd_8h.html#a101">LETTER_NUM_C1</a>; i++) {
00528         pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o1">wNonShiftCode</a>[i] = lpSoftKbdData-&gt;wCode[0][<a class="code" href="../../d5/d8/sftkbdc1_8c.html#a1">SKC1VirtKey</a>[i]];
00529         pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o0">wShiftCode</a>[i] = lpSoftKbdData-&gt;wCode[1][<a class="code" href="../../d5/d8/sftkbdc1_8c.html#a1">SKC1VirtKey</a>[i]];
00530     }
00531 
00532     SetBkColor(hMemDC, 0x00BFBFBF);  <span class="comment">// set text bk color ??</span>
00533 
00534     <span class="keywordflow">for</span> (i=0; i &lt; <a class="code" href="../../d7/d9/softkbd_8h.html#a101">LETTER_NUM_C1</a>; i++) {
00535         <span class="keywordtype">int</span>  nchar;
00536         RECT rc;
00537 
00538         <span class="comment">// draw shift char.</span>
00539         rc.left = <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a2">gptButtonPos</a>[i].x + <a class="code" href="../../d7/d9/softkbd_8h.html#a119">X_SHIFT_CHAR_C1</a>;
00540         rc.top = <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a2">gptButtonPos</a>[i].y + <a class="code" href="../../d7/d9/softkbd_8h.html#a120">Y_SHIFT_CHAR_C1</a>;
00541         rc.right = rc.left + <a class="code" href="../../d7/d9/softkbd_8h.html#a115">SIZEFONT_C1</a>;
00542         rc.bottom = rc.top + <a class="code" href="../../d7/d9/softkbd_8h.html#a115">SIZEFONT_C1</a>;
00543 
00544         nchar = (pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o0">wShiftCode</a>[i] == 0) ? 0 : 1;
00545 
00546 <span class="preprocessor">#if (WINVER &gt;= 0x0400)</span>
00547 <span class="preprocessor"></span>        DrawTextEx(hMemDC, (LPWSTR)&amp;pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o0">wShiftCode</a>[i],
00548                    nchar, &amp;rc, DT_CENTER, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00549 <span class="preprocessor">#else</span>
00550 <span class="preprocessor"></span>        ExtTextOut(hMemDC,
00551             rc.left,
00552             rc.top,
00553             ETO_OPAQUE, &amp;rc,
00554             (LPWSTR)&amp;pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o0">wShiftCode</a>[i], nchar, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00555 <span class="preprocessor">#endif</span>
00556 <span class="preprocessor"></span>
00557         <span class="comment">// draw non-shift char.</span>
00558         rc.left = <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a2">gptButtonPos</a>[i].x + <a class="code" href="../../d7/d9/softkbd_8h.html#a121">X_NONSHIFT_CHAR_C1</a>;
00559         rc.top = <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a2">gptButtonPos</a>[i].y + <a class="code" href="../../d7/d9/softkbd_8h.html#a122">Y_NONSHIFT_CHAR_C1</a>;
00560         rc.right = rc.left + <a class="code" href="../../d7/d9/softkbd_8h.html#a115">SIZEFONT_C1</a>;
00561         rc.bottom = rc.top + <a class="code" href="../../d7/d9/softkbd_8h.html#a115">SIZEFONT_C1</a>;
00562 
00563         nchar = (pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o1">wNonShiftCode</a>[i] == 0) ? 0 : 1;
00564 
00565 <span class="preprocessor">#if (WINVER &gt;= 0x0400)</span>
00566 <span class="preprocessor"></span>        DrawTextEx(hMemDC, (LPWSTR)&amp;pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o1">wNonShiftCode</a>[i],
00567                    nchar, &amp;rc, DT_CENTER, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00568 <span class="preprocessor">#else</span>
00569 <span class="preprocessor"></span>        ExtTextOut(hMemDC,
00570             rc.left,
00571             rc.top,
00572             ETO_OPAQUE, &amp;rc,
00573             (LPWSTR)&amp;pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o1">wNonShiftCode</a>[i], nchar, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00574 <span class="preprocessor">#endif</span>
00575 <span class="preprocessor"></span>    }
00576 
00577     <span class="comment">// init states</span>
00578     <span class="keywordflow">if</span> (pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o2">uState</a> &amp; <a class="code" href="../../d7/d9/softkbd_8h.html#a124">FLAG_SHIFT_C1</a>){
00579        <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a6">SKC1InvertButton</a>(hMemDC, <a class="code" href="../../d7/d9/softkbd_8h.html#a110">SHIFT_TYPE_C1</a>);
00580     }
00581     pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o2">uState</a> = 0;
00582 
00583     SelectObject(hMemDC, hOldBmp);
00584     SelectObject(hMemDC, hOldFont);
00585     DeleteDC(hMemDC);
00586 
00587     DeleteObject(hFont);
00588     <a class="code" href="../../d3/d8/client_8c.html#a45">ReleaseDC</a>(hSKWnd,hDC);
00589 
00590     <span class="comment">// Unlock hSKC1Ctxt</span>
00591     GlobalUnlock(hSKC1Ctxt);
00592 
00593     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00594 }
00595 
00596 
00597 <span class="comment">/**********************************************************************\</span>
00598 <span class="comment">* SKC1DrawDragBorder() -- Draw Drag Border</span>
00599 <span class="comment">*</span>
00600 <span class="comment">\**********************************************************************/</span>
<a name="l00601"></a><a class="code" href="../../d7/d9/softkbd_8h.html#a148">00601</a> <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a> <a class="code" href="../../d7/d9/softkbd_8h.html#a148">SKC1DrawDragBorder</a>(
00602     HWND    hWnd,               <span class="comment">// window is dragged</span>
00603     LPPOINT lpptCursor,         <span class="comment">// the cursor position</span>
00604     LPPOINT lpptOffset)         <span class="comment">// the offset form cursor to window org</span>
00605 {
00606     HDC     hDC;
00607     RECT    rcWnd, rcWorkArea;
00608     <span class="keywordtype">int</span>     cxBorder, cyBorder;
00609     <span class="keywordtype">int</span>     x, y;
00610     <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="../../d6/d9/softkbd_8c.html#a3">GetAllMonitorSize</a>(LPRECT lprc);
00611 
00612     <span class="comment">// get rectangle of work area</span>
00613     <a class="code" href="../../d6/d9/softkbd_8c.html#a3">GetAllMonitorSize</a>(&amp;rcWorkArea);
00614 
00615     cxBorder = <a class="code" href="../../d3/d9/client_2wow_8c.html#a16">GetSystemMetrics</a>(SM_CXBORDER);   <span class="comment">// width of border</span>
00616     cyBorder = <a class="code" href="../../d3/d9/client_2wow_8c.html#a16">GetSystemMetrics</a>(SM_CYBORDER);   <span class="comment">// height of border</span>
00617 
00618     <span class="comment">// create DISPLAY dc to draw track</span>
00619     hDC = CreateDC(<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"DISPLAY"</span>, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00620     SelectObject(hDC, GetStockObject(GRAY_BRUSH));
00621 
00622     <span class="comment">// start point (left,top)</span>
00623     x = lpptCursor-&gt;x - lpptOffset-&gt;x;
00624     y = lpptCursor-&gt;y - lpptOffset-&gt;y;
00625 
00626     <span class="comment">// check for the min boundary of the display</span>
00627     <span class="keywordflow">if</span> (x &lt; rcWorkArea.left) {
00628         x = rcWorkArea.left;
00629     }
00630 
00631     <span class="keywordflow">if</span> (y &lt; rcWorkArea.top) {
00632         y = rcWorkArea.top;
00633     }
00634 
00635     <span class="comment">// check for the max boundary of the display</span>
00636     <a class="code" href="../../d3/d9/client_2wow_8c.html#a26">GetWindowRect</a>(<a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a29">hWnd</a>, &amp;rcWnd);
00637 
00638     <span class="keywordflow">if</span> (x + rcWnd.right - rcWnd.left &gt; rcWorkArea.right) {
00639         x = rcWorkArea.right - (rcWnd.right - rcWnd.left);
00640     }
00641 
00642     <span class="keywordflow">if</span> (y + rcWnd.bottom - rcWnd.top &gt; rcWorkArea.bottom) {
00643         y = rcWorkArea.bottom - (rcWnd.bottom - rcWnd.top);
00644     }
00645 
00646     <span class="comment">// adjust Offset</span>
00647     lpptOffset-&gt;x = lpptCursor-&gt;x - x;
00648     lpptOffset-&gt;y = lpptCursor-&gt;y - y;
00649 
00650     <span class="comment">// draw rectangle</span>
00651     PatBlt(hDC, x, y, rcWnd.right - rcWnd.left - cxBorder, cyBorder, PATINVERT);
00652     PatBlt(hDC, x, y + cyBorder, cxBorder, rcWnd.bottom - rcWnd.top - cyBorder, PATINVERT);
00653     PatBlt(hDC, x + cxBorder, y + rcWnd.bottom - rcWnd.top, rcWnd.right -
00654            rcWnd.left - cxBorder, -cyBorder, PATINVERT);
00655     PatBlt(hDC, x + rcWnd.right - rcWnd.left, y, - cxBorder, rcWnd.bottom -
00656            rcWnd.top - cyBorder, PATINVERT);
00657 
00658     <span class="comment">// delete DISPLAY DC</span>
00659     DeleteDC(hDC);
00660 
00661     <span class="keywordflow">return</span>;
00662 }
00663 
00664 
00665 <span class="comment">/**********************************************************************\</span>
00666 <span class="comment">* SKC1MousePosition() -- judge the cursor position</span>
00667 <span class="comment">*</span>
00668 <span class="comment">\**********************************************************************/</span>
00669 
<a name="l00670"></a><a class="code" href="../../d5/d8/sftkbdc1_8c.html#a0">00670</a> <span class="preprocessor">#define CHECK_RECT(name)  \</span>
00671 <span class="preprocessor">    if (ImmPtInRect(gptButtonPos[name ## _TYPE_C1].x,   \</span>
00672 <span class="preprocessor">            gptButtonPos[name ## _TYPE_C1].y,           \</span>
00673 <span class="preprocessor">            W_ ## name ## _C1 + 2 * BORDER_C1,          \</span>
00674 <span class="preprocessor">            H_ ## name ## _C1 + 2 * BORDER_C1,          \</span>
00675 <span class="preprocessor">            lpptCursor)) {                              \</span>
00676 <span class="preprocessor">        return name ## _TYPE_C1;                        \</span>
00677 <span class="preprocessor">    }</span>
00678 <span class="preprocessor"></span>
<a name="l00679"></a><a class="code" href="../../d5/d8/sftkbdc1_8c.html#a15">00679</a> <a class="code" href="../../d9/d5/ndismain_8h.html#a263">INT</a> <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a15">SKC1MousePosition</a>(
00680     LPPOINT lpptCursor)
00681 {
00682     <span class="keywordtype">int</span>   i;
00683 
00684     <span class="comment">// letter buttons</span>
00685     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../d7/d9/softkbd_8h.html#a101">LETTER_NUM_C1</a>; i++){
00686 
00687        <span class="keywordflow">if</span> (<a class="code" href="../../d5/d0/w32_2ntuser_2imm_2misc_8c.html#a35">ImmPtInRect</a>(<a class="code" href="../../d5/d8/sftkbdc1_8c.html#a2">gptButtonPos</a>[i].x,
00688                 <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a2">gptButtonPos</a>[i].y,
00689                 <a class="code" href="../../d7/d9/softkbd_8h.html#a73">W_LETTER_BTN_C1</a>,
00690                 <a class="code" href="../../d7/d9/softkbd_8h.html#a74">H_LETTER_BTN_C1</a>,
00691                 lpptCursor)) {
00692            <span class="keywordflow">return</span> i;
00693        }
00694     }
00695 
00696     <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a0">CHECK_RECT</a>(BACKSP);
00697     <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a0">CHECK_RECT</a>(TAB);
00698     <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a0">CHECK_RECT</a>(CAPS);
00699     <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a0">CHECK_RECT</a>(<a class="code" href="../../d7/d4/trace_8h.html#a0">ENTER</a>);
00700     <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a0">CHECK_RECT</a>(<a class="code" href="../../d2/d9/uipriv_8c.html#a0">SHIFT</a>);
00701     <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a0">CHECK_RECT</a>(ESC);
00702     <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a0">CHECK_RECT</a>(<a class="code" href="../../d9/d7/udf_8h.html#a27">SPACE</a>);
00703     <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a0">CHECK_RECT</a>(INS);
00704     <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a0">CHECK_RECT</a>(DEL);
00705 
00706     <span class="keywordflow">return</span> -1;
00707 }
00708 
00709 <span class="preprocessor">#undef CHECK_RECT</span>
00710 <span class="preprocessor"></span>
00711 
00712 <span class="comment">/**********************************************************************\</span>
00713 <span class="comment">* SKC1ButtonDown</span>
00714 <span class="comment">*</span>
00715 <span class="comment">\**********************************************************************/</span>
<a name="l00716"></a><a class="code" href="../../d5/d8/sftkbdc1_8c.html#a16">00716</a> <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a> <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a16">SKC1ButtonDown</a>(
00717     HWND      hSKWnd,
00718     <a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html">PSKC1CTXT</a> pSKC1Ctxt)
00719 {
00720     <span class="comment">// capture the mouse activity</span>
00721     <a class="code" href="../../d3/d0/user32_8def.html#a44">SetCapture</a>(hSKWnd);
00722 
00723     <span class="comment">// in drag area</span>
00724     <span class="keywordflow">if</span> (pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o5">uKeyIndex</a> == -1) {
00725        pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o2">uState</a> |= <a class="code" href="../../d7/d9/softkbd_8h.html#a125">FLAG_DRAG_C1</a>;
00726 
00727        <a class="code" href="../../d7/d9/softkbd_8h.html#a148">SKC1DrawDragBorder</a>(hSKWnd, &amp;pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o6">ptSkCursor</a>, &amp;pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o7">ptSkOffset</a>);
00728     } <span class="keywordflow">else</span> {
00729        <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> uVirtKey = 0xff;
00730        <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> bRet = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00731 
00732        <span class="keywordflow">if</span> (pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o5">uKeyIndex</a> == <a class="code" href="../../d7/d9/softkbd_8h.html#a110">SHIFT_TYPE_C1</a>) {
00733           <span class="keywordflow">if</span> (!(pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o2">uState</a> &amp; <a class="code" href="../../d7/d9/softkbd_8h.html#a124">FLAG_SHIFT_C1</a>)) {
00734              bRet = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00735           }
00736        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o5">uKeyIndex</a> &lt; <a class="code" href="../../d7/d9/softkbd_8h.html#a101">LETTER_NUM_C1</a>) {
00737           <span class="keywordflow">if</span> (pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o2">uState</a> &amp; <a class="code" href="../../d7/d9/softkbd_8h.html#a124">FLAG_SHIFT_C1</a>) {
00738              uVirtKey = pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o0">wShiftCode</a>[pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o5">uKeyIndex</a>];
00739           }
00740           <span class="keywordflow">else</span> {
00741              uVirtKey = pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o1">wNonShiftCode</a>[pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o5">uKeyIndex</a>];
00742           }
00743 
00744           <span class="keywordflow">if</span> (uVirtKey) {
00745              bRet = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00746           } <span class="keywordflow">else</span> {
00747              <a class="code" href="../../d3/d8/client_8c.html#a110">MessageBeep</a>(0xFFFFFFFF);
00748              pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o5">uKeyIndex</a> = -1;
00749           }
00750        } <span class="keywordflow">else</span> {
00751           bRet = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00752        }
00753 
00754        <span class="keywordflow">if</span> (bRet) {
00755           HDC      hDC, hMemDC;
00756           HBITMAP  hOldBmp;
00757 
00758           hDC = <a class="code" href="../../d3/d4/w32_2ntuser_2client_2nt6_2pch_8h.html#a1">GetDC</a>(hSKWnd);
00759           hMemDC = CreateCompatibleDC(hDC);
00760           hOldBmp = SelectObject(hMemDC, pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o3">hSoftkbd</a>);
00761 
00762           <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a6">SKC1InvertButton</a>(hDC, pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o5">uKeyIndex</a>);
00763           <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a6">SKC1InvertButton</a>(hMemDC, pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o5">uKeyIndex</a>);
00764 
00765           SelectObject(hMemDC, hOldBmp);
00766           DeleteDC(hMemDC);
00767           <a class="code" href="../../d3/d8/client_8c.html#a45">ReleaseDC</a>(hSKWnd,hDC);
00768        }
00769 
00770        <span class="keywordflow">if</span>(uVirtKey) {
00771           pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o2">uState</a> |= <a class="code" href="../../d7/d9/softkbd_8h.html#a126">FLAG_FOCUS_C1</a>;
00772        }
00773     }
00774 
00775     <span class="keywordflow">return</span>;
00776 }
00777 
00778 
00779 <span class="comment">/**********************************************************************\</span>
00780 <span class="comment">* SKC1SetCursor</span>
00781 <span class="comment">*</span>
00782 <span class="comment">\**********************************************************************/</span>
<a name="l00783"></a><a class="code" href="../../d5/d8/sftkbdc1_8c.html#a17">00783</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a17">SKC1SetCursor</a>(
00784    HWND   hSKWnd,
00785    LPARAM lParam)
00786 {
00787     HGLOBAL   hSKC1Ctxt;
00788     <a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html">PSKC1CTXT</a> pSKC1Ctxt;
00789     POINT     ptSkCursor, ptSkOffset;
00790     <span class="keywordtype">int</span>       uKeyIndex;
00791 
00792     <span class="comment">// Get and lock hSKC1Ctxt</span>
00793     hSKC1Ctxt = (HGLOBAL)<a class="code" href="../../d5/d9/cltxt_8h.html#a11">GetWindowLongPtr</a>(hSKWnd, <a class="code" href="../../d7/d9/softkbd_8h.html#a123">SKC1_CONTEXT</a>);
00794     <span class="keywordflow">if</span> (!hSKC1Ctxt) {
00795         <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00796     }
00797 
00798     pSKC1Ctxt = (<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html">PSKC1CTXT</a>)GlobalLock(hSKC1Ctxt);
00799     <span class="keywordflow">if</span> (!pSKC1Ctxt) {
00800         <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00801     }
00802 
00803     <span class="keywordflow">if</span> (pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o2">uState</a> &amp; <a class="code" href="../../d7/d9/softkbd_8h.html#a125">FLAG_DRAG_C1</a>){
00804         <span class="comment">// in drag operation</span>
00805         <a class="code" href="../../d3/d0/user32_8def.html#a65">SetCursor</a>(LoadCursor(<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, IDC_SIZEALL));
00806         GlobalUnlock(hSKC1Ctxt);
00807         <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00808     }
00809 
00810     <a class="code" href="../../d3/d9/client_2wow_8c.html#a25">GetCursorPos</a>(&amp;ptSkCursor);
00811     ptSkOffset = ptSkCursor;
00812     <a class="code" href="../../d3/d9/client_2wow_8c.html#a27">ScreenToClient</a>(hSKWnd, &amp;ptSkOffset);
00813 
00814     uKeyIndex = <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a15">SKC1MousePosition</a>(&amp;ptSkOffset);
00815 
00816     <span class="keywordflow">if</span> (uKeyIndex != -1) {
00817        <a class="code" href="../../d3/d0/user32_8def.html#a65">SetCursor</a>(LoadCursor(<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, IDC_HAND));
00818     } <span class="keywordflow">else</span> {
00819        <a class="code" href="../../d3/d0/user32_8def.html#a65">SetCursor</a>(LoadCursor(<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, IDC_SIZEALL));
00820     }
00821 
00822     <span class="keywordflow">if</span> (HIWORD(lParam) != WM_LBUTTONDOWN){
00823        <span class="comment">// unlock hSKC1Ctxt</span>
00824        GlobalUnlock(hSKC1Ctxt);
00825        <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00826     }
00827 
00828     pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o6">ptSkCursor</a> = ptSkCursor;
00829     pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o7">ptSkOffset</a> = ptSkOffset;
00830     pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o5">uKeyIndex</a> = uKeyIndex;
00831 
00832     <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a16">SKC1ButtonDown</a>(hSKWnd, pSKC1Ctxt);
00833 
00834     <span class="comment">// unlock hSKC1Ctxt</span>
00835     GlobalUnlock(hSKC1Ctxt);
00836     <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00837 }
00838 
00839 
00840 <span class="comment">/**********************************************************************\</span>
00841 <span class="comment">* SKC1MouseMove</span>
00842 <span class="comment">*</span>
00843 <span class="comment">\**********************************************************************/</span>
<a name="l00844"></a><a class="code" href="../../d5/d8/sftkbdc1_8c.html#a18">00844</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a18">SKC1MouseMove</a>(
00845     HWND   hSKWnd,
00846     WPARAM wParam,
00847     LPARAM lParam)
00848 {
00849     HGLOBAL   hSKC1Ctxt;
00850     <a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html">PSKC1CTXT</a> pSKC1Ctxt;
00851 
00852     UNREFERENCED_PARAMETER(wParam);
00853     UNREFERENCED_PARAMETER(lParam);
00854 
00855     <span class="comment">// get and lock hSKC1Ctxt</span>
00856     hSKC1Ctxt = (HGLOBAL)<a class="code" href="../../d5/d9/cltxt_8h.html#a11">GetWindowLongPtr</a>(hSKWnd, <a class="code" href="../../d7/d9/softkbd_8h.html#a123">SKC1_CONTEXT</a>);
00857     <span class="keywordflow">if</span> (!hSKC1Ctxt) {
00858        <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00859     }
00860 
00861     pSKC1Ctxt = (<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html">PSKC1CTXT</a>)GlobalLock(hSKC1Ctxt);
00862     <span class="keywordflow">if</span> (!pSKC1Ctxt) {
00863        <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00864     }
00865 
00866     <span class="keywordflow">if</span> (pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o2">uState</a> &amp; <a class="code" href="../../d7/d9/softkbd_8h.html#a125">FLAG_DRAG_C1</a>) {
00867        <a class="code" href="../../d7/d9/softkbd_8h.html#a148">SKC1DrawDragBorder</a>(hSKWnd, &amp;pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o6">ptSkCursor</a>,
00868                           &amp;pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o7">ptSkOffset</a>);
00869 
00870        <a class="code" href="../../d3/d9/client_2wow_8c.html#a25">GetCursorPos</a>(&amp;pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o6">ptSkCursor</a>);
00871 
00872        <a class="code" href="../../d7/d9/softkbd_8h.html#a148">SKC1DrawDragBorder</a>(hSKWnd, &amp;pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o6">ptSkCursor</a>,
00873                           &amp;pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o7">ptSkOffset</a>);
00874     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o5">uKeyIndex</a> != -1) {
00875        HDC      hDC, hMemDC;
00876        HBITMAP  hOldBmp;
00877        POINT    ptSkOffset;
00878        <span class="keywordtype">int</span>      uKeyIndex;
00879 
00880        <a class="code" href="../../d3/d9/client_2wow_8c.html#a25">GetCursorPos</a>(&amp;ptSkOffset);
00881        <a class="code" href="../../d3/d9/client_2wow_8c.html#a27">ScreenToClient</a>(hSKWnd, &amp;ptSkOffset);
00882        uKeyIndex = <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a15">SKC1MousePosition</a>(&amp;ptSkOffset);
00883 
00884        hDC = <a class="code" href="../../d3/d4/w32_2ntuser_2client_2nt6_2pch_8h.html#a1">GetDC</a>(hSKWnd);
00885        hMemDC = CreateCompatibleDC(hDC);
00886        hOldBmp = SelectObject(hMemDC, pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o3">hSoftkbd</a>);
00887 
00888        <span class="keywordflow">if</span> (((pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o2">uState</a> &amp; <a class="code" href="../../d7/d9/softkbd_8h.html#a126">FLAG_FOCUS_C1</a>) &amp;&amp; (uKeyIndex != pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o5">uKeyIndex</a>)) ||
00889            (!(pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o2">uState</a> &amp; <a class="code" href="../../d7/d9/softkbd_8h.html#a126">FLAG_FOCUS_C1</a>) &amp;&amp; (uKeyIndex == pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o5">uKeyIndex</a>))) {
00890           <span class="keywordflow">if</span> ((pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o5">uKeyIndex</a> != <a class="code" href="../../d7/d9/softkbd_8h.html#a110">SHIFT_TYPE_C1</a>) ||
00891               !(pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o2">uState</a> &amp; <a class="code" href="../../d7/d9/softkbd_8h.html#a124">FLAG_SHIFT_C1</a>)) {
00892              <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a6">SKC1InvertButton</a>(hDC, pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o5">uKeyIndex</a>);
00893              <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a6">SKC1InvertButton</a>(hMemDC, pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o5">uKeyIndex</a>);
00894           }
00895           pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o2">uState</a> ^= <a class="code" href="../../d7/d9/softkbd_8h.html#a126">FLAG_FOCUS_C1</a>;
00896        }
00897 
00898        SelectObject(hMemDC, hOldBmp);
00899        DeleteDC(hMemDC);
00900        <a class="code" href="../../d3/d8/client_8c.html#a45">ReleaseDC</a>(hSKWnd,hDC);
00901     }
00902 
00903     <span class="comment">// unlock hSKC1Ctxt</span>
00904     GlobalUnlock(hSKC1Ctxt);
00905 
00906     <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00907 }
00908 
00909 
00910 <span class="comment">/**********************************************************************\</span>
00911 <span class="comment">* SKC1ButtonUp</span>
00912 <span class="comment">*</span>
00913 <span class="comment">\**********************************************************************/</span>
<a name="l00914"></a><a class="code" href="../../d5/d8/sftkbdc1_8c.html#a19">00914</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a19">SKC1ButtonUp</a>(
00915     HWND       hSKWnd,
00916     WPARAM     wParam,
00917     LPARAM     lParam)
00918 {
00919     HGLOBAL   hSKC1Ctxt;
00920     <a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html">PSKC1CTXT</a> pSKC1Ctxt;
00921     POINT     pt;
00922     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>      uVirtKey;
00923     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>      bRet = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00924 
00925     UNREFERENCED_PARAMETER(wParam);
00926     UNREFERENCED_PARAMETER(lParam);
00927 
00928     <span class="comment">// Get and lock hSKC1Ctxt</span>
00929     hSKC1Ctxt = (HGLOBAL)<a class="code" href="../../d5/d9/cltxt_8h.html#a11">GetWindowLongPtr</a>(hSKWnd, <a class="code" href="../../d7/d9/softkbd_8h.html#a123">SKC1_CONTEXT</a>);
00930     <span class="keywordflow">if</span> (!hSKC1Ctxt) {
00931         <span class="keywordflow">return</span> (bRet);
00932     }
00933 
00934     pSKC1Ctxt = (<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html">PSKC1CTXT</a>)GlobalLock(hSKC1Ctxt);
00935     <span class="keywordflow">if</span> (!pSKC1Ctxt) {
00936         <span class="keywordflow">return</span> (bRet);
00937     }
00938 
00939     <a class="code" href="../../d3/d8/client_8c.html#a124">ReleaseCapture</a>();
00940 
00941     <span class="keywordflow">if</span> (pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o2">uState</a> &amp; <a class="code" href="../../d7/d9/softkbd_8h.html#a125">FLAG_DRAG_C1</a>) {
00942        pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o2">uState</a> &amp;= ~(<a class="code" href="../../d7/d9/softkbd_8h.html#a125">FLAG_DRAG_C1</a>);
00943 
00944        <a class="code" href="../../d7/d9/softkbd_8h.html#a148">SKC1DrawDragBorder</a>(hSKWnd, &amp;pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o6">ptSkCursor</a>, &amp;pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o7">ptSkOffset</a>);
00945 
00946        pt.x = pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o6">ptSkCursor</a>.x - pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o7">ptSkOffset</a>.x;
00947        pt.y = pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o6">ptSkCursor</a>.y - pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o7">ptSkOffset</a>.y;
00948 
00949        <a class="code" href="../../d3/d4/w32_2ntuser_2client_2nt6_2pch_8h.html#a0">SetWindowPos</a>(hSKWnd, (HWND)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, pt.x, pt.y,
00950                      0, 0, SWP_NOACTIVATE|SWP_NOSIZE|SWP_NOZORDER);
00951 
00952        <span class="comment">// update IMC</span>
00953        bRet = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00954        {
00955           HWND          hUIWnd;
00956           HIMC          hImc;
00957           PINPUTCONTEXT pInputContext;
00958 
00959           hUIWnd = <a class="code" href="../../d3/d9/client_2wow_8c.html#a12">GetWindow</a>(hSKWnd, GW_OWNER);
00960           hImc = (HIMC)<a class="code" href="../../d5/d9/cltxt_8h.html#a11">GetWindowLongPtr</a>(hUIWnd, IMMGWLP_IMC);
00961           <span class="keywordflow">if</span> (hImc) {
00962              pInputContext = <a class="code" href="../../d5/d0/w32_2ntuser_2imm_2misc_8c.html#a12">ImmLockIMC</a>(hImc);
00963              <span class="keywordflow">if</span> (pInputContext) {
00964                 pInputContext-&gt;ptSoftKbdPos = pt;
00965                 pInputContext-&gt;fdwInit |= INIT_SOFTKBDPOS;
00966                 <a class="code" href="../../d5/d0/w32_2ntuser_2imm_2misc_8c.html#a13">ImmUnlockIMC</a>(hImc);
00967              }
00968           }
00969        }
00970     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o5">uKeyIndex</a> != -1) {
00971        <span class="keywordflow">if</span> (pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o2">uState</a> &amp; <a class="code" href="../../d7/d9/softkbd_8h.html#a126">FLAG_FOCUS_C1</a>) {
00972           <span class="keywordflow">if</span> (pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o5">uKeyIndex</a> == <a class="code" href="../../d7/d9/softkbd_8h.html#a110">SHIFT_TYPE_C1</a>) {
00973              <span class="keywordflow">if</span> (pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o2">uState</a> &amp; <a class="code" href="../../d7/d9/softkbd_8h.html#a124">FLAG_SHIFT_C1</a>) {
00974                 bRet = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00975              } <span class="keywordflow">else</span> {
00976                 pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o2">uState</a> |= <a class="code" href="../../d7/d9/softkbd_8h.html#a124">FLAG_SHIFT_C1</a>;
00977              }
00978           } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o5">uKeyIndex</a> &lt; <a class="code" href="../../d7/d9/softkbd_8h.html#a101">LETTER_NUM_C1</a>) &amp;&amp;
00979                      (pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o2">uState</a> &amp; <a class="code" href="../../d7/d9/softkbd_8h.html#a124">FLAG_SHIFT_C1</a>)) {
00980                 <a class="code" href="../../d8/d9/client_2ntstubs_8c.html#a34">keybd_event</a>((<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)VK_SHIFT, (<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)<a class="code" href="../../d2/d6/ntuser_2imm_2globals_8c.html#a10">guScanCode</a>[VK_SHIFT],
00981                             0, 0);
00982                 uVirtKey = <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a1">SKC1VirtKey</a>[pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o5">uKeyIndex</a>];
00983                 <a class="code" href="../../d8/d9/client_2ntstubs_8c.html#a34">keybd_event</a>((<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)uVirtKey, (<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)<a class="code" href="../../d2/d6/ntuser_2imm_2globals_8c.html#a10">guScanCode</a>[uVirtKey],
00984                            0, 0);
00985                 <a class="code" href="../../d8/d9/client_2ntstubs_8c.html#a34">keybd_event</a>((<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)uVirtKey, (<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)<a class="code" href="../../d2/d6/ntuser_2imm_2globals_8c.html#a10">guScanCode</a>[uVirtKey],
00986                            (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)KEYEVENTF_KEYUP, 0);
00987                 <a class="code" href="../../d8/d9/client_2ntstubs_8c.html#a34">keybd_event</a>((<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)VK_SHIFT, (<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)<a class="code" href="../../d2/d6/ntuser_2imm_2globals_8c.html#a10">guScanCode</a>[VK_SHIFT],
00988                             (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)KEYEVENTF_KEYUP, 0);
00989                 bRet = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00990           } <span class="keywordflow">else</span> {
00991                 uVirtKey = <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a1">SKC1VirtKey</a>[pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o5">uKeyIndex</a>];
00992                 <a class="code" href="../../d8/d9/client_2ntstubs_8c.html#a34">keybd_event</a>((<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)uVirtKey, (<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)<a class="code" href="../../d2/d6/ntuser_2imm_2globals_8c.html#a10">guScanCode</a>[uVirtKey],
00993                          0, 0);
00994                 <a class="code" href="../../d8/d9/client_2ntstubs_8c.html#a34">keybd_event</a>((<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)uVirtKey, (<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)<a class="code" href="../../d2/d6/ntuser_2imm_2globals_8c.html#a10">guScanCode</a>[uVirtKey],
00995                          (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)KEYEVENTF_KEYUP, 0);
00996                 bRet = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00997           }
00998 
00999           <span class="keywordflow">if</span> (bRet){
01000              HDC      hDC, hMemDC;
01001              HBITMAP  hOldBmp;
01002 
01003              hDC = <a class="code" href="../../d3/d4/w32_2ntuser_2client_2nt6_2pch_8h.html#a1">GetDC</a>(hSKWnd);
01004              hMemDC = CreateCompatibleDC(hDC);
01005              hOldBmp = SelectObject(hMemDC, pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o3">hSoftkbd</a>);
01006 
01007              <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a6">SKC1InvertButton</a>(hDC, pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o5">uKeyIndex</a>);
01008              <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a6">SKC1InvertButton</a>(hMemDC, pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o5">uKeyIndex</a>);
01009 
01010              <span class="keywordflow">if</span> ((pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o5">uKeyIndex</a> != <a class="code" href="../../d7/d9/softkbd_8h.html#a110">SHIFT_TYPE_C1</a>) &amp;&amp;
01011                  (pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o5">uKeyIndex</a> &lt; <a class="code" href="../../d7/d9/softkbd_8h.html#a101">LETTER_NUM_C1</a>) &amp;&amp;
01012                  (pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o2">uState</a> &amp; <a class="code" href="../../d7/d9/softkbd_8h.html#a124">FLAG_SHIFT_C1</a>)) {
01013                 <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a6">SKC1InvertButton</a>(hDC, <a class="code" href="../../d7/d9/softkbd_8h.html#a110">SHIFT_TYPE_C1</a>);
01014                 <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a6">SKC1InvertButton</a>(hMemDC, <a class="code" href="../../d7/d9/softkbd_8h.html#a110">SHIFT_TYPE_C1</a>);
01015              }
01016 
01017              <span class="keywordflow">if</span> ((pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o5">uKeyIndex</a> &lt; <a class="code" href="../../d7/d9/softkbd_8h.html#a101">LETTER_NUM_C1</a>) ||
01018                  (pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o5">uKeyIndex</a> == <a class="code" href="../../d7/d9/softkbd_8h.html#a110">SHIFT_TYPE_C1</a>)) {
01019                 pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o2">uState</a> &amp;= ~(<a class="code" href="../../d7/d9/softkbd_8h.html#a124">FLAG_SHIFT_C1</a>);
01020              }
01021 
01022              SelectObject(hMemDC, hOldBmp);
01023              DeleteDC(hMemDC);
01024              <a class="code" href="../../d3/d8/client_8c.html#a45">ReleaseDC</a>(hSKWnd,hDC);
01025           }
01026           pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o2">uState</a> &amp;= ~ (<a class="code" href="../../d7/d9/softkbd_8h.html#a126">FLAG_FOCUS_C1</a>);
01027        }
01028        pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o5">uKeyIndex</a> = -1;
01029     }
01030 
01031     <span class="comment">// unlock hSKC1Ctxt</span>
01032     GlobalUnlock(hSKC1Ctxt);
01033 
01034     <span class="keywordflow">return</span> (bRet);
01035 }
01036 
01037 
01038 <span class="comment">/**********************************************************************\</span>
01039 <span class="comment">* SKWndProcC1 -- softkeyboard window procedure</span>
01040 <span class="comment">*</span>
01041 <span class="comment">\**********************************************************************/</span>
<a name="l01042"></a><a class="code" href="../../d7/d9/softkbd_8h.html#a147">01042</a> LRESULT <a class="code" href="../../d7/d9/softkbd_8h.html#a147">SKWndProcC1</a>(
01043     HWND   hSKWnd,
01044     UINT   uMsg,
01045     WPARAM wParam,
01046     LPARAM lParam)
01047 {
01048     LRESULT    lRet = 0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>;
01049 
01050     <span class="keywordflow">switch</span> (uMsg) {
01051        <span class="keywordflow">case</span> WM_CREATE:
01052             lRet = <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a10">CreateC1Window</a>(hSKWnd);
01053             <span class="keywordflow">break</span>;
01054 
01055        <span class="keywordflow">case</span> WM_DESTROY:
01056             <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a11">DestroyC1Window</a>(hSKWnd);
01057             <span class="keywordflow">break</span>;
01058 
01059        <span class="keywordflow">case</span> WM_PAINT:
01060             {
01061                HDC         hDC;
01062                PAINTSTRUCT ps;
01063 
01064                hDC = <a class="code" href="../../d3/d0/user32_8def.html#a41">BeginPaint</a>(hSKWnd, &amp;ps);
01065                <a class="code" href="../../d5/d8/sftkbdc1_8c.html#a12">ShowSKC1Window</a>(hDC, hSKWnd);
01066                EndPaint(hSKWnd, &amp;ps);
01067             }
01068             <span class="keywordflow">break</span>;
01069 
01070        <span class="keywordflow">case</span> WM_MOUSEACTIVATE:
01071             lRet = MA_NOACTIVATE;
01072             <span class="keywordflow">break</span>;
01073 
01074        <span class="keywordflow">case</span> WM_SETCURSOR:
01075             <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d8/sftkbdc1_8c.html#a17">SKC1SetCursor</a>(hSKWnd, lParam)) {
01076                lRet = <a class="code" href="../../d5/d9/cltxt_8h.html#a15">DefWindowProc</a>(hSKWnd, uMsg, wParam, lParam);
01077             }
01078             <span class="keywordflow">break</span>;
01079 
01080        <span class="keywordflow">case</span> WM_MOUSEMOVE:
01081             <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d8/sftkbdc1_8c.html#a18">SKC1MouseMove</a>(hSKWnd, wParam, lParam)) {
01082                lRet = <a class="code" href="../../d5/d9/cltxt_8h.html#a15">DefWindowProc</a>(hSKWnd, uMsg, wParam, lParam);
01083             }
01084             <span class="keywordflow">break</span>;
01085 
01086        <span class="keywordflow">case</span> WM_LBUTTONUP:
01087             <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d8/sftkbdc1_8c.html#a19">SKC1ButtonUp</a>(hSKWnd, wParam, lParam)) {
01088                lRet = <a class="code" href="../../d5/d9/cltxt_8h.html#a15">DefWindowProc</a>(hSKWnd, uMsg, wParam, lParam);
01089             }
01090             <span class="keywordflow">break</span>;
01091 
01092        <span class="keywordflow">case</span> WM_IME_CONTROL:
01093             <span class="keywordflow">switch</span> (wParam) {
01094                <span class="keywordflow">case</span> IMC_GETSOFTKBDFONT:
01095                     {
01096                        HDC        hDC;
01097                        LOGFONT    lfFont;
01098 
01099                        hDC = <a class="code" href="../../d3/d4/w32_2ntuser_2client_2nt6_2pch_8h.html#a1">GetDC</a>(hSKWnd);
01100                        GetObject(GetStockObject(DEFAULT_GUI_FONT),
01101                                  <span class="keyword">sizeof</span>(lfFont), &amp;lfFont);
01102                        <a class="code" href="../../d3/d8/client_8c.html#a45">ReleaseDC</a>(hSKWnd, hDC);
01103                        *(LPLOGFONT)lParam = lfFont;
01104                     }
01105                     <span class="keywordflow">break</span>;
01106 
01107                <span class="keywordflow">case</span> IMC_SETSOFTKBDFONT:
01108                     {
01109                        LOGFONT lfFont;
01110 
01111                        GetObject(GetStockObject(DEFAULT_GUI_FONT),
01112                            <span class="keyword">sizeof</span>(lfFont), &amp;lfFont);
01113 
01114                        <span class="comment">// in differet version of Windows</span>
01115                        <span class="keywordflow">if</span> (lfFont.lfCharSet != ((LPLOGFONT)lParam)-&gt;lfCharSet) {
01116                            HGLOBAL    hSKC1Ctxt;
01117                            <a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html">LPSKC1CTXT</a> lpSKC1Ctxt;
01118 
01119                            hSKC1Ctxt = (HGLOBAL)<a class="code" href="../../d5/d9/cltxt_8h.html#a11">GetWindowLongPtr</a>(hSKWnd,
01120                                <a class="code" href="../../d7/d9/softkbd_8h.html#a123">SKC1_CONTEXT</a>);
01121                            <span class="keywordflow">if</span> (!hSKC1Ctxt) {
01122                                <span class="keywordflow">return</span> 1;
01123                            }
01124 
01125                            lpSKC1Ctxt = (<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html">LPSKC1CTXT</a>)GlobalLock(hSKC1Ctxt);
01126                            <span class="keywordflow">if</span> (!lpSKC1Ctxt) {
01127                                <span class="keywordflow">return</span> 1;
01128                            }
01129 
01130                            lpSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o8">lfCharSet</a> =
01131                                ((LPLOGFONT)lParam)-&gt;lfCharSet;
01132 
01133                            GlobalUnlock(hSKC1Ctxt);
01134                        }
01135                     }
01136                     <span class="keywordflow">break</span>;
01137 
01138                <span class="keywordflow">case</span> IMC_GETSOFTKBDPOS:
01139                     {
01140                        RECT rcWnd;
01141 
01142                        <a class="code" href="../../d3/d9/client_2wow_8c.html#a26">GetWindowRect</a>(hSKWnd, &amp;rcWnd);
01143 
01144                        <span class="keywordflow">return</span> MAKELRESULT(rcWnd.left, rcWnd.top);
01145                     }
01146                     <span class="keywordflow">break</span>;
01147 
01148                <span class="keywordflow">case</span> IMC_SETSOFTKBDPOS:
01149                     {
01150                        <a class="code" href="../../d3/d4/w32_2ntuser_2client_2nt6_2pch_8h.html#a0">SetWindowPos</a>(hSKWnd, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
01151                             ((LPPOINTS)lParam)-&gt;x, ((LPPOINTS)lParam)-&gt;y,
01152                             0, 0, SWP_NOACTIVATE|SWP_NOSIZE|SWP_NOZORDER);
01153                        <span class="keywordflow">return</span> (0);
01154                     }
01155                     <span class="keywordflow">break</span>;
01156 
01157                <span class="keywordflow">case</span> IMC_SETSOFTKBDDATA:
01158                     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d8/sftkbdc1_8c.html#a13">UpdateSKC1Window</a>(hSKWnd, (LPSOFTKBDDATA)lParam)) {
01159                        InvalidateRect(hSKWnd, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
01160                     } <span class="keywordflow">else</span> lRet = -1<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>;
01161                     <span class="keywordflow">break</span>;
01162 
01163                <span class="keywordflow">case</span> IMC_GETSOFTKBDSUBTYPE:
01164                <span class="keywordflow">case</span> IMC_SETSOFTKBDSUBTYPE:
01165                     {
01166                        HGLOBAL   hSKC1Ctxt;
01167                        <a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html">PSKC1CTXT</a> pSKC1Ctxt;
01168 
01169                        lRet = -1<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>;
01170 
01171                        hSKC1Ctxt = (HGLOBAL)<a class="code" href="../../d5/d9/cltxt_8h.html#a11">GetWindowLongPtr</a>(hSKWnd, <a class="code" href="../../d7/d9/softkbd_8h.html#a123">SKC1_CONTEXT</a>);
01172                        <span class="keywordflow">if</span> (!hSKC1Ctxt) <span class="keywordflow">break</span>;
01173 
01174                        pSKC1Ctxt = (<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html">PSKC1CTXT</a>)GlobalLock(hSKC1Ctxt);
01175                        <span class="keywordflow">if</span> (!pSKC1Ctxt) <span class="keywordflow">break</span>;
01176 
01177                        <span class="keywordflow">if</span> (wParam == IMC_GETSOFTKBDSUBTYPE) {
01178                           lRet = pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o4">uSubtype</a>;
01179                        } <span class="keywordflow">else</span> {
01180                           lRet = pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o4">uSubtype</a>;
01181                           pSKC1Ctxt-&gt;<a class="code" href="../../d5/d9/struct__tagSKC1CTXT.html#o4">uSubtype</a> = (<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)lParam;
01182                        }
01183 
01184                        GlobalUnlock(hSKC1Ctxt);
01185                     }
01186                     <span class="keywordflow">break</span>;
01187             }
01188             <span class="keywordflow">break</span>;
01189 
01190        <span class="keywordflow">default</span>:
01191             lRet = <a class="code" href="../../d5/d9/cltxt_8h.html#a15">DefWindowProc</a>(hSKWnd, uMsg, wParam, lParam);
01192     }
01193 
01194     <span class="keywordflow">return</span> (lRet);
01195 }
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:41:49 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
